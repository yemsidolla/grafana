{"version":3,"file":"836.js?_cache=f761d9106921fb42c0b4","mappings":"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","sources":["webpack://grafana-metricsdrilldown-app/./GmdVizPanel/components/EventConfigurePanel.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/components/ConfigurePanelAction.tsx","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/config/presets/types.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/config/promql-functions.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/config/getPreferredConfigForMetric.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/types/available-panel-types.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/config/panel-heights.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/config/presets/config-presets-ages.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/config/presets/config-presets-histograms.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/config/presets/config-presets-status-updown.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/config/presets/config-presets-timeseries.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/matchers/isCounterMetric.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/matchers/isHistogramMetric.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/matchers/isAgeMetric.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/matchers/isStatusUpDownMetric.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/components/EventPanelTypeChanged.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/components/SelectAction.tsx","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/config/query-resolutions.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/buildQueryExpression.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/units/getUnit.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/types/heatmap/buildHeatmapPanel.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/types/heatmap/getHeatmapQueryRunnerParams.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/types/percentiles/getPercentilesQueryRunnerParams.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/types/percentiles/buildPercentilesPanel.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/types/stat/getStatQueryRunnerParams.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/types/statushistory/value-mappings.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/types/stat/buildStatPanel.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/types/statushistory/buildStatushistoryPanel.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/types/statushistory/getStatushistoryQueryRunnerParams.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/transformations/addUnspecifiedLabel.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/behaviors/buildPrometheusQuery.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/behaviors/ExtremeValueFilterBehavior.tsx","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/types/timeseries/getTimeseriesQueryRunnerParams.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/types/timeseries/buildTimeseriesPanel.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/GmdVizPanel.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/LayoutSwitcher.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ShowMoreButton.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/events/EventSortByChanged.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/fetchers/fetchAlertingMetrics.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/fetchers/fetchDashboardMetrics.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/MetricUsageFetcher.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/MetricsSorter.tsx","webpack://grafana-metricsdrilldown-app/./MetricsDrilldownDataSourceVariable.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/helpers/areArraysEqual.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/MetricsVariable.ts","webpack://grafana-metricsdrilldown-app/./types/language-provider/versionCheck.ts","webpack://grafana-metricsdrilldown-app/./types/language-provider/v11-6-x.ts","webpack://grafana-metricsdrilldown-app/./types/language-provider/v12-0-0.ts","webpack://grafana-metricsdrilldown-app/./types/language-provider/v12-1-0-plus.ts","webpack://grafana-metricsdrilldown-app/./helpers/MetricDatasourceHelper.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/Labels/LabelsDataSource.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/Labels/LabelValuesVariable.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/Labels/LabelsVariable.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/custom-icons/GroupsIcon.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/EventMetricsVariableActivated.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/EventMetricsVariableDeactivated.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/EventMetricsVariableLoaded.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/withLifecycleEvents.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/GroupBy/MetricsWithLabelValue/MetricsWithLabelValueDataSource.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/helpers/isPrometheusRule.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/GroupBy/MetricsWithLabelValue/MetricsWithLabelValueVariable.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/GroupBy/MetricsGroupByRow.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/GroupBy/MetricsGroupByList.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/FilteredMetricsVariable.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/QuickSearch/CountsProvider/CountsProvider.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/QuickSearch/CountsProvider/MetricVariableCountsProvider.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/QuickSearch/EventQuickSearchChanged.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/QuickSearch/QuickSearch.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/ListControls.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/MetricsVariableFilterEngine.ts","webpack://grafana-metricsdrilldown-app/./RelatedMetricsScene/sortRelatedMetrics.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/MetricsVariableSortEngine.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/MetricsFilterSection/EventFiltersChanged.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/metricLabels.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/EventSectionValueChanged.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/MetricsFilterSection/CheckboxWithCount.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/MetricsFilterSection/CheckBoxList.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/MetricsFilterSection/MetricsFilterSection.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/computeMetricPrefixGroups.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/computeMetricSuffixGroups.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/computeRulesGroups.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/LabelsBrowser/LabelsList.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/LabelsBrowser/LabelsBrowser.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/Settings.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/SideBarButton.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/custom-icons/RulesIcon.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/SideBar.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsReducer.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/helpers/registerRuntimeDataSources.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsList/UsageData.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsList/WithUsageDataPreviewPanel.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsList/MetricsList.tsx","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/components/ConfigurePanelForm/EventApplyPanelConfig.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/components/ConfigurePanelForm/EventCancelConfigurePanel.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/config/percentiles-options.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/components/ConfigurePanelForm/WithConfigPanelOptions.tsx","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/components/ConfigurePanelForm/ConfigurePanelForm.tsx","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/config/presets/getConfigPresetsForMetric.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/matchers/getMetricType.ts","webpack://grafana-metricsdrilldown-app/./PluginInfo/PluginLogo.tsx","webpack://grafana-metricsdrilldown-app/./PluginInfo/PluginInfo.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SceneDrawer.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/GroupByVariable.tsx","webpack://grafana-metricsdrilldown-app/./services/variables.ts","webpack://grafana-metricsdrilldown-app/./constants/ui.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/components/GmdVizPanelVariantSelector.tsx","webpack://grafana-metricsdrilldown-app/./utils/utils.queries.ts","webpack://grafana-metricsdrilldown-app/./Menu/AddToExplorationsButton.tsx","webpack://grafana-metricsdrilldown-app/./Menu/PanelMenu.tsx","webpack://grafana-metricsdrilldown-app/./utils/utils.styles.ts","webpack://grafana-metricsdrilldown-app/./MetricGraphScene.tsx","webpack://grafana-metricsdrilldown-app/./RelatedMetricsScene/PrefixFilterDropdown.tsx","webpack://grafana-metricsdrilldown-app/./RelatedMetricsScene/RelatedListControls.tsx","webpack://grafana-metricsdrilldown-app/./RelatedMetricsScene/RelatedMetricsScene.tsx","webpack://grafana-metricsdrilldown-app/./ShareTrailButton.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/events/EventTimeseriesDataReceived.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/events/EventForceSyncYAxis.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/events/EventResetSyncYAxis.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/behaviors/syncYAxis.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/SelectLabelAction.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/behaviors/publishTimeseriesData.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/transformations/addRefId.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/transformations/sliceSeries.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/LabelVizPanel.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/MetricLabelsList.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/AddToFiltersGraphAction.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/getLabelValueFromDataFrame.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/SortBySelector.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/SceneByFrameRepeater.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/LabelValuesCountProvider.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/LabelValueVizPanel.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/MetricLabelValuesList.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/LabelBreakdownScene.tsx","webpack://grafana-metricsdrilldown-app/./MetricActionBar.tsx","webpack://grafana-metricsdrilldown-app/./TrailStore/useBookmarkState.ts","webpack://grafana-metricsdrilldown-app/./Integrations/logs/labelsCrossReference.ts","webpack://grafana-metricsdrilldown-app/./Integrations/logs/lokiRecordingRules.ts","webpack://grafana-metricsdrilldown-app/./RelatedLogs/RelatedLogsOrchestrator.ts","webpack://grafana-metricsdrilldown-app/./RelatedLogs/NoRelatedLogsFound.tsx","webpack://grafana-metricsdrilldown-app/./RelatedLogs/OpenInLogsDrilldownButton.tsx","webpack://grafana-metricsdrilldown-app/./RelatedLogs/RelatedLogsScene.tsx","webpack://grafana-metricsdrilldown-app/./MetricScene.tsx","webpack://grafana-metricsdrilldown-app/./DataTrailSettings.tsx","webpack://grafana-metricsdrilldown-app/./DataTrail.tsx","webpack://grafana-metricsdrilldown-app/./utils/utils.variables.ts","webpack://grafana-metricsdrilldown-app/./UserPreferences/pref-keys.ts","webpack://grafana-metricsdrilldown-app/./services/levels.ts","webpack://grafana-metricsdrilldown-app/./services/sorting.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/SectionTitle.tsx","webpack://grafana-metricsdrilldown-app/./App/useCatchExceptions.ts","webpack://grafana-metricsdrilldown-app/./shared.ts","webpack://grafana-metricsdrilldown-app/./TrailStore/TrailStore.ts","webpack://grafana-metricsdrilldown-app/./TrailStore/utils.tsx","webpack://grafana-metricsdrilldown-app/./UserPreferences/userStorage.ts","webpack://grafana-metricsdrilldown-app/./App/useTrail.tsx","webpack://grafana-metricsdrilldown-app/./App/ErrorView.tsx","webpack://grafana-metricsdrilldown-app/./interactions.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/helpers/displayStatus.ts","webpack://grafana-metricsdrilldown-app/./utils/utils.scopes.ts","webpack://grafana-metricsdrilldown-app/./utils.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/helpers/localCompare.ts","webpack://grafana-metricsdrilldown-app/./DataTrailCard.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/BookmarksList.tsx","webpack://grafana-metricsdrilldown-app/./App/InlineBanner.tsx","webpack://grafana-metricsdrilldown-app/./utils/utils.datasource.ts","webpack://grafana-metricsdrilldown-app/./App/Routes.tsx"],"sourcesContent":["import { BusEventWithPayload } from '@grafana/data';\n\ninterface EventConfigurePanelPayload {\n  metric: string;\n}\n\nexport class EventConfigurePanel extends BusEventWithPayload<EventConfigurePanelPayload> {\n  public static readonly type = 'configure-panel';\n}\n","import { css, cx } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { PREF_KEYS } from 'UserPreferences/pref-keys';\nimport { userStorage } from 'UserPreferences/userStorage';\n\nimport { EventConfigurePanel } from './EventConfigurePanel';\n\ninterface ConfigurePanelActionState extends SceneObjectState {\n  metric: string;\n  disabled: boolean;\n  isAlreadyConfigured: boolean;\n}\n\nexport class ConfigurePanelAction extends SceneObjectBase<ConfigurePanelActionState> {\n  constructor({\n    metric,\n    disabled,\n  }: {\n    metric: ConfigurePanelActionState['metric'];\n    disabled?: ConfigurePanelActionState['disabled'];\n  }) {\n    const userPrefs = userStorage.getItem(PREF_KEYS.METRIC_PREFS) || {};\n\n    super({\n      metric,\n      disabled: disabled !== undefined ? disabled : false,\n      isAlreadyConfigured: Boolean(userPrefs[metric]?.config),\n    });\n  }\n\n  public onClick = () => {\n    this.publishEvent(new EventConfigurePanel({ metric: this.state.metric }), true);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<ConfigurePanelAction>) => {\n    const styles = useStyles2(getStyles);\n    const { isAlreadyConfigured, disabled } = model.useState();\n\n    const label = isAlreadyConfigured ? 'Reconfigure Prometheus function' : 'Configure Prometheus function';\n\n    return (\n      <Button\n        className={cx(styles.selectButton, isAlreadyConfigured && styles.active)}\n        aria-label={label}\n        variant=\"secondary\"\n        size=\"sm\"\n        fill=\"text\"\n        onClick={model.onClick}\n        icon=\"cog\"\n        tooltip={label}\n        tooltipPlacement=\"top\"\n        disabled={disabled}\n        data-testid=\"configure-panel\"\n      />\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  selectButton: css`\n    margin: 0;\n    padding: 0;\n  `,\n  active: css`\n    color: ${theme.colors.text.maxContrast};\n  `,\n});\n","import { type PanelOptions, type QueryOptions } from 'GmdVizPanel/GmdVizPanel';\n\nexport const CONFIG_PRESETS = {\n  TIMESERIES_AVG: 'timeseries-avg',\n  TIMESERIES_SUM: 'timeseries-sum',\n  TIMESERIES_STDDEV: 'timeseries-stddev',\n  TIMESERIES_PERCENTILES: 'timeseries-percentiles',\n  TIMESERIES_MIN_MAX: 'timeseries-minmax',\n  TIMESERIES_AGE_TIME_MINUS_AVG: 'timeseries-age-time-minus-avg',\n  TIMESERIES_AGE_TIME_MINUS_MIN_MAX: 'timeseries-age-time-minus-min-max',\n  HISTOGRAM_HEATMAP: 'histogram-heatmap',\n  HISTOGRAM_PERCENTILES: 'histogram-percentiles',\n  STATUS_UPDOWN_HISTORY: 'status-updown-history',\n  STATUS_UPDOWN_STAT: 'status-updown-stat',\n} as const;\n\nexport type ConfigPresetId = (typeof CONFIG_PRESETS)[keyof typeof CONFIG_PRESETS];\n\nexport type PanelConfigPreset = {\n  id: ConfigPresetId;\n  name?: string;\n  panelOptions: PanelOptions;\n  queryOptions: QueryOptions;\n};\n","import { promql } from 'tsqtsq';\n\nconst PROMETHEUS_FUNCTIONS = [\n  // timeseries (rate and non-rate)\n  'avg',\n  'sum',\n  'stddev',\n  'quantile',\n  'min',\n  'max',\n  // histograms\n  'histogram_quantile',\n  // age\n  'time-avg(metric)',\n  'time-min(metric)',\n  'time-max(metric)',\n] as const;\n\nexport type PrometheusFunction = (typeof PROMETHEUS_FUNCTIONS)[number];\n\ntype MapEntry = {\n  name: PrometheusFunction;\n  fn: (args: any) => string;\n};\n\nexport const PROMQL_FUNCTIONS = new Map<PrometheusFunction, MapEntry>([\n  // methods exposed in the promql API\n  ...['avg', 'sum', 'stddev', 'quantile', 'min', 'max'].map(\n    (name) =>\n      [\n        name,\n        {\n          name,\n          fn: (args: any) => (promql as any)[name](args),\n        },\n      ] as [PrometheusFunction, MapEntry]\n  ),\n  // custom functions that we define ourselves\n  [\n    'histogram_quantile',\n    {\n      name: 'histogram_quantile',\n      // histogram_quantile is not available in the tsqtsq library\n      fn: ({ expr, parameter }: { expr: string; parameter: number }) => `histogram_quantile(${parameter},${expr})`,\n    },\n  ],\n  [\n    'time-avg(metric)',\n    {\n      name: 'time-avg(metric)',\n      fn: ({ expr }: { expr: string }) => `time()-avg(${expr})`,\n    },\n  ],\n  [\n    'time-min(metric)',\n    {\n      name: 'time-min(metric)',\n      fn: ({ expr }: { expr: string }) => `time()-min(${expr})`,\n    },\n  ],\n  [\n    'time-max(metric)',\n    {\n      name: 'time-max(metric)',\n      fn: ({ expr }: { expr: string }) => `time()-max(${expr})`,\n    },\n  ],\n]);\n","import { AVAILABLE_PANEL_TYPES } from 'GmdVizPanel/types/available-panel-types';\nimport { reportExploreMetrics } from 'interactions';\nimport { PREF_KEYS } from 'UserPreferences/pref-keys';\nimport { userStorage } from 'UserPreferences/userStorage';\nimport { displayWarning } from 'WingmanDataTrail/helpers/displayStatus';\n\nimport { CONFIG_PRESETS, type PanelConfigPreset } from './presets/types';\nimport { PROMQL_FUNCTIONS } from './promql-functions';\n\nconst availableConfigPresetIds = new Set<string>(Object.values(CONFIG_PRESETS));\nconst availablePanelTypes = new Set<string>(AVAILABLE_PANEL_TYPES);\n\nexport function getPreferredConfigForMetric(metric: string): PanelConfigPreset | undefined {\n  const userPrefs = userStorage.getItem(PREF_KEYS.METRIC_PREFS) || {};\n  const metricConfig = userPrefs[metric]?.config;\n\n  if (!metricConfig) {\n    return undefined;\n  }\n\n  if (!isValid(metricConfig)) {\n    reportExploreMetrics('invalid_metric_config', { metricConfig });\n\n    delete userPrefs[metric]?.config;\n    userStorage.setItem(PREF_KEYS.METRIC_PREFS, userPrefs);\n\n    displayWarning([\n      `Invalid configuration found for metric ${metric}!`,\n      'The configuration has been deleted and will not be applied.',\n    ]);\n\n    return undefined;\n  }\n\n  return metricConfig;\n}\n\n/* eslint-disable sonarjs/prefer-single-boolean-return */\nexport function isValid(metricConfig: PanelConfigPreset): boolean {\n  if (!['id', 'panelOptions', 'queryOptions'].every((key) => key in metricConfig)) {\n    return false;\n  }\n\n  if (typeof metricConfig.id !== 'string' || !availableConfigPresetIds.has(metricConfig.id)) {\n    return false;\n  }\n\n  if (typeof metricConfig.panelOptions.type !== 'string' || !availablePanelTypes.has(metricConfig.panelOptions.type)) {\n    return false;\n  }\n\n  if (!Array.isArray(metricConfig.queryOptions.queries)) {\n    return false;\n  }\n\n  if (\n    !metricConfig.queryOptions.queries.every((q) => {\n      if (!PROMQL_FUNCTIONS.has(q.fn)) {\n        return false;\n      }\n\n      if (!['quantile', 'histogram_quantile'].includes(q.fn)) {\n        return true;\n      }\n\n      if (!Array.isArray(q.params?.percentiles) || !q.params.percentiles.length) {\n        return false;\n      }\n\n      return q.params.percentiles.every((p) => p >= 1 && p <= 99);\n    })\n  ) {\n    return false;\n  }\n\n  return true;\n}\n","export const AVAILABLE_PANEL_TYPES = [\n  'heatmap',\n  'percentiles',\n  'stat',\n  'statushistory',\n  'timeseries',\n  // TODO for info metrics, see https://github.com/grafana/metrics-drilldown/issues/450\n  // 'table',\n] as const;\n\nexport type PanelType = (typeof AVAILABLE_PANEL_TYPES)[number];\n","// height in pixels\nexport enum PANEL_HEIGHT {\n  S = 160,\n  M = 220,\n  L = 260,\n  XL = 280,\n}\n","import { CONFIG_PRESETS, type ConfigPresetId, type PanelConfigPreset } from './types';\n\nexport const DEFAULT_TIMESERIES_AGE_PRESETS: Partial<Record<ConfigPresetId, PanelConfigPreset>> = {\n  [CONFIG_PRESETS.TIMESERIES_AGE_TIME_MINUS_AVG]: {\n    id: CONFIG_PRESETS.TIMESERIES_AGE_TIME_MINUS_AVG,\n    name: 'Average age',\n    panelOptions: {\n      type: 'timeseries',\n      description:\n        'Suitable only for metrics that store unix timestamps (usually containing \"timestamp_seconds\" in their name) to calculate an average age. Calculates the age by subtracting the average timestamp value from current time.',\n    },\n    queryOptions: {\n      queries: [{ fn: 'time-avg(metric)' }],\n    },\n  },\n  [CONFIG_PRESETS.TIMESERIES_AGE_TIME_MINUS_MIN_MAX]: {\n    id: CONFIG_PRESETS.TIMESERIES_AGE_TIME_MINUS_MIN_MAX,\n    name: 'Minimum and maximum ages',\n    panelOptions: {\n      type: 'timeseries',\n      description:\n        'Suitable only for metrics that store unix timestamps (usually containing \"timestamp_seconds\" in their name) to calculate a minimum and a maximum age. Calculates the ages by subtracting the min and the max timestamp values from current time.',\n    },\n    queryOptions: {\n      queries: [{ fn: 'time-min(metric)' }, { fn: 'time-max(metric)' }],\n    },\n  },\n} as const;\n","import { CONFIG_PRESETS, type ConfigPresetId, type PanelConfigPreset } from './types';\n\nexport const DEFAULT_HISTOGRAMS_PRESETS: Partial<Record<ConfigPresetId, PanelConfigPreset>> = {\n  [CONFIG_PRESETS.HISTOGRAM_HEATMAP]: {\n    id: CONFIG_PRESETS.HISTOGRAM_HEATMAP,\n    name: 'Heatmap (default)',\n    panelOptions: {\n      type: 'heatmap',\n      description:\n        'Visualizes the full distribution of histogram data over time using color intensity. Perfect for spotting patterns, identifying performance degradation, and understanding latency distribution changes. Shows density of values across different buckets.',\n    },\n    queryOptions: {\n      queries: [],\n    },\n  },\n  [CONFIG_PRESETS.HISTOGRAM_PERCENTILES]: {\n    id: CONFIG_PRESETS.HISTOGRAM_PERCENTILES,\n    name: 'Percentiles',\n    panelOptions: {\n      type: 'percentiles',\n      description:\n        'Extracts specific percentile values from histogram data. Essential for SLA monitoring and performance analysis, showing how response times or other metrics behave for different user experience tiers.',\n    },\n    queryOptions: {\n      queries: [{ fn: 'histogram_quantile', params: { percentiles: [99, 90, 50] } }],\n    },\n  },\n} as const;\n","import { CONFIG_PRESETS, type ConfigPresetId, type PanelConfigPreset } from './types';\n\nexport const DEFAULT_STATUS_UP_DOWN_PRESETS: Partial<Record<ConfigPresetId, PanelConfigPreset>> = {\n  [CONFIG_PRESETS.STATUS_UPDOWN_HISTORY]: {\n    id: CONFIG_PRESETS.STATUS_UPDOWN_HISTORY,\n    name: 'Status History (default)',\n    panelOptions: {\n      type: 'statushistory',\n      description:\n        'Displays binary status changes over time as colored bars (green=up, red=down). Perfect for monitoring service availability, health checks, or any binary state metrics. Shows patterns in uptime/downtime and helps identify recurring issues.',\n    },\n    queryOptions: {\n      queries: [{ fn: 'min' }],\n    },\n  },\n  [CONFIG_PRESETS.STATUS_UPDOWN_STAT]: {\n    id: CONFIG_PRESETS.STATUS_UPDOWN_STAT,\n    name: 'Stat with latest value',\n    panelOptions: {\n      type: 'stat',\n      description:\n        'Shows the current status as a single value display with color coding (green=up, red=down). Ideal for dashboards where you need an at-a-glance view of service health or binary state. Uses minimum value to ensure any \"down\" status is highlighted.',\n    },\n    queryOptions: {\n      queries: [{ fn: 'min' }],\n    },\n  },\n} as const;\n","import { CONFIG_PRESETS, type ConfigPresetId, type PanelConfigPreset } from './types';\n\nexport const DEFAULT_TIMESERIES_PRESETS: Partial<Record<ConfigPresetId, PanelConfigPreset>> = {\n  [CONFIG_PRESETS.TIMESERIES_AVG]: {\n    id: CONFIG_PRESETS.TIMESERIES_AVG,\n    name: 'Average (default)',\n    panelOptions: {\n      type: 'timeseries',\n      description:\n        'Shows the average value across all time series. Ideal for understanding typical behavior and smoothing out variations between different targets. For rate queries, displays average throughput per target.',\n    },\n    queryOptions: {\n      queries: [{ fn: 'avg' }],\n    },\n  },\n  [CONFIG_PRESETS.TIMESERIES_SUM]: {\n    id: CONFIG_PRESETS.TIMESERIES_SUM,\n    name: 'Sum',\n    panelOptions: {\n      type: 'timeseries',\n      description:\n        'Aggregates total values across all time series. Perfect for measuring overall system throughput, total resource consumption, or fleet-wide capacity. Essential for rate queries showing total request rates.',\n    },\n    queryOptions: {\n      queries: [{ fn: 'sum' }],\n    },\n  },\n  [CONFIG_PRESETS.TIMESERIES_STDDEV]: {\n    id: CONFIG_PRESETS.TIMESERIES_STDDEV,\n    name: 'Standard deviation',\n    panelOptions: {\n      type: 'timeseries',\n      description:\n        'Measures variability and consistency across time series. High values indicate uneven load distribution or inconsistent behavior. Useful for detecting load balancing issues or identifying when some targets behave differently.',\n    },\n    queryOptions: {\n      queries: [{ fn: 'stddev' }],\n    },\n  },\n  [CONFIG_PRESETS.TIMESERIES_PERCENTILES]: {\n    id: CONFIG_PRESETS.TIMESERIES_PERCENTILES,\n    name: 'Percentiles',\n    panelOptions: {\n      type: 'percentiles',\n      description:\n        'Displays percentiles to show value distribution. Excellent for SLA monitoring and understanding outlier behavior without being skewed by extreme values. Critical for performance analysis.',\n    },\n    queryOptions: {\n      queries: [{ fn: 'quantile', params: { percentiles: [99, 90, 50] } }],\n    },\n  },\n  [CONFIG_PRESETS.TIMESERIES_MIN_MAX]: {\n    id: CONFIG_PRESETS.TIMESERIES_MIN_MAX,\n    name: 'Minimum and maximum',\n    panelOptions: {\n      type: 'timeseries',\n      description:\n        'Shows the range between lowest and highest values across time series. Useful for capacity planning, identifying idle resources (min), and spotting overloaded targets (max). Helps detect outliers and resource utilization patterns.',\n    },\n    queryOptions: {\n      queries: [{ fn: 'min' }, { fn: 'max' }],\n    },\n  },\n} as const;\n\n// the presets are arranged so the first one is always the default one\n// this is why we define the default rate presets and we don't use DEFAULT_TIMESERIES_PRESETS in GmdVizPanel.tsx\nexport const DEFAULT_TIMESERIES_RATE_PRESETS: Partial<Record<ConfigPresetId, PanelConfigPreset>> = {\n  [CONFIG_PRESETS.TIMESERIES_SUM]: {\n    ...DEFAULT_TIMESERIES_PRESETS[CONFIG_PRESETS.TIMESERIES_SUM],\n    name: 'Sum (default)',\n    id: CONFIG_PRESETS.TIMESERIES_SUM,\n  } as PanelConfigPreset,\n  [CONFIG_PRESETS.TIMESERIES_AVG]: {\n    ...DEFAULT_TIMESERIES_PRESETS[CONFIG_PRESETS.TIMESERIES_AVG],\n    name: 'Average',\n  } as PanelConfigPreset,\n  [CONFIG_PRESETS.TIMESERIES_STDDEV]: DEFAULT_TIMESERIES_PRESETS[CONFIG_PRESETS.TIMESERIES_STDDEV] as PanelConfigPreset,\n  [CONFIG_PRESETS.TIMESERIES_PERCENTILES]: DEFAULT_TIMESERIES_PRESETS[\n    CONFIG_PRESETS.TIMESERIES_PERCENTILES\n  ] as PanelConfigPreset,\n  [CONFIG_PRESETS.TIMESERIES_MIN_MAX]: DEFAULT_TIMESERIES_PRESETS[\n    CONFIG_PRESETS.TIMESERIES_MIN_MAX\n  ] as PanelConfigPreset,\n} as const;\n","const COUNTER_METRIC_SUFFIXES = new Set(['count', 'total', 'sum']);\n\nexport function isCounterMetric(metric: string) {\n  const parts = metric.split('_');\n  const suffix = parts.at(-1);\n  return suffix ? COUNTER_METRIC_SUFFIXES.has(suffix) : false;\n}\n","export const isHistogramMetric = (metric: string) => metric.endsWith('_bucket');\n","/**\n * Identifies gauge metrics with a value measured as a Unix timestamp in seconds\n */\nexport const isAgeMetric = (metric: string) => metric.endsWith('_timestamp_seconds');\n","export const isStatusUpDownMetric = (metric: string): boolean => metric === 'up' || metric.endsWith('_up');\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { type PanelType } from 'GmdVizPanel/types/available-panel-types';\n\ninterface EventPanelTypeChangedPayload {\n  panelType: PanelType;\n}\n\nexport class EventPanelTypeChanged extends BusEventWithPayload<EventPanelTypeChangedPayload> {\n  public static readonly type = 'panel-type-changed';\n}\n","import { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button } from '@grafana/ui';\nimport React from 'react';\n\nimport { MetricSelectedEvent } from 'shared';\n\ninterface SelectActionState extends SceneObjectState {\n  metric: string;\n  variant: 'primary' | 'secondary';\n  fill: 'solid' | 'outline' | 'text';\n}\n\nexport class SelectAction extends SceneObjectBase<SelectActionState> {\n  constructor({\n    metric,\n    variant,\n    fill,\n  }: {\n    metric: SelectActionState['metric'];\n    variant?: SelectActionState['variant'];\n    fill?: SelectActionState['fill'];\n  }) {\n    super({\n      key: `select-action-${metric}`,\n      metric,\n      variant: variant || 'primary',\n      fill: fill || 'outline',\n    });\n  }\n\n  public onClick = () => {\n    this.publishEvent(new MetricSelectedEvent(this.state.metric), true);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<SelectAction>) => {\n    const { variant, fill } = model.useState();\n\n    return (\n      <Button\n        variant={variant}\n        fill={fill}\n        size=\"sm\"\n        onClick={model.onClick}\n        data-testid={`select-action-${model.state.metric}`}\n      >\n        Select\n      </Button>\n    );\n  };\n}\n","// the resolution determines the maxDataPoints of the query runner (e.g. see src/GmdVizPanel/statushistory/getStatushistoryQueryRunnerParams.ts)\nexport enum QUERY_RESOLUTION {\n  HIGH = 'HIGH',\n  MEDIUM = 'MEDIUM',\n}\n","import { isValidLegacyName, utf8Support } from '@grafana/prometheus';\nimport { Expression, MatchingOperator } from 'tsqtsq';\n\nimport { VAR_FILTERS_EXPR } from 'shared';\n\nexport type LabelMatcher = {\n  key: string;\n  operator: string;\n  value: string;\n};\n\nexport function expressionToString(expression: Expression) {\n  // see hacks in buildQueryExpression() below\n  return expression.toString().replaceAll('=\"__REMOVE__\"', '');\n}\n\ntype Options = {\n  metric: string;\n  labelMatchers?: LabelMatcher[];\n  addIgnoreUsageFilter?: boolean;\n};\n\nexport function buildQueryExpression(options: Options): Expression {\n  const { metric, labelMatchers = [], addIgnoreUsageFilter = true } = options;\n\n  const defaultSelectors = labelMatchers.map((m) => ({\n    label: utf8Support(m.key),\n    operator: m.operator as MatchingOperator,\n    value: m.value,\n  }));\n\n  if (addIgnoreUsageFilter) {\n    defaultSelectors.push({ label: '__ignore_usage__', operator: MatchingOperator.equal, value: '' });\n  }\n\n  const isUtf8Metric = !isValidLegacyName(metric);\n  if (isUtf8Metric) {\n    // hack to have the UTF-8 metric name in braces alongside labels\n    // but without extra quotes associated with an empty label value\n    defaultSelectors.push({ label: utf8Support(metric), operator: MatchingOperator.equal, value: '__REMOVE__' });\n  }\n\n  // hack for Scenes to interpolate the VAR_FILTERS variable\n  // added last so that, if filters are empty, the query is still valid\n  defaultSelectors.push({ label: VAR_FILTERS_EXPR, operator: MatchingOperator.equal, value: '__REMOVE__' });\n\n  return new Expression({\n    metric,\n    values: {},\n    defaultOperator: MatchingOperator.equal,\n    defaultSelectors,\n  });\n}\n","export const DEFAULT_UNIT = 'none';\nexport const DEFAULT_RATE_UNIT = 'cps'; // Count per second\n\n// Unit constants\nexport const UNIT_BYTES = 'bytes';\nexport const UNIT_SECONDS = 'seconds';\nconst UNIT_PERCENT = 'percent';\nconst UNIT_COUNT = 'count';\n\n// Rate unit constants\nexport const RATE_BYTES_PER_SECOND = 'Bps';\n\nconst UNIT_MAP: Record<string, string> = {\n  [UNIT_BYTES]: UNIT_BYTES,\n  [UNIT_SECONDS]: 's',\n  [UNIT_PERCENT]: UNIT_PERCENT,\n  [UNIT_COUNT]: DEFAULT_UNIT,\n};\n\nconst UNIT_LIST = Object.keys(UNIT_MAP); // used to check if a metric name contains any of the supported units\n\nconst RATE_UNIT_MAP: Record<string, string> = {\n  [UNIT_BYTES]: RATE_BYTES_PER_SECOND,\n  // seconds per second is unitless\n  [UNIT_SECONDS]: DEFAULT_UNIT,\n  [UNIT_COUNT]: DEFAULT_RATE_UNIT,\n  [UNIT_PERCENT]: UNIT_PERCENT,\n};\n\n// Get unit from metric name (e.g. \"go_gc_duration_seconds\" -> \"seconds\")\nexport function getUnitFromMetric(metric: string) {\n  // Get last two parts of the metric name and check if they are valid units\n  const metricParts = metric.toLowerCase().split('_').slice(-2);\n  for (let i = metricParts.length - 1; i >= Math.max(0, metricParts.length - 2); i--) {\n    const part = metricParts[i];\n    if (UNIT_LIST.includes(part)) {\n      return part;\n    }\n  }\n\n  return null;\n}\n\n// Get Grafana unit for a panel (e.g. \"go_gc_duration_seconds\" -> \"s\")\nexport function getUnit(metricName: string) {\n  const metricPart = getUnitFromMetric(metricName);\n  return (metricPart && UNIT_MAP[metricPart.toLowerCase()]) || DEFAULT_UNIT;\n}\n\nexport function getPerSecondRateUnit(metricName: string) {\n  const metricPart = getUnitFromMetric(metricName);\n  return (metricPart && RATE_UNIT_MAP[metricPart]) || DEFAULT_RATE_UNIT;\n}\n","import { PanelBuilders, SceneQueryRunner, type VizPanel } from '@grafana/scenes';\nimport {\n  HeatmapColorMode,\n  type HeatmapLegend,\n} from '@grafana/schema/dist/esm/raw/composable/heatmap/panelcfg/x/HeatmapPanelCfg_types.gen';\n\nimport { type HistogramType, type PanelConfig, type QueryConfig } from 'GmdVizPanel/GmdVizPanel';\nimport { trailDS } from 'shared';\n\nimport { getHeatmapQueryRunnerParams } from './getHeatmapQueryRunnerParams';\nimport { getUnit } from '../../units/getUnit';\n\ntype HeatmapPanelOptions = {\n  metric: string;\n  histogramType: HistogramType;\n  panelConfig: PanelConfig;\n  queryConfig: QueryConfig;\n};\n\nexport function buildHeatmapPanel(options: HeatmapPanelOptions): VizPanel {\n  const { metric, histogramType, panelConfig, queryConfig } = options;\n  const queryParams = getHeatmapQueryRunnerParams({\n    metric,\n    isNativeHistogram: histogramType === 'native',\n    queryConfig,\n  });\n  const unit = getUnit(metric);\n\n  const queryRunner = new SceneQueryRunner({\n    datasource: trailDS,\n    maxDataPoints: queryParams.maxDataPoints,\n    queries: queryParams.queries,\n  });\n\n  return PanelBuilders.heatmap()\n    .setTitle(panelConfig.title)\n    .setDescription(panelConfig.description)\n    .setHeaderActions(panelConfig.headerActions({ metric, panelConfig }))\n    .setMenu(panelConfig.menu?.clone()) // we clone because it's already stored in GmdVizPanel\n    .setShowMenuAlways(Boolean(panelConfig.menu))\n    .setData(queryRunner)\n    .setUnit(unit)\n    .setOption('calculate', false)\n    .setOption('color', {\n      mode: HeatmapColorMode.Scheme,\n      exponent: 0.5,\n      scheme: 'Spectral',\n      steps: 32,\n      reverse: false,\n    })\n    .setOption('legend', panelConfig.legend as HeatmapLegend)\n    .build();\n}\n","import { type SceneDataQuery } from '@grafana/scenes';\nimport { promql } from 'tsqtsq';\n\nimport { buildQueryExpression, expressionToString } from 'GmdVizPanel/buildQueryExpression';\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/config/query-resolutions';\nimport { type QueryConfig } from 'GmdVizPanel/GmdVizPanel';\n\ntype HeatmapQueryRunnerParams = {\n  maxDataPoints: number;\n  queries: SceneDataQuery[];\n};\n\ntype Options = {\n  metric: string;\n  isNativeHistogram: boolean;\n  queryConfig: QueryConfig;\n};\n\nexport function getHeatmapQueryRunnerParams(options: Options): HeatmapQueryRunnerParams {\n  const { metric, isNativeHistogram, queryConfig } = options;\n  const expression = buildQueryExpression({\n    metric,\n    labelMatchers: queryConfig.labelMatchers,\n    addIgnoreUsageFilter: queryConfig.addIgnoreUsageFilter,\n  });\n\n  const expr = promql.rate({\n    expr: expressionToString(expression),\n  });\n\n  const query = isNativeHistogram ? promql.sum({ expr }) : promql.sum({ expr, by: ['le'] });\n\n  return {\n    maxDataPoints: queryConfig.resolution === QUERY_RESOLUTION.HIGH ? 500 : 250,\n    queries: [\n      {\n        refId: `${metric}-heatmap`,\n        expr: query,\n        format: 'heatmap',\n        fromExploreMetrics: true,\n      },\n    ],\n  };\n}\n","import { type SceneDataQuery } from '@grafana/scenes';\nimport { promql } from 'tsqtsq';\n\nimport { buildQueryExpression, expressionToString } from 'GmdVizPanel/buildQueryExpression';\nimport { PROMQL_FUNCTIONS } from 'GmdVizPanel/config/promql-functions';\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/config/query-resolutions';\nimport { type HistogramType, type QueryConfig, type QueryDefs } from 'GmdVizPanel/GmdVizPanel';\n\nimport { isCounterMetric as isCounterMetricFn } from '../..//matchers/isCounterMetric';\n\ntype PercentilesQueryRunnerParams = {\n  isRateQuery: boolean;\n  maxDataPoints: number;\n  queries: SceneDataQuery[];\n};\n\ntype Options = {\n  metric: string;\n  histogramType: HistogramType;\n  queryConfig: QueryConfig;\n};\n\nconst DEFAULT_PERCENTILES = [99, 90, 50] as const;\n\nexport function getPercentilesQueryRunnerParams(options: Options): PercentilesQueryRunnerParams {\n  const { metric, histogramType, queryConfig } = options;\n  const isCounterMetric = isCounterMetricFn(metric);\n  const expression = buildQueryExpression({\n    metric,\n    labelMatchers: queryConfig.labelMatchers,\n    addIgnoreUsageFilter: queryConfig.addIgnoreUsageFilter,\n  });\n  const expr = expressionToString(expression);\n  const queries =\n    histogramType === 'none'\n      ? buildNonHistogramQueries({\n          metric,\n          queryConfig,\n          isRateQuery: isCounterMetric,\n          expr,\n        })\n      : buildHistogramQueries({\n          metric,\n          isNativeHistogram: histogramType === 'native',\n          queryConfig,\n          expr,\n        });\n\n  return {\n    isRateQuery: histogramType !== 'none' ? true : isCounterMetric,\n    maxDataPoints: queryConfig.resolution === QUERY_RESOLUTION.HIGH ? 500 : 250,\n    queries,\n  };\n}\n\nfunction buildHistogramQueries({\n  metric,\n  isNativeHistogram,\n  queryConfig,\n  expr,\n}: {\n  metric: string;\n  isNativeHistogram: boolean;\n  queryConfig: QueryConfig;\n  expr: string;\n}): SceneDataQuery[] {\n  const queryDefs: QueryDefs = queryConfig.queries?.length\n    ? queryConfig.queries\n    : [{ fn: 'histogram_quantile', params: { percentiles: DEFAULT_PERCENTILES } }];\n\n  const queries: SceneDataQuery[] = [];\n\n  const newExpr = isNativeHistogram\n    ? promql.sum({ expr: promql.rate({ expr }) })\n    : promql.sum({ expr: promql.rate({ expr }), by: ['le'] });\n\n  for (const { fn, params } of queryDefs) {\n    const entry = PROMQL_FUNCTIONS.get(fn)!;\n    const fnName = entry.name;\n    const percentiles = params?.percentiles || DEFAULT_PERCENTILES;\n\n    for (const percentile of percentiles) {\n      const parameter = percentile / 100;\n      const query = entry.fn({ expr: newExpr, parameter });\n\n      queries.push({\n        refId: `${metric}-p${percentile}-${fnName}`,\n        expr: query,\n        legendFormat: `${percentile}th Percentile`,\n        fromExploreMetrics: true,\n      });\n    }\n  }\n\n  return queries;\n}\n\nfunction buildNonHistogramQueries({\n  metric,\n  queryConfig,\n  isRateQuery,\n  expr,\n}: {\n  metric: string;\n  queryConfig: QueryConfig;\n  isRateQuery: boolean;\n  expr: string;\n}): SceneDataQuery[] {\n  const queryDefs: QueryDefs = queryConfig.queries?.length\n    ? queryConfig.queries\n    : [{ fn: 'quantile', params: { percentiles: [99, 90, 50] } }];\n\n  const queries: SceneDataQuery[] = [];\n  const newExpr = isRateQuery ? promql.rate({ expr }) : expr;\n\n  for (const { fn, params } of queryDefs) {\n    const entry = PROMQL_FUNCTIONS.get(fn)!;\n    const fnName = isRateQuery ? `${entry.name}(rate)` : entry.name;\n\n    for (const percentile of params!.percentiles) {\n      const parameter = percentile / 100;\n      const query = entry.fn({ expr: newExpr, parameter });\n\n      queries.push({\n        refId: `${metric}-p${percentile}-${fnName}`,\n        expr: query,\n        legendFormat: `${percentile}th Percentile`,\n        fromExploreMetrics: true,\n      });\n    }\n  }\n\n  return queries;\n}\n","import { PanelBuilders, SceneQueryRunner } from '@grafana/scenes';\nimport { SortOrder, TooltipDisplayMode } from '@grafana/schema';\n\nimport { type HistogramType, type PanelConfig, type QueryConfig } from 'GmdVizPanel/GmdVizPanel';\nimport { getPerSecondRateUnit, getUnit } from 'GmdVizPanel/units/getUnit';\nimport { trailDS } from 'shared';\nimport { getColorByIndex } from 'utils';\n\nimport { getPercentilesQueryRunnerParams } from './getPercentilesQueryRunnerParams';\n\ntype PercentilesPanelOptions = {\n  metric: string;\n  histogramType: HistogramType;\n  panelConfig: PanelConfig;\n  queryConfig: QueryConfig;\n};\n\nexport function buildPercentilesPanel(options: PercentilesPanelOptions) {\n  const { metric, histogramType, panelConfig, queryConfig } = options;\n  const queryParams = getPercentilesQueryRunnerParams({ metric, histogramType, queryConfig });\n  const unit = queryParams.isRateQuery ? getPerSecondRateUnit(metric) : getUnit(metric);\n\n  const $data = new SceneQueryRunner({\n    datasource: trailDS,\n    maxDataPoints: queryParams.maxDataPoints,\n    queries: queryParams.queries,\n  });\n\n  const startColorIndex = panelConfig.fixedColorIndex || 0;\n\n  return PanelBuilders.timeseries()\n    .setTitle(panelConfig.title)\n    .setDescription(panelConfig.description)\n    .setHeaderActions(panelConfig.headerActions({ metric, panelConfig }))\n    .setMenu(panelConfig.menu?.clone()) // we clone because it's already stored in GmdVizPanel\n    .setShowMenuAlways(Boolean(panelConfig.menu))\n    .setData($data)\n    .setUnit(unit)\n    .setOption('tooltip', { mode: TooltipDisplayMode.Multi, sort: SortOrder.Descending })\n    .setCustomFieldConfig('fillOpacity', 9)\n    .setOverrides((b) => {\n      queryParams.queries.forEach((query, i) => {\n        b.matchFieldsByQuery(query.refId).overrideColor({\n          mode: 'fixed',\n          fixedColor: getColorByIndex(startColorIndex + i),\n        });\n      });\n    })\n    .build();\n}\n","import { type SceneDataQuery } from '@grafana/scenes';\nimport { promql } from 'tsqtsq';\n\nimport { buildQueryExpression, expressionToString } from 'GmdVizPanel/buildQueryExpression';\nimport { PROMQL_FUNCTIONS } from 'GmdVizPanel/config/promql-functions';\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/config/query-resolutions';\nimport { type QueryConfig, type QueryDefs } from 'GmdVizPanel/GmdVizPanel';\n\nimport { isCounterMetric } from '../../matchers/isCounterMetric';\n\ntype TimeseriesQueryRunnerParams = {\n  isRateQuery: boolean;\n  maxDataPoints: number;\n  queries: SceneDataQuery[];\n};\n\ntype Options = {\n  metric: string;\n  queryConfig: QueryConfig;\n};\n\nexport function getStatQueryRunnerParams(options: Options): TimeseriesQueryRunnerParams {\n  const { metric, queryConfig } = options;\n  const isRateQuery = isCounterMetric(metric);\n  const expression = buildQueryExpression({\n    metric,\n    labelMatchers: queryConfig.labelMatchers,\n    addIgnoreUsageFilter: queryConfig.addIgnoreUsageFilter,\n  });\n\n  let expr = expressionToString(expression);\n\n  if (isRateQuery) {\n    expr = promql.rate({ expr, interval: '$__rate_interval' });\n  }\n\n  return {\n    isRateQuery,\n    maxDataPoints: queryConfig.resolution === QUERY_RESOLUTION.HIGH ? 500 : 250,\n    queries: buildQueriesWithPresetFunctions({ metric, queryConfig, isRateQuery, expr }),\n  };\n}\n\n// here we support preset functions\nfunction buildQueriesWithPresetFunctions({\n  metric,\n  queryConfig,\n  isRateQuery,\n  expr,\n}: {\n  metric: string;\n  queryConfig: QueryConfig;\n  isRateQuery: boolean;\n  expr: string;\n}): SceneDataQuery[] {\n  const defaultPromqlFn = isRateQuery ? 'sum' : 'avg';\n  const queryDefs: QueryDefs = queryConfig.queries?.length ? queryConfig.queries : [{ fn: defaultPromqlFn }];\n  const queries: SceneDataQuery[] = [];\n\n  for (const { fn } of queryDefs) {\n    const entry = PROMQL_FUNCTIONS.get(fn)!;\n    const query = entry.fn({ expr });\n    const fnName = isRateQuery ? `${entry.name}(rate)` : entry.name;\n\n    queries.push({\n      refId: `${metric}-${fnName}`,\n      expr: query,\n      legendFormat: fnName,\n      fromExploreMetrics: true,\n    });\n  }\n\n  return queries;\n}\n","import { type ValueMapping } from '@grafana/data';\nimport { MappingType } from '@grafana/schema';\n\nexport const UP_DOWN_VALUE_MAPPINGS: ValueMapping[] = [\n  {\n    type: MappingType.ValueToText,\n    options: {\n      '0': {\n        color: 'red',\n        text: 'down',\n      },\n      '1': {\n        color: 'green',\n        text: 'up',\n      },\n    },\n  },\n] as const;\n","import { PanelBuilders, SceneQueryRunner, type VizPanel } from '@grafana/scenes';\n\nimport { type PanelConfig, type QueryConfig } from 'GmdVizPanel/GmdVizPanel';\nimport { trailDS } from 'shared';\nimport { getColorByIndex } from 'utils';\n\nimport { getStatQueryRunnerParams } from './getStatQueryRunnerParams';\nimport { UP_DOWN_VALUE_MAPPINGS } from '../statushistory/value-mappings';\n\ntype StatushistoryPanelOptions = {\n  metric: string;\n  panelConfig: PanelConfig;\n  queryConfig: QueryConfig;\n};\n\nexport function buildStatPanel(options: StatushistoryPanelOptions): VizPanel {\n  const { metric, panelConfig, queryConfig } = options;\n  const queryParams = getStatQueryRunnerParams({ metric, queryConfig });\n  const unit = 'none';\n\n  const queryRunner = new SceneQueryRunner({\n    datasource: trailDS,\n    maxDataPoints: queryParams.maxDataPoints,\n    queries: queryParams.queries,\n  });\n\n  return PanelBuilders.stat()\n    .setTitle(panelConfig.title)\n    .setDescription(panelConfig.description)\n    .setHeaderActions(panelConfig.headerActions({ metric, panelConfig }))\n    .setMenu(panelConfig.menu?.clone()) // we clone because it's already stored in GmdVizPanel\n    .setShowMenuAlways(Boolean(panelConfig.menu))\n    .setData(queryRunner)\n    .setUnit(unit)\n    .setColor({ mode: 'fixed', fixedColor: getColorByIndex(panelConfig.fixedColorIndex || 0) })\n    .setMappings(UP_DOWN_VALUE_MAPPINGS) // current support is only for up/down values\n    .build();\n}\n","import { PanelBuilders, SceneQueryRunner, type VizPanel } from '@grafana/scenes';\nimport { VisibilityMode, type VizLegendOptions } from '@grafana/schema';\n\nimport { type PanelConfig, type QueryConfig } from 'GmdVizPanel/GmdVizPanel';\nimport { trailDS } from 'shared';\n\nimport { getStatushistoryQueryRunnerParams } from './getStatushistoryQueryRunnerParams';\nimport { UP_DOWN_VALUE_MAPPINGS } from './value-mappings';\n\ntype StatushistoryPanelOptions = {\n  metric: string;\n  panelConfig: PanelConfig;\n  queryConfig: QueryConfig;\n};\n\nexport function buildStatushistoryPanel(options: StatushistoryPanelOptions): VizPanel {\n  const { metric, panelConfig, queryConfig } = options;\n  const queryParams = getStatushistoryQueryRunnerParams({ metric, queryConfig });\n  const unit = 'none';\n\n  const queryRunner = new SceneQueryRunner({\n    datasource: trailDS,\n    maxDataPoints: queryParams.maxDataPoints,\n    queries: queryParams.queries,\n  });\n\n  return (\n    PanelBuilders.statushistory()\n      .setTitle(panelConfig.title)\n      .setDescription(panelConfig.description)\n      .setHeaderActions(panelConfig.headerActions({ metric, panelConfig }))\n      .setMenu(panelConfig.menu?.clone()) // we clone because it's already stored in GmdVizPanel\n      .setShowMenuAlways(Boolean(panelConfig.menu))\n      .setData(queryRunner)\n      .setUnit(unit)\n      // Use value mappings for both color and text display\n      .setColor({ mode: 'palette-classic' })\n      .setOption('showValue', VisibilityMode.Never)\n      .setOption('legend', panelConfig.legend as VizLegendOptions)\n      .setOption('perPage', 0) // hide pagination at the bottom of the panel\n      .setMappings(UP_DOWN_VALUE_MAPPINGS) // current support is only for up/down values\n      .build()\n  );\n}\n","import { type SceneDataQuery } from '@grafana/scenes';\nimport { promql } from 'tsqtsq';\n\nimport { buildQueryExpression, expressionToString } from 'GmdVizPanel/buildQueryExpression';\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/config/query-resolutions';\nimport { type QueryConfig } from 'GmdVizPanel/GmdVizPanel';\n\ntype StatushistoryQueryRunnerParams = {\n  maxDataPoints: number;\n  queries: SceneDataQuery[];\n};\n\ntype Options = {\n  metric: string;\n  queryConfig: QueryConfig;\n};\n\nexport function getStatushistoryQueryRunnerParams(options: Options): StatushistoryQueryRunnerParams {\n  const { metric, queryConfig } = options;\n  const expression = buildQueryExpression({\n    metric,\n    labelMatchers: queryConfig.labelMatchers,\n    addIgnoreUsageFilter: queryConfig.addIgnoreUsageFilter,\n  });\n  const query = promql.min({ expr: expressionToString(expression) });\n\n  return {\n    maxDataPoints: queryConfig.resolution === QUERY_RESOLUTION.HIGH ? 200 : 100,\n    queries: [\n      {\n        refId: `${metric}-status`,\n        expr: query,\n        legendFormat: 'status',\n        fromExploreMetrics: true,\n      },\n    ],\n  };\n}\n","import { type DataFrame } from '@grafana/data';\nimport { map, type Observable } from 'rxjs';\n\nexport const addUnspecifiedLabel = (label: string) => () => (source: Observable<DataFrame[]>) =>\n  source.pipe(\n    map((data: DataFrame[]) => {\n      // eslint-disable-next-line sonarjs/no-nested-functions\n      return data?.map((d) => {\n        if (!d?.fields[1]) {\n          return d;\n        }\n\n        if (!d.fields[1].labels?.[label]) {\n          d.fields[1].labels = { ...d.fields[1].labels, [label]: `<unspecified ${label}>` };\n        }\n\n        return d;\n      });\n    })\n  );\n","import { type AdHocVariableFilter } from '@grafana/data';\nimport { isValidLegacyName, utf8Support } from '@grafana/prometheus';\nimport { Expression, MatchingOperator, promql } from 'tsqtsq';\n\nconst nonRateQueryFunctions = new Set(['avg', 'min', 'max'] as const);\nexport type NonRateQueryFunction = typeof nonRateQueryFunctions extends Set<infer T> ? T : never;\nexport const isNonRateQueryFunction = (value: string): value is NonRateQueryFunction =>\n  nonRateQueryFunctions.has(value as NonRateQueryFunction);\nconst DEFAULT_NON_RATE_QUERY_FUNCTION: NonRateQueryFunction = 'avg';\n\nexport interface BuildPrometheusQueryParams {\n  metric: string;\n  filters: AdHocVariableFilter[];\n  isRateQuery: boolean;\n  groupings?: string[];\n  ignoreUsage?: boolean;\n  nonRateQueryFunction?: NonRateQueryFunction;\n  filterExtremeValues?: boolean;\n}\n\nfunction getPromqlFunction(\n  isRateQuery: boolean,\n  nonRateQueryFunction: NonRateQueryFunction = DEFAULT_NON_RATE_QUERY_FUNCTION\n): NonRateQueryFunction | 'sum' {\n  return isRateQuery ? 'sum' : nonRateQueryFunction; // eslint-disable-line sonarjs/no-selector-parameter\n}\n\nexport function buildPrometheusQuery({\n  metric,\n  filters,\n  isRateQuery,\n  groupings,\n  ignoreUsage = false,\n  nonRateQueryFunction = DEFAULT_NON_RATE_QUERY_FUNCTION,\n  filterExtremeValues = false,\n}: BuildPrometheusQueryParams): string {\n  // Check if metric name contains UTF-8 characters\n  const isUtf8Metric = !isValidLegacyName(metric);\n\n  const expr = new Expression({\n    metric: isUtf8Metric ? '' : metric,\n    values: {},\n    defaultOperator: MatchingOperator.equal,\n    defaultSelectors: [\n      ...(isUtf8Metric ? [{ label: utf8Support(metric), operator: MatchingOperator.equal, value: '__REMOVE__' }] : []),\n      ...(ignoreUsage ? [{ label: '__ignore_usage__', operator: MatchingOperator.equal, value: '' }] : []),\n      ...filters\n        .filter((filter) => filter.key !== '__name__')\n        .map(({ key, value, operator }) => ({\n          label: utf8Support(key),\n          operator: operator as MatchingOperator,\n          value,\n        })),\n    ],\n  });\n\n  let metricPartString = expr.toString();\n\n  // Hack to have the UTF-8 metric name in braces alongside labels,\n  // but without extra quotes associated with an empty label value\n  if (isUtf8Metric) {\n    metricPartString = metricPartString.replace('=\"__REMOVE__\"', '');\n  }\n\n  if (filterExtremeValues) {\n    // Create a filter expression that excludes extreme values\n    const extremeValueFilter = promql.and({\n      left: metricPartString,\n      right: `${metricPartString} > -Inf`,\n    });\n    metricPartString = extremeValueFilter;\n  }\n\n  // Add rate if needed\n  if (isRateQuery) {\n    metricPartString = promql.rate({ expr: metricPartString, interval: '$__rate_interval' });\n  }\n\n  // Build final query using tsqtsq\n  // native histograms will not get `sum by (le)` here because they are not identified as rate queries in `determineProperties` function because they don't have the suffix bucket. The `rate` function is defined much earlier for them in `MetricVizPanel.buildQueryRunner` and is passed here as the `nonRateQueryFunction`.\n  return promql[getPromqlFunction(isRateQuery, nonRateQueryFunction)]({\n    expr: metricPartString,\n    ...(groupings?.length ? { by: groupings } : {}),\n  });\n}\n","import { css } from '@emotion/css';\nimport { LoadingState, type AdHocVariableFilter, type DataFrame, type Field, type GrafanaTheme2 } from '@grafana/data';\nimport { sceneGraph, SceneQueryRunner, type CancelActivationHandler, type VizPanel } from '@grafana/scenes';\nimport { Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport { parser } from '@prometheus-io/lezer-promql';\nimport React from 'react';\nimport { type Unsubscribable } from 'rxjs';\n\nimport { reportExploreMetrics } from 'interactions';\n\nimport { buildPrometheusQuery, isNonRateQueryFunction, type NonRateQueryFunction } from './buildPrometheusQuery';\nimport { VAR_FILTERS_EXPR, VAR_METRIC_EXPR } from '../../shared';\nimport { logger } from '../../tracking/logger/logger';\nimport { processLabelMatcher } from '../../utils/utils.promql';\n\n/**\n * A stateless function that detects when all data in a query result is NaN\n * and attempts to re-run the query with extreme value filtering.\n *\n * This addresses the issue where Prometheus metrics with extremely small values\n * (e.g., 9e-129) cause arithmetic operations during averaging to underflow\n * or become undefined, resulting in NaN for queries like `avg(some_metric_with_extreme_values)`.\n *\n * @remarks\n * Implementing this as a behavior allows us to apply the extreme values filtering\n * to only the queries that are affected by the extreme values, rather than all queries in the scene.\n * That way, we can keep queries simpler by default, and only apply the extreme values filtering\n * when it's necessary.\n */\nexport function extremeValueFilterBehavior(panel: VizPanel): CancelActivationHandler | void {\n  const [queryRunner] = sceneGraph.findDescendents(panel, SceneQueryRunner);\n\n  // When the query runner's state changes, check if the data is all NaN.\n  // If it is, remove the extreme values from the query.\n  const queryRunnerSub = queryRunner?.subscribeToState((state) => {\n    if (state.data?.state === LoadingState.Done && state.data?.series) {\n      const { series } = state.data;\n\n      if (series.length === 0 || !isAllDataNaN(series)) {\n        return;\n      }\n\n      reportExploreMetrics('extreme_value_filter_behavior_triggered', {\n        expression: sceneGraph.interpolate(queryRunner, queryRunner.state.queries[0].expr),\n      });\n      const extremeValueRemoval = removeExtremeValues(queryRunner, panel, queryRunnerSub);\n\n      if (!extremeValueRemoval.success) {\n        panel.setState({\n          titleItems: (\n            <VizPanelExtremeValuesMessage\n              level=\"warning\"\n              message=\"Extreme values detected, but could not re-run the query with extreme value filtering\"\n            />\n          ),\n        });\n        logger.warn('ExtremeValueFilterBehavior: Failed to remove extreme values:', extremeValueRemoval.issue);\n      }\n    }\n  });\n\n  // Return cleanup function\n  return () => {\n    if (queryRunnerSub) {\n      queryRunnerSub.unsubscribe();\n    }\n  };\n}\n\n/**\n * Checks if all data in the series contains only NaN values,\n * short-circuiting if any frame contains non-NaN values.\n */\nfunction isAllDataNaN(series: DataFrame[]): boolean {\n  return series.every((frame) => isDataFrameAllNaN(frame));\n}\n\ninterface FieldWithEntitiesNaN extends Field<any> {\n  entities: {\n    NaN: number[];\n  };\n}\n\nfunction isFieldWithEntitiesNaN(field: Field): field is FieldWithEntitiesNaN {\n  return 'entities' in field && Array.isArray((field as FieldWithEntitiesNaN).entities?.NaN);\n}\n\n/**\n * Checks if all the values in the DataFrame are NaN\n */\nfunction isDataFrameAllNaN(frame: DataFrame): boolean {\n  const valuesField = frame.fields.find((field) => field.name === 'Value');\n\n  if (!valuesField || !isFieldWithEntitiesNaN(valuesField)) {\n    return false;\n  }\n\n  return valuesField.entities.NaN.length === frame.length;\n}\n\ntype RemoveExtremeValuesMeta = { success: true } | { success: false; issue: string };\n\n/**\n * Re-run the query with extreme value filtering enabled\n */\nfunction removeExtremeValues(\n  queryRunner: SceneQueryRunner,\n  panel: VizPanel,\n  queryRunnerSub: Unsubscribable\n): RemoveExtremeValuesMeta {\n  const queries = queryRunner.state.queries;\n  if (!queries || queries.length === 0) {\n    return { success: false, issue: 'No queries found in query runner' };\n  }\n\n  // Parse the original query to extract the metric, filters, groupings, etc.\n  const queryParsing = parseQueryForRebuild(queries[0].expr, queryRunner);\n\n  if (!queryParsing.success) {\n    return { success: false, issue: queryParsing.issue };\n  }\n\n  // Rebuild the query with extreme value filtering\n  const filteredQuery = buildPrometheusQuery({\n    ...queryParsing.queryParts,\n    filterExtremeValues: true,\n  });\n\n  // Unsubscribe from the original query runner before replacing it\n  if (queryRunnerSub) {\n    queryRunnerSub.unsubscribe();\n  }\n\n  // Create a new query runner with the filtered query\n  const newQueryRunner = queryRunner.clone({\n    queries: [\n      {\n        ...queries[0],\n        expr: filteredQuery,\n      },\n    ],\n  });\n\n  panel.setState({\n    $data: newQueryRunner,\n    titleItems: (\n      <VizPanelExtremeValuesMessage\n        level=\"info\"\n        message=\"Panel data was re-fetched with a more complex query to handle extremely small values in the series\"\n      />\n    ),\n  });\n\n  newQueryRunner.runQueries();\n\n  return { success: true };\n}\n\ninterface QueryParts {\n  metric: string;\n  filters: AdHocVariableFilter[];\n  isRateQuery: boolean;\n  nonRateQueryFunction?: NonRateQueryFunction;\n  groupings?: string[];\n}\n\ntype ParseQueryForRebuildResult = { success: true; queryParts: QueryParts } | { success: false; issue: string };\n\n/**\n * Parses a PromQL query to extract parameters for rebuilding with filtering\n */\nfunction parseQueryForRebuild(query: string, queryRunner: SceneQueryRunner): ParseQueryForRebuildResult {\n  let queryExpression = query;\n  const hasTemplateVariables = query.includes(VAR_METRIC_EXPR) || query.includes(VAR_FILTERS_EXPR);\n\n  if (hasTemplateVariables) {\n    queryExpression = sceneGraph.interpolate(queryRunner, query);\n  }\n\n  try {\n    const tree = parser.parse(queryExpression);\n    let metric = '';\n    const labels: AdHocVariableFilter[] = [];\n    let isRateQuery = false;\n    let groupings: string[] | undefined;\n    let nonRateQueryFunction: NonRateQueryFunction | undefined;\n\n    // Use tree.iterate() for simpler traversal\n    tree.iterate({\n      enter: (node) => {\n        // Check for rate function\n        if (node.name === 'FunctionCall') {\n          // Find the function name (first child should be the identifier)\n          let functionName = '';\n          for (let child = node.node.firstChild; child; child = child.nextSibling) {\n            if (child.type.name === 'Identifier') {\n              functionName = queryExpression.slice(child.from, child.to);\n              break;\n            }\n          }\n\n          if (functionName === 'rate') {\n            isRateQuery = true;\n          } else if (isNonRateQueryFunction(functionName)) {\n            nonRateQueryFunction = functionName;\n            isRateQuery = false;\n          }\n        }\n\n        // Get the first metric name from any VectorSelector > Identifier\n        if (!metric && node.name === 'Identifier' && node.node.parent?.type.name === 'VectorSelector') {\n          metric = queryExpression.slice(node.from, node.to);\n        }\n\n        // Extract label matchers\n        const labelData = processLabelMatcher(node, queryExpression);\n        if (labelData) {\n          labels.push({\n            key: labelData.label,\n            operator: labelData.op,\n            value: labelData.value,\n          });\n        }\n\n        // Extract groupings from by clause\n        if (node.name === 'GroupingLabels' && nonRateQueryFunction) {\n          groupings = extractGroupings(node, queryExpression);\n        }\n      },\n    });\n\n    if (!metric) {\n      return {\n        success: false,\n        issue: `Could not parse the metric name from the query: ${queryExpression}`,\n      };\n    }\n\n    return {\n      success: true,\n      queryParts: {\n        metric,\n        filters: labels,\n        isRateQuery,\n        groupings,\n        nonRateQueryFunction,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      issue: `Unexpected error during query parsing to handle extreme values: ${\n        error instanceof Error ? error.message : String(error)\n      }`,\n    };\n  }\n}\n\n/**\n * Extracts groupings from a GroupingLabels node\n */\nfunction extractGroupings(node: any, expr: string): string[] {\n  const groupings: string[] = [];\n\n  // Traverse children to find LabelName nodes\n  for (let child = node.node.firstChild; child; child = child.nextSibling) {\n    if (child.type.name === 'LabelName') {\n      const grouping = expr.slice(child.from, child.to);\n      if (grouping) {\n        groupings.push(grouping);\n      }\n    }\n  }\n\n  return groupings;\n}\n\ninterface VizPanelExtremeValuesMessageProps {\n  message: string;\n  level: 'warning' | 'info';\n}\n\nfunction VizPanelExtremeValuesMessage({ message, level }: Readonly<VizPanelExtremeValuesMessageProps>) {\n  const styles = useStyles2(getStyles, level);\n\n  return (\n    <div className={styles.extremeValuedisclaimer}>\n      <Tooltip content={message}>\n        <span className={styles.warningMessage}>\n          <Icon name={level === 'warning' ? 'exclamation-triangle' : 'info-circle'} aria-hidden=\"true\" />\n        </span>\n      </Tooltip>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2, level: 'warning' | 'info') => ({\n  extremeValuedisclaimer: css({\n    label: 'extreme-value-disclaimer',\n    display: 'flex',\n    alignItems: 'center',\n    gap: theme.spacing(1),\n  }),\n  warningMessage: css({\n    display: 'flex',\n    alignItems: 'center',\n    gap: theme.spacing(0.5),\n    color: level === 'warning' ? theme.colors.warning.main : theme.colors.info.main,\n    fontSize: theme.typography.bodySmall.fontSize,\n  }),\n});\n","import { type SceneDataQuery } from '@grafana/scenes';\nimport { promql } from 'tsqtsq';\n\nimport { buildQueryExpression, expressionToString } from 'GmdVizPanel/buildQueryExpression';\nimport { PROMQL_FUNCTIONS } from 'GmdVizPanel/config/promql-functions';\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/config/query-resolutions';\nimport { type QueryConfig, type QueryDefs } from 'GmdVizPanel/GmdVizPanel';\n\nimport { isCounterMetric } from '../../matchers/isCounterMetric';\n\ntype TimeseriesQueryRunnerParams = {\n  isRateQuery: boolean;\n  maxDataPoints: number;\n  queries: SceneDataQuery[];\n};\n\ntype Options = {\n  metric: string;\n  queryConfig: QueryConfig;\n};\n\nexport function getTimeseriesQueryRunnerParams(options: Options): TimeseriesQueryRunnerParams {\n  const { metric, queryConfig } = options;\n  const isRateQuery = isCounterMetric(metric);\n  const expression = buildQueryExpression({\n    metric,\n    labelMatchers: queryConfig.labelMatchers,\n    addIgnoreUsageFilter: queryConfig.addIgnoreUsageFilter,\n  });\n\n  let expr = expressionToString(expression);\n\n  if (isRateQuery) {\n    expr = promql.rate({ expr, interval: '$__rate_interval' });\n  }\n\n  return {\n    isRateQuery,\n    maxDataPoints: queryConfig.resolution === QUERY_RESOLUTION.HIGH ? 500 : 250,\n    queries: queryConfig.groupBy\n      ? buildGroupByQueries({ metric, queryConfig, isRateQuery, expr })\n      : buildQueriesWithPresetFunctions({ metric, queryConfig, isRateQuery, expr }),\n  };\n}\n\n// if grouped by, we don't provide support for preset functions\nfunction buildGroupByQueries({\n  metric,\n  queryConfig,\n  isRateQuery,\n  expr,\n}: {\n  metric: string;\n  queryConfig: QueryConfig;\n  isRateQuery: boolean;\n  expr: string;\n}): SceneDataQuery[] {\n  return [\n    {\n      refId: `${metric}-by-${queryConfig.groupBy}`,\n      expr: isRateQuery\n        ? promql.sum({ expr, by: [queryConfig.groupBy!] })\n        : promql.avg({ expr, by: [queryConfig.groupBy!] }),\n      legendFormat: `{{${queryConfig.groupBy}}}`,\n      fromExploreMetrics: true,\n    },\n  ];\n}\n\n// here we support preset functions\nfunction buildQueriesWithPresetFunctions({\n  metric,\n  queryConfig,\n  isRateQuery,\n  expr,\n}: {\n  metric: string;\n  queryConfig: QueryConfig;\n  isRateQuery: boolean;\n  expr: string;\n}): SceneDataQuery[] {\n  const defaultPromqlFn = isRateQuery ? 'sum' : 'avg';\n  const queryDefs: QueryDefs = queryConfig.queries?.length ? queryConfig.queries : [{ fn: defaultPromqlFn }];\n  const queries: SceneDataQuery[] = [];\n\n  for (const { fn } of queryDefs) {\n    const entry = PROMQL_FUNCTIONS.get(fn)!;\n    const query = entry.fn({ expr });\n    const fnName = isRateQuery ? `${entry.name}(rate)` : entry.name;\n\n    queries.push({\n      refId: `${metric}-${fnName}`,\n      expr: query,\n      legendFormat: fnName,\n      fromExploreMetrics: true,\n    });\n  }\n\n  return queries;\n}\n","import { PanelBuilders, SceneDataTransformer, SceneQueryRunner, type VizPanel } from '@grafana/scenes';\nimport { SortOrder, TooltipDisplayMode, type LegendPlacement } from '@grafana/schema';\n\nimport { addUnspecifiedLabel } from 'Breakdown/MetricLabelsList/transformations/addUnspecifiedLabel';\nimport { extremeValueFilterBehavior } from 'GmdVizPanel/behaviors/ExtremeValueFilterBehavior';\nimport { type PanelConfig, type QueryConfig } from 'GmdVizPanel/GmdVizPanel';\nimport { trailDS } from 'shared';\nimport { getColorByIndex } from 'utils';\n\nimport { getTimeseriesQueryRunnerParams } from './getTimeseriesQueryRunnerParams';\nimport { getPerSecondRateUnit, getUnit } from '../../units/getUnit';\n\ntype TimeseriesPanelOptions = {\n  metric: string;\n  panelConfig: PanelConfig;\n  queryConfig: QueryConfig;\n};\n\nexport function buildTimeseriesPanel(options: TimeseriesPanelOptions): VizPanel {\n  if (options.queryConfig?.groupBy) {\n    return buildGroupByPanel(options as Required<TimeseriesPanelOptions>);\n  }\n\n  const { metric, panelConfig, queryConfig } = options;\n  const queryParams = getTimeseriesQueryRunnerParams({ metric, queryConfig });\n  const unit = queryParams.isRateQuery ? getPerSecondRateUnit(metric) : getUnit(metric);\n\n  const $data = new SceneQueryRunner({\n    datasource: trailDS,\n    maxDataPoints: queryParams.maxDataPoints,\n    queries: queryParams.queries,\n  });\n\n  const vizPanelBuilder = PanelBuilders.timeseries()\n    .setTitle(panelConfig.title)\n    .setDescription(panelConfig.description)\n    .setHeaderActions(panelConfig.headerActions({ metric, panelConfig }))\n    .setMenu(panelConfig.menu?.clone()) // we clone because it's already stored in GmdVizPanel\n    .setShowMenuAlways(Boolean(panelConfig.menu))\n    .setData($data)\n    .setUnit(unit)\n    .setOption('legend', { showLegend: true, placement: 'bottom' as LegendPlacement })\n    .setCustomFieldConfig('fillOpacity', 9)\n    .setBehaviors([extremeValueFilterBehavior]);\n\n  if (queryParams.queries.length > 1) {\n    const startColorIndex = panelConfig.fixedColorIndex || 0;\n\n    vizPanelBuilder.setOverrides((b) => {\n      queryParams.queries.forEach((query, i) => {\n        b.matchFieldsByQuery(query.refId).overrideColor({\n          mode: 'fixed',\n          fixedColor: getColorByIndex(startColorIndex + i),\n        });\n      });\n    });\n  } else {\n    vizPanelBuilder.setColor(\n      panelConfig.fixedColorIndex\n        ? { mode: 'fixed', fixedColor: getColorByIndex(panelConfig.fixedColorIndex) }\n        : undefined\n    );\n  }\n\n  return vizPanelBuilder.build();\n}\n\nfunction buildGroupByPanel(options: Required<TimeseriesPanelOptions>): VizPanel {\n  const { metric, panelConfig, queryConfig } = options;\n  const queryParams = getTimeseriesQueryRunnerParams({ metric, queryConfig });\n  const unit = queryParams.isRateQuery ? getPerSecondRateUnit(metric) : getUnit(metric);\n\n  const $data = new SceneDataTransformer({\n    $data: new SceneQueryRunner({\n      datasource: trailDS,\n      maxDataPoints: queryParams.maxDataPoints,\n      queries: queryParams.queries,\n    }),\n    transformations: [addUnspecifiedLabel(queryConfig.groupBy!)],\n  });\n\n  return PanelBuilders.timeseries()\n    .setTitle(panelConfig.title)\n    .setDescription(panelConfig.description)\n    .setHeaderActions(panelConfig.headerActions({ metric, panelConfig }))\n    .setMenu(panelConfig.menu?.clone()) // we clone because it's already stored in GmdVizPanel\n    .setShowMenuAlways(Boolean(panelConfig.menu))\n    .setData($data)\n    .setUnit(unit)\n    .setOption('legend', panelConfig.legend || { showLegend: true, placement: 'right' as LegendPlacement })\n    .setOption('tooltip', { mode: TooltipDisplayMode.Multi, sort: SortOrder.Descending })\n    .build();\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2, type ValueMapping } from '@grafana/data';\nimport {\n  SceneObjectBase,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type VizPanel,\n  type VizPanelState,\n} from '@grafana/scenes';\nimport { useStyles2, type VizLegendOptions } from '@grafana/ui';\nimport { isEqual } from 'lodash';\nimport React from 'react';\n\nimport { getTrailFor } from 'utils';\n\nimport { type LabelMatcher } from './buildQueryExpression';\nimport { EventPanelTypeChanged } from './components/EventPanelTypeChanged';\nimport { SelectAction } from './components/SelectAction';\nimport { getPreferredConfigForMetric } from './config/getPreferredConfigForMetric';\nimport { PANEL_HEIGHT } from './config/panel-heights';\nimport { type PrometheusFunction } from './config/promql-functions';\nimport { QUERY_RESOLUTION } from './config/query-resolutions';\nimport { isHistogramMetric } from './matchers/isHistogramMetric';\nimport { isStatusUpDownMetric } from './matchers/isStatusUpDownMetric';\nimport { type PanelType } from './types/available-panel-types';\nimport { buildHeatmapPanel } from './types/heatmap/buildHeatmapPanel';\nimport { buildPercentilesPanel } from './types/percentiles/buildPercentilesPanel';\nimport { buildStatPanel } from './types/stat/buildStatPanel';\nimport { buildStatushistoryPanel } from './types/statushistory/buildStatushistoryPanel';\nimport { buildTimeseriesPanel } from './types/timeseries/buildTimeseriesPanel';\n\n/* Panel config */\n\nexport type PanelConfig = {\n  type: PanelType;\n  title: string;\n  height: PANEL_HEIGHT;\n  headerActions: (headerActionsArgs: { metric: string; panelConfig: PanelConfig }) => VizPanelState['headerActions'];\n  fixedColorIndex?: number;\n  description?: string;\n  menu?: VizPanelState['menu'];\n  legend?: Partial<VizLegendOptions>;\n  mappings?: ValueMapping[];\n};\n\nexport type PanelOptions = {\n  type?: PanelConfig['type'];\n  height?: PanelConfig['height'];\n  fixedColorIndex?: PanelConfig['fixedColorIndex'];\n  title?: PanelConfig['title'];\n  description?: PanelConfig['description'];\n  headerActions?: PanelConfig['headerActions'];\n  menu?: PanelConfig['menu'];\n  legend?: PanelConfig['legend'];\n  mappings?: PanelConfig['mappings'];\n};\n\n/* Query config */\n\nexport type QueryDefs = Array<{\n  fn: PrometheusFunction;\n  params?: Record<string, any>;\n}>;\n\nexport type QueryConfig = {\n  resolution: QUERY_RESOLUTION;\n  labelMatchers: LabelMatcher[];\n  addIgnoreUsageFilter: boolean;\n  groupBy?: string;\n  queries?: QueryDefs;\n};\n\nexport type QueryOptions = {\n  resolution?: QueryConfig['resolution'];\n  labelMatchers?: QueryConfig['labelMatchers'];\n  groupBy?: string;\n  queries?: QueryDefs;\n};\n\n/* GmdVizPanelState */\n\nexport type HistogramType = 'native' | 'classic' | 'none';\n\ninterface GmdVizPanelState extends SceneObjectState {\n  metric: string;\n  histogramType: HistogramType;\n  panelConfig: PanelConfig;\n  queryConfig: QueryConfig;\n  body?: VizPanel;\n}\n\nexport class GmdVizPanel extends SceneObjectBase<GmdVizPanelState> {\n  constructor({\n    key,\n    metric,\n    panelOptions,\n    queryOptions,\n    discardUserPrefs,\n  }: {\n    key?: string;\n    metric: GmdVizPanelState['metric'];\n    panelOptions?: PanelOptions;\n    queryOptions?: QueryOptions;\n    discardUserPrefs?: boolean;\n  }) {\n    const histogramType = isHistogramMetric(metric) ? 'classic' : 'none';\n    const prefConfig = discardUserPrefs ? undefined : getPreferredConfigForMetric(metric);\n\n    super({\n      key,\n      metric,\n      histogramType,\n      panelConfig: {\n        // we want a panel type to get a chance to render the panel as soon as possible\n        // we can't determine if it's a native histogram here because it's an async process that will be done in onActivate()\n        type: panelOptions?.type || GmdVizPanel.getDefaultPanelTypeForMetric(metric, histogramType),\n        title: metric,\n        height: PANEL_HEIGHT.M,\n        headerActions: ({ metric }) => [new SelectAction({ metric })],\n        ...panelOptions,\n        ...prefConfig?.panelOptions,\n      },\n      queryConfig: {\n        resolution: QUERY_RESOLUTION.MEDIUM,\n        labelMatchers: [],\n        addIgnoreUsageFilter: true,\n        ...queryOptions,\n        ...prefConfig?.queryOptions,\n      },\n      body: undefined,\n    });\n\n    this.addActivationHandler(() => {\n      this.onActivate(Boolean(panelOptions?.type || prefConfig?.panelOptions.type));\n    });\n  }\n\n  private async onActivate(discardPanelTypeUpdates: boolean) {\n    const { metric, panelConfig } = this.state;\n\n    const isNativeHistogram = await getTrailFor(this).isNativeHistogram(metric);\n    if (isNativeHistogram) {\n      this.setState({\n        histogramType: 'native',\n        panelConfig: discardPanelTypeUpdates\n          ? panelConfig\n          : { description: 'Native Histogram ', ...panelConfig, type: 'heatmap' },\n      });\n    }\n\n    this.updateBody();\n\n    this.subscribeToStateChanges();\n    this.subscribeToEvents();\n  }\n\n  private static getDefaultPanelTypeForMetric(metric: string, histogramType: HistogramType): PanelType {\n    if (isStatusUpDownMetric(metric)) {\n      return 'statushistory';\n    }\n\n    if (histogramType === 'classic' || histogramType === 'native') {\n      return 'heatmap';\n    }\n\n    return 'timeseries';\n  }\n\n  private subscribeToStateChanges() {\n    this.subscribeToState((newState, prevState) => {\n      if (\n        newState.histogramType !== prevState.histogramType ||\n        !isEqual(newState.panelConfig, prevState.panelConfig) ||\n        !isEqual(newState.queryConfig, prevState.queryConfig)\n      ) {\n        this.updateBody();\n      }\n    });\n  }\n\n  private subscribeToEvents() {\n    this.subscribeToEvent(EventPanelTypeChanged, (event) => {\n      this.setState({\n        panelConfig: {\n          ...this.state.panelConfig,\n          type: event.payload.panelType,\n        },\n      });\n    });\n  }\n\n  private updateBody() {\n    const { metric, panelConfig, queryConfig, histogramType } = this.state;\n\n    switch (panelConfig.type) {\n      case 'timeseries':\n        this.setState({\n          body: buildTimeseriesPanel({ metric, panelConfig, queryConfig }),\n        });\n        return;\n\n      case 'heatmap':\n        this.setState({\n          body: buildHeatmapPanel({ metric, histogramType, panelConfig, queryConfig }),\n        });\n        return;\n\n      case 'percentiles':\n        this.setState({\n          body: buildPercentilesPanel({\n            metric,\n            histogramType,\n            panelConfig,\n            queryConfig,\n          }),\n        });\n        return;\n\n      case 'statushistory':\n        this.setState({\n          body: buildStatushistoryPanel({ metric, panelConfig, queryConfig }),\n        });\n        return;\n\n      case 'stat':\n        this.setState({\n          body: buildStatPanel({ metric, panelConfig, queryConfig }),\n        });\n        return;\n\n      default:\n        throw new TypeError(`Unsupported panel type \"${panelConfig.type}\"!`);\n    }\n  }\n\n  public update(panelOptions: PanelOptions, queryOptions: QueryOptions) {\n    const { panelConfig, queryConfig } = this.state;\n\n    this.setState({\n      panelConfig: {\n        ...panelConfig,\n        ...panelOptions,\n      },\n      queryConfig: {\n        ...queryConfig,\n        ...queryOptions,\n      },\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<GmdVizPanel>) => {\n    const { body, panelConfig } = model.useState();\n    const styles = useStyles2(getStyles, panelConfig.height);\n\n    return (\n      <div className={styles.container} data-testid=\"gmd-vizpanel\">\n        {body && <body.Component model={body} />}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2, height: PANEL_HEIGHT) {\n  return {\n    container: css`\n      width: 100%;\n      height: ${height}px;\n    `,\n  };\n}\n","import {\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport React from 'react';\n\nexport enum LayoutType {\n  GRID = 'grid',\n  ROWS = 'rows',\n  SINGLE = 'single',\n}\n\nexport interface LayoutSwitcherState extends SceneObjectState {\n  urlSearchParamName: string;\n  layout: LayoutType;\n  options: Array<{ label: string; value: LayoutType }>;\n}\n\nexport class LayoutSwitcher extends SceneObjectBase<LayoutSwitcherState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: [this.state.urlSearchParamName],\n  });\n\n  static readonly DEFAULT_OPTIONS = [\n    { label: 'Grid', value: LayoutType.GRID },\n    { label: 'Rows', value: LayoutType.ROWS },\n  ];\n\n  static readonly DEFAULT_LAYOUT = LayoutType.GRID;\n\n  constructor({\n    urlSearchParamName,\n    options,\n  }: {\n    urlSearchParamName?: LayoutSwitcherState['urlSearchParamName'];\n    options?: LayoutSwitcherState['options'];\n  }) {\n    super({\n      key: 'layout-switcher',\n      urlSearchParamName: urlSearchParamName || 'layout',\n      options: options || LayoutSwitcher.DEFAULT_OPTIONS,\n      layout: LayoutSwitcher.DEFAULT_LAYOUT,\n    });\n  }\n\n  getUrlState() {\n    return {\n      [this.state.urlSearchParamName]: this.state.layout,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<LayoutSwitcherState> = {};\n    const newLayout = values[this.state.urlSearchParamName] as LayoutType;\n\n    if (newLayout !== this.state.layout) {\n      stateUpdate.layout = this.state.options.find((o) => o.value === newLayout)\n        ? newLayout\n        : LayoutSwitcher.DEFAULT_LAYOUT;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  private onChange = (layout: LayoutType) => {\n    this.setState({ layout });\n  };\n\n  static readonly Component = ({ model }: SceneComponentProps<LayoutSwitcher>) => {\n    const { options, layout } = model.useState();\n\n    return (\n      <RadioButtonGroup\n        aria-label=\"Layout switcher\"\n        options={options}\n        value={layout}\n        onChange={model.onChange}\n        fullWidth={false}\n      />\n    );\n  };\n}\n","import {\n  MultiValueVariable,\n  sceneGraph,\n  SceneObjectBase,\n  VariableDependencyConfig,\n  type SceneComponentProps,\n  type SceneLayout,\n  type SceneObject,\n  type SceneObjectState,\n  type VariableValueOption,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { logger } from 'tracking/logger/logger';\n\n/**\n * This component has been borrowd from Scenes v5,41,1, which is the version Metrics Drilldown currently use.\n *\n * The main purpose of this new component is to create a Scene object that has the capabilities of the original SceneByVariableRepeater and\n * that also to provide:\n *\n *   1. lazy loading/pagination\n *   2. configurable loading/error/empty states\n *   4. minor details (like calling getLayoutChild() and passing an index for multi coloring timeseries)\n *\n *\n */\ninterface SceneByVariableRepeaterState extends SceneObjectState {\n  variableName: string;\n  body: SceneLayout;\n  getLayoutChild(option: VariableValueOption, index: number, options: VariableValueOption[]): SceneObject | null;\n  getLayoutLoading?: () => SceneObject;\n  getLayoutError?: (error: Error) => SceneObject;\n  getLayoutEmpty?: () => SceneObject;\n  currentBatchSize: number;\n  initialPageSize: number;\n  pageSizeIncrement: number;\n  loadingLayout?: SceneObject;\n  errorLayout?: SceneObject;\n  emptyLayout?: SceneObject;\n}\n\nconst DEFAULT_INITIAL_PAGE_SIZE = 6;\nconst DEFAULT_PAGE_SIZE_INCREMENT = 9;\n\nexport class SceneByVariableRepeater extends SceneObjectBase<SceneByVariableRepeaterState> {\n  protected _variableDependency: VariableDependencyConfig<SceneByVariableRepeaterState> = new VariableDependencyConfig(\n    this,\n    {\n      variableNames: [this.state.variableName],\n      onVariableUpdateCompleted: () => this.performRepeat(),\n    }\n  );\n\n  public constructor({\n    variableName,\n    body,\n    getLayoutChild,\n    getLayoutLoading,\n    getLayoutError,\n    getLayoutEmpty,\n    initialPageSize,\n    pageSizeIncrement,\n  }: {\n    variableName: SceneByVariableRepeaterState['variableName'];\n    body: SceneByVariableRepeaterState['body'];\n    getLayoutChild: SceneByVariableRepeaterState['getLayoutChild'];\n    getLayoutLoading?: SceneByVariableRepeaterState['getLayoutLoading'];\n    getLayoutError?: SceneByVariableRepeaterState['getLayoutError'];\n    getLayoutEmpty?: SceneByVariableRepeaterState['getLayoutEmpty'];\n    initialPageSize?: SceneByVariableRepeaterState['initialPageSize'];\n    pageSizeIncrement?: SceneByVariableRepeaterState['pageSizeIncrement'];\n  }) {\n    super({\n      variableName,\n      body,\n      getLayoutChild,\n      getLayoutLoading,\n      getLayoutError,\n      getLayoutEmpty,\n      currentBatchSize: 0,\n      initialPageSize: initialPageSize || DEFAULT_INITIAL_PAGE_SIZE,\n      pageSizeIncrement: pageSizeIncrement || DEFAULT_PAGE_SIZE_INCREMENT,\n      loadingLayout: undefined,\n      errorLayout: undefined,\n      emptyLayout: undefined,\n    });\n\n    this.addActivationHandler(() => this.performRepeat());\n  }\n\n  private performRepeat() {\n    if (this._variableDependency.hasDependencyInLoadingState()) {\n      this.setState({\n        loadingLayout: this.state.getLayoutLoading?.(),\n        errorLayout: undefined,\n        emptyLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this);\n    if (!(variable instanceof MultiValueVariable)) {\n      const error = new Error('SceneByVariableRepeater: variable is not a MultiValueVariable!');\n      logger.error(error);\n      return;\n    }\n\n    if (variable.state.error) {\n      this.setState({\n        errorLayout: this.state.getLayoutError?.(variable.state.error),\n        loadingLayout: undefined,\n        emptyLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    const values = getMultiVariableValues(variable);\n\n    if (!values.length) {\n      this.setState({\n        emptyLayout: this.state.getLayoutEmpty?.(),\n        errorLayout: undefined,\n        loadingLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    this.setState({\n      loadingLayout: undefined,\n      errorLayout: undefined,\n      emptyLayout: undefined,\n      currentBatchSize: this.state.initialPageSize,\n    });\n\n    const newChildren: SceneObject[] = values\n      .slice(0, this.state.initialPageSize)\n      .map((option, index) => this.state.getLayoutChild(option, index, values))\n      .filter(Boolean) as SceneObject[];\n\n    this.state.body.setState({\n      children: newChildren,\n    });\n  }\n\n  public increaseBatchSize() {\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this) as MultiValueVariable;\n    const values = getMultiVariableValues(variable);\n\n    const newBatchSize = this.state.currentBatchSize + this.state.pageSizeIncrement;\n\n    const newChildren: SceneObject[] = values\n      .slice(this.state.currentBatchSize, newBatchSize)\n      .map((option, index) => this.state.getLayoutChild(option, this.state.currentBatchSize + index, values))\n      .filter(Boolean) as SceneObject[];\n\n    this.state.body.setState({\n      children: [...this.state.body.state.children, ...newChildren],\n    });\n\n    this.setState({\n      currentBatchSize: newBatchSize,\n    });\n  }\n\n  public useSizes() {\n    const { currentBatchSize, pageSizeIncrement } = this.useState();\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this);\n    const total = (variable as MultiValueVariable).state.options.length;\n    const remaining = total - currentBatchSize;\n    const increment = remaining < pageSizeIncrement ? remaining : pageSizeIncrement;\n    return {\n      increment,\n      current: currentBatchSize,\n      total,\n    };\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<SceneByVariableRepeater>) => {\n    const { body, loadingLayout, errorLayout, emptyLayout } = model.useState();\n\n    if (loadingLayout) {\n      return <loadingLayout.Component model={loadingLayout} />;\n    }\n\n    if (errorLayout) {\n      return <errorLayout.Component model={errorLayout} />;\n    }\n\n    if (emptyLayout) {\n      return <emptyLayout.Component model={emptyLayout} />;\n    }\n\n    return <body.Component model={body} />;\n  };\n}\n\nexport function getMultiVariableValues(variable: MultiValueVariable): VariableValueOption[] {\n  const { value, text, options } = variable.state;\n\n  if (variable.hasAllValue()) {\n    return options;\n  }\n\n  if (Array.isArray(value) && Array.isArray(text)) {\n    return value.map((v, i) => ({ value: v, label: text[i] as string }));\n  }\n\n  return [{ value: value as string, label: text as string }];\n}\n","import { Button } from '@grafana/ui';\nimport React, { type MouseEventHandler } from 'react';\n\ntype ShowMoreButtonProps = {\n  label: string;\n  batchSizes: {\n    increment: number;\n    current: number;\n    total: number;\n  };\n  onClick: MouseEventHandler<HTMLButtonElement>;\n  tooltip?: string;\n};\n\nexport function ShowMoreButton({ label, batchSizes, onClick, tooltip }: Readonly<ShowMoreButtonProps>) {\n  return (\n    <Button variant=\"secondary\" fill=\"outline\" onClick={onClick} tooltip={tooltip} tooltipPlacement=\"top\">\n      Show {batchSizes.increment} more {batchSizes.increment === 1 ? label : `${label}s`} ({batchSizes.current}/\n      {batchSizes.total})\n    </Button>\n  );\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { type SortingOption } from '../MetricsSorter';\n\ninterface EventSortByChangedPayload {\n  sortBy: SortingOption;\n}\n\nexport class EventSortByChanged extends BusEventWithPayload<EventSortByChangedPayload> {\n  public static readonly type = 'sort-by-changed';\n}\n","import { getBackendSrv, type BackendSrvRequest } from '@grafana/runtime';\n\nimport { logger } from '../../../../tracking/logger/logger';\nimport { extractMetricNames } from '../../../../utils/utils.promql';\n\nimport type { MetricUsageDetails } from './fetchDashboardMetrics';\ninterface AlertingRule {\n  id: number;\n  uid: string;\n  title: string;\n  data: Array<{\n    refId: string;\n    queryType: string;\n    datasourceUid: string;\n    model: {\n      expr?: string;\n      expression?: string;\n      type?: string;\n      datasource?: {\n        type: string;\n        uid: string;\n      };\n    };\n  }>;\n}\n\nconst usageRequestOptions: Partial<BackendSrvRequest> = {\n  showSuccessAlert: false,\n  showErrorAlert: false,\n} as const;\n\n// TODO: update parseAlertingRules to do what the dashboards function does\nfunction transformCountsToAlertingUsage(counts: Record<string, number>): Record<string, MetricUsageDetails> {\n  const result: Record<string, MetricUsageDetails> = {};\n  for (const metric in counts) {\n    result[metric] = {\n      usageType: 'alerting-usage',\n      count: counts[metric],\n    };\n  }\n  return result;\n}\n\n/**\n * Fetches metric usage data from alerting rules\n * @returns A record mapping metric names to their occurrence count in alerting rules\n */\nexport async function fetchAlertingMetrics(): Promise<Record<string, MetricUsageDetails>> {\n  try {\n    const alertingRules = await getBackendSrv().get<AlertingRule[]>(\n      '/api/v1/provisioning/alert-rules',\n      undefined,\n      'grafana-metricsdrilldown-app-alert-rule-metric-usage',\n      usageRequestOptions\n    );\n\n    return transformCountsToAlertingUsage(parseAlertingRules(alertingRules));\n  } catch (err) {\n    const error = typeof err === 'string' ? new Error(err) : (err as Error);\n    logger.error(error, {\n      message: 'Failed to fetch alerting rules',\n    });\n    // Return empty object when fetch fails\n    return {};\n  }\n}\n\nfunction parseAlertingRules(alertingRules: AlertingRule[]): Record<string, number> {\n  // Create a map to count metric occurrences\n  const metricCounts: Record<string, number> = {};\n\n  const relevantRules = alertingRules.filter((rule) => rule?.data.length > 0);\n\n  for (const rule of relevantRules) {\n    // Skip non-Prometheus queries or expression queries (like threshold or reduce expressions)\n    const prometheusQueries = rule.data.filter(\n      (query) => typeof query.model?.expr === 'string' && query.datasourceUid !== '__expr__'\n    );\n\n    for (const query of prometheusQueries) {\n      try {\n        // Extract metrics from the PromQL expression\n        const metrics = extractMetricNames(query.model.expr as string);\n\n        // Count each metric occurrence\n        for (const metric of metrics) {\n          metricCounts[metric] = (metricCounts[metric] || 0) + 1;\n        }\n      } catch (error) {\n        // Log parsing errors but continue processing other expressions\n        logger.warn(error, {\n          message: `Failed to parse PromQL expression in alert rule ${rule.title}`,\n        });\n      }\n    }\n  }\n\n  return metricCounts;\n}\n","import { getBackendSrv, type BackendSrvRequest } from '@grafana/runtime';\nimport { type Dashboard, type Panel } from '@grafana/schema';\nimport { limitFunction } from 'p-limit';\n\nimport { logger } from '../../../../tracking/logger/logger';\nimport { isPrometheusDataSource } from '../../../../utils/utils.datasource';\nimport { extractMetricNames } from '../../../../utils/utils.promql';\n\ninterface DashboardSearchItem {\n  id: number;\n  uid: string;\n  title: string;\n  url: string;\n  folderTitle?: string;\n  folderUid?: string;\n  tags: string[];\n  isStarred: boolean;\n}\n\nexport type MetricUsageDetails =\n  | {\n      usageType: 'dashboard-usage';\n      count: number;\n      dashboards: Record<string, { count: number; uid: string; url: string }>;\n    } // e.g., {\"Dashboard A\": { count: 2, uid: \"123\" }}\n  | { usageType: 'alerting-usage'; count: number }; // TODO: implement `alerts: Record<string, number>`\n\ntype MetricUsageMap = Record<string, MetricUsageDetails>;\n\nconst usageRequestOptions: Partial<BackendSrvRequest> = {\n  showSuccessAlert: false,\n  showErrorAlert: false,\n} as const;\n\ntype DashboardWithUrl = Dashboard & { url: string };\n\nconst dashboardRequestMap = new Map<string, Promise<DashboardWithUrl | null>>();\n\nconst getDashboardLimited = limitFunction(\n  async (dashboardUid: string, url, dashboardRequestsFailedCount: number) => {\n    let promise = dashboardRequestMap.get(dashboardUid);\n\n    if (!promise) {\n      promise = getBackendSrv()\n        .get<{ dashboard: Dashboard }>(\n          `/api/dashboards/uid/${dashboardUid}`,\n          undefined,\n          `grafana-metricsdrilldown-app-dashboard-metric-usage-${dashboardUid}`,\n          usageRequestOptions\n        )\n        .then(({ dashboard }) => ({ ...dashboard, url } as DashboardWithUrl))\n        .catch((error) => {\n          // Prevent excessive noise\n          if (dashboardRequestsFailedCount <= 5) {\n            logger.error(error, { dashboardUid });\n          }\n\n          dashboardRequestsFailedCount++;\n          return Promise.resolve(null);\n        })\n        .finally(() => {\n          dashboardRequestMap.delete(dashboardUid);\n        });\n      dashboardRequestMap.set(dashboardUid, promise);\n    }\n\n    return promise;\n  },\n  { concurrency: 50 }\n);\n\n/**\n * Fetches metric usage data from dashboards\n * @returns A record mapping metric names to their dashboard usage data\n */\nexport async function fetchDashboardMetrics(): Promise<Record<string, MetricUsageDetails>> {\n  try {\n    const dashboards = await getBackendSrv().get<DashboardSearchItem[]>(\n      '/api/search',\n      {\n        type: 'dash-db',\n        limit: 500,\n      },\n      'grafana-metricsdrilldown-app-dashboard-search',\n      usageRequestOptions\n    );\n\n    let dashboardRequestsFailedCount = 0;\n\n    const metricCounts = await Promise.all(\n      dashboards.map(({ uid, url }) => getDashboardLimited(uid, url, dashboardRequestsFailedCount))\n    ).then(parseDashboardSearchResponse);\n\n    return metricCounts;\n  } catch (err) {\n    const error = typeof err === 'string' ? new Error(err) : (err as Error);\n    logger.error(error, {\n      message: 'Failed to fetch dashboard metrics',\n    });\n    return {};\n  }\n}\n\nfunction updateMetricUsage(\n  metric: string,\n  dashboardName: string,\n  dashboardUid: string,\n  dashboardUrl: string,\n  dashboardData: Record<string, MetricUsageDetails>\n): void {\n  if (!dashboardData[metric]) {\n    dashboardData[metric] = { usageType: 'dashboard-usage', count: 0, dashboards: {} };\n  }\n\n  dashboardData[metric].count++;\n  if (dashboardData[metric].usageType === 'dashboard-usage') {\n    dashboardData[metric].dashboards[dashboardName] = {\n      count: (dashboardData[metric].dashboards[dashboardName]?.count || 0) + 1,\n      uid: dashboardUid || 'unknown',\n      url: dashboardUrl,\n    };\n  }\n}\n\nfunction parseDashboardSearchResponse(dashboardSearchResponse: Array<DashboardWithUrl | null>): MetricUsageMap {\n  // Create a map to track metric names and their usage details\n  const dashboardData: Record<string, MetricUsageDetails> = {};\n\n  const relevantDashboards = dashboardSearchResponse.filter(\n    (dashboard) => dashboard && dashboard?.panels?.length\n  ) as Array<DashboardWithUrl & { panels: NonNullable<Panel[]> }>;\n  // For each dashboard, for each panel in that dashboard, for each query in that panel, what metrics does that query use\n  for (const dashboard of relevantDashboards) {\n    const dashboardName = dashboard.title || `Dashboard ${dashboard.uid}`;\n    // Skip panels with non-Prometheus data sources\n    const relevantPanels = dashboard.panels.filter(\n      (panel) => isPrometheusDataSource(panel.datasource) && 'targets' in panel && panel.targets?.length\n    ) as Array<Panel & { targets: NonNullable<Panel['targets']> }>;\n\n    for (const panel of relevantPanels) {\n      for (const target of panel.targets) {\n        const expr = typeof target.expr === 'string' ? target.expr : '';\n\n        const metrics = extractMetricNames(expr); // Array of metric names used in the query\n\n        // Count each metric occurrence\n        for (const metric of metrics) {\n          updateMetricUsage(metric, dashboardName, dashboard.uid || 'unknown', dashboard.url, dashboardData);\n        }\n      }\n    }\n  }\n  return dashboardData;\n}\n","import { fetchAlertingMetrics } from './fetchers/fetchAlertingMetrics';\nimport { fetchDashboardMetrics, type MetricUsageDetails } from './fetchers/fetchDashboardMetrics';\n\ninterface MetricsUsageState {\n  metrics: Record<string, MetricUsageDetails>;\n  metricsPromise: Promise<Record<string, MetricUsageDetails>> | undefined;\n  fetcher: () => Promise<Record<string, MetricUsageDetails>>;\n}\n\nexport type MetricUsageType = 'dashboard-usage' | 'alerting-usage';\n// Fetches and stores metric usage data for dashboards and alerting rules\nexport class MetricUsageFetcher {\n  private _usageState: Record<MetricUsageType, MetricsUsageState> = {\n    'dashboard-usage': {\n      metrics: {},\n      metricsPromise: undefined,\n      fetcher: fetchDashboardMetrics,\n    },\n    'alerting-usage': {\n      metrics: {},\n      metricsPromise: undefined,\n      fetcher: fetchAlertingMetrics,\n    },\n  };\n\n  public getUsageMetrics(usageType: MetricUsageType): Promise<Record<string, MetricUsageDetails>> {\n    const hasExistingMetrics =\n      this._usageState[usageType].metrics && Object.keys(this._usageState[usageType].metrics).length > 0;\n\n    if (hasExistingMetrics) {\n      return Promise.resolve(this._usageState[usageType].metrics);\n    }\n\n    if (!this._usageState[usageType].metricsPromise) {\n      this._usageState[usageType].metricsPromise = this._usageState[usageType].fetcher().then((metrics) => {\n        this._usageState[usageType].metrics = metrics;\n        this._usageState[usageType].metricsPromise = undefined;\n        return metrics;\n      });\n    }\n\n    return this._usageState[usageType].metricsPromise;\n  }\n\n  public getUsageForMetric(metricName: string, usageType: MetricUsageType): Promise<number> {\n    return this.getUsageMetrics(usageType).then((metrics) => metrics[metricName]?.count ?? 0);\n  }\n\n  public getUsageDetailsForMetric(metricName: string, usageType: MetricUsageType): Promise<MetricUsageDetails> {\n    return this.getUsageMetrics(usageType).then(\n      (metrics) =>\n        metrics[metricName] ??\n        (usageType === 'dashboard-usage'\n          ? { usageType: 'dashboard-usage', count: 0, dashboards: {} }\n          : { usageType: 'alerting-usage', count: 0 })\n    );\n  }\n}\n","import {\n  CustomVariable,\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n  VariableValueSelectors,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type VariableValueOption,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { localeCompare } from 'WingmanDataTrail/helpers/localCompare';\n\nimport { EventSortByChanged } from './events/EventSortByChanged';\nimport { type MetricUsageDetails } from './fetchers/fetchDashboardMetrics';\nimport { MetricUsageFetcher, type MetricUsageType } from './MetricUsageFetcher';\nimport { logger } from '../../../tracking/logger/logger';\nimport { PREF_KEYS } from '../../../UserPreferences/pref-keys';\nimport { userStorage } from '../../../UserPreferences/userStorage';\nexport type SortingOption = 'default' | 'dashboard-usage' | 'alerting-usage';\n\nconst MAX_RECENT_METRICS = 6;\nconst RECENT_METRICS_EXPIRY_DAYS = 30;\n\ninterface RecentMetric {\n  name: string;\n  timestamp: number;\n}\n\n/**\n * Adds a metric to the recent metrics list in localStorage\n * @param metricName The name of the metric to add\n */\nexport function addRecentMetric(metricName: string): void {\n  try {\n    const recentMetrics = getRecentMetrics();\n    const now = Date.now();\n\n    // Remove the metric if it already exists and add it with new timestamp\n    const filteredMetrics = recentMetrics.filter((m) => m.name !== metricName);\n    filteredMetrics.unshift({ name: metricName, timestamp: now });\n\n    // Keep only the most recent metrics\n    const updatedMetrics = filteredMetrics.slice(0, MAX_RECENT_METRICS);\n    userStorage.setItem(PREF_KEYS.RECENT_METRICS, updatedMetrics);\n  } catch (error) {\n    const errorObject = error instanceof Error ? error : new Error(String(error));\n\n    logger.error(errorObject, {\n      ...(errorObject.cause || {}),\n      metricName,\n    });\n  }\n}\n\n/**\n * Gets the list of recent metrics from localStorage, removing expired ones\n * @returns Array of recent metric names\n */\nexport function getRecentMetrics(): RecentMetric[] {\n  try {\n    const recentMetrics: RecentMetric[] = userStorage.getItem(PREF_KEYS.RECENT_METRICS) || [];\n    if (!recentMetrics.length) {\n      return [];\n    }\n\n    const now = Date.now();\n    const thirtyDaysAgo = now - RECENT_METRICS_EXPIRY_DAYS * 24 * 60 * 60 * 1000;\n\n    // Filter out expired metrics\n    const validMetrics = recentMetrics.filter((metric) => metric.timestamp > thirtyDaysAgo);\n\n    // If any metrics were removed, update storage\n    if (validMetrics.length !== recentMetrics.length) {\n      userStorage.setItem(PREF_KEYS.RECENT_METRICS, validMetrics);\n    }\n\n    return validMetrics;\n  } catch (error) {\n    logger.error(error as Error, { message: 'Failed to get recent metrics:' });\n    return [];\n  }\n}\n\ninterface MetricsSorterState extends SceneObjectState {\n  $variables: SceneVariableSet;\n  inputControls: SceneObject;\n}\n\nconst sortByOptions: VariableValueOption[] = [\n  { label: 'Default', value: 'default' },\n  { label: 'Dashboard Usage', value: 'dashboard-usage' },\n  { label: 'Alerting Usage', value: 'alerting-usage' },\n] as const;\n\nexport const VAR_WINGMAN_SORT_BY = 'metrics-reducer-sort-by';\n\nexport class MetricsSorter extends SceneObjectBase<MetricsSorterState> {\n  initialized = false;\n  supportedSortByOptions = new Set<SortingOption>(['default', 'dashboard-usage', 'alerting-usage']);\n  private usageFetcher = new MetricUsageFetcher();\n\n  constructor(state: Partial<MetricsSorterState>) {\n    super({\n      ...state,\n      key: 'metrics-sorter',\n      $variables: new SceneVariableSet({\n        variables: [\n          new CustomVariable({\n            name: VAR_WINGMAN_SORT_BY,\n            label: 'Sort by',\n            value: 'default',\n            query: sortByOptions.map((option) => `${option.label} : ${option.value}`).join(','),\n            description:\n              'Sort metrics by default (alphabetically, with recently-selected metrics first), by prevalence in dashboard panel queries, or by prevalence in alerting rules',\n          }),\n        ],\n      }),\n      inputControls: new VariableValueSelectors({ layout: 'horizontal' }),\n    });\n\n    this.addActivationHandler(() => this.activationHandler());\n  }\n\n  private activationHandler() {\n    const sortByVar = sceneGraph.getVariables(this).getByName(VAR_WINGMAN_SORT_BY) as CustomVariable;\n\n    if (!this.supportedSortByOptions.has(sortByVar.getValue() as SortingOption)) {\n      // Migration for the old sortBy values\n      sortByVar.changeValueTo('default');\n    }\n\n    this._subs.add(\n      sortByVar.subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          this.publishEvent(new EventSortByChanged({ sortBy: newState.value as SortingOption }), true);\n        }\n      })\n    );\n  }\n\n  public getUsageDetailsForMetric(metricName: string, usageType: MetricUsageType): Promise<MetricUsageDetails> {\n    return this.usageFetcher.getUsageDetailsForMetric(metricName, usageType);\n  }\n\n  // Converts MetricUsageDetails format to simple counts (Record<string, number>) for backward compatibility with sorting logic\n  public getUsageMetrics(usageType: MetricUsageType): Promise<Record<string, number>> {\n    return this.usageFetcher.getUsageMetrics(usageType).then((metrics) => {\n      const metricsToCounts: Record<string, number> = {};\n      for (const metric in metrics) {\n        metricsToCounts[metric] = metrics[metric].count;\n      }\n      return metricsToCounts;\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsSorter>) => {\n    const { inputControls } = model.useState();\n\n    return (\n      <div data-testid=\"sort-by-select\">\n        <inputControls.Component model={inputControls} />\n      </div>\n    );\n  };\n}\n\n/**\n * Sort metrics by an arbitrary count (descending)\n * @param metrics Array of metric names\n * @param counts A record mapping metric names to an arbitrary count\n * @returns Sorted array of metric names\n */\nexport function sortMetricsByCount(metrics: string[], counts: Record<string, number>): string[] {\n  return [...metrics].sort((a, b) => {\n    const scoreA = counts[a] || 0;\n    const scoreB = counts[b] || 0;\n\n    // Primary sort by score (descending)\n    if (scoreB !== scoreA) {\n      return scoreB - scoreA;\n    }\n\n    // Secondary sort alphabetically for metrics with the same score\n    return localeCompare(a, b);\n  });\n}\n\n/**\n * Sort metrics in alphabetical order\n * @param metrics Array of metric names\n * @returns Sorted array of metric names in alphabetical order\n */\nfunction sortMetricsAlphabetically(metrics: string[]): string[] {\n  return [...metrics].sort((a, b) => localeCompare(a, b));\n}\n\n/**\n * Sort metrics with recent metrics first (by recency), then alphabetically\n * @param metrics Array of metric names\n * @returns Sorted array of metric names\n */\nexport function sortMetricsWithRecentFirst(metrics: string[]): string[] {\n  const allRecentMetrics = getRecentMetrics().map((m) => m.name);\n  const allRecentMetricsSet = new Set(allRecentMetrics);\n  const [recent, nonRecent] = metrics.reduce<[string[], string[]]>(\n    ([recent, nonRecent], metric) => {\n      if (allRecentMetricsSet.has(metric)) {\n        recent.push(metric);\n      } else {\n        nonRecent.push(metric);\n      }\n      return [recent, nonRecent];\n    },\n    [[], []]\n  );\n  const sortedNonRecent = sortMetricsAlphabetically(nonRecent);\n  // `recentMetrics` are already sorted by recency, so we just need to filter them\n  const sortedRecent = allRecentMetrics.filter((m) => recent.includes(m));\n\n  return [...sortedRecent, ...sortedNonRecent];\n}\n","import { config } from '@grafana/runtime';\nimport { DataSourceVariable } from '@grafana/scenes';\n\nimport { VAR_DATASOURCE } from 'shared';\nimport { logger } from 'tracking/logger/logger';\nimport { isPrometheusDataSource } from 'utils/utils.datasource';\n\nimport { PREF_KEYS } from './UserPreferences/pref-keys';\nimport { userStorage } from './UserPreferences/userStorage';\n\nexport class MetricsDrilldownDataSourceVariable extends DataSourceVariable {\n  constructor({ initialDS }: { initialDS?: string }) {\n    super({\n      key: VAR_DATASOURCE,\n      name: VAR_DATASOURCE,\n      pluginId: 'prometheus',\n      label: 'Data source',\n      description: 'Only prometheus data sources are supported',\n      // if no initialDS is passed to the constructor, we bypass Scenes native behaviour by determining the data source ourselves (see getCurrentDataSource())...\n      skipUrlSync: !initialDS,\n      // ... by doing this, we make sure that we'll always have a data source when the \"var-ds\" URL search param is missing, incorrect, etc.\n      value: initialDS || MetricsDrilldownDataSourceVariable.getCurrentDataSource(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.setState({ skipUrlSync: false }); // restore URL sync\n\n    this.subscribeToState((newState, prevState) => {\n      if (newState.value && newState.value !== prevState.value) {\n        // store the new value for future visits\n        userStorage.setItem(PREF_KEYS.DATASOURCE, newState.value as string);\n      }\n    });\n  }\n\n  private static getCurrentDataSource(): string {\n    const prometheusDataSources = Object.values(config.datasources).filter((ds) => isPrometheusDataSource(ds));\n\n    const uidFromUrl = new URL(window.location.href).searchParams.get(`var-${VAR_DATASOURCE}`);\n    const uidFromLocalStorage = userStorage.getItem(PREF_KEYS.DATASOURCE);\n\n    const currentDataSource =\n      prometheusDataSources.find((ds) => ds.uid === uidFromUrl) ||\n      prometheusDataSources.find((ds) => ds.uid === uidFromLocalStorage) ||\n      prometheusDataSources.find((ds) => ds.isDefault) ||\n      prometheusDataSources[0];\n\n    if (!currentDataSource) {\n      logger.warn('Cannot find any Prometheus data source!');\n      return 'no-data-source-configured';\n    }\n\n    return currentDataSource.uid;\n  }\n}\n","import { isEqual } from 'lodash';\n\nexport const areArraysEqual = (array1: any[], array2: any[]) =>\n  array1.length === array2.length && isEqual(array1, array2);\n","import { VariableHide, VariableRefresh, VariableSort } from '@grafana/data';\nimport { QueryVariable, type SceneObjectState } from '@grafana/scenes';\n\nimport { trailDS, VAR_FILTERS } from 'shared';\n\nexport const VAR_METRICS_VARIABLE = 'metrics-wingman';\n\nexport type MetricOptions = Array<{ label: string; value: string }>;\n\ninterface MetricsVariableState extends SceneObjectState {\n  key: string;\n  name?: string;\n  label?: string;\n}\n\nexport class MetricsVariable extends QueryVariable {\n  constructor(state?: MetricsVariableState) {\n    super({\n      key: VAR_METRICS_VARIABLE,\n      name: VAR_METRICS_VARIABLE,\n      label: 'Metrics',\n      ...state,\n      datasource: trailDS,\n      query: `label_values({$${VAR_FILTERS}}, __name__)`,\n      includeAll: true,\n      value: '$__all',\n      skipUrlSync: true,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      sort: VariableSort.alphabeticalAsc,\n      hide: VariableHide.hideVariable,\n    });\n  }\n}\n","import { isPrometheusDatasourceV11_6_x } from './v11-6-x';\nimport { isPrometheusDatasourceV12_0_0 } from './v12-0-0';\nimport { isPrometheusDatasourceV12_1_0Plus } from './v12-1-0-plus';\n\nexport const languageProviderVersionIs = {\n  '11.6.x': isPrometheusDatasourceV11_6_x,\n  '12.0.0': isPrometheusDatasourceV12_0_0,\n  '12.1.0-plus': isPrometheusDatasourceV12_1_0Plus,\n};\n","import {\n  type AbstractQuery,\n  type AdHocVariableFilter,\n  type LanguageProvider,\n  type Scope,\n  type TimeRange,\n} from '@grafana/data';\nimport { type PrometheusDatasource, type PromMetricsMetadata, type PromQuery } from '@grafana/prometheus';\nimport { type BackendSrvRequest } from '@grafana/runtime';\n\nimport { type PrometheusRuntimeDatasource } from '../../helpers/MetricDatasourceHelper';\nimport { type PromQLLabelMatcher } from '../../utils/utils.promql';\n\ninterface PromQlLanguageProviderElevenDotSix extends LanguageProvider {\n  histogramMetrics: string[];\n  timeRange: TimeRange;\n  metrics: string[];\n  metricsMetadata?: PromMetricsMetadata;\n  startTask: Promise<any>;\n  datasource: PrometheusDatasource;\n  labelKeys: string[];\n  labelFetchTs: number;\n  getDefaultCacheHeaders():\n    | {\n        headers: {\n          'X-Grafana-Cache': string;\n        };\n      }\n    | undefined;\n  cleanText(s: string): string;\n  get syntax(): Prism.Grammar;\n  request: (url: string, defaultValue: any, params?: {}, options?: Partial<BackendSrvRequest>) => Promise<any>;\n  start: (timeRange?: TimeRange) => Promise<any[]>;\n  loadMetricsMetadata(): Promise<void>;\n  getLabelKeys(): string[];\n  importFromAbstractQuery(labelBasedQuery: AbstractQuery): PromQuery;\n  exportToAbstractQuery(query: PromQuery): AbstractQuery;\n  getSeries(selector: string, withName?: boolean): Promise<Record<string, string[]>>;\n  /**\n   * @param key\n   */\n  fetchLabelValues: (key: string) => Promise<string[]>;\n  getLabelValues(key: string): Promise<string[]>;\n  /**\n   * Fetches all label keys\n   */\n  fetchLabels: (timeRange?: TimeRange, queries?: PromQuery[]) => Promise<string[]>;\n  /**\n   * Gets series values\n   * Function to replace old getSeries calls in a way that will provide faster endpoints for new prometheus instances,\n   * while maintaining backward compatability\n   * @param labelName\n   * @param selector\n   */\n  getSeriesValues: (labelName: string, selector: string) => Promise<string[]>;\n  /**\n   * Fetches all values for a label, with optional match[]\n   * @param name\n   * @param match\n   * @param timeRange\n   * @param requestId\n   */\n  fetchSeriesValuesWithMatch: (\n    name: string,\n    match: string,\n    requestId?: string,\n    timeRange?: TimeRange\n  ) => Promise<string[]>;\n  /**\n   * Gets series labels\n   * Function to replace old getSeries calls in a way that will provide faster endpoints for new prometheus instances,\n   * while maintaining backward compatability. The old API call got the labels and the values in a single query,\n   * but with the new query we need two calls, one to get the labels, and another to get the values.\n   *\n   * @param selector\n   * @param otherLabels\n   */\n  getSeriesLabels: (selector: string, otherLabels: PromQLLabelMatcher[]) => Promise<string[]>;\n  /**\n   * Fetch labels using the best endpoint that datasource supports.\n   * This is cached by its args but also by the global timeRange currently selected as they can change over requested time.\n   * @param name\n   * @param withName\n   */\n  fetchLabelsWithMatch: (name: string, withName?: boolean) => Promise<Record<string, string[]>>;\n  /**\n   * Fetch labels for a series using /series endpoint. This is cached by its args but also by the global timeRange currently selected as\n   * they can change over requested time.\n   * @param name\n   * @param withName\n   * @param withLimit\n   */\n  fetchSeriesLabels: (name: string, withName?: boolean, withLimit?: string) => Promise<Record<string, string[]>>;\n  /**\n   * Fetch labels for a series using /labels endpoint.  This is cached by its args but also by the global timeRange currently selected as\n   * they can change over requested time.\n   * @param name\n   * @param withName\n   */\n  fetchSeriesLabelsMatch: (name: string, withName?: boolean) => Promise<Record<string, string[]>>;\n  /**\n   * Fetch series for a selector. Use this for raw results. Use fetchSeriesLabels() to get labels.\n   * @param match\n   */\n  fetchSeries: (match: string) => Promise<Array<Record<string, string>>>;\n  /**\n   * Fetch this only one as we assume this won't change over time. This is cached differently from fetchSeriesLabels\n   * because we can cache more aggressively here and also we do not want to invalidate this cache the same way as in\n   * fetchSeriesLabels.\n   */\n  fetchDefaultSeries: () => Promise<{}>;\n  /**\n   * Fetch labels or values for a label based on the queries, scopes, filters and time range\n   * @param timeRange\n   * @param queries\n   * @param scopes\n   * @param adhocFilters\n   * @param labelName\n   * @param limit\n   * @param requestId\n   */\n  fetchSuggestions: (\n    timeRange?: TimeRange,\n    queries?: PromQuery[],\n    scopes?: Scope[],\n    adhocFilters?: AdHocVariableFilter[],\n    labelName?: string,\n    limit?: number,\n    requestId?: string\n  ) => Promise<string[]>;\n}\n\nexport function isPrometheusDatasourceV11_6_x(ds: PrometheusRuntimeDatasource): ds is PrometheusRuntimeDatasource & {\n  languageProvider: PromQlLanguageProviderElevenDotSix;\n} {\n  const languageProvider = ds.languageProvider as PromQlLanguageProviderElevenDotSix;\n\n  return (\n    // eslint-disable-next-line sonarjs/deprecation\n    typeof languageProvider.fetchLabelValues === 'function' && languageProvider.fetchLabelValues.length === 1\n  );\n}\n","import {\n  type AbstractQuery,\n  type AdHocVariableFilter,\n  type LanguageProvider,\n  type Scope,\n  type TimeRange,\n} from '@grafana/data';\nimport { type PrometheusDatasource, type PromMetricsMetadata, type PromQuery } from '@grafana/prometheus';\nimport { type BackendSrvRequest } from '@grafana/runtime';\n\nimport { type PrometheusRuntimeDatasource } from '../../helpers/MetricDatasourceHelper';\nimport { type PromQLLabelMatcher } from '../../utils/utils.promql';\n\ninterface PromQlLanguageProviderTwelveDotZero extends LanguageProvider {\n  histogramMetrics: string[];\n  metrics: string[];\n  metricsMetadata?: PromMetricsMetadata;\n  startTask: Promise<any>;\n  datasource: PrometheusDatasource;\n  labelKeys: string[];\n  labelFetchTs: number;\n  getDefaultCacheHeaders():\n    | {\n        headers: {\n          'X-Grafana-Cache': string;\n        };\n      }\n    | undefined;\n  cleanText(s: string): string;\n  get syntax(): Prism.Grammar;\n  request: (url: string, defaultValue: any, params?: {}, options?: Partial<BackendSrvRequest>) => Promise<any>;\n  start: (timeRange?: TimeRange) => Promise<any[]>;\n  loadMetricsMetadata(): Promise<void>;\n  getLabelKeys(): string[];\n  importFromAbstractQuery(labelBasedQuery: AbstractQuery): PromQuery;\n  exportToAbstractQuery(query: PromQuery): AbstractQuery;\n  getSeries(timeRange: TimeRange, selector: string, withName?: boolean): Promise<Record<string, string[]>>;\n  fetchLabelValues: (range: TimeRange, key: string) => Promise<string[]>;\n  getLabelValues(range: TimeRange, key: string): Promise<string[]>;\n  /**\n   * Fetches all label keys\n   */\n  fetchLabels: (timeRange: TimeRange, queries?: PromQuery[]) => Promise<string[]>;\n  /**\n   * Gets series values\n   * Function to replace old getSeries calls in a way that will provide faster endpoints\n   * for new prometheus instances, while maintaining backward compatability\n   */\n  getSeriesValues: (timeRange: TimeRange, labelName: string, selector: string) => Promise<string[]>;\n  /**\n   * Fetches all values for a label, with optional match[]\n   * @param name\n   * @param match\n   * @param timeRange\n   * @param requestId\n   */\n  fetchSeriesValuesWithMatch: (\n    timeRange: TimeRange,\n    name: string,\n    match: string,\n    requestId?: string\n  ) => Promise<string[]>;\n  /**\n   * Gets series labels\n   * Function to replace old getSeries calls in a way that will provide faster endpoints for new prometheus instances,\n   * while maintaining backward compatability. The old API call got the labels and the values in a single query,\n   * but with the new query we need two calls, one to get the labels, and another to get the values.\n   *\n   * @param selector\n   * @param otherLabels\n   */\n  getSeriesLabels: (timeRange: TimeRange, selector: string, otherLabels: PromQLLabelMatcher[]) => Promise<string[]>;\n  /**\n   * Fetch labels using the best endpoint that datasource supports.\n   * This is cached by its args but also by the global timeRange currently selected as they can change over requested time.\n   */\n  fetchLabelsWithMatch: (timeRange: TimeRange, name: string, withName?: boolean) => Promise<Record<string, string[]>>;\n  /**\n   * Fetch labels for a series using /series endpoint. This is cached by its args but also by the global timeRange currently selected as\n   * they can change over requested time.\n   */\n  fetchSeriesLabels: (\n    timeRange: TimeRange,\n    name: string,\n    withName?: boolean,\n    withLimit?: string\n  ) => Promise<Record<string, string[]>>;\n  /**\n   * Fetch labels for a series using /labels endpoint.  This is cached by its args but also by the global timeRange currently selected as\n   * they can change over requested time.\n   */\n  fetchSeriesLabelsMatch: (timeRange: TimeRange, name: string, withName?: boolean) => Promise<Record<string, string[]>>;\n  /**\n   * Fetch series for a selector. Use this for raw results. Use fetchSeriesLabels() to get labels.\n   */\n  fetchSeries: (timeRange: TimeRange, match: string) => Promise<Array<Record<string, string>>>;\n  /**\n   * Fetch this only one as we assume this won't change over time. This is cached differently from fetchSeriesLabels\n   * because we can cache more aggressively here and also we do not want to invalidate this cache the same way as in\n   * fetchSeriesLabels.\n   */\n  fetchDefaultSeries: (timeRange: TimeRange) => Promise<{}>;\n  /**\n   * Fetch labels or values for a label based on the queries, scopes, filters and time range\n   * @param timeRange\n   * @param queries\n   * @param scopes\n   * @param adhocFilters\n   * @param labelName\n   * @param limit\n   * @param requestId\n   */\n  fetchSuggestions: (\n    timeRange?: TimeRange,\n    queries?: PromQuery[],\n    scopes?: Scope[],\n    adhocFilters?: AdHocVariableFilter[],\n    labelName?: string,\n    limit?: number,\n    requestId?: string\n  ) => Promise<string[]>;\n}\n\nexport function isPrometheusDatasourceV12_0_0(ds: PrometheusRuntimeDatasource): ds is PrometheusRuntimeDatasource & {\n  languageProvider: PromQlLanguageProviderTwelveDotZero;\n} {\n  const languageProvider = ds.languageProvider as PromQlLanguageProviderTwelveDotZero;\n\n  // eslint-disable-next-line sonarjs/deprecation\n  return typeof languageProvider.fetchLabelValues === 'function' && languageProvider.fetchLabelValues.length > 1;\n}\n","import { type PrometheusDatasource } from '@grafana/prometheus';\n\nimport { type PrometheusRuntimeDatasource } from 'helpers/MetricDatasourceHelper';\n\nexport function isPrometheusDatasourceV12_1_0Plus(ds: PrometheusRuntimeDatasource): ds is PrometheusDatasource {\n  return typeof (ds.languageProvider as PrometheusDatasource['languageProvider']).queryLabelKeys === 'function';\n}\n","import {\n  type DataSourceGetTagKeysOptions,\n  type DataSourceGetTagValuesOptions,\n  type MetricFindValue,\n  type TimeRange,\n} from '@grafana/data';\nimport {\n  type PrometheusDatasource,\n  type PromMetricsMetadata,\n  type PromMetricsMetadataItem,\n  type PromQuery,\n} from '@grafana/prometheus';\nimport { getDataSourceSrv } from '@grafana/runtime';\nimport { sceneGraph, type DataSourceVariable, type SceneObject, type VariableValueOption } from '@grafana/scenes';\nimport { type Unsubscribable } from 'rxjs';\n\nimport { isHistogramMetric } from 'GmdVizPanel/matchers/isHistogramMetric';\nimport { MetricsDrilldownDataSourceVariable } from 'MetricsDrilldownDataSourceVariable';\nimport { displayError, displayWarning } from 'WingmanDataTrail/helpers/displayStatus';\nimport { areArraysEqual } from 'WingmanDataTrail/MetricsVariables/helpers/areArraysEqual';\nimport { MetricsVariable, VAR_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\n\nimport { type DataTrail } from '../DataTrail';\nimport { VAR_DATASOURCE, VAR_DATASOURCE_EXPR } from '../shared';\nimport { languageProviderVersionIs } from '../types/language-provider/versionCheck';\nimport { isPrometheusDataSource } from '../utils/utils.datasource';\n\n/**\n * When we fetch the Prometheus data source with `@grafana/runtime`, its language provider\n * could be one of multiple flavors that we need to support. We use this type to represent\n * the Prometheus data source before we have checked the version of the language provider.\n * The language provider version is then checked with the `languageProviderVersionIs` helper.\n */\nexport type PrometheusRuntimeDatasource = Omit<PrometheusDatasource, 'languageProvider'> & {\n  languageProvider: unknown;\n};\n\nexport class MetricDatasourceHelper {\n  private trail: DataTrail;\n  private datasource?: PrometheusRuntimeDatasource;\n  private subs: Unsubscribable[];\n\n  // Maps & Sets are efficient data structures compared to a classic JS objects\n  private metricsMetadata: Map<string, PromMetricsMetadataItem> | undefined;\n  private metadataFetchP?: Promise<void>;\n  private classicHistograms: Set<string> | undefined;\n\n  constructor(trail: DataTrail) {\n    this.trail = trail;\n    this.subs = [];\n  }\n\n  private async getRuntimeDatasource(): Promise<PrometheusRuntimeDatasource | undefined> {\n    if (!this.datasource) {\n      const ds = await getDataSourceSrv().get(VAR_DATASOURCE_EXPR, { __sceneObject: { value: this.trail } });\n      this.datasource = isPrometheusDataSource(ds) ? ds : undefined;\n    }\n    return this.datasource;\n  }\n\n  public async init() {\n    for (const sub of this.subs) {\n      sub.unsubscribe();\n    }\n\n    const metricsVariable = sceneGraph.findByKeyAndType(this.trail, VAR_METRICS_VARIABLE, MetricsVariable);\n    this.subs.push(\n      metricsVariable.subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.options, prevState.options)) {\n          this.initializeClassicHistograms(newState.options);\n        }\n      })\n    );\n\n    const datasourceVariable = sceneGraph.findByKeyAndType(\n      this.trail,\n      VAR_DATASOURCE,\n      MetricsDrilldownDataSourceVariable\n    );\n    this.subs.push(\n      datasourceVariable.subscribeToState(async (newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          this.reset();\n        }\n      })\n    );\n\n    this.initializeClassicHistograms(metricsVariable.state.options);\n  }\n\n  private reset() {\n    this.datasource = undefined;\n    this.metricsMetadata = undefined;\n    this.metadataFetchP = undefined;\n    this.classicHistograms = undefined;\n  }\n\n  private initializeClassicHistograms(metricsVariableOptions: VariableValueOption[]) {\n    this.classicHistograms = new Set();\n\n    for (const metricData of metricsVariableOptions) {\n      const name = metricData.value as string;\n\n      if (name.endsWith('_bucket')) {\n        this.classicHistograms.add(name);\n      }\n    }\n  }\n\n  /**\n   * Identify native histograms by 2 strategies.\n   * 1. querying classic histograms and all metrics,\n   * then comparing the results and build the collection of native histograms.\n   * 2. querying all metrics and checking if the metric is a histogram type and does not have the bucket suffix.\n   *\n   * classic histogram = test_metric_bucket\n   * native histogram = test_metric\n   *\n   * @param metric\n   * @returns boolean\n   */\n  public async isNativeHistogram(metric: string): Promise<boolean> {\n    const isClassicHistogram = isHistogramMetric(metric);\n    if (isClassicHistogram) {\n      return false;\n    }\n\n    if (this.classicHistograms?.has(`${metric}_bucket`)) {\n      return true;\n    }\n\n    const metadata = await this.getMetadataForMetric(metric);\n    return metadata?.type === 'histogram';\n  }\n\n  private async ensureMetricsMetadata(): Promise<void> {\n    if (!this.metadataFetchP) {\n      this.metadataFetchP = this.getMetricsMetadata();\n    }\n\n    try {\n      await this.metadataFetchP;\n    } catch (error) {\n      displayWarning([\n        'Error while initializing histograms!',\n        (error as Error).toString(),\n        'Native histogram metrics might not be properly displayed.',\n      ]);\n    }\n  }\n\n  private async getMetricsMetadata(): Promise<void> {\n    const ds = await this.getRuntimeDatasource();\n    if (!ds) {\n      return;\n    }\n\n    const queryMetadata = getQueryMetricsMetadata(ds);\n    let metadata = await queryMetadata();\n\n    if (!metadata) {\n      const loadMetadata = getLoadMetricsMetadata(ds, queryMetadata);\n      metadata = await loadMetadata();\n    }\n\n    this.metricsMetadata = metadata ? new Map(Object.entries(metadata)) : undefined;\n  }\n\n  public async getMetadataForMetric(metric: string) {\n    await this.ensureMetricsMetadata();\n    return this.metricsMetadata?.get(metric);\n  }\n\n  /**\n   * Used for additional filtering for adhoc vars labels in Metrics Drilldown.\n   * @param options\n   * @returns\n   */\n  public async getTagKeys(options: DataSourceGetTagKeysOptions<PromQuery>): Promise<MetricFindValue[]> {\n    const ds = await this.getRuntimeDatasource();\n    if (!ds) {\n      return [];\n    }\n\n    const keys = await ds.getTagKeys(options);\n    return keys;\n  }\n\n  /**\n   * Used for additional filtering for adhoc vars label values in Metrics Drilldown.\n   * @param options\n   * @returns\n   */\n  public async getTagValues(options: DataSourceGetTagValuesOptions<PromQuery>) {\n    const ds = await this.getRuntimeDatasource();\n    if (!ds) {\n      return [];\n    }\n\n    options.key = unwrapQuotes(options.key);\n    const keys = await ds.getTagValues(options);\n    return keys;\n  }\n\n  /**\n   * Fetches available labels from a Prometheus datasource with version compatibility.\n   *\n   * This method abstracts the complexity of supporting multiple versions of `@grafana/prometheus`\n   * spanning from 11.6.0 up to the latest 12.x versions. It detects which API style the current\n   * datasource supports and calls the appropriate method with the correct signature.\n   * It handles three different `@grafana/prometheus` API styles:\n   *\n   * 1. **(12.1.0+)**: Uses the modern `queryLabelKeys` method\n   * 2. **(12.0.0)**: Uses `fetchLabelsWithMatch` with timeRange parameter\n   * 3. **(11.6.0-11.x)**: Uses `fetchLabelsWithMatch` without timeRange parameter\n   *\n   * @param params - Configuration object containing datasource, time range, and matcher\n   * @param params.ds - The Prometheus datasource instance\n   * @param params.timeRange - Time range for the query\n   * @param params.matcher - PromQL matcher string to filter labels (e.g., '{job=\"prometheus\"}')\n   * @returns Promise that resolves to an array of available label keys\n   *\n   * @example\n   * ```typescript\n   * const labels = await MetricDatasourceHelper.fetchLabels({\n   *   ds: prometheusDatasource,\n   *   timeRange: { from: 'now-1h', to: 'now' },\n   *   matcher: '{job=\"prometheus\"}'\n   * });\n   * ```\n   */\n  public static fetchLabels(params: FetchLabelsOptions): Promise<string[]> {\n    const { timeRange, matcher } = params;\n    const ds = params.ds;\n\n    if (languageProviderVersionIs['12.1.0-plus'](ds)) {\n      return ds.languageProvider.queryLabelKeys(timeRange, matcher);\n    } else if (languageProviderVersionIs['12.0.0'](ds)) {\n      return ds.languageProvider.fetchLabelsWithMatch(timeRange, matcher).then((labels) => Object.keys(labels));\n    } else if (languageProviderVersionIs['11.6.x'](ds)) {\n      return ds.languageProvider.fetchLabelsWithMatch(matcher).then((labels) => Object.keys(labels));\n    }\n\n    throw new Error('Unsupported language provider version');\n  }\n\n  /**\n   * Fetches available values for a specific label from a Prometheus datasource with version compatibility.\n   *\n   * This method abstracts the complexity of supporting multiple versions of `@grafana/prometheus`\n   * spanning from 11.6.0 up to the latest 12.x versions. It detects which API style the current\n   * datasource supports and calls the appropriate method with the correct signature.\n   * It handles three different `@grafana/prometheus` API styles:\n   *\n   * 1. **(12.1.0+)**: Uses the modern `queryLabelValues` method\n   * 2. **(12.0.0)**: Uses `fetchLabelValues` or `fetchSeriesValuesWithMatch` with timeRange parameter\n   * 3. **(11.6.0-11.x)**: Uses `fetchLabelValues` or `fetchSeriesValuesWithMatch` without timeRange parameter\n   *\n   * @param params - Configuration object containing datasource, label name, time range, and optional matcher\n   * @param params.ds - The Prometheus datasource instance\n   * @param params.labelName - The name of the label to fetch values for (e.g., 'job', 'instance')\n   * @param params.timeRange - Time range for the query\n   * @param params.matcher - Optional PromQL matcher string to filter results (e.g., '{job=\"prometheus\"}')\n   * @returns Promise that resolves to an array of available values for the specified label\n   *\n   * @example\n   * ```typescript\n   * const jobValues = await MetricDatasourceHelper.fetchLabelValues({\n   *   ds: prometheusDatasource,\n   *   labelName: 'job',\n   *   timeRange: { from: 'now-1h', to: 'now' },\n   *   matcher: '{__name__=~\".*_total\"}'\n   * });\n   * ```\n   */\n  public static fetchLabelValues(params: FetchLabelValuesOptions) {\n    const { labelName, timeRange, matcher = '' } = params;\n    const ds = params.ds as PrometheusRuntimeDatasource;\n\n    if (languageProviderVersionIs['12.1.0-plus'](ds)) {\n      return ds.languageProvider.queryLabelValues(timeRange, labelName, matcher);\n    }\n\n    if (languageProviderVersionIs['12.0.0'](ds)) {\n      // If a matcher isn't provided, use the simpler `fetchLabelValues` method.\n      const fetchLabelValuesWithOptionalMatcher = matcher\n        ? ds.languageProvider.fetchSeriesValuesWithMatch\n        : ds.languageProvider.fetchLabelValues;\n\n      return fetchLabelValuesWithOptionalMatcher(timeRange, labelName, matcher);\n    }\n\n    if (languageProviderVersionIs['11.6.x'](ds)) {\n      // If a matcher isn't provided, use the simpler `fetchLabelValues` method.\n      const fetchLabelValuesWithOptionalMatcher = matcher\n        ? ds.languageProvider.fetchSeriesValuesWithMatch\n        : ds.languageProvider.fetchLabelValues;\n\n      return fetchLabelValuesWithOptionalMatcher(labelName, matcher);\n    }\n\n    throw new Error('Unsupported language provider version');\n  }\n\n  public static async getPrometheusDataSourceForScene(\n    sceneObject: SceneObject\n  ): Promise<PrometheusDatasource | undefined> {\n    try {\n      const dsVariable = sceneGraph.findByKey(sceneObject, VAR_DATASOURCE) as DataSourceVariable;\n      const uid = (dsVariable?.state.value as string) ?? '';\n      const ds = await getDataSourceSrv().get({ uid });\n\n      return ds as unknown as PrometheusDatasource; // we trust that VAR_DATASOURCE has been set to a Prometheus datasource\n    } catch (error) {\n      displayError(error as Error, ['Error while getting the Prometheus data source!']);\n      return undefined;\n    }\n  }\n}\n\ninterface FetchLabelsOptions {\n  ds: PrometheusRuntimeDatasource;\n  timeRange: TimeRange;\n  matcher: string;\n}\n\ninterface FetchLabelValuesOptions {\n  ds: PrometheusRuntimeDatasource;\n  timeRange: TimeRange;\n  labelName: string;\n  matcher?: string;\n}\n\nexport function getMetricDescription(metadata?: PromMetricsMetadataItem) {\n  if (!metadata) {\n    return undefined;\n  }\n\n  const { type, help, unit } = metadata;\n\n  const lines = [\n    help, //\n    type && `**Type:** *${type}*`,\n    unit && `**Unit:** ${unit}`,\n  ];\n\n  return lines.join('\\n\\n');\n}\n\nfunction unwrapQuotes(value: string): string {\n  if (value === '' || !isWrappedInQuotes(value)) {\n    return value;\n  }\n  return value.slice(1, -1);\n}\n\nfunction isWrappedInQuotes(value: string): boolean {\n  const wrappedInQuotes = /^\".*\"$/;\n  return wrappedInQuotes.test(value);\n}\n\nfunction getQueryMetricsMetadata(ds: PrometheusRuntimeDatasource) {\n  if (languageProviderVersionIs['12.1.0-plus'](ds)) {\n    return ds.languageProvider.queryMetricsMetadata;\n  }\n\n  if (languageProviderVersionIs['12.0.0'](ds) || languageProviderVersionIs['11.6.x'](ds)) {\n    return () => Promise.resolve(ds.languageProvider.metricsMetadata);\n  }\n\n  throw new Error('Unsupported language provider version');\n}\n\nfunction getLoadMetricsMetadata(\n  ds: PrometheusRuntimeDatasource,\n  queryMetadata: () => Promise<PromMetricsMetadata | undefined>\n) {\n  if (languageProviderVersionIs['12.1.0-plus'](ds)) {\n    return ds.languageProvider.retrieveMetricsMetadata;\n  }\n\n  if (languageProviderVersionIs['12.0.0'](ds) || languageProviderVersionIs['11.6.x'](ds)) {\n    return () => (ds.languageProvider.loadMetricsMetadata?.() ?? Promise.resolve()).then(() => queryMetadata());\n  }\n\n  throw new Error('Unsupported language provider version');\n}\n","import {\n  FieldType,\n  LoadingState,\n  type DataQueryResponse,\n  type LegacyMetricFindQueryOptions,\n  type MetricFindValue,\n  type TestDataSourceResponse,\n} from '@grafana/data';\nimport { type PrometheusDatasource } from '@grafana/prometheus';\nimport { RuntimeDataSource, sceneGraph, type SceneObject } from '@grafana/scenes';\n\nimport { MetricDatasourceHelper } from 'helpers/MetricDatasourceHelper';\nimport { VAR_FILTERS } from 'shared';\nimport { isAdHocFiltersVariable } from 'utils/utils.variables';\nimport { displayWarning } from 'WingmanDataTrail/helpers/displayStatus';\n\nimport { localeCompare } from '../helpers/localCompare';\n\n// TODO can we get rid of it and use e.g. undefined or an empty string?\nexport const NULL_GROUP_BY_VALUE = '(none)';\n\nexport class LabelsDataSource extends RuntimeDataSource {\n  static readonly uid = 'grafana-prometheus-labels-datasource';\n\n  constructor() {\n    super(LabelsDataSource.uid, LabelsDataSource.uid);\n  }\n\n  async query(): Promise<DataQueryResponse> {\n    return {\n      state: LoadingState.Done,\n      data: [\n        {\n          name: 'Labels',\n          fields: [\n            {\n              name: null,\n              type: FieldType.other,\n              values: [],\n              config: {},\n            },\n          ],\n          length: 0,\n        },\n      ],\n    };\n  }\n\n  async metricFindQuery(matcher: string, options: LegacyMetricFindQueryOptions): Promise<MetricFindValue[]> {\n    const sceneObject = options.scopedVars?.__sceneObject?.valueOf() as SceneObject;\n\n    const ds = await MetricDatasourceHelper.getPrometheusDataSourceForScene(sceneObject);\n    if (!ds) {\n      return [];\n    }\n\n    const [, labelName] = matcher.match(/valuesOf\\((.+)\\)/) ?? [];\n    if (labelName) {\n      const labelValues = await LabelsDataSource.fetchLabelValues(labelName, sceneObject);\n      return labelValues.map((value) => ({ value, text: value }));\n    }\n\n    let labelOptions: MetricFindValue[] = [];\n\n    try {\n      labelOptions = await this.fetchLabels(ds, sceneObject, matcher);\n    } catch (error) {\n      displayWarning(['Error while fetching labels! Defaulting to an empty array.', (error as Error).toString()]);\n    }\n\n    return [{ value: NULL_GROUP_BY_VALUE, text: '(none)' }, ...labelOptions] as MetricFindValue[];\n  }\n\n  private async fetchLabels(ds: PrometheusDatasource, sceneObject: SceneObject, matcher: string) {\n    // there is probably a more graceful way to implement this, but this is what the DS offers us.\n    // if a DS does not support the labels match API, we need getTagKeys to handle the empty matcher\n    if (!LabelsDataSource.getLabelsMatchAPISupport(ds)) {\n      // the Prometheus series endpoint cannot accept an empty matcher\n      // when there are no filters, we cannot send the matcher passed to this function because Prometheus evaluates it as empty and returns an error\n      const filters = LabelsDataSource.getFiltersFromVariable(sceneObject);\n      const response = await ds.getTagKeys(filters);\n\n      return this.processLabelOptions(\n        response.map(({ text }) => ({\n          value: text,\n          text,\n        }))\n      );\n    }\n\n    const response = await MetricDatasourceHelper.fetchLabels({\n      ds,\n      timeRange: sceneGraph.getTimeRange(sceneObject).state.value,\n      matcher,\n    });\n\n    return this.processLabelOptions(\n      response.map((label) => ({\n        value: label,\n        text: label,\n      }))\n    );\n  }\n\n  private static getLabelsMatchAPISupport(ds: PrometheusDatasource) {\n    try {\n      return ds.hasLabelsMatchAPISupport();\n    } catch (error) {\n      displayWarning([\n        'Error while checking if the current data source supports the labels match API! Defaulting to false.',\n        (error as Error).toString(),\n      ]);\n      return false;\n    }\n  }\n\n  private static getFiltersFromVariable(sceneObject: SceneObject): { filters: any[] } {\n    const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, sceneObject);\n\n    if (isAdHocFiltersVariable(filtersVariable)) {\n      return { filters: filtersVariable.state.filters };\n    }\n\n    return { filters: [] };\n  }\n\n  private processLabelOptions(options: Array<{ value: string; text: string }>): Array<{ value: string; text: string }> {\n    return options.filter(({ value }) => !value.startsWith('__')).sort((a, b) => localeCompare(a.value, b.value));\n  }\n\n  static async fetchLabelValues(labelName: string, sceneObject: SceneObject): Promise<string[]> {\n    const ds = await MetricDatasourceHelper.getPrometheusDataSourceForScene(sceneObject);\n    if (!ds) {\n      return [];\n    }\n\n    try {\n      return await MetricDatasourceHelper.fetchLabelValues({\n        ds,\n        labelName,\n        timeRange: sceneGraph.getTimeRange(sceneObject).state.value,\n      });\n    } catch (error) {\n      displayWarning([\n        `Error while retrieving label \"${labelName}\" values! Defaulting to an empty array.`,\n        (error as Error).toString(),\n      ]);\n      return [];\n    }\n  }\n\n  async testDatasource(): Promise<TestDataSourceResponse> {\n    return {\n      status: 'success',\n      message: 'OK',\n    };\n  }\n}\n","import { VariableHide, VariableRefresh } from '@grafana/data';\nimport { QueryVariable } from '@grafana/scenes';\nimport React from 'react';\n\nimport { LabelsDataSource } from './LabelsDataSource';\n\nexport const VAR_LABEL_VALUES = 'wingmanLabelValues';\n\nexport class LabelValuesVariable extends QueryVariable {\n  constructor({ labelName }: { labelName: string }) {\n    super({\n      name: VAR_LABEL_VALUES,\n      datasource: { uid: LabelsDataSource.uid },\n      // just some syntax we make up so that the data source can decide what to fetch\n      query: `valuesOf(${labelName})`,\n      isMulti: false,\n      allowCustomValue: false,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      hide: VariableHide.hideVariable,\n      // BOTH \"value\" and \"includeAll\" below ensure the repetition in SceneByVariableRepeater\n      // // (if not set, it'll render only the 1st variable option)\n      value: '$__all',\n      includeAll: true,\n    });\n  }\n\n  public static readonly Component = () => {\n    return <></>;\n  };\n}\n","import { css } from '@emotion/css';\nimport { VariableHide, VariableRefresh, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  DataSourceVariable,\n  QueryVariable,\n  sceneGraph,\n  type MultiValueVariable,\n  type SceneComponentProps,\n} from '@grafana/scenes';\nimport { Label, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { VAR_DATASOURCE, VAR_FILTERS, VAR_FILTERS_EXPR } from 'shared';\n\nimport { LabelsDataSource, NULL_GROUP_BY_VALUE } from './LabelsDataSource';\n\nexport const VAR_WINGMAN_GROUP_BY = 'labelsWingman';\n\nexport class LabelsVariable extends QueryVariable {\n  constructor() {\n    super({\n      name: VAR_WINGMAN_GROUP_BY,\n      label: 'Group by label',\n      placeholder: 'Group by label...',\n      datasource: { uid: LabelsDataSource.uid },\n      query: '',\n      includeAll: false,\n      isMulti: false,\n      allowCustomValue: false,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      hide: VariableHide.hideVariable,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this._subs.add(\n      this.subscribeToState((newState, prevState) => {\n        if (newState.query !== prevState.query) {\n          // preserve the value from the URL search param when landing\n          if (prevState.query) {\n            this.setState({ value: NULL_GROUP_BY_VALUE });\n          }\n\n          this.refreshOptions();\n        }\n      })\n    );\n\n    this._subs.add(\n      sceneGraph.findByKeyAndType(this, VAR_DATASOURCE, DataSourceVariable).subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          this.setState({ value: NULL_GROUP_BY_VALUE });\n          this.refreshOptions();\n        }\n      })\n    );\n\n    this._subs.add(\n      sceneGraph.findByKeyAndType(this, VAR_FILTERS, AdHocFiltersVariable).subscribeToState((newState, prevState) => {\n        if (newState.filterExpression !== prevState.filterExpression) {\n          this.updateQuery();\n        }\n      })\n    );\n\n    // hack to ensure that labels are loaded when landing: sometimes filters are not interpolated and fetching labels give no results\n    this.updateQuery();\n  }\n\n  private updateQuery() {\n    const filterExpression = sceneGraph.interpolate(this, VAR_FILTERS_EXPR, {});\n    this.setState({ query: `{__name__=~\".+\",${filterExpression}}` });\n  }\n\n  static readonly Component = ({ model }: SceneComponentProps<MultiValueVariable>) => {\n    const styles = useStyles2(getStyles);\n    const { label } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <Label className={styles.label}>{label}</Label>\n        <QueryVariable.Component model={model} />\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    align-items: center;\n    gap: 0;\n\n    [class*='input-wrapper'] {\n      width: 240px;\n    }\n  `,\n  label: css`\n    height: 32px;\n    white-space: nowrap;\n    margin: 0;\n    background-color: ${theme.colors.background.primary};\n    padding: ${theme.spacing(1)};\n    border-radius: ${theme.shape.radius.default};\n    border: 1px solid ${theme.colors.border.weak};\n    border-right: none;\n  `,\n});\n","import React from 'react';\n\nexport function GroupsIcon() {\n  return (\n    <svg stroke=\"currentColor\" width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\">\n      <circle cx=\"8.92688\" cy=\"3.63132\" r=\"2.375\" strokeWidth=\"1.5\" />\n      <path d=\"M13.6469 4.37965C14.6813 4.76699 15.3235 7.03139 14.9362 8.06582\" strokeWidth=\"1.5\" />\n      <path d=\"M4.35309 4.37965C3.31866 4.76699 2.67651 7.03139 3.06384 8.06582\" strokeWidth=\"1.5\" />\n      <path d=\"M10.3408 14.2531C9.75237 14.8415 8.11813 14.7799 7.50903 14.1708\" strokeWidth=\"1.5\" />\n      <circle cx=\"4.00195\" cy=\"12.251\" r=\"2.375\" strokeWidth=\"1.5\" />\n      <circle cx=\"13.8478\" cy=\"12.251\" r=\"2.375\" strokeWidth=\"1.5\" />\n    </svg>\n  );\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\ninterface EventMetricsVariableActivatedPayload {\n  key: string;\n}\n\nexport class EventMetricsVariableActivated extends BusEventWithPayload<EventMetricsVariableActivatedPayload> {\n  public static readonly type = 'metrics-variable-activated';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\ninterface EventMetricsVariableDeactivatedPayload {\n  key: string;\n}\n\nexport class EventMetricsVariableDeactivated extends BusEventWithPayload<EventMetricsVariableDeactivatedPayload> {\n  public static readonly type = 'metrics-variable-deactivated';\n}\n","import { BusEventWithPayload } from '@grafana/data';\nimport { type VariableValueOption } from '@grafana/scenes';\n\ninterface EventMetricsVariableLoadedPayload {\n  key: string;\n  options: VariableValueOption[];\n}\n\nexport class EventMetricsVariableLoaded extends BusEventWithPayload<EventMetricsVariableLoadedPayload> {\n  public static readonly type = 'metrics-variable-loaded';\n}\n","import { type MultiValueVariable, type MultiValueVariableState } from '@grafana/scenes';\n\nimport { EventMetricsVariableActivated } from './EventMetricsVariableActivated';\nimport { EventMetricsVariableDeactivated } from './EventMetricsVariableDeactivated';\nimport { EventMetricsVariableLoaded } from './EventMetricsVariableLoaded';\n\n/**\n * Adds the publication of lifecycle events to a metrics variable:\n *\n * - `EventMetricsVariableActivated`\n * - `EventMetricsVariableDeactivated`\n * - `EventMetricsVariableLoaded`\n *\n * This is particularly useful for filtering and sorting the variable options, while keeping the\n * different pieces of code decoupled.\n *\n * The filtering and sorting logic is centralized in the `MetricsReducer` class.\n */\nexport function withLifecycleEvents<T extends MultiValueVariable>(variable: T): T {\n  const key = variable.state.key as string;\n\n  if (!key) {\n    throw new TypeError(\n      `Variable \"${variable.state.name}\" has no key. Please provide a key in order to publish its lifecycle events.`\n    );\n  }\n\n  variable.addActivationHandler(() => {\n    variable.publishEvent(new EventMetricsVariableActivated({ key }), true);\n\n    // We make sure filtering and sorting work in a scenario where the user goes from the MetricsReducer to the MetricScene and back.\n    // Indeed, sometimes, the variable already has its options and does not load new ones (issue reported in a dev env).\n    if (!variable.state.loading && variable.state.options.length) {\n      variable.publishEvent(new EventMetricsVariableLoaded({ key, options: variable.state.options }), true);\n    }\n\n    variable.subscribeToState((newState: MultiValueVariableState, prevState: MultiValueVariableState) => {\n      if (!newState.loading && prevState.loading) {\n        variable.publishEvent(new EventMetricsVariableLoaded({ key, options: newState.options }), true);\n      }\n    });\n\n    return () => {\n      variable.publishEvent(new EventMetricsVariableDeactivated({ key }), true);\n    };\n  });\n\n  return variable;\n}\n","import {\n  FieldType,\n  LoadingState,\n  type DataQueryResponse,\n  type LegacyMetricFindQueryOptions,\n  type MetricFindValue,\n  type TestDataSourceResponse,\n} from '@grafana/data';\nimport { RuntimeDataSource, sceneGraph, type SceneObject } from '@grafana/scenes';\n\nimport { MetricDatasourceHelper } from 'helpers/MetricDatasourceHelper';\nimport { isPrometheusRule } from 'WingmanDataTrail/helpers/isPrometheusRule';\n\nexport class MetricsWithLabelValueDataSource extends RuntimeDataSource {\n  static readonly uid = 'grafana-prometheus-metrics-with-label-values-datasource';\n\n  constructor() {\n    super(MetricsWithLabelValueDataSource.uid, MetricsWithLabelValueDataSource.uid);\n  }\n\n  async query(): Promise<DataQueryResponse> {\n    return {\n      state: LoadingState.Done,\n      data: [\n        {\n          name: 'Labels',\n          fields: [\n            {\n              name: null,\n              type: FieldType.other,\n              values: [],\n              config: {},\n            },\n          ],\n          length: 0,\n        },\n      ],\n    };\n  }\n\n  async metricFindQuery(query: string, options: LegacyMetricFindQueryOptions): Promise<MetricFindValue[]> {\n    const sceneObject = options.scopedVars?.__sceneObject?.valueOf() as SceneObject;\n\n    const ds = await MetricDatasourceHelper.getPrometheusDataSourceForScene(sceneObject);\n    if (!ds) {\n      return [];\n    }\n\n    const timeRange = sceneGraph.getTimeRange(sceneObject).state.value;\n    let metricsList: string[] = [];\n\n    const removeRules = query.startsWith('removeRules');\n    const matcher = removeRules ? query.replace('removeRules', '') : query;\n\n    metricsList = await MetricDatasourceHelper.fetchLabelValues({\n      ds,\n      labelName: '__name__',\n      matcher,\n      timeRange,\n    });\n\n    if (removeRules) {\n      metricsList = metricsList.filter((metricName) => !isPrometheusRule(metricName));\n    }\n\n    return metricsList.map((metricName) => ({ value: metricName, text: metricName }));\n  }\n\n  async testDatasource(): Promise<TestDataSourceResponse> {\n    return {\n      status: 'success',\n      message: 'OK',\n    };\n  }\n}\n","export const isPrometheusRule = (metricName: string) =>\n  metricName === 'ALERTS' || metricName === 'ALERTS_FOR_STATE' || metricName.includes(':');\n","import { VariableHide, VariableRefresh } from '@grafana/data';\nimport { QueryVariable, sceneGraph } from '@grafana/scenes';\n\nimport { VAR_FILTERS, VAR_FILTERS_EXPR } from 'shared';\nimport { withLifecycleEvents } from 'WingmanDataTrail/MetricsVariables/withLifecycleEvents';\n\nimport { MetricsWithLabelValueDataSource } from './MetricsWithLabelValueDataSource';\n\nexport const VAR_METRIC_WITH_LABEL_VALUE = 'metrics-with-label-value';\n\nexport class MetricsWithLabelValueVariable extends QueryVariable {\n  constructor({\n    labelName,\n    labelValue,\n    removeRules,\n  }: {\n    labelName: string;\n    labelValue: string;\n    removeRules?: boolean;\n  }) {\n    super({\n      key: `${VAR_METRIC_WITH_LABEL_VALUE}-${labelName}-${labelValue}`,\n      name: VAR_METRIC_WITH_LABEL_VALUE,\n      datasource: { uid: MetricsWithLabelValueDataSource.uid },\n      query: MetricsWithLabelValueVariable.buildQuery(labelName, labelValue, removeRules),\n      isMulti: false,\n      allowCustomValue: false,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      hide: VariableHide.hideVariable,\n      skipUrlSync: true,\n      // BOTH \"value\" and \"includeAll\" below ensure the repetition in SceneByVariableRepeater\n      // // (if not set, it'll render only the 1st variable option)\n      value: '$__all',\n      includeAll: true,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, labelName, labelValue, removeRules));\n\n    // required for filtering and sorting\n    return withLifecycleEvents<MetricsWithLabelValueVariable>(this);\n  }\n\n  protected onActivate(labelName: string, labelValue: string, removeRules?: boolean) {\n    const adHocFiltersVariable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n\n    if (adHocFiltersVariable?.state.hide !== VariableHide.hideVariable) {\n      this.setState({\n        query: MetricsWithLabelValueVariable.buildQuery(labelName, labelValue, removeRules),\n      });\n    }\n  }\n\n  private static buildQuery(labelName: string, labelValue: string, removeRules?: boolean) {\n    return removeRules\n      ? `removeRules{${labelName}=\"${labelValue}\",${VAR_FILTERS_EXPR}}`\n      : `{${labelName}=\"${labelValue}\",${VAR_FILTERS_EXPR}}`;\n  }\n}\n","import { css } from '@emotion/css';\nimport { DashboardCursorSync, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneReactObject,\n  SceneVariableSet,\n  type AdHocFiltersVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Button, CollapsableSection, Spinner, useStyles2 } from '@grafana/ui';\nimport React, { useState } from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { ConfigurePanelAction } from 'GmdVizPanel/components/ConfigurePanelAction';\nimport { SelectAction } from 'GmdVizPanel/components/SelectAction';\nimport { GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { VAR_FILTERS } from 'shared';\nimport { NULL_GROUP_BY_VALUE } from 'WingmanDataTrail/Labels/LabelsDataSource';\nimport { VAR_WINGMAN_GROUP_BY, type LabelsVariable } from 'WingmanDataTrail/Labels/LabelsVariable';\nimport { LayoutSwitcher, LayoutType, type LayoutSwitcherState } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { GRID_TEMPLATE_COLUMNS, GRID_TEMPLATE_ROWS } from 'WingmanDataTrail/MetricsList/MetricsList';\nimport {\n  VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW,\n  WithUsageDataPreviewPanel,\n} from 'WingmanDataTrail/MetricsList/WithUsageDataPreviewPanel';\nimport { SceneByVariableRepeater } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\nimport { GroupsIcon } from 'WingmanDataTrail/SideBar/custom-icons/GroupsIcon';\n\nimport {\n  MetricsWithLabelValueVariable,\n  VAR_METRIC_WITH_LABEL_VALUE,\n} from './MetricsWithLabelValue/MetricsWithLabelValueVariable';\n\ninterface MetricsGroupByRowState extends SceneObjectState {\n  index: number;\n  labelName: string;\n  labelValue: string;\n  labelCardinality: number;\n  $variables: SceneVariableSet;\n  body: SceneByVariableRepeater;\n}\n\nexport class MetricsGroupByRow extends SceneObjectBase<MetricsGroupByRowState> {\n  public constructor({\n    index,\n    labelName,\n    labelValue,\n    labelCardinality,\n  }: {\n    index: MetricsGroupByRowState['index'];\n    labelName: MetricsGroupByRowState['labelName'];\n    labelValue: MetricsGroupByRowState['labelValue'];\n    labelCardinality: MetricsGroupByRowState['labelCardinality'];\n  }) {\n    super({\n      index,\n      labelName,\n      labelValue,\n      labelCardinality,\n      key: `${labelName || ''}-${labelValue || ''}`,\n      $variables: new SceneVariableSet({\n        variables: [new MetricsWithLabelValueVariable({ labelName, labelValue })],\n      }),\n      body: new SceneByVariableRepeater({\n        variableName: VAR_METRIC_WITH_LABEL_VALUE,\n        initialPageSize: 3,\n        body: new SceneCSSGridLayout({\n          children: [],\n          isLazy: true,\n          templateColumns: GRID_TEMPLATE_COLUMNS,\n          autoRows: VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW,\n          $behaviors: [\n            new behaviors.CursorSync({\n              key: 'metricCrosshairSync',\n              sync: DashboardCursorSync.Crosshair,\n            }),\n          ],\n        }),\n        getLayoutLoading: () =>\n          new SceneReactObject({\n            reactNode: <Spinner inline />,\n          }),\n        getLayoutEmpty: () =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner title=\"\" severity=\"info\">\n                No metrics found for the current filters and time range.\n              </InlineBanner>\n            ),\n          }),\n        getLayoutError: (error: Error) =>\n          new SceneReactObject({\n            reactNode: <InlineBanner severity=\"error\" title=\"Error while loading metrics!\" error={error} />,\n          }),\n        getLayoutChild: (option, colorIndex) => {\n          const metric = option.value as string;\n\n          return new SceneCSSGridItem({\n            body: new WithUsageDataPreviewPanel({\n              metric,\n              vizPanelInGridItem: new GmdVizPanel({\n                metric,\n                panelOptions: {\n                  fixedColorIndex: colorIndex,\n                  headerActions: () => [new SelectAction({ metric }), new ConfigurePanelAction({ metric })],\n                },\n                queryOptions: {\n                  labelMatchers: [{ key: labelName, operator: '=', value: labelValue }],\n                },\n              }),\n            }),\n          });\n        },\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToLayoutChange();\n  }\n\n  private subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', LayoutSwitcher);\n    const body = this.state.body.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: LayoutSwitcherState, prevState?: LayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: newState.layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n        });\n      }\n    };\n\n    onChangeState(layoutSwitcher.state); // ensure layout when landing on the page\n\n    this._subs.add(layoutSwitcher.subscribeToState(onChangeState));\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsGroupByRow>) => {\n    const [isCollapsed, setIsCollapsed] = useState(false);\n    const styles = useStyles2(getStyles);\n\n    const { index, labelName, labelValue, labelCardinality, $variables, body } = model.useState();\n\n    const variable = $variables.state.variables[0] as MetricsWithLabelValueVariable;\n    const { loading, error } = variable.useState();\n\n    const batchSizes = body.useSizes();\n    const shouldDisplayShowMoreButton =\n      !loading && !error && batchSizes.total > 0 && batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      body.increaseBatchSize();\n    };\n\n    const onClickSelect = () => {\n      const adHocFiltersVariable = sceneGraph.lookupVariable(VAR_FILTERS, model) as AdHocFiltersVariable;\n\n      adHocFiltersVariable.setState({\n        // TOOD: keep unique filters\n        filters: [...adHocFiltersVariable.state.filters, { key: labelName, operator: '=', value: labelValue }],\n      });\n\n      (sceneGraph.lookupVariable(VAR_WINGMAN_GROUP_BY, model) as LabelsVariable)?.changeValueTo(NULL_GROUP_BY_VALUE);\n    };\n\n    return (\n      <div className={styles.container} data-testid={`${labelName}-${labelValue}-metrics-group`}>\n        <div className={styles.containerHeader}>\n          <div className={styles.headerButtons}>\n            <Button\n              className={styles.selectButton}\n              variant=\"secondary\"\n              onClick={onClickSelect}\n              tooltip={`See metrics with ${labelName}=${labelValue}`}\n              tooltipPlacement=\"top\"\n            >\n              Select\n            </Button>\n          </div>\n        </div>\n\n        {\n          <CollapsableSection\n            isOpen={!isCollapsed}\n            onToggle={() => setIsCollapsed(!isCollapsed)}\n            label={\n              <div className={styles.groupName}>\n                <GroupsIcon />\n                <div className={styles.labelValue}>{labelValue}</div>\n                {labelCardinality > 1 && (\n                  <div className={styles.index}>\n                    ({index + 1}/{labelCardinality})\n                  </div>\n                )}\n              </div>\n            }\n          >\n            <div className={styles.collapsableSectionBody}>\n              <body.Component model={body} />\n            </div>\n\n            {shouldDisplayShowMoreButton && (\n              <div className={styles.footer}>\n                <ShowMoreButton\n                  label=\"metric\"\n                  batchSizes={batchSizes}\n                  onClick={onClickShowMore}\n                  tooltip={`Show more metrics for ${labelName}=\"${labelValue}\"`}\n                />\n              </div>\n            )}\n          </CollapsableSection>\n        }\n\n        {/* required to trigger its activation handlers */}\n        <div className={styles.variable}>\n          <variable.Component key={variable.state.name} model={variable} />\n        </div>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      background: theme.colors.background.canvas,\n      margin: theme.spacing(1, 0, 0, 0),\n\n      '& div:focus-within': {\n        boxShadow: 'none !important',\n      },\n    }),\n    containerHeader: css({\n      display: 'flex',\n      alignItems: 'center',\n      gap: '8px',\n      marginBottom: '-36px',\n      paddingBottom: theme.spacing(1.5),\n      borderBottom: `1px solid ${theme.colors.border.medium}`,\n    }),\n    headerButtons: css({\n      position: 'relative',\n      top: '3px',\n      marginLeft: 'auto',\n      marginRight: '30px',\n      zIndex: 100,\n    }),\n    selectButton: css({\n      height: '28px',\n    }),\n    collapsableSectionBody: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: '24px',\n      padding: theme.spacing(1),\n    }),\n    groupName: css({\n      display: 'flex',\n      alignItems: 'center',\n      fontSize: '1.3rem',\n      lineHeight: '1.3rem',\n    }),\n    labelValue: css({\n      fontSize: '16px',\n      marginLeft: '8px',\n    }),\n    index: css({\n      fontSize: '12px',\n      color: theme.colors.text.secondary,\n      marginLeft: '8px',\n    }),\n    footer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      marginTop: theme.spacing(1),\n\n      '& button': {\n        height: '40px',\n      },\n    }),\n    variable: css({\n      display: 'none',\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneObjectBase,\n  SceneReactObject,\n  SceneVariableSet,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { LabelValuesVariable, VAR_LABEL_VALUES } from 'WingmanDataTrail/Labels/LabelValuesVariable';\nimport { SceneByVariableRepeater } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\n\nimport { MetricsGroupByRow } from './MetricsGroupByRow';\n\ninterface MetricsGroupByListState extends SceneObjectState {\n  labelName: string;\n  $variables: SceneVariableSet;\n  body: SceneByVariableRepeater;\n}\n\nexport class MetricsGroupByList extends SceneObjectBase<MetricsGroupByListState> {\n  constructor({ labelName }: { labelName: MetricsGroupByListState['labelName'] }) {\n    super({\n      key: 'metrics-group-list',\n      labelName,\n      $variables: new SceneVariableSet({\n        variables: [new LabelValuesVariable({ labelName })],\n      }),\n      body: new SceneByVariableRepeater({\n        variableName: VAR_LABEL_VALUES,\n        initialPageSize: 20,\n        pageSizeIncrement: 10,\n        body: new SceneCSSGridLayout({\n          children: [],\n          isLazy: true,\n          templateColumns: '1fr',\n          autoRows: 'auto',\n          rowGap: 1,\n        }),\n        getLayoutLoading: () =>\n          new SceneReactObject({\n            reactNode: <Spinner inline />,\n          }),\n        getLayoutEmpty: () =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner title=\"\" severity=\"info\">\n                No label values found for label &quot;{labelName}&quot;.\n              </InlineBanner>\n            ),\n          }),\n        getLayoutError: (error: Error) =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner severity=\"error\" title={`Error while loading label \"${labelName}\" values!`} error={error} />\n            ),\n          }),\n        getLayoutChild: (option, index, options) => {\n          return new SceneCSSGridItem({\n            body: new MetricsGroupByRow({\n              index,\n              labelName,\n              labelValue: option.value as string,\n              labelCardinality: options.length,\n            }),\n          });\n        },\n      }),\n    });\n  }\n\n  static readonly Component = ({ model }: SceneComponentProps<MetricsGroupByList>) => {\n    const styles = useStyles2(getStyles);\n    const { body, $variables, labelName } = model.useState();\n\n    const variable = $variables.state.variables[0] as LabelValuesVariable;\n    const { loading, error } = variable.useState();\n\n    const batchSizes = body.useSizes();\n    const shouldDisplayShowMoreButton =\n      !loading && !error && batchSizes.total > 0 && batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      body.increaseBatchSize();\n    };\n\n    return (\n      <div data-testid=\"metrics-groupby-list\">\n        <body.Component model={body} />\n\n        {shouldDisplayShowMoreButton && (\n          <div className={styles.footer}>\n            <ShowMoreButton label={`\"${labelName}\" value`} batchSizes={batchSizes} onClick={onClickShowMore} />\n          </div>\n        )}\n\n        {/* required to trigger its activation handlers */}\n        <div className={styles.variable}>\n          <variable.Component key={variable.state.name} model={variable} />\n        </div>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    footer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      margin: theme.spacing(3, 0, 1, 0),\n\n      '& button': {\n        height: '40px',\n      },\n    }),\n    variable: css({\n      display: 'none',\n    }),\n  };\n}\n","import { CustomVariable, sceneGraph } from '@grafana/scenes';\n\nimport { MetricsVariable, VAR_METRICS_VARIABLE } from './MetricsVariable';\nimport { withLifecycleEvents } from './withLifecycleEvents';\n\nexport const VAR_FILTERED_METRICS_VARIABLE = 'filtered-metrics-wingman';\n\nexport class FilteredMetricsVariable extends CustomVariable {\n  constructor() {\n    super({\n      key: VAR_FILTERED_METRICS_VARIABLE,\n      name: VAR_FILTERED_METRICS_VARIABLE,\n      label: 'Filtered Metrics',\n      loading: false,\n      error: null,\n      options: [],\n      includeAll: true,\n      value: '$__all',\n      skipUrlSync: true,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n\n    // required for filtering and sorting\n    return withLifecycleEvents<FilteredMetricsVariable>(this);\n  }\n\n  private onActivate() {\n    const metricsVariable = sceneGraph.findByKeyAndType(this, VAR_METRICS_VARIABLE, MetricsVariable);\n    const { loading, error, options } = metricsVariable.state;\n\n    this.setState({ loading, error, options });\n\n    this._subs.add(\n      metricsVariable.subscribeToState((newState) => {\n        this.setState({\n          loading: newState.loading,\n          error: newState.error,\n          options: newState.options,\n        });\n      })\n    );\n  }\n}\n","import { SceneObjectBase, type SceneObjectState } from '@grafana/scenes';\n\nexport type CountsData = {\n  current: number;\n  total: number;\n};\n\ninterface CountsProviderState extends SceneObjectState {\n  counts: CountsData;\n}\n\nexport class CountsProvider<T extends CountsProviderState = CountsProviderState> extends SceneObjectBase<T> {\n  constructor(state: Partial<T>) {\n    super({\n      ...state,\n      counts: { current: 0, total: 0 },\n    } as T);\n  }\n\n  public useCounts(): CountsData {\n    return this.useState().counts;\n  }\n}\n","import { sceneGraph, type MultiValueVariable } from '@grafana/scenes';\n\nimport { VAR_FILTERED_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\nimport { areArraysEqual } from 'WingmanDataTrail/MetricsVariables/helpers/areArraysEqual';\nimport { VAR_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\n\nimport { CountsProvider } from './CountsProvider';\n\nexport class MetricVariableCountsProvider extends CountsProvider {\n  constructor() {\n    super({ key: 'MetricVariableCountsProvider' });\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const nonFilteredVariable = sceneGraph.lookupVariable(VAR_METRICS_VARIABLE, this) as MultiValueVariable;\n    const filteredVariable = sceneGraph.lookupVariable(VAR_FILTERED_METRICS_VARIABLE, this) as MultiValueVariable;\n\n    this.setInitCounts(nonFilteredVariable, filteredVariable);\n\n    this._subs.add(\n      nonFilteredVariable.subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.options, prevState.options)) {\n          this.setState({\n            counts: {\n              current: filteredVariable.state.options.length,\n              total: newState.options.length,\n            },\n          });\n        }\n      })\n    );\n\n    this._subs.add(\n      filteredVariable.subscribeToState((newState, prevState) => {\n        if (!newState.loading && !prevState.loading && !areArraysEqual(newState.options, prevState.options)) {\n          this.setState({\n            counts: {\n              current: newState.options.length,\n              total: nonFilteredVariable.state.options.length,\n            },\n          });\n        }\n      })\n    );\n  }\n\n  private setInitCounts(nonFilteredVariable: MultiValueVariable, filteredVariable: MultiValueVariable) {\n    const initCounts = { current: 0, total: 0 };\n\n    // We make sure the count of metrics is not 0 in a scenario where the user goes from the MetricsReducer to the MetricScene and back.\n    // Indeed, sometimes, the variables already have their options and do not load new ones.\n    if (!nonFilteredVariable.state.loading && nonFilteredVariable.state.options.length) {\n      initCounts.total = nonFilteredVariable.state.options.length;\n    }\n\n    if (!filteredVariable.state.loading && filteredVariable.state.options.length) {\n      initCounts.current = filteredVariable.state.options.length;\n    }\n\n    this.setState({ counts: initCounts });\n  }\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\ninterface EventQuickSearchChangedPayload {\n  searchText: string;\n}\n\nexport class EventQuickSearchChanged extends BusEventWithPayload<EventQuickSearchChangedPayload> {\n  public static readonly type = 'quick-search-changed';\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  VariableDependencyConfig,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { IconButton, Input, Tag, Tooltip, useStyles2 } from '@grafana/ui';\nimport { debounce } from 'lodash';\nimport React, { type KeyboardEvent } from 'react';\n\nimport { reportExploreMetrics } from 'interactions';\nimport { VAR_DATASOURCE } from 'shared';\n\nimport { type CountsProvider } from './CountsProvider/CountsProvider';\nimport { EventQuickSearchChanged } from './EventQuickSearchChanged';\n\ninterface QuickSearchState extends SceneObjectState {\n  urlSearchParamName: string;\n  targetName: string;\n  countsProvider: CountsProvider;\n  displayCounts: boolean;\n  value: string;\n}\n\nexport class QuickSearch extends SceneObjectBase<QuickSearchState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_DATASOURCE],\n    onReferencedVariableValueChanged: () => {\n      this.setState({ value: '' });\n    },\n  });\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: [this.state.urlSearchParamName],\n  });\n\n  getUrlState() {\n    return { [this.state.urlSearchParamName]: this.state.value };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const newValue = (values[this.state.urlSearchParamName] as string) || '';\n\n    if (newValue !== this.state.value) {\n      this.setState({ value: newValue });\n    }\n  }\n\n  public constructor({\n    urlSearchParamName,\n    targetName,\n    countsProvider,\n    displayCounts,\n  }: {\n    urlSearchParamName: QuickSearchState['urlSearchParamName'];\n    targetName: QuickSearchState['targetName'];\n    countsProvider: QuickSearchState['countsProvider'];\n    displayCounts?: QuickSearchState['displayCounts'];\n  }) {\n    super({\n      key: 'quick-search',\n      urlSearchParamName,\n      targetName,\n      countsProvider,\n      displayCounts: Boolean(displayCounts),\n      value: '',\n    });\n  }\n\n  public toggleCountsDisplay(displayCounts: boolean) {\n    this.setState({ displayCounts });\n  }\n\n  private notifyValueChange = debounce((value: string) => {\n    this.publishEvent(new EventQuickSearchChanged({ searchText: value }), true);\n  }, 250);\n\n  private updateValue(value: string) {\n    const wasEmpty = this.state.value === '';\n    const isNewSearch = wasEmpty && value !== '';\n\n    if (isNewSearch) {\n      reportExploreMetrics('quick_search_used', {});\n    }\n\n    this.setState({ value });\n    this.notifyValueChange(value);\n  }\n\n  private onChange = (e: React.FormEvent<HTMLInputElement>) => {\n    this.updateValue(e.currentTarget.value);\n  };\n\n  private clear = () => {\n    this.updateValue('');\n  };\n\n  private onKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Escape') {\n      e.preventDefault();\n      this.clear();\n    }\n  };\n\n  private useHumanFriendlyCountsMessage() {\n    const { targetName, countsProvider, displayCounts } = this.state;\n    const counts = countsProvider.useCounts();\n\n    if (!displayCounts) {\n      return {\n        tagName: '',\n        tooltipContent: '',\n      };\n    }\n\n    if (counts.current === counts.total) {\n      return {\n        tagName: `${counts.current}`,\n        tooltipContent: counts.current !== 1 ? `${counts.current} ${targetName}s in total` : `1 ${targetName} in total`,\n      };\n    }\n\n    return {\n      tagName: `${counts.current}/${counts.total}`,\n      tooltipContent:\n        counts.current !== 1\n          ? `${counts.current} out of ${counts.total} ${targetName}s in total`\n          : `1 out of ${counts.total} ${targetName}s in total`,\n    };\n  }\n\n  static readonly Component = ({ model }: { model: QuickSearch }) => {\n    const styles = useStyles2(getStyles);\n    const { targetName, value, countsProvider } = model.useState();\n    const { tagName, tooltipContent } = model.useHumanFriendlyCountsMessage();\n\n    return (\n      <Input\n        value={value}\n        onChange={model.onChange}\n        onKeyDown={model.onKeyDown}\n        placeholder={`Quick search ${targetName}s`}\n        prefix={<i className=\"fa fa-search\" />}\n        suffix={\n          <>\n            <countsProvider.Component model={countsProvider} />\n            {tagName && (\n              <Tooltip content={tooltipContent} placement=\"top\">\n                <Tag className={styles.counts} name={tagName} colorIndex={9} />\n              </Tooltip>\n            )}\n            <IconButton\n              name=\"times\"\n              variant=\"secondary\"\n              tooltip=\"Clear search\"\n              onClick={model.clear}\n              disabled={!value}\n            />\n          </>\n        }\n      />\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  counts: css`\n    margin-right: ${theme.spacing(1)};\n    border-radius: 11px;\n    padding: 2px ${theme.spacing(1)};\n    color: ${theme.colors.text.primary};\n    background-color: ${theme.colors.background.secondary};\n  `,\n});\n","import { css } from '@emotion/css';\nimport { type SelectableValue } from '@grafana/data';\nimport {\n  EmbeddedScene,\n  SceneFlexItem,\n  SceneFlexLayout,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type SceneReactObject,\n  type SceneVariableSet,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { MetricsSorter } from './MetricsSorter/MetricsSorter';\nimport { type CountsProvider } from './QuickSearch/CountsProvider/CountsProvider';\nimport { MetricVariableCountsProvider } from './QuickSearch/CountsProvider/MetricVariableCountsProvider';\nimport { QuickSearch } from './QuickSearch/QuickSearch';\n\ninterface ListControlsState extends SceneObjectState {\n  $variables?: SceneVariableSet;\n  inputControls?: SceneReactObject;\n  onChange?: (value: SelectableValue<string>) => void; // Keeping for backward compatibility\n}\n\n// @ts-ignore to fix build error. Is there a Scenes friend way of doing this?\nexport class ListControls extends EmbeddedScene {\n  constructor(state: Partial<ListControlsState>) {\n    super({\n      ...state,\n      key: 'list-controls',\n      body: new SceneFlexLayout({\n        direction: 'row',\n        width: '100%',\n        maxHeight: '32px',\n        children: [\n          new SceneFlexItem({\n            body: new QuickSearch({\n              urlSearchParamName: 'search_txt',\n              targetName: 'metric',\n              countsProvider: new MetricVariableCountsProvider() as unknown as CountsProvider,\n            }),\n          }),\n          new SceneFlexItem({\n            width: 'auto',\n            body: new MetricsSorter({}),\n          }),\n          new SceneFlexItem({\n            width: 'auto',\n            body: new LayoutSwitcher({}),\n          }),\n        ],\n      }),\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<ListControls>) => {\n    const styles = useStyles2(getStyles);\n    const { body } = model.useState();\n\n    return (\n      <div className={styles.headerWrapper}>\n        <body.Component model={body} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles() {\n  return {\n    headerWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n      '& > div': {\n        display: 'flex',\n        alignItems: 'center',\n        '& > div': {\n          display: 'flex',\n          alignItems: 'center',\n        },\n      },\n    }),\n  };\n}\n","import { SceneVariableValueChangedEvent, type QueryVariable, type VariableValueOption } from '@grafana/scenes';\nimport { cloneDeep, isEqual } from 'lodash';\n\nimport { type MetricOptions } from './MetricsVariable';\n\nexport type MetricFilters = {\n  categories: string[];\n  prefixes: string[];\n  suffixes: string[];\n  names: string[];\n};\n\nexport class MetricsVariableFilterEngine {\n  private variable: QueryVariable;\n  private initOptions: VariableValueOption[] = [];\n  private filters: MetricFilters = {\n    categories: [],\n    prefixes: [],\n    suffixes: [],\n    names: [],\n  };\n\n  constructor(variable: QueryVariable) {\n    this.variable = variable;\n  }\n\n  public setInitOptions(options: VariableValueOption[]) {\n    this.initOptions = cloneDeep(options);\n  }\n\n  /**\n   * Get a copy of the current filters\n   */\n  public getFilters(): MetricFilters {\n    return this.filters;\n  }\n\n  /**\n   * Compute options based on filters.\n   * @param options The options to filter\n   * @param filters The filters to apply\n   * @returns Filtered options\n   */\n  public static getFilteredOptions(options: VariableValueOption[], filters: MetricFilters): MetricOptions {\n    let filteredOptions = options as MetricOptions;\n\n    if (filters.categories.length > 0) {\n      filteredOptions = MetricsVariableFilterEngine.applyCategoryFilters(filteredOptions, filters.categories);\n    }\n\n    if (filters.prefixes.length > 0) {\n      filteredOptions = MetricsVariableFilterEngine.applyPrefixFilters(filteredOptions, filters.prefixes);\n    }\n\n    if (filters.suffixes.length > 0) {\n      filteredOptions = MetricsVariableFilterEngine.applySuffixFilters(filteredOptions, filters.suffixes);\n    }\n\n    if (filters.names.length > 0) {\n      filteredOptions = MetricsVariableFilterEngine.applyNameFilters(filteredOptions, filters.names);\n    }\n\n    return filteredOptions;\n  }\n\n  public applyFilters(filters: Partial<MetricFilters> = this.filters, settings = { forceUpdate: false, notify: true }) {\n    const updatedFilters: MetricFilters = {\n      ...this.filters,\n      ...filters,\n    };\n\n    if (!settings.forceUpdate && isEqual(this.filters, updatedFilters)) {\n      return;\n    }\n\n    if (\n      !updatedFilters.categories.length &&\n      !updatedFilters.prefixes.length &&\n      !updatedFilters.suffixes.length &&\n      !updatedFilters.names.length\n    ) {\n      this.filters = updatedFilters;\n\n      this.variable.setState({ options: this.initOptions });\n\n      if (settings.notify) {\n        this.notifyUpdate();\n      }\n\n      return;\n    }\n\n    this.filters = updatedFilters;\n\n    const filteredOptions = MetricsVariableFilterEngine.getFilteredOptions(this.initOptions, this.filters);\n\n    this.variable.setState({ options: filteredOptions });\n\n    if (settings.notify) {\n      this.notifyUpdate();\n    }\n  }\n\n  private static applyCategoryFilters(options: MetricOptions, categories: string[]): MetricOptions {\n    let filteredOptions: MetricOptions = [];\n\n    for (const category of categories) {\n      const categoryRegex = MetricsVariableFilterEngine.buildRegex(category, 'i'); // see e.g. computeRulesGroups (could apply to other categories in the future)\n      filteredOptions = filteredOptions.concat(options.filter((option) => categoryRegex.test(option.value)));\n    }\n\n    return filteredOptions;\n  }\n\n  private static applyPrefixFilters(options: MetricOptions, prefixes: string[]): MetricOptions {\n    const pattern = prefixes\n      .map((prefix) => {\n        // Multi-value support (see computeMetricPrefixGroups)\n        if (prefix.includes('|')) {\n          return `${prefix\n            .split('|')\n            .map((p) => `^${p}([^a-z0-9]|$)`)\n            .join('|')}`;\n        }\n\n        return `^${prefix}([^a-z0-9]|$)`;\n      })\n      .join('|');\n\n    const prefixesRegex = MetricsVariableFilterEngine.buildRegex(`(${pattern})`);\n\n    const filteredOptions = options.filter((option) => prefixesRegex.test(option.value as string));\n\n    return filteredOptions;\n  }\n\n  private static applySuffixFilters(options: MetricOptions, suffixes: string[]): MetricOptions {\n    const pattern = suffixes\n      .map((suffix) => {\n        // Multi-value support (see computeMetricSuffixGroups)\n        if (suffix.includes('|')) {\n          return `${suffix\n            .split('|')\n            .map((s) => `(^|[^a-z0-9])${s}$`)\n            .join('|')}`;\n        }\n\n        return `(^|[^a-z0-9])${suffix}$`;\n      })\n      .join('|');\n\n    const suffixesRegex = MetricsVariableFilterEngine.buildRegex(`(${pattern})`);\n\n    const filteredOptions = options.filter((option) => suffixesRegex.test(option.value as string));\n\n    return filteredOptions;\n  }\n\n  private static applyNameFilters(options: MetricOptions, names: string[]): MetricOptions {\n    const [namePatterns] = names;\n\n    const regexes = namePatterns\n      .split(',')\n      .map((p) => p.trim())\n      .filter(Boolean)\n      .map((r) => {\n        try {\n          return new RegExp(r);\n        } catch {\n          return null;\n        }\n      })\n      .filter(Boolean) as RegExp[];\n\n    return options.filter((option) => regexes.some((regex) => regex.test(option.value as string)));\n  }\n\n  private static buildRegex(pattern: string, flags?: string) {\n    try {\n      return new RegExp(pattern, flags);\n    } catch {\n      return new RegExp('.*');\n    }\n  }\n\n  private notifyUpdate() {\n    // hack to force SceneByVariableRepeater to re-render\n    this.variable.publishEvent(new SceneVariableValueChangedEvent(this.variable), true);\n  }\n}\n","import leven from 'leven';\n\nexport function sortRelatedMetrics(metricList: string[], metric: string) {\n  return metricList.sort((aValue, bValue) => {\n    const a = getLevenDistances(aValue, metric);\n    const b = getLevenDistances(bValue, metric);\n\n    return a.halfLeven + a.wholeLeven - (b.halfLeven + b.wholeLeven);\n  });\n}\n\ntype LevenDistances = { halfLeven: number; wholeLeven: number };\ntype TargetToLevenDistances = Map<string, LevenDistances>;\n\nconst metricToTargetLevenDistances = new Map<string, TargetToLevenDistances>();\n\n// Provides the Levenshtein distance between a metric to be sorted\n// and a targetMetric compared to which all other metrics are being sorted\n// There are two distances: once for the first half and once for the whole string.\n// This operation is not expected to be symmetric; order of parameters matters\n// since only `metric` is split.\nfunction getLevenDistances(metric: string, targetMetric: string) {\n  let targetToDistances: TargetToLevenDistances | undefined = metricToTargetLevenDistances.get(metric);\n  if (!targetToDistances) {\n    targetToDistances = new Map<string, LevenDistances>();\n    metricToTargetLevenDistances.set(metric, targetToDistances);\n  }\n\n  let distances: LevenDistances | undefined = targetToDistances.get(targetMetric);\n  if (!distances) {\n    const metricSplit = metric.split('_');\n    const metricHalf = metricSplit.slice(0, metricSplit.length / 2).join('_');\n\n    const halfLeven = leven(metricHalf, targetMetric!) || 0;\n    const wholeLeven = leven(metric, targetMetric!) || 0;\n\n    distances = { halfLeven, wholeLeven };\n    targetToDistances.set(targetMetric, distances);\n  }\n\n  return distances;\n}\n","import { sceneGraph, SceneVariableValueChangedEvent, type QueryVariable } from '@grafana/scenes';\n\nimport { sortRelatedMetrics } from 'RelatedMetricsScene/sortRelatedMetrics';\nimport { logger } from 'tracking/logger/logger';\nimport {\n  MetricsSorter,\n  sortMetricsByCount,\n  sortMetricsWithRecentFirst,\n  type SortingOption,\n} from 'WingmanDataTrail/ListControls/MetricsSorter/MetricsSorter';\nimport { type MetricUsageType } from 'WingmanDataTrail/ListControls/MetricsSorter/MetricUsageFetcher';\n\nimport { areArraysEqual } from './helpers/areArraysEqual';\n\nexport class MetricsVariableSortEngine {\n  private variable: QueryVariable;\n  private lastMetrics: string[];\n  private sortBy?: SortingOption | 'related';\n\n  constructor(variable: QueryVariable) {\n    this.variable = variable;\n    this.sortBy = undefined;\n    this.lastMetrics = [];\n  }\n\n  public async sort(sortBy = this.sortBy, options: Record<string, any> = {}) {\n    const metrics = this.variable.state.options.map((option) => option.value as string);\n\n    if (sortBy === this.sortBy && areArraysEqual(metrics, this.lastMetrics)) {\n      return;\n    }\n\n    let sortedMetrics: string[];\n\n    switch (sortBy) {\n      case 'dashboard-usage':\n      case 'alerting-usage':\n        sortedMetrics = await this.sortByUsage(metrics, sortBy);\n        break;\n\n      case 'related':\n        sortedMetrics = sortRelatedMetrics(metrics, options.metric);\n        break;\n\n      default:\n        sortedMetrics = sortMetricsWithRecentFirst(metrics);\n        break;\n    }\n\n    this.sortBy = sortBy;\n    this.lastMetrics = sortedMetrics;\n\n    this.variable.setState({\n      options: sortedMetrics.map((metricName) => ({\n        label: metricName,\n        value: metricName,\n      })),\n    });\n\n    this.notifyUpdate();\n  }\n\n  private async sortByUsage(metrics: string[], usageType: MetricUsageType) {\n    try {\n      const metricsSorter = sceneGraph.findByKeyAndType(this.variable, 'metrics-sorter', MetricsSorter);\n      if (!metricsSorter) {\n        logger.warn('Metrics sorter not found. Returning unsorted metrics.', { usageType });\n        return metrics;\n      }\n      const usageMetrics = await metricsSorter.getUsageMetrics(usageType);\n      return sortMetricsByCount(metrics, usageMetrics);\n    } catch (err) {\n      const error = typeof err === 'string' ? new Error(err) : (err as Error);\n      logger.error(error, {\n        usageType,\n      });\n      return metrics;\n    }\n  }\n\n  private notifyUpdate() {\n    // hack to force SceneByVariableRepeater to re-render\n    this.variable.publishEvent(new SceneVariableValueChangedEvent(this.variable), true);\n  }\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { type MetricFilters } from 'WingmanDataTrail/MetricsVariables/MetricsVariableFilterEngine';\n\ninterface EventFiltersChangedPayload {\n  type: keyof MetricFilters;\n  filters: string[];\n}\n\nexport class EventFiltersChanged extends BusEventWithPayload<EventFiltersChangedPayload> {\n  public static readonly type = 'filters-changed';\n}\n","export const ruleGroupLabels = {\n  metrics: 'Non-rules metrics',\n  rules: 'Recording rules',\n} as const;\n\nexport type RuleGroupLabel = (typeof ruleGroupLabels)[keyof typeof ruleGroupLabels];\n","import { BusEventWithPayload } from '@grafana/data';\n\ninterface EventSectionValueChangedPayload {\n  key: string;\n  values: string[];\n}\n\nexport class EventSectionValueChanged extends BusEventWithPayload<EventSectionValueChangedPayload> {\n  public static readonly type = 'section-value-changed';\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Checkbox, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nexport const CheckboxWithCount = ({\n  label,\n  count,\n  checked,\n  onChange,\n}: {\n  label: string;\n  count: number;\n  checked: boolean;\n  onChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\n}) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.checkboxWrapper} title={label}>\n      <Checkbox label={label} value={checked} onChange={onChange} />\n      <span className={styles.count}>({count})</span>\n    </div>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    checkboxWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n      width: '100%',\n      '& label *': {\n        fontSize: '14px !important',\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n      },\n    }),\n    count: css({\n      color: theme.colors.text.secondary,\n      marginLeft: theme.spacing(0.5),\n      display: 'inline-block',\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { type RuleGroupLabel } from 'WingmanDataTrail/MetricsVariables/metricLabels';\n\nimport { CheckboxWithCount } from './CheckboxWithCount';\nimport { type MetricsFilterSectionState } from './MetricsFilterSection';\n\ntype CheckBoxListProps = {\n  groups: MetricsFilterSectionState['groups'];\n  selectedGroups: MetricsFilterSectionState['selectedGroups'];\n  onSelectionChange: (newGroups: MetricsFilterSectionState['selectedGroups']) => void;\n};\n\nexport function CheckBoxList({ groups, selectedGroups, onSelectionChange }: Readonly<CheckBoxListProps>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <>\n      <div className={styles.checkboxListHeader}>\n        <div>{selectedGroups.length} selected</div>\n        <Button variant=\"secondary\" fill=\"text\" onClick={() => onSelectionChange([])} disabled={!selectedGroups.length}>\n          clear\n        </Button>\n      </div>\n\n      {!groups.length && <div className={styles.noResults}>No results.</div>}\n\n      {groups.length > 0 && (\n        <ul className={styles.checkboxList} data-testid=\"checkbox-filters-list\">\n          {groups.map((group) => (\n            <li key={group.value} className={styles.checkboxItem}>\n              <CheckboxWithCount\n                label={group.label}\n                count={group.count}\n                checked={selectedGroups.some((g) => g.value === group.value)}\n                onChange={(e) => {\n                  const newGroups = e.currentTarget.checked\n                    ? [...selectedGroups, { label: group.label as RuleGroupLabel, value: group.value }]\n                    : selectedGroups.filter((v) => v.value !== group.value);\n\n                  onSelectionChange(newGroups);\n                }}\n              />\n            </li>\n          ))}\n        </ul>\n      )}\n    </>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    checkboxListHeader: css({\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'center',\n      color: theme.colors.text.secondary,\n      margin: theme.spacing(0),\n      padding: theme.spacing(0, 0, 0, 1),\n    }),\n    checkboxList: css({\n      height: '100%',\n      margin: 0,\n      padding: theme.spacing(0, 1, 1, 1),\n      overflowY: 'auto',\n      '& .css-1n4u71h-Label': {\n        fontSize: '14px !important',\n      },\n      '&::-webkit-scrollbar': {\n        '-webkit-appearance': 'none',\n        width: '7px',\n      },\n      '&::-webkit-scrollbar-thumb': {\n        borderRadius: '4px',\n        backgroundColor: theme.colors.secondary.main,\n        '-webkit-box-shadow': `0 0 1px ${theme.colors.secondary.shade}`,\n      },\n    }),\n    checkboxItem: css({\n      display: 'flex',\n      alignItems: 'center',\n      width: '100%',\n      padding: theme.spacing(0.5, 0),\n    }),\n    noResults: css({\n      fontStyle: 'italic',\n      padding: theme.spacing(0, 1, 1, 1),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  VariableDependencyConfig,\n  type MultiValueVariable,\n  type SceneComponentProps,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { Icon, IconButton, Input, Spinner, Switch, useStyles2 } from '@grafana/ui';\nimport React, { useMemo, useState, type KeyboardEventHandler } from 'react';\n\nimport { logger } from 'tracking/logger/logger';\nimport { MetricsReducer } from 'WingmanDataTrail/MetricsReducer';\nimport {\n  VAR_FILTERED_METRICS_VARIABLE,\n  type FilteredMetricsVariable,\n} from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\nimport { ruleGroupLabels, type RuleGroupLabel } from 'WingmanDataTrail/MetricsVariables/metricLabels';\nimport {\n  VAR_METRICS_VARIABLE,\n  type MetricOptions,\n  type MetricsVariable,\n} from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\nimport {\n  MetricsVariableFilterEngine,\n  type MetricFilters,\n} from 'WingmanDataTrail/MetricsVariables/MetricsVariableFilterEngine';\n\nimport { reportExploreMetrics } from '../../../../interactions';\nimport { EventSectionValueChanged } from '../EventSectionValueChanged';\nimport { SectionTitle } from '../SectionTitle';\nimport { type SideBarSectionState } from '../types';\nimport { CheckBoxList } from './CheckBoxList';\nimport { EventFiltersChanged } from './EventFiltersChanged';\n\nexport interface MetricsFilterSectionState extends SideBarSectionState {\n  type: keyof MetricFilters;\n  computeGroups: (\n    options: Array<{ label: string; value: string }>\n  ) => Array<{ label: string; value: string; count: number }>;\n  showHideEmpty: boolean;\n  showSearch: boolean;\n  groups: Array<{ label: string; value: string; count: number }>;\n  selectedGroups: Array<{ label: RuleGroupLabel; value: string }>; // we need labels for displaying tooltips in `SideBar.tsx`\n  loading: boolean;\n}\n\nexport class MetricsFilterSection extends SceneObjectBase<MetricsFilterSectionState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_METRICS_VARIABLE, VAR_FILTERED_METRICS_VARIABLE],\n    onReferencedVariableValueChanged: (variable) => {\n      const { name, options } = (variable as MultiValueVariable).state;\n\n      if (name === VAR_METRICS_VARIABLE) {\n        this.updateLists(options as MetricOptions);\n        return;\n      }\n\n      if (name === VAR_FILTERED_METRICS_VARIABLE) {\n        this.updateCounts();\n      }\n    },\n  });\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: [this.state.key] });\n\n  getUrlState() {\n    return {\n      [this.state.key]: this.state.selectedGroups.map((g) => g.value).join(','),\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<MetricsFilterSectionState> = {};\n\n    if (\n      typeof values[this.state.key] === 'string' &&\n      values[this.state.key] !== this.state.selectedGroups.map((g) => g.value).join(',')\n    ) {\n      stateUpdate.selectedGroups = (values[this.state.key] as string)\n        .split(',')\n        .map((v) => ({ label: v as RuleGroupLabel, value: v })) as Array<{ label: RuleGroupLabel; value: string }>;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  constructor({\n    key,\n    type,\n    title,\n    description,\n    icon,\n    computeGroups,\n    showHideEmpty,\n    showSearch,\n    disabled,\n    active,\n  }: {\n    key: MetricsFilterSectionState['key'];\n    type: MetricsFilterSectionState['type'];\n    title: MetricsFilterSectionState['title'];\n    description: MetricsFilterSectionState['description'];\n    icon: MetricsFilterSectionState['icon'];\n    computeGroups: MetricsFilterSectionState['computeGroups'];\n    showHideEmpty?: MetricsFilterSectionState['showHideEmpty'];\n    showSearch?: MetricsFilterSectionState['showSearch'];\n    disabled?: MetricsFilterSectionState['disabled'];\n    active?: MetricsFilterSectionState['active'];\n  }) {\n    super({\n      key,\n      type,\n      title,\n      description,\n      icon,\n      groups: [],\n      computeGroups,\n      selectedGroups: [],\n      loading: true,\n      showHideEmpty: showHideEmpty ?? true,\n      showSearch: showSearch ?? true,\n      disabled: disabled ?? false,\n      active: active ?? false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const metricsVariable = sceneGraph.lookupVariable(VAR_METRICS_VARIABLE, this) as MetricsVariable;\n    const filteredMetricsVariable = sceneGraph.lookupVariable(\n      VAR_FILTERED_METRICS_VARIABLE,\n      this\n    ) as FilteredMetricsVariable;\n\n    this.updateLists(metricsVariable.state.options as MetricOptions);\n    this.updateCounts();\n\n    const { selectedGroups } = this.state;\n\n    this.setState({\n      loading: filteredMetricsVariable.state.loading,\n      active: selectedGroups.length > 0,\n    });\n  }\n\n  private updateLists(options: MetricOptions) {\n    this.setState({\n      groups: this.state.computeGroups(options),\n      loading: false,\n    });\n  }\n\n  private updateCounts() {\n    const { groups, computeGroups, type } = this.state;\n\n    // Access the original unfiltered options\n    const metricsVariable = sceneGraph.lookupVariable(VAR_METRICS_VARIABLE, this) as MetricsVariable;\n    const originalOptions = metricsVariable.state.options as MetricOptions;\n\n    const metricsReducer = sceneGraph.getAncestor(this, MetricsReducer);\n    const filterEngine = metricsReducer.state.enginesMap.get(VAR_FILTERED_METRICS_VARIABLE)?.filterEngine;\n\n    if (!filterEngine) {\n      logger.warn('MetricsFilterSection: No filter engine found');\n      return;\n    }\n\n    // Create a copy of current filters excluding the current filter type\n    const filtersWithoutCurrentType = { ...filterEngine.getFilters(), [type]: [] };\n\n    // Get options filtered by everything except the current filter type\n    const optionsForCounting = MetricsVariableFilterEngine.getFilteredOptions(\n      originalOptions,\n      filtersWithoutCurrentType\n    );\n\n    // Calculate counts based on these options\n    const newGroups = new Map<string, number>(\n      computeGroups(optionsForCounting).map((option) => [option.label, option.count])\n    );\n\n    const newGroupsWithCount = groups.map((group) => ({\n      ...group,\n      count: newGroups.get(group.label) ?? 0,\n    }));\n\n    this.setState({\n      groups: newGroupsWithCount,\n      loading: false,\n    });\n  }\n\n  private onSelectionChange = (selectedGroups: MetricsFilterSectionState['selectedGroups']) => {\n    this.setState({ selectedGroups, active: selectedGroups.length > 0 });\n\n    this.publishEvent(\n      new EventFiltersChanged({ type: this.state.type, filters: selectedGroups.map((g) => g.value) }),\n      true\n    );\n\n    this.publishEvent(\n      new EventSectionValueChanged({ key: this.state.key, values: selectedGroups.map((g) => g.label) }),\n      true\n    );\n\n    if (this.state.type === 'prefixes') {\n      reportExploreMetrics('sidebar_prefix_filter_applied', {\n        filter_count: selectedGroups.length,\n      });\n    } else if (this.state.type === 'suffixes') {\n      reportExploreMetrics('sidebar_suffix_filter_applied', {\n        filter_count: selectedGroups.length,\n      });\n    }\n\n    // Track rule filter selection events\n    if (this.state.key === 'filters-rule' && selectedGroups.length > 0) {\n      // Map the label to the appropriate filter_type for the event\n      selectedGroups.forEach((group) => {\n        let filterType: 'non_rules_metrics' | 'recording_rules' | 'alerting_rules';\n\n        switch (group.label) {\n          case ruleGroupLabels.metrics:\n            filterType = 'non_rules_metrics';\n            break;\n          case ruleGroupLabels.rules:\n            filterType = 'recording_rules';\n            break;\n          default:\n            return; // Skip if it's not a recognized rules filter\n        }\n\n        reportExploreMetrics('sidebar_rules_filter_selected', { filter_type: filterType });\n      });\n    }\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsFilterSection>) => {\n    const styles = useStyles2(getStyles);\n    const { groups, selectedGroups, loading, title, description, showHideEmpty, showSearch } = model.useState();\n\n    const [hideEmpty, setHideEmpty] = useState(false);\n    const [searchValue, setSearchValue] = useState('');\n\n    const filteredGroups = useMemo(() => {\n      const filters: Array<(item: { label: string; value: string; count: number }) => boolean> = [];\n\n      if (hideEmpty) {\n        filters.push((item) => item.count > 0);\n      }\n\n      filters.push((item) => item.label.toLowerCase().includes(searchValue.toLowerCase()));\n\n      return groups.filter((group) => filters.every((filter) => filter(group)));\n    }, [hideEmpty, groups, searchValue]);\n\n    const onKeyDown: KeyboardEventHandler<HTMLInputElement> = (e) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        setSearchValue('');\n      }\n    };\n\n    return (\n      <div className={styles.container}>\n        <SectionTitle title={title} description={description} />\n\n        {showHideEmpty && (\n          <div className={styles.switchContainer}>\n            <span className={styles.switchLabel}>Hide empty</span>\n            <Switch value={hideEmpty} onChange={(e) => setHideEmpty(e.currentTarget.checked)} />\n          </div>\n        )}\n\n        {showSearch && (\n          <Input\n            className={styles.searchInput}\n            prefix={<Icon name=\"search\" />}\n            placeholder=\"Search...\"\n            value={searchValue}\n            onChange={(e) => setSearchValue(e.currentTarget.value)}\n            onKeyDown={onKeyDown}\n            suffix={\n              <IconButton name=\"times\" variant=\"secondary\" tooltip=\"Clear search\" onClick={() => setSearchValue('')} />\n            }\n          />\n        )}\n\n        {loading && <Spinner inline />}\n\n        {!loading && (\n          <CheckBoxList\n            groups={filteredGroups}\n            selectedGroups={selectedGroups}\n            onSelectionChange={model.onSelectionChange}\n          />\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n      height: '100%',\n      overflowY: 'hidden',\n    }),\n    switchContainer: css({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'flex-end',\n      gap: theme.spacing(1),\n    }),\n    switchLabel: css({\n      fontSize: '12px',\n      color: theme.colors.text.primary,\n    }),\n    searchInput: css({\n      flexBasis: '32px',\n      flexShrink: 0,\n      marginBottom: theme.spacing(1),\n      padding: theme.spacing(0, 0.5),\n    }),\n  };\n}\n","import { localeCompare } from 'WingmanDataTrail/helpers/localCompare';\n\nconst NONE_PREFIX = '<none>';\n\nexport function computeMetricPrefixGroups(options: Array<{ label: string; value: string }>) {\n  const rawPrefixesMap = new Map<string, string[]>();\n\n  for (const option of options) {\n    const parts = option.value.split(/[^a-z0-9]/i);\n    const key = parts.length <= 1 ? option.value : parts[0];\n    const values = rawPrefixesMap.get(key) ?? [];\n\n    values.push(option.value);\n    rawPrefixesMap.set(key || NONE_PREFIX, values);\n  }\n\n  const prefixesMap = new Map<string, number>();\n\n  for (const [prefix, values] of rawPrefixesMap) {\n    prefixesMap.set(prefix, values.length);\n  }\n\n  return Array.from(prefixesMap.entries())\n    .sort((a, b) => {\n      if (a[1] !== b[1]) {\n        return b[1] - a[1];\n      }\n\n      return localeCompare(a[0], b[0]);\n    })\n    .map(([value, count]) => ({\n      value,\n      count,\n      label: value,\n    }));\n}\n","import { localeCompare } from 'WingmanDataTrail/helpers/localCompare';\n\nconst NONE_SUFFIX = '<none>';\n\nexport function computeMetricSuffixGroups(options: Array<{ label: string; value: string }>) {\n  const rawSuffixesMap = new Map<string, string[]>();\n\n  for (const option of options) {\n    const parts = option.value.split(/[^a-z0-9]/i);\n    const key = parts.length <= 1 ? option.value : parts[parts.length - 1];\n    const values = rawSuffixesMap.get(key) ?? [];\n\n    values.push(option.value);\n    rawSuffixesMap.set(key || NONE_SUFFIX, values);\n  }\n\n  const suffixesMap = new Map<string, number>();\n\n  for (const [suffix, values] of rawSuffixesMap) {\n    suffixesMap.set(suffix, values.length);\n  }\n\n  return Array.from(suffixesMap.entries())\n    .sort((a, b) => {\n      if (a[1] !== b[1]) {\n        return b[1] - a[1];\n      }\n\n      return localeCompare(a[0], b[0]);\n    })\n    .map(([value, count]) => ({\n      value,\n      count,\n      label: value,\n    }));\n}\n","import { ruleGroupLabels } from './metricLabels';\n\ntype MetricType = 'metrics' | 'rules';\n\n/**\n * Checks if a metric name follows Prometheus recording rule naming conventions.\n *\n * @remarks Recording rules follow the pattern: `level:metric:operations` or `level:metric`.\n * The `level` component might be empty. Where `level` and `operations` can contain\n * underscores and alphanumeric characters. The `metric` part can contain any character, but can't be empty.\n */\nfunction isRecordingRule(value: string): boolean {\n  // Matches patterns like:\n  // - instance_path:requests:rate5m\n  // - path:requests:rate5m\n  // - job:request_failures_per_requests:ratio_rate5m\n  // - apiserver_request:availability30d\n  // - asserts:container_memory\n  // - :requests:rate5m\n  return /^\\w*:.*?(?::\\w+)?$/.test(value);\n}\n\nexport function computeRulesGroups(options: Array<{ label: string; value: string }>) {\n  const rulesMap = new Map<MetricType, string[]>([\n    ['metrics', []],\n    ['rules', []],\n  ]);\n\n  for (const option of options) {\n    const { value } = option;\n    const key: MetricType = isRecordingRule(value) ? 'rules' : 'metrics';\n\n    const values = rulesMap.get(key) ?? [];\n    values.push(value);\n    rulesMap.set(key, values);\n  }\n\n  return [\n    { value: '^(?!.*:.*)', label: ruleGroupLabels.metrics, count: rulesMap.get('metrics')!.length },\n    { value: ':', label: ruleGroupLabels.rules, count: rulesMap.get('rules')!.length },\n  ];\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2, type SelectableValue } from '@grafana/data';\nimport { Button, RadioButtonList, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { NULL_GROUP_BY_VALUE } from 'WingmanDataTrail/Labels/LabelsDataSource';\n\ntype LabelsListProps = {\n  labels: Array<SelectableValue<string>>;\n  selectedLabel: string;\n  onClickLabel: (label: string) => void;\n  onClickClearSelection: () => void;\n};\n\nexport function LabelsList({ labels, selectedLabel, onClickLabel, onClickClearSelection }: Readonly<LabelsListProps>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <>\n      <div className={styles.listHeader}>\n        <div className={styles.selected}>\n          {selectedLabel === NULL_GROUP_BY_VALUE ? 'No selection' : `Selected: \"${selectedLabel}\"`}\n        </div>\n        <Button\n          variant=\"secondary\"\n          fill=\"text\"\n          onClick={onClickClearSelection}\n          disabled={selectedLabel === NULL_GROUP_BY_VALUE}\n        >\n          clear\n        </Button>\n      </div>\n\n      {!labels.length && <div className={styles.noResults}>No results.</div>}\n\n      {labels.length > 0 && (\n        <div className={styles.list} data-testid=\"labels-list\">\n          {/* TODO: use a custom one to have option labels with ellipsis and title/tooltip when hovering\n      now we're customizing too much the component CSS */}\n          <RadioButtonList name=\"labels-list\" options={labels} onChange={onClickLabel} value={selectedLabel} />\n        </div>\n      )}\n    </>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    listHeader: css({\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'center',\n      color: theme.colors.text.secondary,\n      margin: theme.spacing(0),\n      padding: theme.spacing(0, 0, 0, 1),\n    }),\n    selected: css({\n      overflow: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n    }),\n    list: css({\n      display: 'flex',\n      flex: 1,\n      flexDirection: 'column',\n      gap: 0,\n      overflowY: 'auto',\n\n      '& [role=\"radiogroup\"]': {\n        gap: 0,\n      },\n\n      '& label': {\n        cursor: 'pointer',\n        padding: theme.spacing(0.5, 1),\n        '&:hover': {\n          background: theme.colors.background.secondary,\n        },\n      },\n\n      '& label div': {\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n      },\n    }),\n    noResults: css({\n      fontStyle: 'italic',\n      padding: theme.spacing(0, 1, 1, 1),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2, type SelectableValue } from '@grafana/data';\nimport { sceneGraph, SceneObjectBase, type SceneComponentProps } from '@grafana/scenes';\nimport { Icon, IconButton, Input, Spinner, useStyles2 } from '@grafana/ui';\nimport React, { useMemo, useState } from 'react';\n\nimport { NULL_GROUP_BY_VALUE } from 'WingmanDataTrail/Labels/LabelsDataSource';\nimport { type LabelsVariable } from 'WingmanDataTrail/Labels/LabelsVariable';\n\nimport { reportExploreMetrics } from '../../../../interactions';\nimport { EventSectionValueChanged } from '../EventSectionValueChanged';\nimport { SectionTitle } from '../SectionTitle';\nimport { type SideBarSectionState } from '../types';\nimport { LabelsList } from './LabelsList';\n\ninterface LabelsBrowserState extends SideBarSectionState {\n  variableName: string;\n}\n\nexport class LabelsBrowser extends SceneObjectBase<LabelsBrowserState> {\n  constructor({\n    key,\n    variableName,\n    title,\n    description,\n    icon,\n    disabled,\n    active,\n  }: {\n    key: LabelsBrowserState['key'];\n    variableName: LabelsBrowserState['variableName'];\n    title: LabelsBrowserState['title'];\n    description: LabelsBrowserState['description'];\n    icon: LabelsBrowserState['icon'];\n    disabled?: LabelsBrowserState['disabled'];\n    active?: LabelsBrowserState['active'];\n  }) {\n    super({\n      key,\n      variableName,\n      title,\n      description,\n      icon,\n      disabled: disabled ?? false,\n      active: active ?? false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const labelsVariable = sceneGraph.lookupVariable(this.state.variableName, this) as LabelsVariable;\n    const labelValue = labelsVariable.state.value;\n\n    this.setState({ active: Boolean(labelValue && labelValue !== NULL_GROUP_BY_VALUE) });\n\n    // Subscribe to variable changes to update active state when the variable is changed externally\n    this._subs.add(\n      labelsVariable.subscribeToState((newState) => {\n        const active = Boolean(newState.value && newState.value !== NULL_GROUP_BY_VALUE);\n        this.setState({ active });\n        this.publishEvent(new EventSectionValueChanged({ key: this.state.key, values: active ? [newState.value as string] : [] }), true);\n      })\n    );\n  }\n\n  private selectLabel(label: string) {\n    const labelsVariable = sceneGraph.lookupVariable(this.state.variableName, this) as LabelsVariable;\n    labelsVariable.changeValueTo(label);\n\n    const active = Boolean(label && label !== NULL_GROUP_BY_VALUE);\n\n    this.setState({ active });\n\n    this.publishEvent(new EventSectionValueChanged({ key: this.state.key, values: active ? [label] : [] }), true);\n  }\n\n  private onClickLabel = (label: string) => {\n    reportExploreMetrics('sidebar_group_by_label_filter_applied', { label });\n    this.selectLabel(label);\n  };\n\n  private onClickClearSelection = () => {\n    this.selectLabel(NULL_GROUP_BY_VALUE);\n  };\n\n  private useLabelsBrowser = () => {\n    const { variableName, title, description } = this.useState();\n\n    const labelsVariable = sceneGraph.lookupVariable(variableName, this) as LabelsVariable;\n    const { loading, options: labels, value: labelValue } = labelsVariable.useState();\n\n    const [searchValue, setSearchValue] = useState('');\n\n    const labelsList: Array<SelectableValue<string>> = useMemo(() => {\n      const filters = [\n        (item: string) => item !== NULL_GROUP_BY_VALUE,\n        (item: string) => item.toLowerCase().includes(searchValue.toLowerCase()),\n      ];\n\n      return labels.filter((item) => filters.every((filter) => filter(item.value as string))) as Array<\n        SelectableValue<string>\n      >;\n    }, [labels, searchValue]);\n\n    const onInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n      setSearchValue(e.currentTarget.value);\n    };\n\n    const onInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        setSearchValue('');\n      }\n    };\n\n    const onInputClear = () => {\n      setSearchValue('');\n    };\n\n    return {\n      title,\n      description,\n      loading,\n      selectedLabel: labelValue as string,\n      labelsList,\n      searchValue,\n      onInputChange,\n      onInputKeyDown,\n      onInputClear,\n    };\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<LabelsBrowser>) => {\n    const styles = useStyles2(getStyles);\n\n    const {\n      title,\n      description,\n      loading,\n      labelsList,\n      selectedLabel,\n      searchValue,\n      onInputChange,\n      onInputKeyDown,\n      onInputClear,\n    } = model.useLabelsBrowser();\n\n    return (\n      <div className={styles.container} data-testid=\"labels-browser\">\n        <SectionTitle title={title} description={description} />\n\n        <Input\n          className={styles.search}\n          prefix={<Icon name=\"search\" />}\n          placeholder=\"Search...\"\n          value={searchValue}\n          onChange={onInputChange}\n          onKeyDown={onInputKeyDown}\n          suffix={<IconButton name=\"times\" variant=\"secondary\" tooltip=\"Clear search\" onClick={onInputClear} />}\n        />\n\n        {loading && <Spinner inline />}\n\n        {!loading && (\n          <LabelsList\n            labels={labelsList}\n            selectedLabel={selectedLabel}\n            onClickLabel={model.onClickLabel}\n            onClickClearSelection={model.onClickClearSelection}\n          />\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n      height: '100%',\n      overflowY: 'hidden',\n    }),\n    search: css({\n      marginBottom: theme.spacing(1),\n      padding: theme.spacing(0, 0.5),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { SectionTitle } from './SectionTitle';\nimport { type SideBarSectionState } from './types';\n\ninterface SettingsState extends SideBarSectionState {}\n\nexport class Settings extends SceneObjectBase<SettingsState> {\n  constructor({\n    key,\n    title,\n    description,\n    icon,\n    disabled,\n  }: {\n    key: SettingsState['key'];\n    title: SettingsState['title'];\n    description: SettingsState['description'];\n    icon: SettingsState['icon'];\n    disabled?: SettingsState['disabled'];\n  }) {\n    super({\n      key,\n      title,\n      description,\n      icon,\n      disabled: disabled ?? false,\n      active: false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {}\n\n  public static readonly Component = ({ model }: SceneComponentProps<Settings>) => {\n    const styles = useStyles2(getStyles);\n    const { title, description } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <SectionTitle title={title} description={description} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n      height: '100%',\n      overflowY: 'hidden',\n    }),\n  };\n}\n","import { css, cx } from '@emotion/css';\nimport { availableIconsIndex, type GrafanaTheme2, type IconName } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { GroupsIcon } from './custom-icons/GroupsIcon';\nimport { RulesIcon } from './custom-icons/RulesIcon';\n\nconst CustomIcons = new Map<string, React.FC>([\n  ['rules', RulesIcon],\n  ['groups', GroupsIcon],\n]);\n\ntype SideBarButtonProps = {\n  ariaLabel: string;\n  disabled: boolean;\n  visible: boolean;\n  active: boolean;\n  tooltip: string;\n  onClick: () => void;\n  iconOrText: string | IconName;\n};\n\nexport function SideBarButton({\n  ariaLabel,\n  disabled,\n  visible,\n  active,\n  tooltip,\n  iconOrText,\n  onClick,\n}: Readonly<SideBarButtonProps>) {\n  const styles = useStyles2(getStyles);\n\n  let buttonIcon;\n  let ButtonChild;\n\n  if (iconOrText in availableIconsIndex) {\n    buttonIcon = iconOrText as IconName;\n  } else if (CustomIcons.has(iconOrText)) {\n    // some icons are not available in the Saga Design System and have been added as SVG files to the code base\n    ButtonChild = CustomIcons.get(iconOrText);\n  } else {\n    ButtonChild = function ButtonChildText() {\n      return <>{iconOrText}</>;\n    };\n  }\n\n  return (\n    <Button\n      className={cx(styles.button, disabled && 'disabled', visible && 'visible', active && 'active')}\n      size=\"md\"\n      variant=\"secondary\"\n      fill=\"text\"\n      icon={buttonIcon}\n      aria-label={ariaLabel}\n      tooltip={tooltip}\n      tooltipPlacement=\"right\"\n      onClick={onClick}\n      disabled={disabled}\n    >\n      {ButtonChild && <ButtonChild />}\n    </Button>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    button: css({\n      margin: 0,\n      color: theme.colors.text.secondary,\n      '&:hover': {\n        color: theme.colors.text.maxContrast,\n        background: 'transparent',\n      },\n      '&.disabled:hover': {\n        color: theme.colors.text.secondary,\n      },\n      '&.visible': {\n        color: theme.colors.text.maxContrast,\n      },\n      '&.active': {\n        color: theme.colors.text.maxContrast,\n      },\n    }),\n  };\n}\n","import React from 'react';\n\nexport function RulesIcon() {\n  return (\n    <svg stroke=\"currentColor\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n      <rect x=\"1.25\" y=\"1.625\" width=\"5.25\" height=\"5.25\" rx=\"1\" strokeWidth=\"1.5\" />\n      <circle cx=\"12.25\" cy=\"4.25\" r=\"2.75\" strokeWidth=\"1.5\" />\n      <circle cx=\"3.75\" cy=\"11.75\" r=\"2.75\" strokeWidth=\"1.5\" />\n      <rect x=\"9.5\" y=\"9.125\" width=\"5.25\" height=\"5.25\" rx=\"1\" strokeWidth=\"1.5\" />\n    </svg>\n  );\n}\n","import { css, cx } from '@emotion/css';\nimport { VariableHide, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  sceneGraph,\n  SceneObjectBase,\n  type AdHocFilterWithLabels,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { IconButton, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { VAR_OTHER_METRIC_FILTERS } from 'shared';\nimport { getTrailFor } from 'utils';\nimport { isAdHocFiltersVariable } from 'utils/utils.variables';\nimport { NULL_GROUP_BY_VALUE } from 'WingmanDataTrail/Labels/LabelsDataSource';\nimport { VAR_WINGMAN_GROUP_BY } from 'WingmanDataTrail/Labels/LabelsVariable';\nimport { computeMetricPrefixGroups } from 'WingmanDataTrail/MetricsVariables/computeMetricPrefixGroups';\nimport { computeMetricSuffixGroups } from 'WingmanDataTrail/MetricsVariables/computeMetricSuffixGroups';\nimport { computeRulesGroups } from 'WingmanDataTrail/MetricsVariables/computeRulesGroups';\n\nimport { reportExploreMetrics } from '../../interactions';\nimport { BookmarksList } from './sections/BookmarksList';\nimport { EventSectionValueChanged } from './sections/EventSectionValueChanged';\nimport { LabelsBrowser } from './sections/LabelsBrowser/LabelsBrowser';\nimport { MetricsFilterSection } from './sections/MetricsFilterSection/MetricsFilterSection';\nimport { Settings } from './sections/Settings';\nimport { SideBarButton } from './SideBarButton';\n\ntype Section = MetricsFilterSection | LabelsBrowser | BookmarksList | Settings;\n\ninterface SideBarState extends SceneObjectState {\n  sections: Section[];\n  visibleSection: Section | null;\n  sectionValues: Map<string, string[]>;\n}\n\nconst metricFiltersVariables = ['filters-rule', 'filters-prefix', 'filters-suffix'] as const;\ntype MetricFiltersVariable = (typeof metricFiltersVariables)[number];\n\nexport class SideBar extends SceneObjectBase<SideBarState> {\n  constructor(state: Partial<SideBarState>) {\n    const sectionValues = SideBar.getSectionValuesFromUrl();\n\n    super({\n      key: 'sidebar',\n      visibleSection: null,\n      sections: [\n        new MetricsFilterSection({\n          key: 'filters-rule',\n          type: 'categories',\n          title: 'Rules filters',\n          description: 'Filter metrics and recording rules',\n          icon: 'rules',\n          computeGroups: computeRulesGroups,\n          showHideEmpty: false,\n          showSearch: false,\n          active: Boolean(sectionValues.get('filters-rule')?.length),\n        }),\n        new MetricsFilterSection({\n          key: 'filters-prefix',\n          type: 'prefixes',\n          title: 'Prefix filters',\n          description: 'Filter metrics based on their name prefix (Prometheus namespace)',\n          icon: 'A_',\n          computeGroups: computeMetricPrefixGroups,\n          active: Boolean(sectionValues.get('filters-prefix')?.length),\n        }),\n        new MetricsFilterSection({\n          key: 'filters-suffix',\n          type: 'suffixes',\n          title: 'Suffix filters',\n          description: 'Filter metrics based on their name suffix',\n          icon: '_Z',\n          computeGroups: computeMetricSuffixGroups,\n          active: Boolean(sectionValues.get('filters-suffix')?.length),\n        }),\n        new LabelsBrowser({\n          key: 'groupby-labels',\n          variableName: VAR_WINGMAN_GROUP_BY,\n          title: 'Group by labels',\n          description: 'Group metrics by their label values',\n          icon: 'groups',\n          active: sectionValues.has('groupby-labels'),\n        }),\n        new BookmarksList({\n          key: 'bookmarks',\n          title: 'Bookmarks',\n          description: 'Access your saved metrics for quick reference',\n          icon: 'star',\n        }),\n        new Settings({\n          key: 'settings',\n          title: 'Settings',\n          description: 'Settings',\n          icon: 'cog',\n          disabled: true,\n        }),\n      ],\n      sectionValues,\n      ...state,\n    });\n\n    // FIXME: rule values are regexes, we do this only to disable adding the values to the button tooltip\n    // we need to provide the corresponding label instead\n    sectionValues.set('filters-rule', []);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const cleanupOtherMetricsVar = this.initOtherMetricsVar();\n\n    this._subs.add(\n      this.subscribeToEvent(EventSectionValueChanged, (event) => {\n        const { key, values } = event.payload;\n        const { sectionValues } = this.state;\n        const newSectionValues = new Map(sectionValues).set(key, values);\n        this.setOtherMetricFilters(newSectionValues);\n        this.setState({ sectionValues: newSectionValues });\n      })\n    );\n\n    return () => {\n      cleanupOtherMetricsVar();\n    };\n  }\n\n  private setOtherMetricFilters(sectionValues: Map<string, string[]>) {\n    const otherMetricFiltersVar = sceneGraph.lookupVariable(VAR_OTHER_METRIC_FILTERS, this);\n    if (!isAdHocFiltersVariable(otherMetricFiltersVar)) {\n      return;\n    }\n\n    const varToTextMap: Record<MetricFiltersVariable, string> = {\n      'filters-rule': 'rule group',\n      'filters-prefix': 'prefix',\n      'filters-suffix': 'suffix',\n    };\n\n    const newFilters = Array.from(sectionValues.entries()).reduce<Array<AdHocFilterWithLabels<{}>>>(\n      (acc, [key, value]) => {\n        if (value.length && metricFiltersVariables.includes(key as MetricFiltersVariable)) {\n          acc.push({\n            key,\n            operator: '=',\n            value: value.join(', '),\n            keyLabel: varToTextMap[key as MetricFiltersVariable],\n          });\n        }\n\n        return acc;\n      },\n      []\n    );\n\n    otherMetricFiltersVar.setState({\n      filters: newFilters,\n      hide: newFilters.length ? VariableHide.hideLabel : VariableHide.hideVariable,\n    });\n  }\n\n  /**\n   * Initialize the other metrics variable and set the filters from the current sidebar selections.\n   * This powers the read-only, \"other metric filters\" UI next to the label filters.\n   * The purpose of this is to provide users with at-a-glance feedback about the current sidebar\n   * selections, without needing to interact with the sidebar.\n   */\n  private initOtherMetricsVar() {\n    const currentVariableSet = getTrailFor(this).state.$variables;\n    if (!currentVariableSet) {\n      return () => {};\n    }\n\n    const otherMetricFiltersVar = new AdHocFiltersVariable({\n      name: VAR_OTHER_METRIC_FILTERS,\n      readOnly: true,\n      skipUrlSync: true,\n      datasource: null,\n      hide: VariableHide.hideVariable,\n      layout: 'combobox',\n      applyMode: 'manual',\n      allowCustomValue: true,\n    });\n\n    currentVariableSet.setState({\n      variables: [...currentVariableSet.state.variables, otherMetricFiltersVar],\n    });\n\n    this.setOtherMetricFilters(this.state.sectionValues);\n\n    return () => {\n      currentVariableSet.setState({\n        variables: [...currentVariableSet.state.variables.filter((v) => v !== otherMetricFiltersVar)],\n      });\n    };\n  }\n\n  private static getSectionValuesFromUrl() {\n    const urlSearchParams = new URLSearchParams(window.location.search);\n    const sectionValues = new Map();\n\n    for (const filterKey of metricFiltersVariables) {\n      const filterValueFromUrl = urlSearchParams.get(filterKey);\n      sectionValues.set(filterKey, filterValueFromUrl ? filterValueFromUrl.split(',').map((v) => v.trim()) : []);\n    }\n\n    const labelValue = urlSearchParams.get(`var-${VAR_WINGMAN_GROUP_BY}`);\n    const isLabelsBrowserActive = Boolean(labelValue && labelValue !== NULL_GROUP_BY_VALUE);\n    if (isLabelsBrowserActive) {\n      sectionValues.set('groupby-labels', [labelValue!]);\n    }\n\n    return sectionValues;\n  }\n\n  private setActiveSection(sectionKey: string) {\n    const { visibleSection, sections } = this.state;\n\n    if (!sectionKey || sectionKey === visibleSection?.state.key) {\n      // Report closing the sidebar\n      reportExploreMetrics('metrics_sidebar_toggled', {\n        action: 'closed',\n        section: visibleSection?.state.key,\n      });\n\n      this.setState({ visibleSection: null });\n      return;\n    }\n\n    // Report opening the sidebar with the selected section\n    reportExploreMetrics('metrics_sidebar_toggled', {\n      action: 'opened',\n      section: sectionKey,\n    });\n\n    if (sectionKey === 'filters-prefix') {\n      reportExploreMetrics('sidebar_prefix_filter_section_clicked', {});\n    } else if (sectionKey === 'filters-suffix') {\n      reportExploreMetrics('sidebar_suffix_filter_section_clicked', {});\n    }\n\n    this.setState({\n      visibleSection: sections.find((section) => section.state.key === sectionKey) ?? null,\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<SideBar>) => {\n    const styles = useStyles2(getStyles);\n    const { sections, visibleSection, sectionValues } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <div className={styles.buttonsBar} data-testid=\"sidebar-buttons\">\n          {sections.map((section) => {\n            const { key, title, icon: iconOrText, disabled, active } = section.state;\n            const visible = visibleSection?.state.key === key;\n            const tooltip = sectionValues.get(key)?.length ? `${title}: ${sectionValues.get(key)?.join(', ')}` : title;\n\n            return (\n              <div\n                key={key}\n                className={cx(styles.buttonContainer, visible && 'visible', active && 'active', disabled && 'disabled')}\n              >\n                <SideBarButton\n                  ariaLabel={title}\n                  disabled={disabled}\n                  visible={visible}\n                  active={active}\n                  tooltip={tooltip}\n                  onClick={() => model.setActiveSection(key)}\n                  iconOrText={iconOrText}\n                />\n              </div>\n            );\n          })}\n        </div>\n        {visibleSection && (\n          <div className={styles.content} data-testid=\"sidebar-content\">\n            <IconButton\n              className={styles.closeButton}\n              name=\"times\"\n              aria-label=\"Close\"\n              tooltip=\"Close\"\n              tooltipPlacement=\"top\"\n              onClick={() => model.setActiveSection('')}\n            />\n            {/* TODO: find a better way */}\n            {visibleSection instanceof MetricsFilterSection && <visibleSection.Component model={visibleSection} />}\n            {visibleSection instanceof LabelsBrowser && <visibleSection.Component model={visibleSection} />}\n            {visibleSection instanceof BookmarksList && <visibleSection.Component model={visibleSection} />}\n            {visibleSection instanceof Settings && <visibleSection.Component model={visibleSection} />}\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      position: 'relative',\n      display: 'flex',\n      flexDirection: 'row',\n      height: '100%',\n      overflow: 'hidden',\n    }),\n    buttonsBar: css({\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center',\n      gap: 0,\n      width: '42px',\n      padding: 0,\n      margin: 0,\n      boxSizing: 'border-box',\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderRadius: theme.shape.radius.default,\n      backgroundColor: theme.colors.background.primary,\n      borderTopLeftRadius: 0,\n      borderBottomLeftRadius: 0,\n      position: 'relative',\n    }),\n    buttonContainer: css({\n      marginTop: theme.spacing(1),\n      '&::before': {\n        transition: '0.5s ease',\n        content: '\"\"',\n        position: 'absolute',\n        left: 0,\n        height: '32px',\n        borderLeft: `2px solid ${theme.colors.action.selectedBorder}`,\n        boxSizing: 'border-box',\n        opacity: 0,\n        visibility: 'hidden',\n      },\n      '&:hover::before': {\n        opacity: 1,\n        visibility: 'visible',\n      },\n      '&.visible::before': {\n        opacity: 1,\n        visibility: 'visible',\n      },\n      '&.disabled::before': {\n        opacity: 0,\n        visibility: 'hidden',\n      },\n      '&.active::after': {\n        content: '\"\"',\n        position: 'absolute',\n        right: 0,\n        width: '8px',\n        height: '8px',\n        backgroundColor: theme.colors.action.selectedBorder,\n        borderRadius: '50%',\n        margin: '2px 4px 0 0',\n      },\n    }),\n    content: css({\n      width: 'calc(300px - 42px)', // we want 300px in total\n      boxSizing: 'border-box',\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderLeft: 'none',\n      borderRadius: theme.shape.radius.default,\n      backgroundColor: theme.colors.background.canvas,\n      padding: theme.spacing(1.5),\n    }),\n    closeButton: css({\n      position: 'absolute',\n      top: theme.spacing(1.5),\n      right: theme.spacing(1),\n      margin: 0,\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { useChromeHeaderHeight } from '@grafana/runtime';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n  VariableDependencyConfig,\n  type CustomVariable,\n  type QueryVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from 'interactions';\n\nimport { MetricSelectedEvent } from '../shared';\nimport { MetricsGroupByList } from './GroupBy/MetricsGroupByList';\nimport { MetricsWithLabelValueDataSource } from './GroupBy/MetricsWithLabelValue/MetricsWithLabelValueDataSource';\nimport { registerRuntimeDataSources } from './helpers/registerRuntimeDataSources';\nimport { LabelsDataSource, NULL_GROUP_BY_VALUE } from './Labels/LabelsDataSource';\nimport { LabelsVariable, VAR_WINGMAN_GROUP_BY } from './Labels/LabelsVariable';\nimport { ListControls } from './ListControls/ListControls';\nimport { EventSortByChanged } from './ListControls/MetricsSorter/events/EventSortByChanged';\nimport {\n  addRecentMetric,\n  MetricsSorter,\n  VAR_WINGMAN_SORT_BY,\n  type SortingOption,\n} from './ListControls/MetricsSorter/MetricsSorter';\nimport { EventQuickSearchChanged } from './ListControls/QuickSearch/EventQuickSearchChanged';\nimport { QuickSearch } from './ListControls/QuickSearch/QuickSearch';\nimport { MetricsList } from './MetricsList/MetricsList';\nimport { EventMetricsVariableActivated } from './MetricsVariables/EventMetricsVariableActivated';\nimport { EventMetricsVariableDeactivated } from './MetricsVariables/EventMetricsVariableDeactivated';\nimport { EventMetricsVariableLoaded } from './MetricsVariables/EventMetricsVariableLoaded';\nimport { FilteredMetricsVariable, VAR_FILTERED_METRICS_VARIABLE } from './MetricsVariables/FilteredMetricsVariable';\nimport { MetricsVariableFilterEngine, type MetricFilters } from './MetricsVariables/MetricsVariableFilterEngine';\nimport { MetricsVariableSortEngine } from './MetricsVariables/MetricsVariableSortEngine';\nimport { EventFiltersChanged } from './SideBar/sections/MetricsFilterSection/EventFiltersChanged';\nimport { MetricsFilterSection } from './SideBar/sections/MetricsFilterSection/MetricsFilterSection';\nimport { SideBar } from './SideBar/SideBar';\n\ninterface MetricsReducerState extends SceneObjectState {\n  listControls: ListControls;\n  sidebar: SideBar;\n  body: SceneObjectBase;\n  enginesMap: Map<string, { filterEngine: MetricsVariableFilterEngine; sortEngine: MetricsVariableSortEngine }>;\n}\n\nexport class MetricsReducer extends SceneObjectBase<MetricsReducerState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_WINGMAN_GROUP_BY],\n    onReferencedVariableValueChanged: (variable) => {\n      this.updateBasedOnGroupBy((variable as LabelsVariable).state.value as string);\n    },\n  });\n\n  public constructor() {\n    super({\n      $variables: new SceneVariableSet({\n        variables: [new FilteredMetricsVariable(), new LabelsVariable()],\n      }),\n      listControls: new ListControls({}),\n      sidebar: new SideBar({}),\n      body: new MetricsList({ variableName: VAR_FILTERED_METRICS_VARIABLE }) as unknown as SceneObjectBase,\n      enginesMap: new Map(),\n    });\n\n    registerRuntimeDataSources([new LabelsDataSource(), new MetricsWithLabelValueDataSource()]);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const groupByValue = (sceneGraph.lookupVariable(VAR_WINGMAN_GROUP_BY, this) as LabelsVariable).state\n      .value as string;\n\n    this.updateBasedOnGroupBy(groupByValue);\n\n    this.subscribeToEvents();\n  }\n\n  private updateBasedOnGroupBy(groupByValue: string) {\n    const hasGroupByValue = Boolean(groupByValue && groupByValue !== NULL_GROUP_BY_VALUE);\n\n    sceneGraph.findByKeyAndType(this, 'quick-search', QuickSearch).toggleCountsDisplay(!hasGroupByValue);\n\n    this.setState({\n      body: hasGroupByValue\n        ? (new MetricsGroupByList({ labelName: groupByValue }) as unknown as SceneObjectBase)\n        : (new MetricsList({ variableName: VAR_FILTERED_METRICS_VARIABLE }) as unknown as SceneObjectBase),\n    });\n  }\n\n  private subscribeToEvents() {\n    this.initVariablesFilteringAndSorting();\n\n    this._subs.add(\n      this.subscribeToEvent(MetricSelectedEvent, (event) => {\n        if (event.payload !== undefined) {\n          addRecentMetric(event.payload);\n        }\n      })\n    );\n  }\n\n  /**\n   * The centralized filtering and sorting mechanism implemented here is decoupled via the usage of events.\n   * In order to work, the variables to be filtered/sorted must emit lifecycle events.\n   * This is done via the `withLifecycleEvents` decorator function.\n   *\n   * For example, check the `FilteredMetricsVariable` class.\n   */\n  private initVariablesFilteringAndSorting() {\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableActivated, (event) => {\n        // register engines\n        const { key } = event.payload;\n        const filteredMetricsVariable = sceneGraph.findByKey(this, key) as QueryVariable;\n\n        this.state.enginesMap.set(key, {\n          filterEngine: new MetricsVariableFilterEngine(filteredMetricsVariable),\n          sortEngine: new MetricsVariableSortEngine(filteredMetricsVariable),\n        });\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableDeactivated, (event) => {\n        // unregister engines\n        this.state.enginesMap.delete(event.payload.key);\n      })\n    );\n\n    const quickSearch = sceneGraph.findByKeyAndType(this, 'quick-search', QuickSearch);\n    const filterSections = sceneGraph.findAllObjects(\n      this,\n      (o) => o instanceof MetricsFilterSection\n    ) as MetricsFilterSection[];\n    const metricsSorter = sceneGraph.findByKeyAndType(this, 'metrics-sorter', MetricsSorter);\n    const sortByVariable = metricsSorter.state.$variables.getByName(VAR_WINGMAN_SORT_BY) as CustomVariable;\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableLoaded, (event) => {\n        // filter and sort on initial load\n        const { key, options } = event.payload;\n        const { filterEngine, sortEngine } = this.state.enginesMap.get(key)!;\n\n        filterEngine.setInitOptions(options);\n\n        const filters: Partial<MetricFilters> = {\n          names: quickSearch.state.value ? [quickSearch.state.value] : [],\n        };\n\n        for (const filterSection of filterSections) {\n          filters[filterSection.state.type] = filterSection.state.selectedGroups.map((g) => g.value);\n        }\n\n        filterEngine.applyFilters(filters, { forceUpdate: true, notify: false });\n        sortEngine.sort(sortByVariable.state.value as SortingOption);\n      })\n    );\n\n    /* Filters */\n\n    this._subs.add(\n      this.subscribeToEvent(EventQuickSearchChanged, (event) => {\n        const { searchText } = event.payload;\n\n        for (const [, { filterEngine, sortEngine }] of this.state.enginesMap) {\n          filterEngine.applyFilters({ names: searchText ? [searchText] : [] });\n          sortEngine.sort(sortByVariable.state.value as SortingOption);\n        }\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventFiltersChanged, (event) => {\n        const { type, filters } = event.payload;\n\n        for (const [, { filterEngine, sortEngine }] of this.state.enginesMap) {\n          filterEngine.applyFilters({ [type]: filters });\n          sortEngine.sort(sortByVariable.state.value as SortingOption);\n        }\n      })\n    );\n\n    /* Sorting */\n\n    this._subs.add(\n      this.subscribeToEvent(EventSortByChanged, (event) => {\n        const { sortBy } = event.payload;\n        reportExploreMetrics('sorting_changed', { from: 'metrics-reducer', sortBy });\n\n        for (const [, { sortEngine }] of this.state.enginesMap) {\n          sortEngine.sort(sortBy);\n        }\n      })\n    );\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsReducer>) => {\n    const chromeHeaderHeight = useChromeHeaderHeight() ?? 0;\n    const styles = useStyles2(getStyles, chromeHeaderHeight);\n\n    const { $variables, body, listControls, sidebar } = model.useState();\n\n    return (\n      <>\n        <div className={styles.listControls} data-testid=\"list-controls\">\n          <listControls.Component model={listControls} />\n        </div>\n        <div className={styles.body}>\n          <div className={styles.sidebar} data-testid=\"sidebar\">\n            <sidebar.Component model={sidebar} />\n          </div>\n          <div className={styles.list}>\n            <body.Component model={body} />\n          </div>\n        </div>\n        <div className={styles.variables}>\n          {$variables?.state.variables.map((variable) => (\n            <variable.Component key={variable.state.name} model={variable} />\n          ))}\n        </div>\n      </>\n    );\n  };\n}\n\n// the height of header between Grafana's chrome header and the metrics list container.\nconst APP_HEADER_HEIGHT = 144;\n\nfunction getStyles(theme: GrafanaTheme2, chromeHeaderHeight: number) {\n  return {\n    listControls: css({\n      marginBottom: theme.spacing(1.5),\n    }),\n    body: css({\n      display: 'flex',\n      flexDirection: 'row',\n      gap: theme.spacing(1),\n      height: `calc(100vh - ${chromeHeaderHeight + APP_HEADER_HEIGHT}px)`,\n    }),\n    list: css({\n      width: '100%',\n      overflowY: 'auto',\n    }),\n    sidebar: css({\n      flex: '0 0 auto',\n      overflowY: 'auto',\n    }),\n    variables: css({\n      display: 'none',\n    }),\n  };\n}\n","import { registerRuntimeDataSource, type RuntimeDataSource } from '@grafana/scenes';\n\nimport { displayError } from './displayStatus';\n\nexport function registerRuntimeDataSources(dataSources: RuntimeDataSource[]) {\n  try {\n    for (const dataSource of dataSources) {\n      registerRuntimeDataSource({ dataSource });\n    }\n  } catch (error) {\n    const { message } = error as Error;\n\n    if (!/A runtime data source with uid (.+) has already been registered/.test(message)) {\n      displayError(error as Error, [\n        'Fail to register all the runtime data sources!',\n        'The application cannot work as expected, please try reloading the page or if the problem persists, contact your organization admin.',\n      ]);\n    }\n  }\n}\n","import { css, cx } from '@emotion/css';\nimport { type GrafanaTheme2, type IconName } from '@grafana/data';\nimport { Button, Dropdown, Icon, Menu, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { type MetricUsageType } from 'WingmanDataTrail/ListControls/MetricsSorter/MetricUsageFetcher';\n\nimport { type WithUsageDataPreviewPanelState } from './WithUsageDataPreviewPanel';\n\ninterface UsageSectionProps {\n  usageType: MetricUsageType;\n  usageCount: number;\n  singularUsageType: string;\n  pluralUsageType: string;\n  icon: IconName;\n  dashboardItems: WithUsageDataPreviewPanelState['dashboardItems'];\n}\n\nexport function UsageData({\n  usageType,\n  usageCount,\n  singularUsageType,\n  pluralUsageType,\n  icon,\n  dashboardItems,\n}: Readonly<UsageSectionProps>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.usageContainer} data-testid=\"usage-data-panel\">\n      {usageType === 'dashboard-usage' ? (\n        <>\n          <Dropdown\n            placement=\"right-start\"\n            overlay={\n              <Menu style={{ maxWidth: '240px', maxHeight: '245px', overflowY: 'auto' }}>\n                {dashboardItems.map((item) => (\n                  <Menu.Item\n                    key={item.id}\n                    label=\"\"\n                    url={item.url}\n                    target=\"_blank\"\n                    className={styles.menuItem}\n                    component={() => (\n                      <Tooltip\n                        content={`Used ${item.count} ${item.count === 1 ? 'time' : 'times'} in ${item.label}`}\n                        placement=\"right\"\n                      >\n                        <div className={styles.menuItemContent}>\n                          <Icon name=\"external-link-alt\" /> {item.label} ({item.count})\n                        </div>\n                      </Tooltip>\n                    )}\n                  />\n                ))}\n              </Menu>\n            }\n          >\n            <Button\n              variant=\"secondary\"\n              size=\"sm\"\n              tooltip={`Metric used ${usageCount} ${\n                usageCount === 1 ? 'time' : 'times'\n              } in dashboard queries. Click to view the dashboards.`}\n              className={cx(styles.usageItem, styles.clickableUsageItem)}\n            >\n              <span data-testid={usageType}>\n                <Icon name={icon} style={{ marginRight: '4px' }} /> {usageCount}\n              </span>\n            </Button>\n          </Dropdown>\n        </>\n      ) : (\n        <Tooltip\n          content={`Metric is used in ${usageCount} ${usageCount === 1 ? singularUsageType : pluralUsageType}`}\n          placement=\"top\"\n        >\n          <span className={styles.usageItem} data-testid={usageType}>\n            <Icon name={icon} /> {usageCount}\n          </span>\n        </Tooltip>\n      )}\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    usageContainer: css({\n      display: 'flex',\n      flexDirection: 'row',\n      justifyContent: 'flex-start',\n      gap: '17px',\n      padding: '8px 12px',\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderTopWidth: 0,\n      backgroundColor: theme.colors.background.primary,\n      alignItems: 'center',\n    }),\n    usageItem: css({\n      display: 'flex',\n      alignItems: 'center',\n      gap: '4px',\n      color: theme.colors.text.secondary,\n      opacity: '65%',\n    }),\n    clickableUsageItem: css({\n      backgroundColor: 'transparent',\n      border: 'none',\n    }),\n    menuItem: css({\n      color: theme.colors.text.primary,\n      textDecoration: 'none',\n      '&:hover': {\n        color: theme.colors.text.link,\n      },\n    }),\n    menuItemContent: css({\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      whiteSpace: 'nowrap',\n      color: theme.colors.text.primary,\n      '&:hover': {\n        color: theme.colors.text.link,\n      },\n    }),\n  };\n}\n","import {\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { type IconName } from '@grafana/ui';\nimport React from 'react';\n\nimport { type GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { logger } from 'tracking/logger/logger';\nimport { isCustomVariable } from 'utils/utils.variables';\nimport {\n  MetricsSorter,\n  VAR_WINGMAN_SORT_BY,\n  type SortingOption,\n} from 'WingmanDataTrail/ListControls/MetricsSorter/MetricsSorter';\nimport { MetricsReducer } from 'WingmanDataTrail/MetricsReducer';\nimport { VAR_FILTERED_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\n\nimport { UsageData } from './UsageData';\n\nexport const VIZ_PANEL_HEIGHT = '220px';\nexport const VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW = '260px';\n\ntype SortBy = Exclude<SortingOption, 'related'>;\n\nexport type WithUsageDataPreviewPanelState = SceneObjectState & {\n  vizPanelInGridItem: GmdVizPanel;\n  metric: string;\n  sortBy: SortBy;\n  usageCount: number;\n  singularUsageType: string;\n  pluralUsageType: string;\n  icon: IconName;\n  dashboardItems: Array<{ id: string; label: string; count: number; url: string }>;\n};\n\nexport class WithUsageDataPreviewPanel extends SceneObjectBase<WithUsageDataPreviewPanelState> {\n  constructor(state: Pick<WithUsageDataPreviewPanelState, 'vizPanelInGridItem' | 'metric'>) {\n    super({\n      ...state,\n      sortBy: 'default',\n      usageCount: 0,\n      singularUsageType: '',\n      pluralUsageType: '',\n      icon: '' as IconName,\n      dashboardItems: [],\n    });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  private _onActivate() {\n    let metricsReducer;\n\n    try {\n      metricsReducer = sceneGraph.getAncestor(this, MetricsReducer);\n    } catch {\n      return;\n    }\n\n    const filteredMetricsEngine = metricsReducer.state.enginesMap.get(VAR_FILTERED_METRICS_VARIABLE);\n    if (!filteredMetricsEngine) {\n      return;\n    }\n\n    const metricsSorter = sceneGraph.findByKeyAndType(this, 'metrics-sorter', MetricsSorter);\n    const sortByVar = sceneGraph.getVariables(metricsSorter).getByName(VAR_WINGMAN_SORT_BY);\n\n    if (isCustomVariable(sortByVar)) {\n      this.updateSortBy(metricsSorter, sortByVar.getValue() as SortBy);\n\n      this._subs.add(\n        sortByVar.subscribeToState(({ value }) => {\n          this.updateSortBy(metricsSorter, value as SortBy);\n        })\n      );\n    }\n  }\n\n  private async updateSortBy(metricsSorter: MetricsSorter, sortBy: SortBy) {\n    this.setState({ sortBy });\n    this.updateLayout(sortBy);\n\n    if (sortBy === 'default') {\n      return;\n    }\n\n    const usage = await metricsSorter.getUsageDetailsForMetric(this.state.metric, sortBy);\n\n    switch (sortBy) {\n      case 'dashboard-usage':\n        // FIXME: we do this only to satisfy TS Lord\n        if (usage.usageType !== 'dashboard-usage') {\n          return;\n        }\n\n        const { dashboards } = usage;\n\n        this.setState({\n          usageCount: usage.count,\n          singularUsageType: 'dashboard panel query',\n          pluralUsageType: 'dashboard panel queries',\n          icon: 'apps',\n          dashboardItems: Object.entries(dashboards)\n            .map(([label, dashboardInfo]) => ({\n              id: dashboardInfo.uid,\n              label,\n              count: dashboardInfo.count,\n              url: dashboardInfo.url,\n            }))\n            .sort((a, b) => b.count - a.count),\n        });\n        break;\n\n      case 'alerting-usage':\n        this.setState({\n          usageCount: usage.count,\n          singularUsageType: 'alert rule',\n          pluralUsageType: 'alert rules',\n          icon: 'bell',\n        });\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  private updateLayout(sortBy: WithUsageDataPreviewPanelState['sortBy']) {\n    const gridLayout = sceneGraph.getAncestor(this, SceneCSSGridLayout);\n    const currentGridLayoutHeight = gridLayout?.state.autoRows;\n\n    const expectedPanelHeight = sortBy === 'default' ? VIZ_PANEL_HEIGHT : VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW;\n\n    if (currentGridLayoutHeight !== expectedPanelHeight) {\n      gridLayout.setState({ autoRows: expectedPanelHeight });\n    }\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<WithUsageDataPreviewPanel>) => {\n    const { vizPanelInGridItem, sortBy, usageCount, singularUsageType, pluralUsageType, icon, dashboardItems } =\n      model.useState();\n\n    if (!vizPanelInGridItem) {\n      logger.log('no viz panel');\n      return;\n    }\n\n    return (\n      <div data-testid=\"with-usage-data-preview-panel\">\n        <vizPanelInGridItem.Component model={vizPanelInGridItem} />\n        {sortBy !== 'default' && (\n          <UsageData\n            usageType={sortBy}\n            usageCount={usageCount}\n            singularUsageType={singularUsageType}\n            pluralUsageType={pluralUsageType}\n            icon={icon}\n            dashboardItems={dashboardItems}\n          />\n        )}\n      </div>\n    );\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneReactObject,\n  type MultiValueVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { DashboardCursorSync } from '@grafana/schema';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { ConfigurePanelAction } from 'GmdVizPanel/components/ConfigurePanelAction';\nimport { SelectAction } from 'GmdVizPanel/components/SelectAction';\nimport { GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { LayoutSwitcher, LayoutType, type LayoutSwitcherState } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { SceneByVariableRepeater } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\n\nimport { VIZ_PANEL_HEIGHT, WithUsageDataPreviewPanel } from './WithUsageDataPreviewPanel';\n\nexport const GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(400px, 1fr))';\nexport const GRID_TEMPLATE_ROWS = '1fr';\n\ninterface MetricsListState extends SceneObjectState {\n  variableName: string;\n  body: SceneByVariableRepeater;\n}\n\nexport class MetricsList extends SceneObjectBase<MetricsListState> {\n  constructor({ variableName }: { variableName: MetricsListState['variableName'] }) {\n    super({\n      key: 'metrics-list',\n      variableName,\n      body: new SceneByVariableRepeater({\n        variableName,\n        initialPageSize: 120,\n        pageSizeIncrement: 9,\n        body: new SceneCSSGridLayout({\n          children: [],\n          isLazy: true,\n          templateColumns: GRID_TEMPLATE_COLUMNS,\n          autoRows: VIZ_PANEL_HEIGHT,\n          $behaviors: [\n            new behaviors.CursorSync({\n              key: 'metricCrosshairSync',\n              sync: DashboardCursorSync.Crosshair,\n            }),\n          ],\n        }),\n        getLayoutLoading: () =>\n          new SceneReactObject({\n            reactNode: <Spinner inline />,\n          }),\n        getLayoutEmpty: () =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner title=\"\" severity=\"info\">\n                No metrics found for the current filters and time range.\n              </InlineBanner>\n            ),\n          }),\n        getLayoutError: (error: Error) =>\n          new SceneReactObject({\n            reactNode: <InlineBanner severity=\"error\" title=\"Error while loading metrics!\" error={error} />,\n          }),\n        getLayoutChild: (option, colorIndex) => {\n          const metric = option.value as string;\n\n          return new SceneCSSGridItem({\n            body: new WithUsageDataPreviewPanel({\n              metric: option.value as string,\n              vizPanelInGridItem: new GmdVizPanel({\n                metric,\n                panelOptions: {\n                  fixedColorIndex: colorIndex,\n                  headerActions: () => [new SelectAction({ metric }), new ConfigurePanelAction({ metric })],\n                },\n              }),\n            }),\n          });\n        },\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToLayoutChange();\n  }\n\n  private subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', LayoutSwitcher);\n    const body = this.state.body.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: LayoutSwitcherState, prevState?: LayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: newState.layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n        });\n      }\n    };\n\n    onChangeState(layoutSwitcher.state); // ensure layout when landing on the page\n\n    this._subs.add(layoutSwitcher.subscribeToState(onChangeState));\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsList>) => {\n    const { variableName, body } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const variable = sceneGraph.lookupVariable(variableName, model) as MultiValueVariable;\n    const { loading, error } = variable.useState();\n\n    const batchSizes = body.useSizes();\n    const shouldDisplayShowMoreButton =\n      !loading && !error && batchSizes.total > 0 && batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      body.increaseBatchSize();\n    };\n\n    return (\n      <div data-testid=\"metrics-list\">\n        <div className={styles.container}>\n          <body.Component model={body} />\n        </div>\n        {shouldDisplayShowMoreButton && (\n          <div className={styles.footer}>\n            <ShowMoreButton label=\"metric\" batchSizes={batchSizes} onClick={onClickShowMore} />\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({}),\n    footer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      marginTop: theme.spacing(4),\n\n      '& button': {\n        height: '40px',\n        borderRadius: '8px',\n      },\n    }),\n  };\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { type PanelConfigPreset } from 'GmdVizPanel/config/presets/types';\n\ninterface EventApplyPanelConfigPayload {\n  metric: string;\n  config: PanelConfigPreset;\n  restoreDefault?: boolean;\n}\n\nexport class EventApplyPanelConfig extends BusEventWithPayload<EventApplyPanelConfigPayload> {\n  public static readonly type = 'apply-panel-config';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\ninterface EventCancelConfigurePanelPayload {\n  metric: string;\n}\n\nexport class EventCancelConfigurePanel extends BusEventWithPayload<EventCancelConfigurePanelPayload> {\n  public static readonly type = 'cancel-configure-panel';\n}\n","export const AVAILABLE_PERCENTILES_OPTIONS = [\n  { value: 99, label: 'P99' },\n  { value: 95, label: 'P95' },\n  { value: 90, label: 'P90' },\n  { value: 75, label: 'P75' },\n  { value: 50, label: 'P50' },\n] as const;\n","import { css, cx } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Tooltip, useStyles2 } from '@grafana/ui';\nimport { cloneDeep } from 'lodash';\nimport React from 'react';\n\nimport { AVAILABLE_PERCENTILES_OPTIONS } from 'GmdVizPanel/config/percentiles-options';\nimport { type ConfigPresetId } from 'GmdVizPanel/config/presets/types';\nimport { type GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\n\ninterface WithConfigPanelOptionsState extends SceneObjectState {\n  presetId: ConfigPresetId;\n  body: GmdVizPanel;\n  isSelected: boolean;\n  onSelect: (presetId: ConfigPresetId) => void;\n  // currently, only percentiles are handheld by the app\n  // in the future, if we add more parameters, this code will have to be more generic\n  queryParams: {\n    show: boolean;\n    options: Array<{ value: any; label: string; checked: boolean }>;\n    type?: 'percentiles';\n  };\n}\n\nexport class WithConfigPanelOptions extends SceneObjectBase<WithConfigPanelOptionsState> {\n  constructor({\n    body,\n    presetId,\n    isSelected,\n    onSelect,\n  }: {\n    body: WithConfigPanelOptionsState['body'];\n    presetId: WithConfigPanelOptionsState['presetId'];\n    isSelected: WithConfigPanelOptionsState['isSelected'];\n    onSelect: WithConfigPanelOptionsState['onSelect'];\n  }) {\n    super({\n      presetId,\n      body,\n      isSelected,\n      onSelect,\n      queryParams: {\n        show: false,\n        options: [],\n      },\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.initPercentilesParams();\n  }\n\n  private initPercentilesParams() {\n    const queryConfig = this.state.body.state.queryConfig;\n\n    const percentiles = new Set(queryConfig.queries?.find((q) => q.params?.percentiles)?.params?.percentiles || []);\n\n    const options =\n      percentiles.size > 0\n        ? AVAILABLE_PERCENTILES_OPTIONS.map((o) => ({ ...o, checked: percentiles.has(o.value) }))\n        : [];\n\n    this.setState({\n      queryParams: {\n        show: options.length > 0,\n        options,\n      },\n    });\n  }\n\n  private onTogglePercentile = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const { queryParams, body } = this.state;\n    const value = Number(event.target.value);\n\n    const option = queryParams.options.find((o) => o.value === value);\n    if (!option) {\n      return;\n    }\n\n    // update in situ, for simplicity (so we don't have to clone queryParams)\n    option.checked = !option.checked;\n\n    const checkedOptions = queryParams.options.filter((o) => o.checked);\n    if (!checkedOptions.length) {\n      return; // prevent invalid config\n    }\n\n    // we have to clone queryConfig so that the body state update below triggers\n    // a re-render of the panel (see GmdVizPanel.subscribeToEvents())\n    const newQueryConfig = cloneDeep(body.state.queryConfig);\n\n    newQueryConfig.queries?.some((q) => {\n      if (q.params?.percentiles) {\n        q.params.percentiles = checkedOptions.map((o) => o.value);\n        return true;\n      }\n      return false;\n    });\n\n    body.update({}, newQueryConfig);\n\n    this.setState({ queryParams });\n  };\n\n  private onClickPreset = () => {\n    this.state.onSelect(this.state.presetId);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<WithConfigPanelOptions>) => {\n    const styles = useStyles2(getStyles);\n    const { body, isSelected, queryParams } = model.useState();\n\n    return (\n      <div\n        className={cx(styles.container, isSelected && styles.selected)}\n        onClick={!isSelected ? model.onClickPreset : undefined}\n      >\n        <div className={cx(styles.bodyAndParams)}>\n          <body.Component model={body} />\n\n          {queryParams.show && (\n            <div className={styles.paramsContainer}>\n              {queryParams.options.map((o) => (\n                <label key={o.value} className={cx('param', styles.param)} htmlFor={`checkbox-${o.value}`}>\n                  <input\n                    id={`checkbox-${o.value}`}\n                    type=\"checkbox\"\n                    value={o.value}\n                    checked={o.checked}\n                    onChange={model.onTogglePercentile}\n                  />\n                  <span>{o.label}</span>\n                </label>\n              ))}\n            </div>\n          )}\n        </div>\n        <div className={styles.radioContainer}>\n          <Tooltip\n            content={!isSelected ? 'Click to select this configuration' : 'Current configuration'}\n            placement=\"top\"\n          >\n            <input type=\"radio\" name=\"select-config\" checked={isSelected} />\n          </Tooltip>\n        </div>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css`\n      display: flex;\n      flex-direction: column;\n      gap: ${theme.spacing(1)};\n      padding: ${theme.spacing(1, 1, 1.25, 1)};\n      border: 1px solid transparent;\n      transition: all 0.2s ease-in-out;\n\n      &:hover {\n        border: 1px solid ${theme.colors.border.weak};\n        border-color: ${theme.colors.primary.border};\n      }\n      &:focus {\n        border: 1px solid ${theme.colors.border.weak};\n        outline: 1px solid ${theme.colors.primary.main};\n        outline-offset: 1px;\n      }\n    `,\n    selected: css`\n      cursor: default;\n      border: 1px solid ${theme.colors.border.weak};\n      border-color: ${theme.colors.primary.border};\n    `,\n    bodyAndParams: css`\n      display: flex;\n      flex-direction: row;\n      gap: ${theme.spacing(1.25)};\n      width: 100%;\n    `,\n    paramsContainer: css`\n      margin-top: ${theme.spacing(1)};\n    `,\n    param: css`\n      display: flex;\n      align-items: center;\n      gap: ${theme.spacing(0.5)};\n      margin-bottom: ${theme.spacing(0.5)};\n      font-size: 12px;\n      cursor: pointer;\n\n      & [type='checkbox'] {\n        cursor: pointer;\n      }\n    `,\n    radioContainer: css`\n      display: flex;\n      align-items: center;\n      justify-content: center;\n\n      & [type='radio'] {\n        cursor: pointer;\n      }\n    `,\n  };\n}\n","import { css } from '@emotion/css';\nimport { DashboardCursorSync, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneRefreshPicker,\n  SceneTimePicker,\n  SceneTimeRange,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Button, ConfirmModal, useStyles2 } from '@grafana/ui';\nimport { cloneDeep, omit } from 'lodash';\nimport React from 'react';\n\nimport { DataTrail } from 'DataTrail';\nimport { getPreferredConfigForMetric } from 'GmdVizPanel/config/getPreferredConfigForMetric';\nimport { PANEL_HEIGHT } from 'GmdVizPanel/config/panel-heights';\nimport { getConfigPresetsForMetric } from 'GmdVizPanel/config/presets/getConfigPresetsForMetric';\nimport { type PanelConfigPreset } from 'GmdVizPanel/config/presets/types';\nimport { GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { PREF_KEYS } from 'UserPreferences/pref-keys';\nimport { userStorage } from 'UserPreferences/userStorage';\nimport { getTrailFor } from 'utils';\nimport { displayError } from 'WingmanDataTrail/helpers/displayStatus';\nimport { GRID_TEMPLATE_COLUMNS } from 'WingmanDataTrail/MetricsList/MetricsList';\n\nimport { EventApplyPanelConfig } from './EventApplyPanelConfig';\nimport { EventCancelConfigurePanel } from './EventCancelConfigurePanel';\nimport { WithConfigPanelOptions } from './WithConfigPanelOptions';\n\ninterface ConfigurePanelFormState extends SceneObjectState {\n  metric: string;\n  $timeRange: SceneTimeRange;\n  controls: SceneObject[];\n  isConfirmModalOpen: boolean;\n  presets: PanelConfigPreset[];\n  selectedPresetId?: string;\n  body?: SceneCSSGridLayout;\n}\n\nexport class ConfigurePanelForm extends SceneObjectBase<ConfigurePanelFormState> {\n  constructor({ metric }: { metric: ConfigurePanelFormState['metric'] }) {\n    super({\n      metric,\n      $timeRange: new SceneTimeRange({}),\n      controls: [new SceneTimePicker({}), new SceneRefreshPicker({})],\n      isConfirmModalOpen: false,\n      presets: [],\n      selectedPresetId: undefined,\n      body: undefined,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.syncTimeRange();\n    this.buildBody();\n    this.subscribeToEvents();\n  }\n\n  private syncTimeRange() {\n    const metricScene = sceneGraph.getAncestor(this, DataTrail);\n    const { from, to, timeZone, value } = sceneGraph.getTimeRange(metricScene).state;\n    sceneGraph.getTimeRange(this).setState({ from, to, timeZone, value });\n  }\n\n  private async buildBody() {\n    const { metric } = this.state;\n    const prefConfig = getPreferredConfigForMetric(metric);\n    const isNativeHistogram = await getTrailFor(this).isNativeHistogram(metric);\n    const presets = getConfigPresetsForMetric(metric, isNativeHistogram);\n\n    // if not found in the user preferences, we use the first preset\n    // it always works because the presets are organized to always have the default one as the first element (see GmdVizPanel/config/presets)\n    const selectedPresetId = (prefConfig || presets[0]).id;\n\n    const body = new SceneCSSGridLayout({\n      templateColumns: GRID_TEMPLATE_COLUMNS,\n      autoRows: PANEL_HEIGHT.M + 46, // see css in WithConfigPanelOptions\n      isLazy: true,\n      $behaviors: [\n        new behaviors.CursorSync({\n          key: 'metricCrosshairSync',\n          sync: DashboardCursorSync.Crosshair,\n        }),\n      ],\n      children: presets.map((option, colorIndex) => {\n        return new SceneCSSGridItem({\n          body: new WithConfigPanelOptions({\n            presetId: option.id,\n            isSelected: selectedPresetId === option.id,\n            onSelect: (presetId) => this.onSelectPreset(presetId),\n            body: new GmdVizPanel({\n              key: `panel-${option.id}`,\n              // we make sure that, if the user has previously configured some query parameters (like percentiles),\n              // they are applied here\n              discardUserPrefs: option.id !== prefConfig?.id,\n              metric,\n              panelOptions: {\n                ...option.panelOptions,\n                title: option.name,\n                fixedColorIndex: colorIndex,\n                headerActions: () => [],\n              },\n              queryOptions: option.queryOptions,\n            }),\n          }),\n        });\n      }),\n    });\n\n    this.setState({ presets, selectedPresetId, body });\n  }\n\n  private onSelectPreset = (presetId: string) => {\n    for (const panel of sceneGraph.findDescendents(this, WithConfigPanelOptions)) {\n      panel.setState({ isSelected: panel.state.presetId === presetId });\n    }\n\n    this.setState({ selectedPresetId: presetId });\n  };\n\n  private subscribeToEvents() {\n    const { metric } = this.state;\n\n    this._subs.add(\n      this.subscribeToEvent(EventApplyPanelConfig, (event) => {\n        const { config, restoreDefault } = event.payload;\n        const userPrefs = userStorage.getItem(PREF_KEYS.METRIC_PREFS) || {};\n        const userPrefForMetric = userPrefs[metric];\n\n        if (restoreDefault && userPrefForMetric) {\n          delete userPrefs[metric].config;\n        } else {\n          userPrefs[metric] = { ...userPrefForMetric, config };\n        }\n\n        userStorage.setItem(PREF_KEYS.METRIC_PREFS, userPrefs);\n      })\n    );\n  }\n\n  private onClickRestoreDefault = () => {\n    this.setState({ isConfirmModalOpen: true });\n  };\n\n  private onClickConfirmRestoreDefault = () => {\n    const { metric, presets } = this.state;\n    const [defaultPreset] = presets;\n\n    if (!defaultPreset) {\n      displayError(new Error(`No default config found for metric ${metric}!`), [\n        'Cannot restore default configuration.',\n      ]);\n      return;\n    }\n\n    this.publishEvent(\n      new EventApplyPanelConfig({\n        metric,\n        config: ConfigurePanelForm.getPanelConfigFromPreset(defaultPreset),\n        restoreDefault: true,\n      }),\n      true\n    );\n\n    this.closeConfirmModal();\n  };\n\n  private closeConfirmModal = () => {\n    this.setState({ isConfirmModalOpen: false });\n  };\n\n  private onClickCancel = () => {\n    this.publishEvent(new EventCancelConfigurePanel({ metric: this.state.metric }), true);\n  };\n\n  private onClickApplyConfig = () => {\n    const { metric, presets, selectedPresetId } = this.state;\n\n    const presetPanel = sceneGraph.findByKeyAndType(this, `panel-${selectedPresetId}`, GmdVizPanel);\n    if (!presetPanel) {\n      throw new Error(`Panel not found for preset id=\"${selectedPresetId}\"!`);\n    }\n\n    const preset = presets.find((preset) => preset.id === selectedPresetId);\n    if (!preset) {\n      throw new Error(`Preset with id=\"${selectedPresetId}\" not found!`);\n    }\n\n    // we clone the preset to update its queries property to\n    // ensure that some customized parameters (like percentiles) are properly applied\n    const presetWithQueryParams: PanelConfigPreset = cloneDeep(preset);\n    presetWithQueryParams.queryOptions.queries = presetPanel.state.queryConfig.queries;\n\n    this.publishEvent(\n      new EventApplyPanelConfig({\n        metric,\n        config: ConfigurePanelForm.getPanelConfigFromPreset(presetWithQueryParams),\n      }),\n      true\n    );\n  };\n\n  private static getPanelConfigFromPreset(preset: PanelConfigPreset) {\n    return omit(preset, ['name', 'panelOptions.description']) as PanelConfigPreset;\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<ConfigurePanelForm>) => {\n    const styles = useStyles2(getStyles);\n    const { metric, body, controls, isConfirmModalOpen } = model.useState();\n\n    return (\n      <div>\n        <div className={styles.controlsContainer}>\n          <Button variant=\"secondary\" size=\"md\" onClick={model.onClickRestoreDefault}>\n            Restore default config\n          </Button>\n          <div className={styles.controls}>\n            {controls.map((control) => (\n              <control.Component key={control.state.key} model={control} />\n            ))}\n          </div>\n        </div>\n\n        <div className={styles.messageContainer}>\n          <p>Select a Prometheus function that will be used by default to display the {metric} metric.</p>\n        </div>\n\n        {body && <body.Component model={body} />}\n\n        <div className={styles.formButtonsContainer}>\n          <Button variant=\"primary\" size=\"md\" onClick={model.onClickApplyConfig}>\n            Apply\n          </Button>\n          <Button variant=\"secondary\" size=\"md\" onClick={model.onClickCancel}>\n            Cancel\n          </Button>\n        </div>\n\n        <ConfirmModal\n          isOpen={isConfirmModalOpen}\n          title=\"Restore default configuration\"\n          body={`Are you sure you want to restore the default configuration for the ${metric} metric?`}\n          confirmText=\"Restore\"\n          onConfirm={model.onClickConfirmRestoreDefault}\n          onDismiss={model.closeConfirmModal}\n        />\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    controlsContainer: css`\n      display: flex;\n      justify-content: flex-end;\n      gap: ${theme.spacing(1)};\n      margin-bottom: ${theme.spacing(2)};\n    `,\n    messageContainer: css`\n      margin: ${theme.spacing(2.5, 0, 1, 0)};\n    `,\n    controls: css`\n      display: flex;\n    `,\n    formButtonsContainer: css`\n      display: flex;\n      justify-content: center;\n      gap: ${theme.spacing(2)};\n      position: sticky;\n      bottom: 0;\n      background: ${theme.colors.background.primary};\n      padding: ${theme.spacing(2, 0)};\n      border-top: 1px solid ${theme.colors.border.weak};\n    `,\n  };\n}\n","import { DEFAULT_TIMESERIES_AGE_PRESETS } from './config-presets-ages';\nimport { DEFAULT_HISTOGRAMS_PRESETS } from './config-presets-histograms';\nimport { DEFAULT_STATUS_UP_DOWN_PRESETS } from './config-presets-status-updown';\nimport { DEFAULT_TIMESERIES_PRESETS, DEFAULT_TIMESERIES_RATE_PRESETS } from './config-presets-timeseries';\nimport { type PanelConfigPreset } from './types';\nimport { isCounterMetric } from '../..//matchers/isCounterMetric';\nimport { isHistogramMetric } from '../..//matchers/isHistogramMetric';\nimport { isAgeMetric } from '../../matchers/isAgeMetric';\nimport { isStatusUpDownMetric } from '../../matchers/isStatusUpDownMetric';\n\nexport function getConfigPresetsForMetric(metric: string, isNativeHistogram: boolean): PanelConfigPreset[] {\n  if (isStatusUpDownMetric(metric)) {\n    return Object.values(DEFAULT_STATUS_UP_DOWN_PRESETS);\n  }\n\n  if (isNativeHistogram || isHistogramMetric(metric)) {\n    return Object.values(DEFAULT_HISTOGRAMS_PRESETS);\n  }\n\n  if (isAgeMetric(metric)) {\n    return [Object.values(DEFAULT_TIMESERIES_PRESETS)[0], ...Object.values(DEFAULT_TIMESERIES_AGE_PRESETS)];\n  }\n\n  if (isCounterMetric(metric)) {\n    return Object.values(DEFAULT_TIMESERIES_RATE_PRESETS);\n  }\n\n  return Object.values(DEFAULT_TIMESERIES_PRESETS);\n}\n","import { isAgeMetric } from './isAgeMetric';\nimport { isCounterMetric } from './isCounterMetric';\nimport { isHistogramMetric } from './isHistogramMetric';\nimport { isStatusUpDownMetric } from './isStatusUpDownMetric';\n\nexport type MetricType = 'status-updown' | 'histogram' | 'age' | 'counter' | 'gauge';\n\nexport function getMetricType(metric: string): MetricType {\n  if (isStatusUpDownMetric(metric)) {\n    return 'status-updown';\n  }\n\n  if (isHistogramMetric(metric)) {\n    return 'histogram';\n  }\n\n  if (isAgeMetric(metric)) {\n    return 'age';\n  }\n\n  if (isCounterMetric(metric)) {\n    return 'counter';\n  }\n\n  return 'gauge';\n}\n","import { css, cx } from '@emotion/css';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { memo } from 'react';\n\ntype PluginLogoProps = {\n  size: 'small' | 'large';\n};\n\nexport const PluginLogo = memo(function PluginLogoComponent({ size }: PluginLogoProps) {\n  const styles = useStyles2(getStyles);\n  return <img className={cx(styles.logo, size)} src=\"public/plugins/grafana-metricsdrilldown-app/img/logo.svg\" />;\n});\n\nconst getStyles = () => ({\n  logo: css`\n    &.small {\n      width: 24px;\n      height: 24px;\n      margin-right: 4px;\n      position: relative;\n      top: -2px;\n    }\n\n    &.large {\n      width: 40px;\n      height: 40px;\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { usePluginContext, type GrafanaTheme2 } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { Button, Dropdown, Menu, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { PluginLogo } from './PluginLogo';\nimport { GIT_COMMIT } from '../version';\n\nconst pluginCommitSha: string = GIT_COMMIT;\nconst pluginCommitURL = `https://github.com/grafana/metrics-drilldown/commit/${pluginCommitSha}`;\n\nconst { buildInfo: grafanaBuildInfo } = config;\n\nfunction InfoMenuHeader() {\n  const styles = useStyles2(getStyles);\n\n  const {\n    meta: {\n      info: { version, updated },\n    },\n  } = usePluginContext() || { meta: { info: { version: '?.?.?', updated: '?' } } };\n\n  return (\n    <div className={styles.menuHeader}>\n      <h5>\n        <PluginLogo size=\"small\" />\n        Grafana Metrics Drilldown v{version}\n      </h5>\n      <div className={styles.subTitle}>Last update: {updated}</div>\n    </div>\n  );\n}\n\nfunction InfoMenu() {\n  const isDev = pluginCommitSha === 'dev';\n  const shortCommitSha = isDev ? pluginCommitSha : pluginCommitSha.slice(0, 8);\n\n  return (\n    <Menu header={<InfoMenuHeader />}>\n      <Menu.Item\n        label={`Commit SHA: ${shortCommitSha}`}\n        icon=\"github\"\n        onClick={() => window.open(pluginCommitURL)}\n        disabled={isDev}\n      />\n      <Menu.Item\n        label=\"Changelog\"\n        icon=\"list-ul\"\n        onClick={() =>\n          window.open(\n            'https://github.com/grafana/metrics-drilldown/blob/main/CHANGELOG.md',\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n      <Menu.Item\n        label=\"Contribute\"\n        icon=\"external-link-alt\"\n        onClick={() =>\n          window.open(\n            'https://github.com/grafana/metrics-drilldown/blob/main/docs/contributing.md',\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n      <Menu.Item\n        label=\"Documentation\"\n        icon=\"document-info\"\n        onClick={() =>\n          window.open(\n            'https://grafana.com/docs/grafana/latest/explore/simplified-exploration/metrics',\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n      <Menu.Item\n        label=\"Report an issue\"\n        icon=\"bug\"\n        onClick={() =>\n          window.open(\n            'https://github.com/grafana/metrics-drilldown/issues/new?template=bug_report.md',\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n      <Menu.Divider />\n      <Menu.Item\n        label={`Grafana ${grafanaBuildInfo.edition} v${grafanaBuildInfo.version} (${grafanaBuildInfo.env})`}\n        icon=\"grafana\"\n        onClick={() =>\n          window.open(\n            `https://github.com/grafana/grafana/commit/${grafanaBuildInfo.commit}`,\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n    </Menu>\n  );\n}\n\nexport function PluginInfo() {\n  return (\n    <Dropdown overlay={() => <InfoMenu />} placement=\"bottom-end\">\n      <Button\n        icon=\"info-circle\"\n        variant=\"secondary\"\n        tooltip=\"Plugin info\"\n        tooltipPlacement=\"top\"\n        title=\"Plugin info\"\n        data-testid=\"plugin-info-button\"\n      />\n    </Dropdown>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  button: css`\n    position: relative;\n    display: flex;\n    align-items: center;\n    width: 32px;\n    height: 32px;\n    line-height: 30px;\n    border: 1px solid ${theme.colors.border.weak};\n    border-radius: 2px;\n    border-left: 0;\n    color: ${theme.colors.text.primary};\n    background: ${theme.colors.background.secondary};\n\n    &:hover {\n      border-color: ${theme.colors.border.medium};\n      background-color: ${theme.colors.background.canvas};\n    }\n  `,\n  menuHeader: css`\n    padding: ${theme.spacing(0.5, 1)};\n    white-space: nowrap;\n  `,\n  subTitle: css`\n    color: ${theme.colors.text.secondary};\n    font-size: ${theme.typography.bodySmall.fontSize};\n  `,\n});\n","import { SceneObjectBase, type SceneComponentProps, type SceneObject, type SceneObjectState } from '@grafana/scenes';\nimport { Drawer } from '@grafana/ui';\nimport React from 'react';\n\ninterface SceneDrawerState extends SceneObjectState {\n  key?: string;\n  isOpen?: boolean;\n  title?: string;\n  subTitle?: string;\n  body?: SceneObject;\n}\n\nexport class SceneDrawer extends SceneObjectBase<SceneDrawerState> {\n  constructor(state?: SceneDrawerState) {\n    super({\n      key: 'drawer',\n      isOpen: false,\n      ...state,\n    });\n  }\n\n  open = ({\n    title,\n    subTitle,\n    body,\n  }: {\n    title?: SceneDrawerState['title'];\n    subTitle?: SceneDrawerState['subTitle'];\n    body?: SceneDrawerState['body'];\n  }) => {\n    this.setState({ ...this.state, isOpen: true, title, subTitle, body });\n  };\n\n  close = () => {\n    this.setState({ isOpen: false });\n  };\n\n  static readonly Component = ({ model }: SceneComponentProps<SceneDrawer>) => {\n    const { isOpen, title, subTitle, body } = model.useState();\n\n    return (\n      <>\n        {body && isOpen && (\n          <Drawer size=\"lg\" title={title} subtitle={subTitle} closeOnMaskClick onClose={model.close}>\n            <body.Component model={body} />\n          </Drawer>\n        )}\n      </>\n    );\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { QueryVariable, sceneGraph, type MultiValueVariable, type SceneComponentProps } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from 'interactions';\nimport { ALL_VARIABLE_VALUE } from 'services/variables';\nimport { trailDS, VAR_FILTERS, VAR_GROUP_BY, VAR_METRIC_EXPR } from 'shared';\nimport { isAdHocFiltersVariable } from 'utils/utils.variables';\n\nexport class GroupByVariable extends QueryVariable {\n  constructor() {\n    super({\n      name: VAR_GROUP_BY,\n      label: 'Group by',\n      datasource: trailDS,\n      includeAll: true,\n      defaultToAll: true,\n      query: `label_names(${VAR_METRIC_EXPR})`,\n      value: '',\n      text: '',\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToState((newState, prevState) => {\n      if (newState.value && newState.value !== prevState.value) {\n        reportExploreMetrics('groupby_label_changed', { label: String(newState.value) });\n        return;\n      }\n\n      if (newState.options !== prevState.options && newState.options.find((o) => o.value === 'le')) {\n        this.setState({ options: newState.options.filter((o) => o.value !== 'le') });\n      }\n    });\n\n    const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n\n    if (isAdHocFiltersVariable(filtersVariable)) {\n      filtersVariable.subscribeToState((newState, prevState) => {\n        if (newState.filterExpression !== prevState.filterExpression) {\n          this.changeValueTo(ALL_VARIABLE_VALUE);\n        }\n      });\n    }\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MultiValueVariable>) => {\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.select} data-testid=\"breakdown-label-selector\">\n        <QueryVariable.Component model={model} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    select: css`\n      width: ${theme.spacing(16)};\n      & > div {\n        width: 100%;\n      }\n    `,\n  };\n}\n","export const ALL_VARIABLE_VALUE = '$__all';\n","export const UI_TEXT = {\n  SEARCH: {\n    TITLE: 'Search metrics',\n  },\n  METRIC_SELECT_SCENE: {\n    OPEN_EXPLORE_LABEL: 'Open in explore',\n    COPY_URL_LABEL: 'Copy url',\n    BOOKMARK_LABEL: 'Bookmark',\n    SELECT_NEW_METRIC_TOOLTIP: 'Remove existing metric and choose a new metric',\n  },\n};\n","import { sceneGraph, SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport React from 'react';\n\nimport { GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { type PanelType } from 'GmdVizPanel/types/available-panel-types';\nimport { reportExploreMetrics } from 'interactions';\n\nimport { EventPanelTypeChanged } from './EventPanelTypeChanged';\n\ninterface GmdVizPanelVariantSelectorState extends SceneObjectState {\n  metric: string;\n  options: Array<{\n    label: string;\n    value: PanelType;\n  }>;\n  currentPanelType?: PanelType;\n}\n\n// currently used only for histogram metrics\nexport class GmdVizPanelVariantSelector extends SceneObjectBase<GmdVizPanelVariantSelectorState> {\n  constructor({ metric }: { metric: GmdVizPanelVariantSelectorState['metric'] }) {\n    super({\n      metric,\n      options: [\n        { value: 'percentiles' as PanelType, label: 'percentiles' },\n        { value: 'heatmap' as PanelType, label: 'heatmap' },\n      ],\n      currentPanelType: undefined,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const vizPanel = sceneGraph.getAncestor(this, GmdVizPanel);\n\n    this.setState({\n      currentPanelType: vizPanel.state.panelConfig.type,\n    });\n\n    this._subs.add(\n      vizPanel.subscribeToState((newState, prevState) => {\n        if (newState.panelConfig.type !== prevState.panelConfig.type) {\n          this.setState({\n            currentPanelType: newState.panelConfig.type,\n          });\n        }\n      })\n    );\n  }\n\n  private onChange = (newPanelType: PanelType) => {\n    reportExploreMetrics('histogram_panel_type_changed', { panelType: newPanelType });\n\n    this.publishEvent(new EventPanelTypeChanged({ panelType: newPanelType }), true);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<GmdVizPanelVariantSelector>) => {\n    const { options, currentPanelType } = model.useState();\n\n    if (!options.length) {\n      return null;\n    }\n\n    return <RadioButtonGroup size=\"sm\" options={options} value={currentPanelType} onChange={model.onChange} />;\n  };\n}\n","import { type SceneDataTransformer, type SceneObject, type SceneQueryRunner } from '@grafana/scenes';\n\nexport function getQueryRunnerFor(sceneObject: SceneObject | undefined): SceneQueryRunner | undefined {\n  if (!sceneObject) {\n    return undefined;\n  }\n\n  const dataProvider = sceneObject.state.$data ?? sceneObject.parent?.state.$data;\n\n  if (isSceneQueryRunner(dataProvider)) {\n    return dataProvider;\n  }\n\n  if (isSceneDataTransformer(dataProvider)) {\n    return getQueryRunnerFor(dataProvider);\n  }\n\n  return undefined;\n}\n\nexport function isSceneQueryRunner(input: SceneObject | null | undefined): input is SceneQueryRunner {\n  return typeof input !== 'undefined' && input !== null && 'state' in input && 'runQueries' in input;\n}\n\nfunction isSceneDataTransformer(input: SceneObject | null | undefined): input is SceneDataTransformer {\n  return typeof input !== 'undefined' && input !== null && 'state' in input && 'transformations' in input.state;\n}\n","import { type DataFrame, type FieldConfig, type FieldConfigSource, type TimeRange } from '@grafana/data';\nimport { usePluginLinks } from '@grafana/runtime';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  VizPanel,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { type DataQuery, type DataSourceRef } from '@grafana/schema';\nimport { IconButton } from '@grafana/ui';\nimport React from 'react';\n\nimport MimirLogo from 'img/logo.svg';\nimport { findObjectOfType } from 'utils';\n\nimport pluginJson from '../plugin.json';\nimport { VAR_DATASOURCE_EXPR } from '../shared';\nimport { isSceneQueryRunner } from '../utils/utils.queries';\n\nexport const investigationsPluginId = 'grafana-investigations-app';\nexport const extensionPointId = `${pluginJson.id}/investigation/v1`;\nexport const addToExplorationsButtonLabel = 'add panel to exploration';\n\ninterface AddToExplorationButtonState extends SceneObjectState {\n  frame?: DataFrame;\n  dsUid?: string;\n  labelName?: string;\n  fieldName?: string;\n  context?: ExtensionContext;\n\n  queries: DataQuery[];\n  fieldConfig?: FieldConfigSource;\n}\n\ninterface ExtensionContext {\n  timeRange: TimeRange;\n  queries: DataQuery[];\n  datasource: DataSourceRef;\n  origin: string;\n  url: string;\n  type: string;\n  title: string;\n  id: string;\n  logoPath: string;\n  note?: string;\n  drillDownLabel?: string;\n}\n\nexport class AddToExplorationButton extends SceneObjectBase<AddToExplorationButtonState> {\n  constructor(state: Omit<AddToExplorationButtonState, 'queries'>) {\n    super({ ...state, queries: [] });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  private _onActivate = () => {\n    this._subs.add(\n      this.subscribeToState(() => {\n        this.getQueries();\n        this.getContext();\n      })\n    );\n\n    const datasourceUid = sceneGraph.interpolate(this, VAR_DATASOURCE_EXPR);\n    this.setState({ dsUid: datasourceUid });\n  };\n\n  private readonly getQueries = () => {\n    const data = sceneGraph.getData(this);\n    const queryRunner = sceneGraph.findObject(data, isSceneQueryRunner);\n\n    if (isSceneQueryRunner(queryRunner)) {\n      const filter = this.state.frame ? getFilter(this.state.frame) : null;\n      const queries = queryRunner.state.queries.map((q) => ({\n        ...q,\n        expr: sceneGraph.interpolate(queryRunner, q.expr),\n        legendFormat: filter?.name ? `{{ ${filter.name} }}` : sceneGraph.interpolate(queryRunner, q.legendFormat),\n      }));\n\n      if (JSON.stringify(queries) !== JSON.stringify(this.state.queries)) {\n        this.setState({ queries });\n      }\n    }\n  };\n\n  private getPanelConfigAndDataFrames() {\n    const panel = findObjectOfType(this, (o) => o instanceof VizPanel, VizPanel);\n    const data = sceneGraph.getData(this);\n\n    return {\n      fieldConfig: panel?.state.fieldConfig,\n      frames: data?.state.data?.series,\n    };\n  }\n\n  private readonly updateFieldConfigOverrides = () => {\n    const { fieldConfig, frames } = this.getPanelConfigAndDataFrames();\n\n    if (!fieldConfig || !frames?.length) {\n      return undefined;\n    }\n\n    for (const frame of frames) {\n      for (const field of frame.fields) {\n        const configKeys = Object.keys(field.config);\n        const properties = configKeys.map((key) => ({\n          id: key,\n          value: field.config[key as keyof FieldConfig],\n        }));\n\n        // check if the override already exists\n        const existingOverride = fieldConfig.overrides.find(\n          (o) =>\n            o.matcher.options === (field.config.displayNameFromDS ?? field.config.displayName ?? field.name) &&\n            o.matcher.id === 'byName'\n        );\n\n        if (!existingOverride) {\n          // add as first override\n          fieldConfig.overrides.unshift({\n            matcher: {\n              id: 'byName',\n              options: field.config.displayNameFromDS ?? field.config.displayName ?? field.name,\n            },\n            properties,\n          });\n        }\n\n        if (existingOverride && JSON.stringify(existingOverride.properties) !== JSON.stringify(properties)) {\n          existingOverride.properties = properties;\n        }\n      }\n    }\n\n    return fieldConfig;\n  };\n\n  private readonly getContext = () => {\n    const fieldConfig = this.updateFieldConfigOverrides();\n    const { queries, dsUid, labelName, fieldName } = this.state;\n    const timeRange = sceneGraph.getTimeRange(this);\n\n    if (!timeRange || !queries || !dsUid) {\n      return;\n    }\n    const ctx = {\n      origin: 'Metrics Drilldown',\n      type: 'timeseries',\n      queries,\n      timeRange: { ...timeRange.state.value },\n      datasource: { uid: dsUid },\n      url: window.location.href,\n      id: `${JSON.stringify(queries)}${labelName}${fieldName}`,\n      title: labelName + (fieldName ? ` > ${fieldName}` : ''),\n      logoPath: MimirLogo,\n      drillDownLabel: fieldName,\n      fieldConfig,\n    };\n    if (JSON.stringify(ctx) !== JSON.stringify(this.state.context)) {\n      this.setState({ context: ctx });\n    }\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<AddToExplorationButton>) => {\n    const { context } = model.useState();\n    const { links } = usePluginLinks({ extensionPointId, context, limitPerPlugin: 1 });\n    const link = links.find((link) => link.pluginId === investigationsPluginId);\n\n    if (!link) {\n      return null;\n    }\n\n    return (\n      <IconButton\n        tooltip={link.description}\n        aria-label={addToExplorationsButtonLabel} // this is overriden by the `tooltip`\n        key={link.id}\n        name={link.icon ?? 'panel-add'}\n        onClick={(e) => {\n          if (link.onClick) {\n            link.onClick(e);\n          }\n        }}\n      />\n    );\n  };\n}\n\nconst getFilter = (frame: DataFrame) => {\n  const filterNameAndValueObj = frame.fields[1]?.labels ?? {};\n  const keys = Object.keys(filterNameAndValueObj);\n  if (keys.length !== 1) {\n    return;\n  }\n  const name = keys[0];\n  return { name, value: filterNameAndValueObj[name] };\n};\n","import { type DataFrame, type PanelMenuItem, type PluginExtensionLink } from '@grafana/data';\nimport { config, getObservablePluginLinks } from '@grafana/runtime';\nimport {\n  getExploreURL,\n  sceneGraph,\n  SceneObjectBase,\n  VizPanel,\n  VizPanelMenu,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport React from 'react';\nimport { firstValueFrom } from 'rxjs';\n\nimport { logger } from 'tracking/logger/logger';\n\nimport { AddToExplorationButton, extensionPointId } from './AddToExplorationsButton';\nimport { getQueryRunnerFor } from '../utils/utils.queries';\n\nconst ADD_TO_INVESTIGATION_MENU_TEXT = 'Add to investigation';\nconst ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT = 'investigations_divider'; // Text won't be visible\nconst ADD_TO_INVESTIGATION_MENU_GROUP_TEXT = 'Investigations';\n\ninterface PanelMenuState extends SceneObjectState {\n  body?: VizPanelMenu;\n  frame?: DataFrame;\n  labelName?: string;\n  fieldName?: string;\n  addExplorationsLink?: boolean;\n  explorationsButton?: AddToExplorationButton;\n}\n\n/**\n * @todo the VizPanelMenu interface is overly restrictive, doesn't allow any member functions on this class, so everything is currently inlined\n */\nexport class PanelMenu extends SceneObjectBase<PanelMenuState> implements VizPanelMenu, SceneObject {\n  constructor(state: Partial<PanelMenuState>) {\n    super({ ...state, addExplorationsLink: state.addExplorationsLink ?? true });\n    this.addActivationHandler(() => {\n      let exploreUrl: Promise<string | undefined> | undefined;\n      try {\n        const viz = sceneGraph.getAncestor(this, VizPanel);\n        const panelData = sceneGraph.getData(viz).state.data;\n        if (!panelData) {\n          throw new Error('Cannot get link to explore, no panel data found');\n        }\n        const queryRunner = getQueryRunnerFor(viz);\n        const queries = queryRunner?.state.queries ?? [];\n        queries.forEach((query) => {\n          // removing legendFormat to get verbose legend in Explore\n          delete query.legendFormat;\n        });\n        // 'this' scene object contain the variable for the metric name which is correctly interpolated into the explore url\n        // when used in the metric select scene case,\n        // this will get the explore url with interpolated variables and include the labels __ignore_usage__, this is a known issue\n        // in the metric scene we do not get use the __ignore_usage__ labels in the explore url\n        exploreUrl = getExploreURL(panelData, this, panelData.timeRange, (query) => {\n          // remove __ignore_usage__=\"\" from the query\n          if ('expr' in query && typeof query.expr === 'string' && query.expr.includes('__ignore_usage__')) {\n            return {\n              ...query,\n              expr: query.expr.replace(/,?__ignore_usage__=\"\",?/, ''), // also remove leading/trailing comma if present\n            };\n          }\n\n          return query;\n        });\n      } catch {}\n\n      // Navigation options (all panels)\n      const items: PanelMenuItem[] = [\n        {\n          text: 'Navigation',\n          type: 'group',\n        },\n        {\n          text: 'Explore',\n          iconClassName: 'compass',\n          onClick: () => exploreUrl?.then((url) => url && window.open(url, '_blank')),\n          shortcut: 'p x',\n        },\n      ];\n\n      this.setState({\n        body: new VizPanelMenu({\n          items,\n        }),\n      });\n\n      const addToExplorationsButton = new AddToExplorationButton({\n        labelName: this.state.labelName,\n        fieldName: this.state.fieldName,\n        frame: this.state.frame,\n      });\n      this._subs.add(\n        addToExplorationsButton?.subscribeToState(async () => {\n          await subscribeToAddToExploration(this);\n        })\n      );\n      this.setState({\n        explorationsButton: addToExplorationsButton,\n      });\n\n      if (this.state.addExplorationsLink) {\n        this.state.explorationsButton?.activate();\n      }\n    });\n  }\n\n  addItem(item: PanelMenuItem): void {\n    if (this.state.body) {\n      this.state.body.addItem(item);\n    }\n  }\n\n  setItems(items: PanelMenuItem[]): void {\n    if (this.state.body) {\n      this.state.body.setItems(items);\n    }\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<PanelMenu>) => {\n    const { body } = model.useState();\n\n    if (body) {\n      return <body.Component model={body} />;\n    }\n\n    return <></>;\n  };\n}\n\nconst getInvestigationLink = async (addToExplorations: AddToExplorationButton) => {\n  const context = addToExplorations.state.context;\n\n  // Check if we're running on Grafana v11\n  if (config.buildInfo.version.startsWith('11.')) {\n    try {\n      const runtime = await import('@grafana/runtime');\n      const getPluginLinkExtensions = (runtime as any).getPluginLinkExtensions;\n      if (getPluginLinkExtensions !== undefined) {\n        const links = getPluginLinkExtensions({\n          extensionPointId,\n          context,\n        });\n\n        return links.extensions[0];\n      }\n    } catch (e) {\n      // Ignore import error and fall through to v12 implementation\n      logger.error(e as Error, { message: 'Error importing getPluginLinkExtensions' });\n    }\n  }\n\n  // `getObservablePluginLinks` is introduced in Grafana v12\n  if (typeof getObservablePluginLinks === 'function') {\n    const links: PluginExtensionLink[] = await firstValueFrom(\n      getObservablePluginLinks({\n        extensionPointId,\n        context,\n      })\n    );\n\n    return links[0];\n  }\n\n  return undefined;\n};\n\nasync function subscribeToAddToExploration(menu: PanelMenu) {\n  const addToExplorationButton = menu.state.explorationsButton;\n  if (addToExplorationButton) {\n    const link = await getInvestigationLink(addToExplorationButton);\n\n    const existingMenuItems = menu.state.body?.state.items ?? [];\n\n    const existingAddToExplorationLink = existingMenuItems.find((item) => item.text === ADD_TO_INVESTIGATION_MENU_TEXT);\n\n    if (link) {\n      if (!existingAddToExplorationLink) {\n        menu.state.body?.addItem({\n          text: ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT,\n          type: 'divider',\n        });\n        menu.state.body?.addItem({\n          text: ADD_TO_INVESTIGATION_MENU_GROUP_TEXT,\n          type: 'group',\n        });\n        menu.state.body?.addItem({\n          text: ADD_TO_INVESTIGATION_MENU_TEXT,\n          iconClassName: 'plus-square',\n          onClick: (e) => link.onClick && link.onClick(e),\n        });\n      } else {\n        if (existingAddToExplorationLink) {\n          menu.state.body?.setItems(\n            existingMenuItems.filter(\n              (item) =>\n                [\n                  ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT,\n                  ADD_TO_INVESTIGATION_MENU_GROUP_TEXT,\n                  ADD_TO_INVESTIGATION_MENU_TEXT,\n                ].includes(item.text) === false\n            )\n          );\n        }\n      }\n    }\n  }\n}\n","import { type GrafanaTheme2 } from '@grafana/data';\n\nimport { type DataTrail } from 'DataTrail';\n\nexport function getAppBackgroundColor(theme: GrafanaTheme2, trail?: DataTrail): string {\n  // If DataTrail is in embedded mode, always use primary background\n  if (trail?.state.embedded) {\n    return theme.colors.background.primary;\n  }\n\n  // Otherwise, use the standard theme-based logic\n  return theme.isLight ? theme.colors.background.primary : theme.colors.background.canvas;\n}\n","import { css, cx } from '@emotion/css';\nimport { DashboardCursorSync, type GrafanaTheme2 } from '@grafana/data';\nimport { useChromeHeaderHeight } from '@grafana/runtime';\nimport {\n  behaviors,\n  SceneFlexItem,\n  SceneFlexLayout,\n  SceneObjectBase,\n  SceneReactObject,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { ConfigurePanelAction } from 'GmdVizPanel/components/ConfigurePanelAction';\nimport { GmdVizPanelVariantSelector } from 'GmdVizPanel/components/GmdVizPanelVariantSelector';\nimport { PANEL_HEIGHT } from 'GmdVizPanel/config/panel-heights';\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/config/query-resolutions';\nimport { GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { isHistogramMetric } from 'GmdVizPanel/matchers/isHistogramMetric';\nimport { getMetricDescription } from 'helpers/MetricDatasourceHelper';\nimport { PanelMenu } from 'Menu/PanelMenu';\nimport { MetricActionBar } from 'MetricActionBar';\n\nimport { type DataTrail } from './DataTrail';\nimport { getTrailFor, getTrailSettings } from './utils';\nimport { getAppBackgroundColor } from './utils/utils.styles';\n\nconst MAIN_PANEL_MIN_HEIGHT = PANEL_HEIGHT.XL;\nconst MAIN_PANEL_MAX_HEIGHT = '40%';\nexport const TOPVIEW_KEY = 'topview';\n\ninterface MetricGraphSceneState extends SceneObjectState {\n  metric: string;\n  topView: SceneFlexLayout;\n  selectedTab?: SceneObject;\n}\n\nexport class MetricGraphScene extends SceneObjectBase<MetricGraphSceneState> {\n  public constructor(state: { metric: MetricGraphSceneState['metric'] }) {\n    super({\n      metric: state.metric,\n      topView: new SceneFlexLayout({\n        direction: 'column',\n        $behaviors: [new behaviors.CursorSync({ key: 'metricCrosshairSync', sync: DashboardCursorSync.Crosshair })],\n        children: [\n          // prevent height flicker when landing\n          new SceneFlexItem({\n            minHeight: MAIN_PANEL_MIN_HEIGHT,\n            maxHeight: MAIN_PANEL_MAX_HEIGHT,\n            body: new SceneReactObject({ reactNode: <div /> }),\n          }),\n        ],\n      }),\n      selectedTab: undefined,\n    });\n\n    this.addActivationHandler(() => {\n      this.onActivate();\n    });\n  }\n\n  private async onActivate() {\n    const { metric, topView } = this.state;\n    const trail = getTrailFor(this);\n    const metadata = await trail.getMetadataForMetric(metric);\n    const description = getMetricDescription(metadata);\n    const isHistogram = isHistogramMetric(metric) || (await trail.isNativeHistogram(metric));\n\n    topView.setState({\n      children: [\n        new SceneFlexItem({\n          key: TOPVIEW_KEY,\n          minHeight: MAIN_PANEL_MIN_HEIGHT,\n          maxHeight: MAIN_PANEL_MAX_HEIGHT,\n          body: new GmdVizPanel({\n            metric,\n            panelOptions: {\n              height: PANEL_HEIGHT.XL,\n              description,\n              headerActions: isHistogram\n                ? () => [new GmdVizPanelVariantSelector({ metric }), new ConfigurePanelAction({ metric })]\n                : () => [new ConfigurePanelAction({ metric })],\n              menu: new PanelMenu({ labelName: metric }),\n            },\n            queryOptions: {\n              resolution: QUERY_RESOLUTION.HIGH,\n            },\n          }),\n        }),\n        new SceneFlexItem({\n          ySizing: 'content',\n          body: new MetricActionBar({}),\n        }),\n      ],\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricGraphScene>) => {\n    const { topView, selectedTab } = model.useState();\n    const { stickyMainGraph } = getTrailSettings(model).useState();\n    const chromeHeaderHeight = useChromeHeaderHeight();\n    const trail = getTrailFor(model);\n    const styles = useStyles2(getStyles, trail.state.embedded ? 0 : chromeHeaderHeight ?? 0, trail);\n\n    return (\n      <div className={styles.container}>\n        <div\n          className={stickyMainGraph ? cx(styles.topView, styles.sticky) : cx(styles.topView, styles.nonSticky)}\n          data-testid=\"top-view\"\n        >\n          <topView.Component model={topView} />\n        </div>\n        {selectedTab && (\n          <div data-testid=\"tab-content\">\n            <selectedTab.Component model={selectedTab} />\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2, headerHeight: number, trail: DataTrail) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      position: 'relative',\n      flexGrow: 1,\n    }),\n    topView: css({}),\n    sticky: css({\n      display: 'flex',\n      flexDirection: 'row',\n      background: getAppBackgroundColor(theme, trail),\n      position: 'sticky',\n      paddingTop: theme.spacing(1),\n      marginTop: `-${theme.spacing(1)}`,\n      zIndex: 10,\n      // --app-controls-height is set dynamically by DataTrail component via ResizeObserver\n      // This ensures the main graph sticks below the app-controls in embedded mode\n      top: `calc(var(--app-controls-height, 0px) + ${headerHeight}px)`,\n    }),\n    nonSticky: css({\n      display: 'flex',\n      flexDirection: 'row',\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  VariableDependencyConfig,\n  type MultiValueVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { Combobox, Icon, InlineField, InlineLabel, Tooltip, useStyles2, type ComboboxOption } from '@grafana/ui';\nimport React from 'react';\n\nimport { computeMetricPrefixGroups } from 'WingmanDataTrail/MetricsVariables/computeMetricPrefixGroups';\nimport { VAR_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\nimport { getMultiVariableValues } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { EventFiltersChanged } from 'WingmanDataTrail/SideBar/sections/MetricsFilterSection/EventFiltersChanged';\n\ninterface PrefixFilterDropdownState extends SceneObjectState {\n  loading: boolean;\n  error: Error | null;\n  options: ComboboxOption[];\n  value: string;\n}\n\nconst METRIC_PREFIX_ALL_OPTION = {\n  label: 'All metric names',\n  value: 'all',\n};\n\nexport class PrefixFilterDropdown extends SceneObjectBase<PrefixFilterDropdownState> {\n  protected _variableDependency: VariableDependencyConfig<PrefixFilterDropdownState> = new VariableDependencyConfig(\n    this,\n    {\n      variableNames: [VAR_METRICS_VARIABLE],\n      onVariableUpdateCompleted: () => this.parseMetricPrefixes(),\n    }\n  );\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['metricPrefix'] });\n\n  getUrlState() {\n    return { metricPrefix: this.state.value };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    if (typeof values.metricPrefix === 'string') {\n      if (this.state.value !== values.metricPrefix) {\n        this.setState({ value: values.metricPrefix });\n      }\n      return;\n    }\n\n    this.setState({ value: METRIC_PREFIX_ALL_OPTION.value });\n  }\n\n  constructor(state: Partial<PrefixFilterDropdownState>) {\n    super({\n      ...state,\n      key: 'related-prefix-filter',\n      loading: true,\n      error: null,\n      options: [METRIC_PREFIX_ALL_OPTION],\n      value: METRIC_PREFIX_ALL_OPTION.value,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.parseMetricPrefixes();\n  }\n\n  private parseMetricPrefixes() {\n    if (this._variableDependency.hasDependencyInLoadingState()) {\n      this.setState({ error: undefined, loading: true });\n      return;\n    }\n\n    const filteredMetricsVariable = sceneGraph.lookupVariable(VAR_METRICS_VARIABLE, this) as MultiValueVariable;\n\n    if (filteredMetricsVariable.state.error) {\n      this.setState({\n        error: filteredMetricsVariable.state.error,\n        loading: false,\n        options: [],\n      });\n      return;\n    }\n\n    const prefixGroups = computeMetricPrefixGroups(\n      getMultiVariableValues(filteredMetricsVariable) as Array<{ label: string; value: string }>\n    );\n\n    const newOptions = [\n      METRIC_PREFIX_ALL_OPTION,\n      ...prefixGroups.map((g) => ({\n        value: g.value,\n        label: `${g.label} (${g.count})`,\n      })),\n    ];\n\n    const { value } = this.state;\n    const newValue = newOptions.find((o) => o.value === value) ? (value as string) : METRIC_PREFIX_ALL_OPTION.value;\n\n    this.setState({\n      error: null,\n      loading: false,\n      options: newOptions,\n    });\n\n    this.selectOption({ value: newValue, label: newValue });\n  }\n\n  private selectOption = (option: ComboboxOption | null) => {\n    const value = option === null ? METRIC_PREFIX_ALL_OPTION.value : option.value;\n\n    this.setState({ value });\n\n    this.publishEvent(\n      new EventFiltersChanged({\n        type: 'prefixes',\n        filters: value === METRIC_PREFIX_ALL_OPTION.value ? [] : [value],\n      }),\n      true\n    );\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<PrefixFilterDropdown>) => {\n    const styles = useStyles2(getStyles);\n    const { loading, options, value, error } = model.useState();\n\n    return (\n      <div className={styles.container} data-testid=\"prefix-filter-selector\">\n        <InlineField\n          disabled={loading}\n          error={error && error.toString()}\n          label={\n            <InlineLabel width=\"auto\" className={styles.label}>\n              <span>View by</span>\n              <Tooltip\n                content=\"View by the metric prefix. A metric prefix is a single word at the beginning of the metric name, relevant to the domain the metric belongs to.\"\n                placement=\"top\"\n              >\n                <Icon className={styles.tooltipIcon} name=\"info-circle\" size=\"sm\" />\n              </Tooltip>\n            </InlineLabel>\n          }\n        >\n          <Combobox value={value} onChange={model.selectOption} options={options} />\n        </InlineField>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css`\n      display: flex;\n\n      & > div {\n        margin: 0;\n      }\n    `,\n\n    label: css`\n      margin-right: 0;\n      background-color: ${theme.colors.background.primary};\n      border: 1px solid ${theme.colors.border.medium};\n      border-right: 0 none;\n      border-top-right-radius: 0;\n      border-bottom-right-radius: 0;\n    `,\n    tooltipIcon: css`\n      margin-left: ${theme.spacing(0.5)};\n    `,\n  };\n}\n","import { css } from '@emotion/css';\nimport { type SelectableValue } from '@grafana/data';\nimport {\n  EmbeddedScene,\n  SceneFlexItem,\n  SceneFlexLayout,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type SceneReactObject,\n  type SceneVariableSet,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { LayoutSwitcher } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { type CountsProvider } from 'WingmanDataTrail/ListControls/QuickSearch/CountsProvider/CountsProvider';\nimport { MetricVariableCountsProvider } from 'WingmanDataTrail/ListControls/QuickSearch/CountsProvider/MetricVariableCountsProvider';\nimport { QuickSearch } from 'WingmanDataTrail/ListControls/QuickSearch/QuickSearch';\n\nimport { PrefixFilterDropdown } from './PrefixFilterDropdown';\n\ninterface RelatedListControlsState extends SceneObjectState {\n  $variables?: SceneVariableSet;\n  inputControls?: SceneReactObject;\n  onChange?: (value: SelectableValue<string>) => void; // Keeping for backward compatibility\n}\n\nexport class RelatedListControls extends EmbeddedScene {\n  constructor(state: Partial<RelatedListControlsState>) {\n    super({\n      ...state,\n      key: 'related-list-controls',\n      body: new SceneFlexLayout({\n        direction: 'row',\n        width: '100%',\n        maxHeight: '32px',\n        children: [\n          new SceneFlexItem({\n            width: 'auto',\n            body: new PrefixFilterDropdown({}),\n          }),\n          new SceneFlexItem({\n            body: new QuickSearch({\n              urlSearchParamName: 'gmd-relatedSearchText',\n              targetName: 'related metric',\n              countsProvider: new MetricVariableCountsProvider() as unknown as CountsProvider,\n              displayCounts: true,\n            }),\n          }),\n          new SceneFlexItem({\n            width: 'auto',\n            body: new LayoutSwitcher({}),\n          }),\n        ],\n      }),\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<RelatedListControls>) => {\n    const styles = useStyles2(getStyles);\n    const { body } = model.useState();\n\n    return (\n      <div className={styles.headerWrapper} data-testid=\"related-list-controls\">\n        <body.Component model={body} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles() {\n  return {\n    headerWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n      '& > div': {\n        display: 'flex',\n        alignItems: 'center',\n        '& > div': {\n          display: 'flex',\n          alignItems: 'center',\n        },\n      },\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n  type QueryVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { EventQuickSearchChanged } from 'WingmanDataTrail/ListControls/QuickSearch/EventQuickSearchChanged';\nimport { QuickSearch } from 'WingmanDataTrail/ListControls/QuickSearch/QuickSearch';\nimport { MetricsList } from 'WingmanDataTrail/MetricsList/MetricsList';\nimport { EventMetricsVariableActivated } from 'WingmanDataTrail/MetricsVariables/EventMetricsVariableActivated';\nimport { EventMetricsVariableDeactivated } from 'WingmanDataTrail/MetricsVariables/EventMetricsVariableDeactivated';\nimport { EventMetricsVariableLoaded } from 'WingmanDataTrail/MetricsVariables/EventMetricsVariableLoaded';\nimport {\n  FilteredMetricsVariable,\n  VAR_FILTERED_METRICS_VARIABLE,\n} from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\nimport {\n  MetricsVariableFilterEngine,\n  type MetricFilters,\n} from 'WingmanDataTrail/MetricsVariables/MetricsVariableFilterEngine';\nimport { MetricsVariableSortEngine } from 'WingmanDataTrail/MetricsVariables/MetricsVariableSortEngine';\nimport { EventFiltersChanged } from 'WingmanDataTrail/SideBar/sections/MetricsFilterSection/EventFiltersChanged';\n\nimport { RelatedListControls } from './RelatedListControls';\n\ninterface RelatedMetricsSceneState extends SceneObjectState {\n  metric: string;\n  body: MetricsList;\n  listControls: RelatedListControls;\n}\n\nexport class RelatedMetricsScene extends SceneObjectBase<RelatedMetricsSceneState> {\n  constructor({ metric }: { metric: RelatedMetricsSceneState['metric'] }) {\n    super({\n      metric,\n      $variables: new SceneVariableSet({\n        variables: [new FilteredMetricsVariable()],\n      }),\n      key: 'RelatedMetricsScene',\n      body: new MetricsList({ variableName: VAR_FILTERED_METRICS_VARIABLE }),\n      listControls: new RelatedListControls({}),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToEvents();\n  }\n\n  private subscribeToEvents() {\n    this.initVariablesFilteringAndSorting();\n  }\n\n  /**\n   * The centralized filtering mechanism implemented here is decoupled via the usage of events.\n   * In order to work, the variables to be filtered/sorted must emit lifecycle events.\n   * This is done via the `withLifecycleEvents` decorator function.\n   *\n   * For example, check the `FilteredMetricsVariable` class.\n   */\n  private initVariablesFilteringAndSorting() {\n    const { metric } = this.state;\n\n    const enginesMap = new Map<\n      string,\n      { filterEngine: MetricsVariableFilterEngine; sortEngine: MetricsVariableSortEngine }\n    >();\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableActivated, (event) => {\n        // register engines\n        const { key } = event.payload;\n        const filteredMetricsVariable = sceneGraph.findByKey(this, key) as QueryVariable;\n\n        enginesMap.set(key, {\n          filterEngine: new MetricsVariableFilterEngine(filteredMetricsVariable),\n          sortEngine: new MetricsVariableSortEngine(filteredMetricsVariable),\n        });\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableDeactivated, (event) => {\n        // unregister engines\n        enginesMap.delete(event.payload.key);\n      })\n    );\n\n    const quickSearch = sceneGraph.findByKeyAndType(this, 'quick-search', QuickSearch);\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableLoaded, (event) => {\n        // filter  on initial load\n        const { key, options } = event.payload;\n        const { filterEngine, sortEngine } = enginesMap.get(key)!;\n\n        filterEngine.setInitOptions(options);\n\n        const filters: Partial<MetricFilters> = {\n          names: quickSearch.state.value ? [quickSearch.state.value] : [],\n        };\n\n        filterEngine.applyFilters(filters, { forceUpdate: true, notify: false });\n        sortEngine.sort('related', { metric });\n      })\n    );\n\n    /* Filters */\n\n    this._subs.add(\n      this.subscribeToEvent(EventQuickSearchChanged, (event) => {\n        const { searchText } = event.payload;\n\n        for (const [, { filterEngine, sortEngine }] of enginesMap) {\n          filterEngine.applyFilters({ names: searchText ? [searchText] : [] });\n          sortEngine.sort('related', { metric });\n        }\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventFiltersChanged, (event) => {\n        const { type, filters } = event.payload;\n\n        for (const [, { filterEngine, sortEngine }] of enginesMap) {\n          filterEngine.applyFilters({ [type]: filters });\n          sortEngine.sort('related', { metric });\n        }\n      })\n    );\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<RelatedMetricsScene>) => {\n    const styles = useStyles2(getStyles);\n    const { $variables, body, listControls } = model.useState();\n\n    return (\n      <>\n        <div className={styles.listControls}>\n          <listControls.Component model={listControls} />\n        </div>\n        <div className={styles.body}>\n          <div className={styles.list} data-testid=\"panels-list\">\n            <body.Component model={body} />\n          </div>\n        </div>\n        <div className={styles.variables}>\n          {$variables?.state.variables.map((variable) => (\n            <variable.Component key={variable.state.name} model={variable} />\n          ))}\n        </div>\n      </>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    body: css({}),\n    list: css({}),\n    listControls: css({\n      margin: theme.spacing(1, 0, 1.5, 0),\n    }),\n    variables: css({\n      display: 'none',\n    }),\n  };\n}\n","import { config } from '@grafana/runtime';\nimport { ToolbarButton } from '@grafana/ui';\nimport React, { useState } from 'react';\n\nimport { PLUGIN_BASE_URL } from './constants';\nimport { UI_TEXT } from './constants/ui';\nimport { type DataTrail } from './DataTrail';\nimport { reportExploreMetrics } from './interactions';\nimport { getUrlForTrail } from './utils';\n\ninterface ShareTrailButtonState {\n  trail: DataTrail;\n}\n\nconst COPY_LABEL = UI_TEXT.METRIC_SELECT_SCENE.COPY_URL_LABEL;\n\nexport const ShareTrailButton = ({ trail }: ShareTrailButtonState) => {\n  const [tooltip, setTooltip] = useState(COPY_LABEL);\n\n  const onShare = () => {\n    if (navigator.clipboard) {\n      reportExploreMetrics('selected_metric_action_clicked', { action: 'share_url' });\n      const appUrl = config.appUrl.endsWith('/') ? config.appUrl.slice(0, -1) : config.appUrl;\n      const url = `${appUrl}${PLUGIN_BASE_URL}/${getUrlForTrail(trail)}`;\n      navigator.clipboard.writeText(url);\n      setTooltip('Copied!');\n      setTimeout(() => {\n        setTooltip(COPY_LABEL);\n      }, 2000);\n    }\n  };\n\n  return <ToolbarButton variant={'canvas'} icon={'share-alt'} tooltip={tooltip} onClick={onShare} />;\n};\n","import { BusEventWithPayload, type DataFrame } from '@grafana/data';\n\ninterface EventTimeseriesDataReceivedPayload {\n  series?: DataFrame[];\n}\n\nexport class EventTimeseriesDataReceived extends BusEventWithPayload<EventTimeseriesDataReceivedPayload> {\n  public static readonly type = 'timeseries-data-received';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\ninterface EventForceSyncYAxisPayload {}\n\nexport class EventForceSyncYAxis extends BusEventWithPayload<EventForceSyncYAxisPayload> {\n  public static readonly type = 'force-sync-y-axis';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\ninterface EventResetSyncYAxisPayload {}\n\nexport class EventResetSyncYAxis extends BusEventWithPayload<EventResetSyncYAxisPayload> {\n  public static readonly type = 'reset-sync-y-axis';\n}\n","import { type DataFrame } from '@grafana/data';\nimport { sceneGraph, VizPanel, type SceneObject, type SceneObjectState } from '@grafana/scenes';\nimport { cloneDeep, merge } from 'lodash';\n\nimport { EventTimeseriesDataReceived } from 'Breakdown/MetricLabelsList/events/EventTimeseriesDataReceived';\n\nimport { EventForceSyncYAxis } from '../events/EventForceSyncYAxis';\nimport { EventResetSyncYAxis } from '../events/EventResetSyncYAxis';\n\n/**\n * Synchronizes the Y-axis ranges across children timeseries panels by listening to data updates from publishTimeseriesData.\n * When new data arrives, it calculates the global min/max values and updates all children panels to use the same scale.\n */\nexport function syncYAxis() {\n  return (vizPanelsParent: SceneObject<SceneObjectState>) => {\n    let max = Number.NEGATIVE_INFINITY;\n    let min = Number.POSITIVE_INFINITY;\n\n    // reset after timerange changes\n    const timeRangeSub = sceneGraph.getTimeRange(vizPanelsParent).subscribeToState(() => {\n      max = Number.NEGATIVE_INFINITY;\n      min = Number.POSITIVE_INFINITY;\n    });\n\n    // reset after receiving the EventResetSyncYAxis event (see SceneByFrameRepeater when filtering/sorting)\n    const resetSub = vizPanelsParent.subscribeToEvent(EventResetSyncYAxis, () => {\n      max = Number.NEGATIVE_INFINITY;\n      min = Number.POSITIVE_INFINITY;\n    });\n\n    // force new panels update after receiving the EventForceSyncYAxis event (see SceneByFrameRepeater when paginating)\n    const forceSub = vizPanelsParent.subscribeToEvent(EventForceSyncYAxis, () => {\n      let [newMax, newMin] = [max, min];\n\n      const nonSyncedPanels = findTimeseriesPanels(vizPanelsParent).filter((t) => {\n        const { fieldConfig, $data } = t.state;\n\n        if ('min' in fieldConfig.defaults && 'max' in fieldConfig.defaults) {\n          return false; // we assume it's already synced (see updateTimeseriesAxis below)\n        }\n\n        [newMax, newMin] = findNewMaxMin($data?.state.data?.series || [], newMax, newMin);\n        return true;\n      });\n\n      if (newMax === max && newMin === min) {\n        updateTimeseriesAxis(vizPanelsParent, max, min, nonSyncedPanels);\n      } else {\n        [max, min] = [newMax, newMin];\n        updateTimeseriesAxis(vizPanelsParent, newMax, newMin);\n      }\n    });\n\n    // new data coming...\n    const dataReceivedSub = vizPanelsParent.subscribeToEvent(EventTimeseriesDataReceived, (event) => {\n      const [newMax, newMin] = findNewMaxMin(event.payload.series || [], max, min);\n\n      if (\n        newMax !== newMin &&\n        newMax !== Number.NEGATIVE_INFINITY &&\n        newMin !== Number.POSITIVE_INFINITY &&\n        (newMax !== max || newMin !== min)\n      ) {\n        [max, min] = [newMax, newMin];\n        updateTimeseriesAxis(vizPanelsParent, newMax, newMin);\n      }\n    });\n\n    return () => {\n      dataReceivedSub.unsubscribe();\n      forceSub.unsubscribe();\n      resetSub.unsubscribe();\n      timeRangeSub.unsubscribe();\n    };\n  };\n}\n\nfunction findNewMaxMin(series: DataFrame[], max: number, min: number) {\n  let [newMax, newMin] = [max, min];\n\n  for (const s of series || []) {\n    const values = s.fields[1]?.values.filter(Boolean);\n\n    if (values) {\n      newMax = Math.max(newMax, ...values);\n      newMin = Math.min(newMin, ...values);\n    }\n  }\n\n  return [newMax, newMin];\n}\n\nfunction findTimeseriesPanels(vizPanelsParent: SceneObject) {\n  // findAllObjects searches down the full scene graph\n  return sceneGraph.findAllObjects(\n    vizPanelsParent,\n    (o) => o instanceof VizPanel && o.state.pluginId === 'timeseries'\n  ) as VizPanel[];\n}\n\nfunction updateTimeseriesAxis(vizPanelsParent: SceneObject, max: number, min: number, panels?: VizPanel[]) {\n  for (const t of panels || findTimeseriesPanels(vizPanelsParent)) {\n    t.clearFieldConfigCache(); // required for the fieldConfig update below\n\n    t.setState({\n      fieldConfig: merge(cloneDeep(t.state.fieldConfig), { defaults: { min, max } }),\n    });\n  }\n}\n","import { sceneGraph, SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button } from '@grafana/ui';\nimport React from 'react';\n\nimport { VAR_GROUP_BY } from 'shared';\nimport { isQueryVariable } from 'utils/utils.variables';\n\nimport { reportExploreMetrics } from '../../interactions';\n\ninterface SelectLabelActionState extends SceneObjectState {\n  label: string;\n}\n\nexport class SelectLabelAction extends SceneObjectBase<SelectLabelActionState> {\n  public onClick = () => {\n    const { label } = this.state;\n\n    reportExploreMetrics('breakdown_panel_selected', { label });\n\n    const groupByVariable = sceneGraph.lookupVariable(VAR_GROUP_BY, this)!;\n    if (!isQueryVariable(groupByVariable)) {\n      throw new Error('Group by variable not found');\n    }\n    groupByVariable.changeValueTo(label);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<SelectLabelAction>) => {\n    return (\n      <Button variant=\"secondary\" size=\"sm\" fill=\"outline\" onClick={model.onClick}>\n        Select\n      </Button>\n    );\n  };\n}\n","import { LoadingState } from '@grafana/data';\nimport { type SceneDataProvider, type VizPanel } from '@grafana/scenes';\n\nimport { EventTimeseriesDataReceived } from '../events/EventTimeseriesDataReceived';\n\n/**\n * Publishes timeseries data events when new data arrives from the VizPanel data provider.\n * These events are used by other behaviors like syncYAxis to coordinate updates across multiple panels.\n */\nexport function publishTimeseriesData() {\n  return (vizPanel: VizPanel) => {\n    const data = vizPanel.state.$data?.state.data;\n\n    if (data?.state === LoadingState.Done) {\n      vizPanel.publishEvent(new EventTimeseriesDataReceived({ series: data.series }), true);\n    }\n\n    (vizPanel.state.$data as SceneDataProvider).subscribeToState((newState, prevState) => {\n      if (newState.data?.state === LoadingState.Done && newState.data?.series !== prevState.data?.series) {\n        vizPanel.publishEvent(new EventTimeseriesDataReceived({ series: newState.data.series }), true);\n      }\n    });\n  };\n}\n","import { type DataFrame } from '@grafana/data';\nimport { map, type Observable } from 'rxjs';\n\nexport const addRefId = () => (source: Observable<DataFrame[]>) =>\n  source.pipe(\n    map((data: DataFrame[]) =>\n      data?.map((d, i) => {\n        d.refId = `${d.refId}-${i}`;\n        return d;\n      })\n    )\n  );\n","import { type DataFrame } from '@grafana/data';\nimport { map, type Observable } from 'rxjs';\n\nexport const SERIES_COUNT_STATS_NAME = 'seriesCount';\n\nexport const sliceSeries = (start: number, end: number) => () => (source: Observable<DataFrame[]>) =>\n  source.pipe(\n    map((data: DataFrame[]) =>\n      // eslint-disable-next-line sonarjs/no-nested-functions\n      data?.slice(start, end).map((d) => {\n        d.meta = { ...d.meta };\n        d.meta.stats ||= [];\n        d.meta.stats.unshift({ displayName: SERIES_COUNT_STATS_NAME, value: data.length });\n        return d;\n      })\n    )\n  );\n","import { css } from '@emotion/css';\nimport { FieldMatcherID, LoadingState, type DataFrame } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneDataTransformer,\n  SceneObjectBase,\n  SceneQueryRunner,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type VizPanel,\n} from '@grafana/scenes';\nimport { SortOrder } from '@grafana/schema';\nimport { TooltipDisplayMode, useStyles2 } from '@grafana/ui';\nimport { merge } from 'lodash';\nimport React from 'react';\n\nimport { SelectLabelAction } from 'Breakdown/MetricLabelsList/SelectLabelAction';\nimport { PANEL_HEIGHT } from 'GmdVizPanel/config/panel-heights';\nimport { PanelMenu } from 'Menu/PanelMenu';\nimport { trailDS } from 'shared';\nimport { getColorByIndex } from 'utils';\n\nimport { publishTimeseriesData } from './behaviors/publishTimeseriesData';\nimport { addRefId } from './transformations/addRefId';\nimport { addUnspecifiedLabel } from './transformations/addUnspecifiedLabel';\nimport { SERIES_COUNT_STATS_NAME, sliceSeries } from './transformations/sliceSeries';\n\ninterface LabelVizPanelState extends SceneObjectState {\n  metric: string;\n  label: string;\n  query: string;\n  unit: string;\n  startColorIndex: number;\n  body: VizPanel;\n}\n\nconst MAX_SERIES_TO_RENDER = 20;\nexport const LABELS_VIZ_PANEL_HEIGHT = PANEL_HEIGHT.M;\n\nexport class LabelVizPanel extends SceneObjectBase<LabelVizPanelState> {\n  constructor({\n    metric,\n    label,\n    query,\n    unit,\n    startColorIndex,\n  }: {\n    metric: LabelVizPanelState['label'];\n    label: LabelVizPanelState['label'];\n    query: LabelVizPanelState['query'];\n    unit: LabelVizPanelState['unit'];\n    startColorIndex: LabelVizPanelState['startColorIndex'];\n  }) {\n    super({\n      key: `label-viz-panel-${label}`,\n      metric,\n      label,\n      query,\n      unit,\n      startColorIndex,\n      body: LabelVizPanel.buildVizPanel({ metric, label, query, unit }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private static buildVizPanel({\n    metric,\n    label,\n    query,\n    unit,\n  }: {\n    metric: LabelVizPanelState['label'];\n    label: LabelVizPanelState['label'];\n    query: LabelVizPanelState['query'];\n    unit: LabelVizPanelState['unit'];\n  }) {\n    const data = new SceneDataTransformer({\n      $data: new SceneQueryRunner({\n        datasource: trailDS,\n        maxDataPoints: 250,\n        queries: [\n          {\n            refId: `${metric}-by-${label}`,\n            expr: query,\n            legendFormat: `{{${label}}}`,\n            fromExploreMetrics: true,\n          },\n        ],\n      }),\n      // addRefId is required for setting the overrides below\n      transformations: [sliceSeries(0, MAX_SERIES_TO_RENDER), addUnspecifiedLabel(label), addRefId],\n    });\n\n    const vizPanel = PanelBuilders.timeseries()\n      .setTitle(label)\n      .setUnit(unit)\n      .setData(data)\n      .setBehaviors([publishTimeseriesData()]) // publishTimeseriesData is required for the syncYAxis behavior (e.g. see MetricLabelsList)\n      .setOption('tooltip', { mode: TooltipDisplayMode.Multi, sort: SortOrder.Descending })\n      .setHeaderActions([new SelectLabelAction({ label })])\n      .setMenu(new PanelMenu({ labelName: label }))\n      .setShowMenuAlways(true)\n      .build();\n\n    return vizPanel;\n  }\n\n  private onActivate() {\n    const { body, label } = this.state;\n\n    this._subs.add(\n      (body.state.$data as SceneQueryRunner).subscribeToState((newState) => {\n        if (newState.data?.state !== LoadingState.Done) {\n          return;\n        }\n\n        const { series } = newState.data;\n\n        if (!series?.length) {\n          return;\n        }\n\n        const hasNoData = series.every((s) => !s.length);\n        const headerActions = hasNoData ? null : [new SelectLabelAction({ label })];\n        const config = this.getAllValuesConfig(series);\n\n        body.setState(merge({}, body.state, { headerActions }, config));\n      })\n    );\n  }\n\n  getAllValuesConfig(series: DataFrame[]) {\n    const { label } = this.state;\n\n    const seriesCountStats = series[0].meta?.stats?.find((s) => s.displayName === SERIES_COUNT_STATS_NAME);\n    const seriesCount = seriesCountStats ? seriesCountStats.value : series.length;\n    const description =\n      series.length < seriesCount\n        ? `Showing only ${series.length} series out of ${seriesCount} to keep the data easy to read. Click on \"Select\" on this panel to view a breakdown of all the label's values.`\n        : '';\n\n    return {\n      title: `${label} (${seriesCount})`,\n      description,\n      fieldConfig: {\n        overrides: this.getOverrides(series),\n      },\n    };\n  }\n\n  getOverrides(series: DataFrame[]) {\n    const { startColorIndex } = this.state;\n\n    return series.map((s, i) => {\n      return {\n        matcher: { id: FieldMatcherID.byFrameRefID, options: s.refId },\n        properties: [\n          {\n            id: 'color',\n            value: { mode: 'fixed', fixedColor: getColorByIndex(startColorIndex + i) },\n          },\n        ],\n      };\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<LabelVizPanel>) => {\n    const { body } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.container}>\n        <body.Component model={body} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles() {\n  return {\n    container: css({\n      height: LABELS_VIZ_PANEL_HEIGHT,\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { DashboardCursorSync, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneReactObject,\n  sceneUtils,\n  type MultiValueVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Field, Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { syncYAxis } from 'Breakdown/MetricLabelsList/behaviors/syncYAxis';\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/config/query-resolutions';\nimport { getTimeseriesQueryRunnerParams } from 'GmdVizPanel/types/timeseries/getTimeseriesQueryRunnerParams';\nimport { getPerSecondRateUnit, getUnit } from 'GmdVizPanel/units/getUnit';\nimport { VAR_GROUP_BY } from 'shared';\nimport { LayoutSwitcher, LayoutType, type LayoutSwitcherState } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { GRID_TEMPLATE_COLUMNS, GRID_TEMPLATE_ROWS } from 'WingmanDataTrail/MetricsList/MetricsList';\nimport { SceneByVariableRepeater } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\n\nimport { LABELS_VIZ_PANEL_HEIGHT, LabelVizPanel } from './LabelVizPanel';\nimport { isCounterMetric } from '../../GmdVizPanel/matchers/isCounterMetric';\n\ninterface MetricLabelsListState extends SceneObjectState {\n  metric: string;\n  layoutSwitcher: LayoutSwitcher;\n  body: SceneByVariableRepeater;\n}\n\nexport class MetricLabelsList extends SceneObjectBase<MetricLabelsListState> {\n  constructor({ metric }: { metric: MetricLabelsListState['metric'] }) {\n    const unit = isCounterMetric(metric) ? getPerSecondRateUnit(metric) : getUnit(metric);\n\n    super({\n      key: 'metric-labels-list',\n      metric,\n      layoutSwitcher: new LayoutSwitcher({}),\n      body: new SceneByVariableRepeater({\n        variableName: VAR_GROUP_BY,\n        initialPageSize: 60,\n        pageSizeIncrement: 9,\n        body: new SceneCSSGridLayout({\n          children: [],\n          isLazy: true,\n          templateColumns: GRID_TEMPLATE_COLUMNS,\n          autoRows: LABELS_VIZ_PANEL_HEIGHT,\n          $behaviors: [\n            new behaviors.CursorSync({\n              key: 'metricCrosshairSync',\n              sync: DashboardCursorSync.Crosshair,\n            }),\n            syncYAxis(),\n          ],\n        }),\n        getLayoutLoading: () =>\n          new SceneReactObject({\n            reactNode: <Spinner inline />,\n          }),\n        getLayoutEmpty: () =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner title=\"\" severity=\"info\">\n                No labels found for the current filters and time range.\n              </InlineBanner>\n            ),\n          }),\n        getLayoutError: (error: Error) =>\n          new SceneReactObject({\n            reactNode: <InlineBanner severity=\"error\" title=\"Error while loading labels!\" error={error} />,\n          }),\n        getLayoutChild: (option, startColorIndex) => {\n          const { queries } = getTimeseriesQueryRunnerParams({\n            metric,\n            queryConfig: {\n              resolution: QUERY_RESOLUTION.MEDIUM,\n              labelMatchers: [],\n              addIgnoreUsageFilter: true,\n              groupBy: option.value as string,\n            },\n          });\n\n          return new SceneCSSGridItem({\n            body: new LabelVizPanel({\n              metric,\n              label: option.value as string,\n              query: queries[0].expr,\n              unit,\n              startColorIndex,\n            }),\n          });\n        },\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToLayoutChange();\n  }\n\n  private subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', LayoutSwitcher);\n    const body = this.state.body.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: LayoutSwitcherState, prevState?: LayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: newState.layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n        });\n      }\n    };\n\n    // We ensure the proper layout when landing on the page:\n    // because MetricLabelsList is created dynamically when LabelBreakdownScene updates its body,\n    // LayoutSwitcher is not properly connected to the URL synchronization system\n    sceneUtils.syncStateFromSearchParams(layoutSwitcher, new URLSearchParams(window.location.search));\n    onChangeState(layoutSwitcher.state);\n\n    this._subs.add(layoutSwitcher.subscribeToState(onChangeState));\n  }\n\n  public Controls({ model }: { model: MetricLabelsList }) {\n    const { layoutSwitcher } = model.useState();\n    return (\n      <Field label=\"View\">\n        <layoutSwitcher.Component model={layoutSwitcher} />\n      </Field>\n    );\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricLabelsList>) => {\n    const { body } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const variable = sceneGraph.lookupVariable(VAR_GROUP_BY, model) as MultiValueVariable;\n    const { loading, error } = variable.useState();\n\n    const batchSizes = body.useSizes();\n    const shouldDisplayShowMoreButton =\n      !loading && !error && batchSizes.total > 0 && batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      body.increaseBatchSize();\n    };\n\n    return (\n      <div data-testid=\"labels-list\">\n        <div className={styles.container}>\n          <body.Component model={body} />\n        </div>\n        {shouldDisplayShowMoreButton && (\n          <div className={styles.footer}>\n            <ShowMoreButton label=\"label\" batchSizes={batchSizes} onClick={onClickShowMore} />\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({ width: '100%' }),\n    footer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      marginTop: theme.spacing(4),\n\n      '& button': {\n        height: '40px',\n        borderRadius: '8px',\n      },\n    }),\n  };\n}\n","import { sceneGraph, SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from 'interactions';\nimport { VAR_FILTERS } from 'shared';\nimport { getTrailFor } from 'utils';\nimport { isAdHocFiltersVariable } from 'utils/utils.variables';\n\ninterface AddToFiltersGraphActionState extends SceneObjectState {\n  labelName: string;\n  labelValue: string;\n}\n\nexport class AddToFiltersGraphAction extends SceneObjectBase<AddToFiltersGraphActionState> {\n  public onClick = () => {\n    const variable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n    if (!isAdHocFiltersVariable(variable)) {\n      return;\n    }\n\n    const { labelName, labelValue } = this.state;\n\n    reportExploreMetrics('label_filter_changed', { label: labelName, action: 'added', cause: 'breakdown' });\n\n    getTrailFor(this).addFilterWithoutReportingInteraction({\n      key: labelName,\n      operator: '=',\n      value: labelValue,\n    });\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<AddToFiltersGraphAction>) => {\n    return (\n      <Button variant=\"secondary\" size=\"sm\" fill=\"outline\" onClick={model.onClick}>\n        Add to filters\n      </Button>\n    );\n  };\n}\n","import { type DataFrame } from '@grafana/data';\n\nexport function getLabelValueFromDataFrame(frame: DataFrame) {\n  const labels = frame.fields[1]?.labels || {};\n\n  const keys = Object.keys(labels);\n  if (keys.length === 0) {\n    return '<unspecified>';\n  }\n\n  return labels[keys[0]];\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Combobox, Field, IconButton, useStyles2, type ComboboxOption } from '@grafana/ui';\nimport React from 'react';\n\nimport { type SortSeriesByOption } from 'services/sorting';\n\nimport { PREF_KEYS } from '../../UserPreferences/pref-keys';\nimport { userStorage } from '../../UserPreferences/userStorage';\n\nexport interface SortBySelectorState extends SceneObjectState {\n  target: 'fields' | 'labels';\n  options: Array<ComboboxOption<SortSeriesByOption>>;\n  value: ComboboxOption<SortSeriesByOption>;\n}\n\nexport class SortBySelector extends SceneObjectBase<SortBySelectorState> {\n  static readonly DEFAULT_OPTIONS = [\n    {\n      value: 'outliers' as SortSeriesByOption,\n      label: 'Outlying series',\n      description: 'Prioritizes values that show distinct behavior from others within the same label',\n    },\n    {\n      value: 'alphabetical' as SortSeriesByOption,\n      label: 'Name [A-Z]',\n      description: 'Alphabetical order',\n    },\n    {\n      value: 'alphabetical-reversed' as SortSeriesByOption,\n      label: 'Name [Z-A]',\n      description: 'Reversed alphabetical order',\n    },\n  ];\n\n  constructor(state: Pick<SortBySelectorState, 'target'>) {\n    const sortBy = userStorage.getItem(PREF_KEYS.BREAKDOWN_SORTBY);\n\n    super({\n      key: 'breakdown-sort-by',\n      target: state.target,\n      options: SortBySelector.DEFAULT_OPTIONS,\n      value:\n        (sortBy && SortBySelector.DEFAULT_OPTIONS.find((o) => o.value === sortBy)) || SortBySelector.DEFAULT_OPTIONS[0],\n    });\n  }\n\n  private onChange = (option: ComboboxOption<SortSeriesByOption>) => {\n    this.setState({ value: option });\n    userStorage.setItem(PREF_KEYS.BREAKDOWN_SORTBY, option.value);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<SortBySelector>) => {\n    const styles = useStyles2(getStyles);\n    const { value, options } = model.useState();\n\n    return (\n      <Field\n        data-testid=\"sort-by-select\"\n        htmlFor=\"sort-by-criteria\"\n        label={\n          <div className={styles.sortByTooltip}>\n            Sort by\n            <IconButton\n              name={'info-circle'}\n              size=\"sm\"\n              variant={'secondary'}\n              tooltip=\"Sorts values using standard or smart time series calculations.\"\n            />\n          </div>\n        }\n      >\n        <Combobox\n          id=\"sort-by-criteria\"\n          placeholder=\"Choose criteria\"\n          width={20}\n          options={options}\n          value={value}\n          onChange={model.onChange}\n          isClearable={false}\n        />\n      </Field>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    sortByTooltip: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n    }),\n  };\n}\n","import { LoadingState, type DataFrame, type PanelData } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  type SceneComponentProps,\n  type SceneDataProvider,\n  type SceneLayout,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneStatelessBehavior,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { EventForceSyncYAxis } from 'Breakdown/MetricLabelsList/events/EventForceSyncYAxis';\nimport { EventResetSyncYAxis } from 'Breakdown/MetricLabelsList/events/EventResetSyncYAxis';\nimport { sortSeries, type SortSeriesByOption } from 'services/sorting';\nimport { type CountsData } from 'WingmanDataTrail/ListControls/QuickSearch/CountsProvider/CountsProvider';\nimport { QuickSearch } from 'WingmanDataTrail/ListControls/QuickSearch/QuickSearch';\n\nimport { getLabelValueFromDataFrame } from './getLabelValueFromDataFrame';\nimport { SortBySelector } from './SortBySelector';\n\n/**\n * Same idea as in our custom SceneByVariableRepeater.tsx, we create a Scene object with more capabilities than the official Scene object.\n * Specifically, we're adding:\n *\n * 1. Support for pagination\n * 2. Support for filtering and sorting (we may consider externalizing this to a separate class in the future)\n * 3. Support for $behaviors, that is used to reset the y axis sync after filtering and/or sorting\n */\ninterface SceneByFrameRepeaterState extends SceneObjectState {\n  $behaviors: Array<SceneObject | SceneStatelessBehavior>;\n  body: SceneLayout;\n  getLayoutChild(data: PanelData, frame: DataFrame, frameIndex: number): SceneObject | null;\n  getLayoutLoading?: () => SceneObject;\n  getLayoutError?: (data: PanelData) => SceneObject;\n  getLayoutEmpty?: () => SceneObject;\n  currentBatchSize: number;\n  initialPageSize: number;\n  pageSizeIncrement: number;\n  loadingLayout?: SceneObject;\n  errorLayout?: SceneObject;\n  emptyLayout?: SceneObject;\n  counts: CountsData;\n  $data?: SceneDataProvider;\n}\n\nconst DEFAULT_INITIAL_PAGE_SIZE = 120;\nconst DEFAULT_PAGE_SIZE_INCREMENT = 9;\n\nexport class SceneByFrameRepeater extends SceneObjectBase<SceneByFrameRepeaterState> {\n  private searchText = '';\n  private sortBy?: SortSeriesByOption;\n\n  public constructor({\n    $behaviors,\n    body,\n    getLayoutChild,\n    getLayoutLoading,\n    getLayoutError,\n    getLayoutEmpty,\n    initialPageSize,\n    pageSizeIncrement,\n    $data,\n  }: {\n    $behaviors: SceneByFrameRepeaterState['$behaviors'];\n    body: SceneByFrameRepeaterState['body'];\n    getLayoutChild: SceneByFrameRepeaterState['getLayoutChild'];\n    getLayoutLoading?: SceneByFrameRepeaterState['getLayoutLoading'];\n    getLayoutError?: SceneByFrameRepeaterState['getLayoutError'];\n    getLayoutEmpty?: SceneByFrameRepeaterState['getLayoutEmpty'];\n    initialPageSize?: SceneByFrameRepeaterState['initialPageSize'];\n    pageSizeIncrement?: SceneByFrameRepeaterState['pageSizeIncrement'];\n    $data?: SceneByFrameRepeaterState['$data'];\n  }) {\n    super({\n      key: 'breakdown-by-frame-repeater',\n      $behaviors,\n      body,\n      getLayoutChild,\n      getLayoutLoading,\n      getLayoutError,\n      getLayoutEmpty,\n      currentBatchSize: 0,\n      initialPageSize: initialPageSize || DEFAULT_INITIAL_PAGE_SIZE,\n      pageSizeIncrement: pageSizeIncrement || DEFAULT_PAGE_SIZE_INCREMENT,\n      loadingLayout: undefined,\n      errorLayout: undefined,\n      emptyLayout: undefined,\n      counts: { current: 0, total: 0 },\n      $data,\n    });\n\n    this.addActivationHandler(() => {\n      const dataProvider = sceneGraph.getData(this);\n      if (!dataProvider) {\n        throw new Error('No data provider found!');\n      }\n\n      this.initFilterAndSort();\n\n      this._subs.add(\n        dataProvider.subscribeToState((newState) => {\n          if (newState.data) {\n            this.performRepeat(newState.data);\n          }\n        })\n      );\n\n      if (dataProvider.state.data) {\n        this.performRepeat(dataProvider.state.data);\n      }\n    });\n  }\n\n  private performRepeat(data: PanelData) {\n    if (data.state === LoadingState.Loading) {\n      this.setState({\n        loadingLayout: this.state.getLayoutLoading?.(),\n        errorLayout: undefined,\n        emptyLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    if (data.state === LoadingState.Error) {\n      this.setState({\n        errorLayout: this.state.getLayoutError?.(data),\n        loadingLayout: undefined,\n        emptyLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    const filteredSeries = this.filterAndSort(data.series);\n\n    if (!filteredSeries.length) {\n      this.setState({\n        emptyLayout: this.state.getLayoutEmpty?.(),\n        errorLayout: undefined,\n        loadingLayout: undefined,\n        currentBatchSize: 0,\n        counts: { current: 0, total: data.series.length },\n      });\n      return;\n    }\n\n    this.setState({\n      loadingLayout: undefined,\n      errorLayout: undefined,\n      emptyLayout: undefined,\n      currentBatchSize: this.state.initialPageSize,\n      counts: { current: filteredSeries.length, total: data.series.length },\n    });\n\n    const newChildren: SceneObject[] = filteredSeries\n      .slice(0, this.state.initialPageSize)\n      .map((s, i) => this.state.getLayoutChild(data, s, i))\n      .filter(Boolean) as SceneObject[];\n\n    this.state.body.setState({ children: newChildren });\n  }\n\n  private initFilterAndSort() {\n    this.searchText = sceneGraph.findByKeyAndType(this, 'quick-search', QuickSearch).state.value;\n    this.sortBy = sceneGraph.findByKeyAndType(this, 'breakdown-sort-by', SortBySelector).state.value.value;\n  }\n\n  private filterAndSort(series: PanelData['series']) {\n    let filteredSeries: DataFrame[] = [];\n\n    if (!this.searchText) {\n      filteredSeries = series;\n    } else {\n      const regexes = this.searchText\n        .split(',')\n        .map((p) => p.trim())\n        .filter(Boolean)\n        .map((r) => {\n          try {\n            return new RegExp(r);\n          } catch {\n            return null;\n          }\n        })\n        .filter(Boolean) as RegExp[];\n\n      for (let i = 0; i < series.length; i += 1) {\n        const s = series[i];\n\n        if (regexes.some((regex) => regex.test(getLabelValueFromDataFrame(s)))) {\n          filteredSeries.push(s);\n        }\n      }\n    }\n\n    if (this.sortBy) {\n      filteredSeries = sortSeries(filteredSeries, this.sortBy);\n    }\n\n    return filteredSeries;\n  }\n\n  public filter(searchText: string) {\n    this.searchText = searchText;\n\n    const { data } = sceneGraph.getData(this).state;\n    if (data) {\n      this.publishEvent(new EventResetSyncYAxis({}), true);\n      this.performRepeat(data);\n    }\n  }\n\n  public sort(sortBy: SortSeriesByOption) {\n    this.sortBy = sortBy;\n\n    const { data } = sceneGraph.getData(this).state;\n    if (data) {\n      this.publishEvent(new EventResetSyncYAxis({}), true);\n      this.performRepeat(data);\n    }\n  }\n\n  public increaseBatchSize() {\n    const { data } = sceneGraph.getData(this).state;\n    if (!data) {\n      return;\n    }\n\n    const newBatchSize = this.state.currentBatchSize + this.state.pageSizeIncrement;\n\n    const newChildren: SceneObject[] = this.filterAndSort(data.series)\n      .slice(this.state.currentBatchSize, newBatchSize)\n      .map((s, i) => this.state.getLayoutChild(data, s, i))\n      .filter(Boolean) as SceneObject[];\n\n    this.state.body.setState({\n      children: [...this.state.body.state.children, ...newChildren],\n    });\n\n    this.setState({\n      currentBatchSize: newBatchSize,\n    });\n\n    this.publishEvent(new EventForceSyncYAxis({}), true);\n  }\n\n  public useSizes() {\n    const { currentBatchSize, pageSizeIncrement } = this.useState();\n    const { data } = sceneGraph.getData(this).state;\n    const total = data ? this.filterAndSort(data.series).length : 0;\n    const remaining = total - currentBatchSize;\n    const increment = remaining < pageSizeIncrement ? remaining : pageSizeIncrement;\n\n    return {\n      increment,\n      current: currentBatchSize,\n      total,\n    };\n  }\n\n  public getCounts() {\n    const { data } = sceneGraph.getData(this).state;\n    return {\n      current: 0,\n      total: data ? data.series.length : 0,\n    };\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<SceneByFrameRepeater>) => {\n    const { body, loadingLayout, errorLayout, emptyLayout } = model.useState();\n\n    if (loadingLayout) {\n      return <loadingLayout.Component model={loadingLayout} />;\n    }\n\n    if (errorLayout) {\n      return <errorLayout.Component model={errorLayout} />;\n    }\n\n    if (emptyLayout) {\n      return <emptyLayout.Component model={emptyLayout} />;\n    }\n\n    return <body.Component model={body} />;\n  };\n}\n","import { sceneGraph } from '@grafana/scenes';\n\nimport { CountsProvider } from 'WingmanDataTrail/ListControls/QuickSearch/CountsProvider/CountsProvider';\n\nimport { SceneByFrameRepeater } from './SceneByFrameRepeater';\n\nexport class LabelValuesCountsProvider extends CountsProvider {\n  constructor() {\n    super({ key: 'LabelValuesCountsProvider' });\n\n    this.addActivationHandler(() => {\n      const byFrameRepeater = sceneGraph.findByKeyAndType(this, 'breakdown-by-frame-repeater', SceneByFrameRepeater);\n\n      byFrameRepeater.subscribeToState((newState, prevState) => {\n        if (newState.counts !== prevState.counts) {\n          this.setState({ counts: newState.counts });\n        }\n      });\n    });\n  }\n}\n","import {\n  PanelBuilders,\n  SceneObjectBase,\n  type SceneComponentProps,\n  type SceneDataNode,\n  type SceneObjectState,\n  type VizPanel,\n  type VizPanelState,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { PANEL_HEIGHT } from 'GmdVizPanel/config/panel-heights';\nimport { type PanelMenu } from 'Menu/PanelMenu';\n\nimport { publishTimeseriesData } from '../MetricLabelsList/behaviors/publishTimeseriesData';\n\ninterface LabelValueVizPanelState extends SceneObjectState {\n  labelValue: string;\n  unit: string;\n  fixedColor: string;\n  body: VizPanel;\n}\n\nexport const LABEL_VALUE_VIZ_PANEL_HEIGHT = PANEL_HEIGHT.M;\n\nexport class LabelValueVizPanel extends SceneObjectBase<LabelValueVizPanelState> {\n  constructor({\n    labelValue,\n    data,\n    unit,\n    fixedColor,\n    headerActions,\n    menu,\n  }: {\n    labelValue: LabelValueVizPanelState['labelValue'];\n    data: SceneDataNode;\n    unit: LabelValueVizPanelState['unit'];\n    fixedColor: LabelValueVizPanelState['fixedColor'];\n    headerActions: VizPanelState['headerActions'];\n    menu: PanelMenu;\n  }) {\n    super({\n      key: `label-value-viz-panel-${labelValue}`,\n      labelValue,\n      unit,\n      fixedColor,\n      body: LabelValueVizPanel.buildVizPanel({\n        labelValue,\n        data,\n        unit,\n        fixedColor,\n        headerActions,\n        menu,\n      }),\n    });\n  }\n\n  private static buildVizPanel({\n    labelValue,\n    data,\n    unit,\n    fixedColor,\n    headerActions,\n    menu,\n  }: {\n    labelValue: LabelValueVizPanelState['labelValue'];\n    data: SceneDataNode;\n    unit: LabelValueVizPanelState['unit'];\n    fixedColor: LabelValueVizPanelState['fixedColor'];\n    headerActions: VizPanelState['headerActions'];\n    menu: PanelMenu;\n  }) {\n    return PanelBuilders.timeseries()\n      .setTitle(labelValue)\n      .setBehaviors([publishTimeseriesData()]) // publishTimeseriesData is required for the syncYAxis behavior\n      .setData(data)\n      .setUnit(unit)\n      .setColor({ mode: 'fixed', fixedColor })\n      .setCustomFieldConfig('fillOpacity', 9)\n      .setHeaderActions(headerActions)\n      .setOption('legend', { showLegend: false })\n      .setShowMenuAlways(true)\n      .setMenu(menu)\n      .build();\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<LabelValueVizPanel>) => {\n    const { body } = model.useState();\n    return <body.Component model={body} />;\n  };\n}\n","import { css } from '@emotion/css';\nimport { DashboardCursorSync, LoadingState, type DataFrame, type GrafanaTheme2, type PanelData } from '@grafana/data';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneDataNode,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneQueryRunner,\n  SceneReactObject,\n  sceneUtils,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Field, Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { syncYAxis } from 'Breakdown/MetricLabelsList/behaviors/syncYAxis';\nimport { addUnspecifiedLabel } from 'Breakdown/MetricLabelsList/transformations/addUnspecifiedLabel';\nimport { PANEL_HEIGHT } from 'GmdVizPanel/config/panel-heights';\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/config/query-resolutions';\nimport { GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { getTimeseriesQueryRunnerParams } from 'GmdVizPanel/types/timeseries/getTimeseriesQueryRunnerParams';\nimport { getPerSecondRateUnit, getUnit } from 'GmdVizPanel/units/getUnit';\nimport { PanelMenu } from 'Menu/PanelMenu';\nimport { trailDS } from 'shared';\nimport { getColorByIndex } from 'utils';\nimport { LayoutSwitcher, LayoutType, type LayoutSwitcherState } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { EventQuickSearchChanged } from 'WingmanDataTrail/ListControls/QuickSearch/EventQuickSearchChanged';\nimport { QuickSearch } from 'WingmanDataTrail/ListControls/QuickSearch/QuickSearch';\nimport { GRID_TEMPLATE_COLUMNS, GRID_TEMPLATE_ROWS } from 'WingmanDataTrail/MetricsList/MetricsList';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\n\nimport { AddToFiltersGraphAction } from './AddToFiltersGraphAction';\nimport { getLabelValueFromDataFrame } from './getLabelValueFromDataFrame';\nimport { LabelValuesCountsProvider } from './LabelValuesCountProvider';\nimport { LABEL_VALUE_VIZ_PANEL_HEIGHT, LabelValueVizPanel } from './LabelValueVizPanel';\nimport { SceneByFrameRepeater } from './SceneByFrameRepeater';\nimport { SortBySelector, type SortBySelectorState } from './SortBySelector';\n\ninterface MetricLabelsValuesListState extends SceneObjectState {\n  metric: string;\n  label: string;\n  layoutSwitcher: LayoutSwitcher;\n  quickSearch: QuickSearch;\n  sortBySelector: SortBySelector;\n  body?: SceneByFrameRepeater | GmdVizPanel;\n}\n\nexport class MetricLabelValuesList extends SceneObjectBase<MetricLabelsValuesListState> {\n  constructor({\n    metric,\n    label,\n  }: {\n    metric: MetricLabelsValuesListState['metric'];\n    label: MetricLabelsValuesListState['label'];\n  }) {\n    super({\n      key: 'metric-label-values-list',\n      metric,\n      label,\n      layoutSwitcher: new LayoutSwitcher({\n        urlSearchParamName: 'breakdownLayout',\n        options: [\n          { label: 'Single', value: LayoutType.SINGLE },\n          { label: 'Grid', value: LayoutType.GRID },\n          { label: 'Rows', value: LayoutType.ROWS },\n        ],\n      }),\n      quickSearch: new QuickSearch({\n        urlSearchParamName: 'breakdownSearchText',\n        targetName: 'label value',\n        countsProvider: new LabelValuesCountsProvider(),\n        displayCounts: true,\n      }),\n      sortBySelector: new SortBySelector({ target: 'labels' }),\n      body: undefined,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToLayoutChange();\n  }\n\n  private subscribeToQuickSearchChange() {\n    // We ensure the proper quick search value when landing on the page:\n    // because MetricLabelValuesList is created dynamically when LabelBreakdownScene updates its body,\n    // QuickSearch is not properly connected to the URL synchronization system\n    sceneUtils.syncStateFromSearchParams(this.state.quickSearch, new URLSearchParams(window.location.search));\n\n    this._subs.add(\n      this.subscribeToEvent(EventQuickSearchChanged, (event) => {\n        const byFrameRepeater = sceneGraph.findDescendents(this, SceneByFrameRepeater)[0];\n        if (byFrameRepeater) {\n          byFrameRepeater.filter(event.payload.searchText);\n        }\n      })\n    );\n  }\n\n  private subscribeToSortByChange() {\n    const { sortBySelector } = this.state;\n\n    this._subs.add(\n      sortBySelector.subscribeToState((newState: SortBySelectorState, prevState?: SortBySelectorState) => {\n        if (newState.value.value !== prevState?.value.value) {\n          const byFrameRepeater = sceneGraph.findDescendents(this, SceneByFrameRepeater)[0];\n          if (byFrameRepeater) {\n            byFrameRepeater.sort(newState.value.value);\n          }\n        }\n      })\n    );\n  }\n\n  private subscribeToLayoutChange() {\n    const { layoutSwitcher } = this.state;\n\n    // We ensure the proper layout when landing on the page:\n    // because MetricLabelValuesList is created dynamically when LabelBreakdownScene updates its body,\n    // LayoutSwitcher is not properly connected to the URL synchronization system\n    sceneUtils.syncStateFromSearchParams(layoutSwitcher, new URLSearchParams(window.location.search));\n\n    const onChangeState = (newState: LayoutSwitcherState, prevState?: LayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        this.updateBody(newState.layout);\n      }\n    };\n\n    onChangeState(layoutSwitcher.state);\n\n    this._subs.add(layoutSwitcher.subscribeToState(onChangeState));\n  }\n\n  private updateBody(layout: LayoutType) {\n    if (layout === LayoutType.SINGLE) {\n      this.setState({ body: this.buildSinglePanel() });\n      return;\n    }\n\n    const existingByFrameRepeater = sceneGraph.findDescendents(this, SceneByFrameRepeater)[0];\n    const byFrameRepeater = existingByFrameRepeater || this.buildByFrameRepeater();\n\n    (byFrameRepeater.state.body as SceneCSSGridLayout).setState({\n      templateColumns: layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n    });\n\n    this.setState({ body: byFrameRepeater });\n\n    if (!existingByFrameRepeater) {\n      // we have to re-subscribe every time we build a new SceneByFrameRepeater instance because these controls (QuickSerach and SortBy) are not rendered when switching to the \"Single\" layout\n      this.subscribeToQuickSearchChange();\n      this.subscribeToSortByChange();\n    }\n  }\n\n  private buildSinglePanel() {\n    const { metric, label } = this.state;\n\n    return new GmdVizPanel({\n      metric,\n      discardUserPrefs: true,\n      panelOptions: {\n        type: 'timeseries',\n        height: PANEL_HEIGHT.XL,\n        headerActions: () => [],\n      },\n      queryOptions: {\n        groupBy: label,\n      },\n    });\n  }\n\n  private buildByFrameRepeater() {\n    const { metric, label } = this.state;\n    const queryParams = getTimeseriesQueryRunnerParams({\n      metric,\n      queryConfig: {\n        resolution: QUERY_RESOLUTION.MEDIUM,\n        labelMatchers: [],\n        addIgnoreUsageFilter: true,\n        groupBy: label,\n      },\n    });\n    const unit = queryParams.isRateQuery ? getPerSecondRateUnit(metric) : getUnit(metric);\n\n    return new SceneByFrameRepeater({\n      $data: new SceneDataTransformer({\n        $data: new SceneQueryRunner({\n          datasource: trailDS,\n          maxDataPoints: queryParams.maxDataPoints,\n          queries: queryParams.queries,\n        }),\n        transformations: [addUnspecifiedLabel(label)],\n      }),\n      // we set the syncYAxis behavior here to ensure that the EventResetSyncYAxis events that are published by SceneByFrameRepeater can be received\n      $behaviors: [\n        syncYAxis(),\n        new behaviors.CursorSync({\n          key: 'metricCrosshairSync',\n          sync: DashboardCursorSync.Crosshair,\n        }),\n      ],\n      body: new SceneCSSGridLayout({\n        children: [],\n        isLazy: true,\n        templateColumns: GRID_TEMPLATE_COLUMNS,\n        autoRows: LABEL_VALUE_VIZ_PANEL_HEIGHT,\n      }),\n      getLayoutLoading: () =>\n        new SceneReactObject({\n          reactNode: <Spinner inline />,\n        }),\n      getLayoutEmpty: () =>\n        new SceneReactObject({\n          reactNode: (\n            <InlineBanner title=\"\" severity=\"info\">\n              No label values found for the current filters and time range.\n            </InlineBanner>\n          ),\n        }),\n      getLayoutError: (data: PanelData) =>\n        new SceneReactObject({\n          reactNode: (\n            <InlineBanner severity=\"error\" title=\"Error while loading metrics!\" error={data.errors![0] as Error} />\n          ),\n        }),\n      getLayoutChild: (data: PanelData, frame: DataFrame, frameIndex: number) => {\n        // hide frames that have less than 2 points\n        if (frame.length < 2) {\n          return null;\n        }\n\n        const labelValue = getLabelValueFromDataFrame(frame);\n        const canAddToFilters = !labelValue.startsWith('<unspecified'); // see the \"addUnspecifiedLabel\" data transformation\n        const headerActions = canAddToFilters ? [new AddToFiltersGraphAction({ labelName: label, labelValue })] : [];\n\n        const vizPanel = new LabelValueVizPanel({\n          labelValue,\n          data: new SceneDataNode({ data: { ...data, series: [frame] } }),\n          unit,\n          fixedColor: getColorByIndex(frameIndex),\n          headerActions,\n          menu: new PanelMenu({ labelName: labelValue }),\n        });\n\n        return new SceneCSSGridItem({ body: vizPanel });\n      },\n    });\n  }\n\n  public Controls({ model }: { model: MetricLabelValuesList }) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n    const { body, quickSearch, layoutSwitcher, sortBySelector } = model.useState();\n\n    return (\n      <>\n        {body instanceof SceneByFrameRepeater && (\n          <>\n            <Field className={styles.quickSearchField} label=\"Search\">\n              <quickSearch.Component model={quickSearch} />\n            </Field>\n            <sortBySelector.Component model={sortBySelector} />\n          </>\n        )}\n        <Field label=\"View\">\n          <layoutSwitcher.Component model={layoutSwitcher} />\n        </Field>\n      </>\n    );\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricLabelValuesList>) => {\n    const { body } = model.useState();\n\n    return (\n      <>\n        {body instanceof GmdVizPanel && <MetricLabelValuesList.SingleMetricPanelComponent model={model} />}\n        {body instanceof SceneByFrameRepeater && <MetricLabelValuesList.ByFrameRepeaterComponent model={model} />}\n      </>\n    );\n  };\n\n  private static readonly SingleMetricPanelComponent = ({ model }: SceneComponentProps<MetricLabelValuesList>) => {\n    const styles = useStyles2(getStyles);\n    const { body } = model.useState();\n\n    return (\n      <div data-testid=\"single-metric-panel\">\n        <div className={styles.singlePanelContainer}>\n          {body instanceof GmdVizPanel && <body.Component model={body} />}\n        </div>\n      </div>\n    );\n  };\n\n  private static readonly ByFrameRepeaterComponent = ({ model }: SceneComponentProps<MetricLabelValuesList>) => {\n    const styles = useStyles2(getStyles);\n    const { body } = model.useState();\n\n    const dataProvider = sceneGraph.getData(model);\n    const { state, errors } = dataProvider.useState().data || {};\n\n    const byFrameRepeater = body as SceneByFrameRepeater;\n\n    const batchSizes = byFrameRepeater.useSizes();\n    const shouldDisplayShowMoreButton =\n      state !== LoadingState.Loading &&\n      !errors?.length &&\n      batchSizes.total > 0 &&\n      batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      byFrameRepeater.increaseBatchSize();\n    };\n\n    return (\n      <div data-testid=\"label-values-list\">\n        <div className={styles.listContainer}>\n          {body instanceof SceneByFrameRepeater && <body.Component model={body} />}\n        </div>\n        {shouldDisplayShowMoreButton && (\n          <div className={styles.listFooter}>\n            <ShowMoreButton label=\"label value\" batchSizes={batchSizes} onClick={onClickShowMore} />\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    singlePanelContainer: css({\n      width: '100%',\n      height: '300px',\n    }),\n    listContainer: css({ width: '100%' }),\n    listFooter: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      marginTop: theme.spacing(4),\n\n      '& button': {\n        height: '40px',\n        borderRadius: '8px',\n      },\n    }),\n    quickSearchField: css({\n      flexGrow: 1,\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  type QueryVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Field, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { RefreshMetricsEvent, VAR_GROUP_BY } from '../shared';\nimport { isQueryVariable } from '../utils/utils.variables';\nimport { MetricLabelsList } from './MetricLabelsList/MetricLabelsList';\nimport { MetricLabelValuesList } from './MetricLabelValuesList/MetricLabelValuesList';\n\ninterface LabelBreakdownSceneState extends SceneObjectState {\n  metric: string;\n  body?: MetricLabelsList | MetricLabelValuesList;\n}\n\nexport class LabelBreakdownScene extends SceneObjectBase<LabelBreakdownSceneState> {\n  constructor({ metric }: { metric: LabelBreakdownSceneState['metric'] }) {\n    super({\n      metric,\n      body: undefined,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const groupByVariable = this.getVariable();\n\n    groupByVariable.subscribeToState((newState, oldState) => {\n      if (newState.value !== oldState.value) {\n        this.updateBody(groupByVariable);\n      }\n    });\n\n    if (config.featureToggles.enableScopesInMetricsExplore) {\n      this._subs.add(\n        this.subscribeToEvent(RefreshMetricsEvent, () => {\n          this.updateBody(groupByVariable);\n        })\n      );\n    }\n\n    this.updateBody(groupByVariable);\n  }\n\n  private getVariable(): QueryVariable {\n    const groupByVariable = sceneGraph.lookupVariable(VAR_GROUP_BY, this)!;\n    if (!isQueryVariable(groupByVariable)) {\n      throw new Error('Group by variable not found');\n    }\n    return groupByVariable;\n  }\n\n  private updateBody(groupByVariable: QueryVariable) {\n    const { metric } = this.state;\n\n    this.setState({\n      body: groupByVariable.hasAllValue()\n        ? new MetricLabelsList({ metric })\n        : new MetricLabelValuesList({ metric, label: groupByVariable.state.value as string }),\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<LabelBreakdownScene>) => {\n    const styles = useStyles2(getStyles);\n    const { body } = model.useState();\n    const groupByVariable = model.getVariable();\n\n    return (\n      <div className={styles.container}>\n        <div className={styles.controls}>\n          <Field label=\"By label\">\n            <groupByVariable.Component model={groupByVariable} />\n          </Field>\n          {body instanceof MetricLabelsList && <body.Controls model={body} />}\n          {body instanceof MetricLabelValuesList && <body.Controls model={body} />}\n        </div>\n        <div data-testid=\"panels-list\">\n          {body instanceof MetricLabelsList && <body.Component model={body} />}\n          {body instanceof MetricLabelValuesList && <body.Component model={body} />}\n        </div>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n      paddingTop: theme.spacing(1),\n    }),\n    controls: css({\n      flexGrow: 0,\n      display: 'flex',\n      gap: theme.spacing(2),\n      height: '70px',\n      justifyContent: 'space-between',\n      alignItems: 'end',\n    }),\n    searchField: css({\n      flexGrow: 1,\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  getExploreURL,\n  sceneGraph,\n  SceneObjectBase,\n  SceneQueryRunner,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Box, Icon, LinkButton, Stack, Tab, TabsBar, ToolbarButton, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { UI_TEXT } from 'constants/ui';\nimport { createAppUrl } from 'extensions/links';\nimport { GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { reportExploreMetrics } from 'interactions';\nimport { TOPVIEW_KEY } from 'MetricGraphScene';\nimport { MetricScene } from 'MetricScene';\nimport { RelatedMetricsScene } from 'RelatedMetricsScene/RelatedMetricsScene';\nimport { MetricSelectedEvent } from 'shared';\nimport { ShareTrailButton } from 'ShareTrailButton';\nimport { useBookmarkState } from 'TrailStore/useBookmarkState';\nimport { getTrailFor, getUrlForTrail } from 'utils';\n\nimport { LabelBreakdownScene } from './Breakdown/LabelBreakdownScene';\n\nexport const actionViews = {\n  breakdown: 'breakdown',\n  related: 'related',\n  relatedLogs: 'logs',\n} as const;\n\nexport type ActionViewType = (typeof actionViews)[keyof typeof actionViews];\n\ninterface ActionViewDefinition {\n  displayName: string;\n  value: ActionViewType;\n  description?: string;\n  getScene: (metricScene: MetricScene) => SceneObject<SceneObjectState>;\n}\n\nexport const actionViewsDefinitions: ActionViewDefinition[] = [\n  {\n    displayName: 'Breakdown',\n    value: actionViews.breakdown,\n    getScene: (metricScene: MetricScene) => new LabelBreakdownScene({ metric: metricScene.state.metric }),\n  },\n  {\n    displayName: 'Related metrics',\n    value: actionViews.related,\n    getScene: (metricScene: MetricScene) => new RelatedMetricsScene({ metric: metricScene.state.metric }),\n    description: 'Relevant metrics based on current label filters',\n  },\n  {\n    displayName: 'Related logs',\n    value: actionViews.relatedLogs,\n    getScene: (metricScene: MetricScene) => metricScene.createRelatedLogsScene(),\n    description: 'Relevant logs based on current label filters and time range',\n  },\n];\n\ninterface MetricActionBarState extends SceneObjectState {}\n\nexport class MetricActionBar extends SceneObjectBase<MetricActionBarState> {\n  public getLinkToExplore = async () => {\n    const topView = sceneGraph.findByKey(this, TOPVIEW_KEY);\n    const vizPanel = sceneGraph.findDescendents(topView, GmdVizPanel)[0];\n    const queryRunner = sceneGraph.findDescendents(vizPanel, SceneQueryRunner)[0];\n    const panelData = queryRunner.state.data;\n\n    if (!panelData) {\n      throw new Error('Cannot get link to explore, no panel data found');\n    }\n\n    const metricScene = sceneGraph.getAncestor(this, MetricScene);\n    return getExploreURL(panelData, metricScene, panelData.timeRange);\n  };\n\n  public openExploreLink = async () => {\n    reportExploreMetrics('selected_metric_action_clicked', { action: 'open_in_explore' });\n    this.getLinkToExplore().then((link) => {\n      // We use window.open instead of a Link or <a> because we want to compute the explore link when clicking,\n      // if we precompute it we have to keep track of a lot of dependencies\n      window.open(link, '_blank');\n    });\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricActionBar>) => {\n    const metricScene = sceneGraph.getAncestor(model, MetricScene);\n    const styles = useStyles2(getStyles);\n    const trail = getTrailFor(model);\n    const [isBookmarked, toggleBookmark] = useBookmarkState(trail);\n    const { actionView } = metricScene.useState();\n\n    return (\n      <Box paddingY={1} data-testid=\"action-bar\">\n        <div className={styles.actions}>\n          <Stack gap={1}>\n            {trail.state.embedded ? (\n              <LinkButton\n                href={createAppUrl(getUrlForTrail(trail))}\n                variant={'secondary'}\n                icon=\"arrow-right\"\n                tooltip=\"Open in Metrics Drilldown\"\n                onClick={() => reportExploreMetrics('selected_metric_action_clicked', { action: 'open_from_embedded' })}\n              >\n                Metrics Drilldown\n              </LinkButton>\n            ) : (\n              <ToolbarButton\n                variant={'canvas'}\n                tooltip={UI_TEXT.METRIC_SELECT_SCENE.SELECT_NEW_METRIC_TOOLTIP}\n                onClick={() => {\n                  reportExploreMetrics('selected_metric_action_clicked', { action: 'unselect' });\n                  trail.publishEvent(new MetricSelectedEvent(undefined));\n                }}\n              >\n                Select new metric\n              </ToolbarButton>\n            )}\n            <ToolbarButton\n              variant={'canvas'}\n              icon=\"compass\"\n              tooltip={UI_TEXT.METRIC_SELECT_SCENE.OPEN_EXPLORE_LABEL}\n              onClick={model.openExploreLink}\n            />\n            <ShareTrailButton trail={trail} />\n            <ToolbarButton\n              variant={'canvas'}\n              icon={\n                isBookmarked ? (\n                  <Icon name={'favorite'} type={'mono'} size={'lg'} />\n                ) : (\n                  <Icon name={'star'} type={'default'} size={'lg'} />\n                )\n              }\n              tooltip={UI_TEXT.METRIC_SELECT_SCENE.BOOKMARK_LABEL}\n              onClick={toggleBookmark}\n            />\n          </Stack>\n        </div>\n\n        <TabsBar className={styles.customTabsBar}>\n          {actionViewsDefinitions.map((tab, index) => {\n            const label = tab.displayName;\n            const counter = tab.value === actionViews.relatedLogs ? metricScene.state.relatedLogsCount : undefined;\n            const isActive = actionView === tab.value;\n\n            const tabRender = (\n              <Tab\n                key={index}\n                label={label}\n                counter={counter}\n                active={isActive}\n                onChangeTab={() => {\n                  if (isActive) {\n                    return;\n                  }\n\n                  reportExploreMetrics('metric_action_view_changed', {\n                    view: tab.value,\n                    related_logs_count: metricScene.relatedLogsOrchestrator.checkConditionsMetForRelatedLogs()\n                      ? counter\n                      : undefined,\n                  });\n\n                  metricScene.setActionView(tab.value);\n                }}\n              />\n            );\n\n            if (tab.description) {\n              return (\n                <Tooltip key={index} content={tab.description} placement=\"top\" theme=\"info\">\n                  {tabRender}\n                </Tooltip>\n              );\n            }\n            return tabRender;\n          })}\n        </TabsBar>\n      </Box>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    actions: css({\n      [theme.breakpoints.up(theme.breakpoints.values.md)]: {\n        position: 'absolute',\n        right: 0,\n        top: 16,\n        zIndex: 2,\n      },\n    }),\n    customTabsBar: css({\n      paddingBottom: theme.spacing(1),\n    }),\n  };\n}\n","import { SceneObjectStateChangedEvent } from '@grafana/scenes';\nimport { useEffect, useState } from 'react';\n\nimport { type DataTrail } from '../DataTrail';\nimport { reportExploreMetrics } from '../interactions';\nimport { getTrailStore } from './TrailStore';\n\nexport function useBookmarkState(trail: DataTrail) {\n  // Note that trail object may stay the same, but the state used by `getBookmarkIndex` result may\n  // differ for each re-render of this hook\n  const getBookmarkIndex = () => getTrailStore().getBookmarkIndex(trail);\n\n  const indexOnRender = getBookmarkIndex();\n\n  const [bookmarkIndex, setBookmarkIndex] = useState(indexOnRender);\n\n  useEffect(() => {\n    const sub = trail.subscribeToEvent(SceneObjectStateChangedEvent, () => {\n      setBookmarkIndex(getTrailStore().getBookmarkIndex(trail));\n    });\n    return () => sub.unsubscribe();\n  }, [trail]);\n\n  // Check if index changed and force a re-render\n  if (indexOnRender !== bookmarkIndex) {\n    setBookmarkIndex(indexOnRender);\n  }\n\n  const isBookmarked = bookmarkIndex != null;\n\n  const toggleBookmark = () => {\n    reportExploreMetrics('bookmark_changed', { action: isBookmarked ? 'toggled_off' : 'toggled_on' });\n    if (isBookmarked) {\n      let indexToRemove = getBookmarkIndex();\n      while (indexToRemove != null) {\n        // This loop will remove all indices that have an equivalent bookmark key\n        getTrailStore().removeBookmark(indexToRemove);\n        indexToRemove = getBookmarkIndex();\n      }\n    } else {\n      getTrailStore().addBookmark(trail);\n    }\n    setBookmarkIndex(getBookmarkIndex());\n  };\n\n  const result: [typeof isBookmarked, typeof toggleBookmark] = [isBookmarked, toggleBookmark];\n  return result;\n}\n","import { type AdHocVariableFilter, type TimeRange } from '@grafana/data';\nimport { getDataSourceSrv } from '@grafana/runtime';\nimport { sceneGraph, type SceneObject } from '@grafana/scenes';\n\nimport { createMetricsLogsConnector, type FoundLokiDataSource } from './base';\nimport { VAR_FILTERS } from '../../shared';\nimport { getTrailFor } from '../../utils';\nimport { getDataSourceFetcher } from '../../utils/utils.datasource';\nimport { isAdHocFiltersVariable } from '../../utils/utils.variables';\n\nconst knownLabelNameDiscrepancies = {\n  job: 'service_name', // `service.name` is `job` in Mimir and `service_name` in Loki\n  instance: 'service_instance_id', // `service.instance.id` is `instance` in Mimir and `service_instance_id` in Loki\n} as const;\n\nfunction isLabelNameThatShouldBeReplaced(x: string): x is keyof typeof knownLabelNameDiscrepancies {\n  return x in knownLabelNameDiscrepancies;\n}\n\nfunction replaceKnownLabelNames(labelName: string): string {\n  if (isLabelNameThatShouldBeReplaced(labelName)) {\n    return knownLabelNameDiscrepancies[labelName];\n  }\n\n  return labelName;\n}\n\n/**\n * Checks if a Loki data source has labels matching the current filters\n */\nasync function hasMatchingLabels(datasourceUid: string, filters: AdHocVariableFilter[], timeRange?: TimeRange) {\n  const ds = await getDataSourceSrv().get(datasourceUid);\n\n  // Get all available label keys for this data source\n  const labelKeys = await ds.getTagKeys?.({\n    timeRange,\n    filters: filters.map(({ key, operator, value }) => ({\n      key: replaceKnownLabelNames(key),\n      operator,\n      value,\n    })),\n  });\n\n  if (!Array.isArray(labelKeys)) {\n    return false;\n  }\n\n  const availableLabels = new Set(labelKeys.map((key) => key.text));\n\n  // Early return if none of our filter labels exist in this data source\n  const mappedFilterLabels = filters.map((f) => replaceKnownLabelNames(f.key));\n  const hasRequiredLabels = mappedFilterLabels.every((label) => availableLabels.has(label));\n  if (!hasRequiredLabels) {\n    return false;\n  }\n\n  // Check if each filter's value exists for its label\n  const results = await Promise.all(\n    filters.map(async (filter) => {\n      const lokiLabelName = replaceKnownLabelNames(filter.key);\n      const values = await ds.getTagValues?.({\n        key: lokiLabelName,\n        timeRange,\n        filters,\n      });\n\n      if (!Array.isArray(values)) {\n        return false;\n      }\n\n      return values.some((v) => v.text === filter.value);\n    })\n  );\n\n  // If any of the filters have no matching values, return false\n  return results.every(Boolean);\n}\n\nexport const createLabelsCrossReferenceConnector = (scene: SceneObject) => {\n  // In this connector, conditions have been met for related logs when label filters have been applied\n  let conditionsMetForRelatedLogs = false;\n\n  return createMetricsLogsConnector({\n    name: 'labelsCrossReference',\n    checkConditionsMetForRelatedLogs: () => conditionsMetForRelatedLogs,\n    async getDataSources(): Promise<FoundLokiDataSource[]> {\n      const trail = getTrailFor(scene);\n      const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, trail);\n\n      if (!isAdHocFiltersVariable(filtersVariable) || !filtersVariable.state.filters.length) {\n        conditionsMetForRelatedLogs = false;\n        return [];\n      }\n\n      conditionsMetForRelatedLogs = true;\n      const filters = filtersVariable.state.filters.map(({ key, operator, value }) => ({ key, operator, value }));\n\n      // Get current time range if available\n      const timeRange = scene.state.$timeRange?.state.value;\n\n      const lokiDataSources = await getDataSourceFetcher().getHealthyDataSources('loki');\n      const results = await Promise.all(\n        lokiDataSources.map(async ({ uid, name }) => {\n          const hasLabels = await hasMatchingLabels(uid, filters, timeRange);\n          return hasLabels ? { uid, name } : null;\n        })\n      );\n\n      return results.filter((ds): ds is FoundLokiDataSource => ds !== null);\n    },\n    getLokiQueryExpr(): string {\n      const trail = getTrailFor(scene);\n      const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, trail);\n\n      if (!isAdHocFiltersVariable(filtersVariable) || !filtersVariable.state.filters.length) {\n        return '';\n      }\n\n      const labelValuePairs = filtersVariable.state.filters.map(\n        (filter) => `${replaceKnownLabelNames(filter.key)}${filter.operator}\"${filter.value}\"`\n      );\n\n      return `{${labelValuePairs.join(',')}}`; // e.g. `{environment=\"dev\",region=\"us-west-1\"}`\n    },\n  });\n};\n","import { type DataSourceInstanceSettings, type DataSourceJsonData } from '@grafana/data';\nimport { MetricExpr, parser, PipelineExpr, Selector } from '@grafana/lezer-logql';\nimport { getBackendSrv, type BackendSrvRequest, type FetchResponse } from '@grafana/runtime';\nimport { type SyntaxNode } from '@lezer/common';\nimport { lastValueFrom } from 'rxjs';\n\nimport { createMetricsLogsConnector, type FoundLokiDataSource } from './base';\nimport { logger } from '../../tracking/logger/logger';\nimport { getDataSourceFetcher } from '../../utils/utils.datasource';\n\nexport interface RecordingRuleGroup {\n  name: string;\n  rules: RecordingRule[];\n}\n\nexport interface RecordingRule {\n  name: string;\n  query: string;\n  type: 'recording' | 'alerting' | string;\n  labels?: Record<string, string>;\n}\n\nexport interface ExtractedRecordingRule extends RecordingRule {\n  datasource: FoundLokiDataSource;\n  hasMultipleOccurrences?: boolean;\n}\n\nexport interface ExtractedRecordingRules {\n  [dataSourceUID: string]: ExtractedRecordingRule[];\n}\n\n/**\n * Fetch Loki recording rule groups from the specified datasource.\n *\n * @param datasourceSettings - The settings of the datasource instance.\n * @returns A promise that resolves to an array of recording rule groups.\n */\nasync function fetchRecordingRuleGroups(datasourceSettings: DataSourceInstanceSettings<DataSourceJsonData>) {\n  const recordingRuleUrl = `api/prometheus/${datasourceSettings.uid}/api/v1/rules`;\n  const recordingRules: BackendSrvRequest = { url: recordingRuleUrl, showErrorAlert: false, showSuccessAlert: false };\n  const res = await lastValueFrom<\n    FetchResponse<{\n      data: { groups: RecordingRuleGroup[] };\n    }>\n  >(getBackendSrv().fetch(recordingRules));\n\n  if (!res.ok) {\n    logger.warn(`Failed to fetch recording rules from Loki data source: ${datasourceSettings.name}`);\n    return [];\n  }\n\n  return res.data.data.groups;\n}\n\n/**\n * Extract recording rules from the provided rule groups and associate them with the given data source.\n *\n * @param ruleGroups - An array of recording rule groups to extract rules from.\n * @param ds - The data source instance settings to associate with the extracted rules.\n * @returns An array of extracted recording rules, each associated with the provided data source.\n */\nexport function extractRecordingRulesFromRuleGroups(\n  ruleGroups: RecordingRuleGroup[],\n  ds: DataSourceInstanceSettings<DataSourceJsonData>\n): ExtractedRecordingRule[] {\n  if (ruleGroups.length === 0) {\n    return [];\n  }\n\n  // We only want to return the first matching rule when there are multiple rules with same name\n  const extractedRules = new Map<string, ExtractedRecordingRule>();\n  ruleGroups.forEach((rg) => {\n    rg.rules\n      .filter((r) => r.type === 'recording')\n      .forEach(({ type, name, query }) => {\n        const isExist = extractedRules.has(name);\n        if (isExist) {\n          // We already have the rule.\n          const existingRule = extractedRules.get(name);\n          if (existingRule) {\n            existingRule.hasMultipleOccurrences = true;\n            extractedRules.set(name, existingRule);\n          }\n        } else {\n          extractedRules.set(name, {\n            type,\n            name,\n            query,\n            datasource: {\n              name: ds.name,\n              uid: ds.uid,\n            },\n            hasMultipleOccurrences: false,\n          });\n        }\n      });\n  });\n\n  return Array.from(extractedRules.values());\n}\n\n/**\n * Retrieve an array of Loki data sources that contain recording rules with the specified metric name.\n *\n * @param metricName - The name of the metric to search for within the recording rules.\n * @param extractedRecordingRules - An object containing extracted recording rules, where each key is a string and the value is an array of recording rules.\n * @returns An array of `FoundLokiDataSource` objects that contain recording rules with the specified metric name.\n */\nexport function getDataSourcesWithRecordingRulesContainingMetric(\n  metricName: string,\n  extractedRecordingRules: ExtractedRecordingRules\n): FoundLokiDataSource[] {\n  const foundLokiDataSources: FoundLokiDataSource[] = [];\n  Object.values(extractedRecordingRules).forEach((recRules) => {\n    recRules\n      .filter((rr) => rr.name === metricName)\n      .forEach((rr) => {\n        foundLokiDataSources.push(rr.datasource);\n      });\n  });\n\n  return foundLokiDataSources;\n}\n\n/**\n * Generate a Loki query string for a related metric based on the provided metric name, data source ID,\n * and extracted recording rules.\n *\n * @param metricName - The name of the metric for which to generate the Loki query.\n * @param dataSourceUid - The UID of the data source containing the recording rules.\n * @param extractedRecordingRules - An object containing recording rules, indexed by data source UID.\n * @returns The generated Loki query string, or an empty string if the data source UID or metric name is not found.\n */\nexport function getLokiQueryForRelatedMetric(\n  metricName: string,\n  dataSourceUid: string,\n  extractedRecordingRules: ExtractedRecordingRules\n): string {\n  if (!dataSourceUid || !extractedRecordingRules[dataSourceUid]) {\n    return '';\n  }\n  const targetRule = extractedRecordingRules[dataSourceUid].find((rule) => rule.name === metricName);\n  if (!targetRule) {\n    return '';\n  }\n  const lokiQuery = getLogQueryFromMetricsQuery(targetRule.query);\n\n  return lokiQuery;\n}\n\n/**\n * Fetch and extract Loki recording rules from all Loki data sources.\n *\n * @returns {Promise<ExtractedRecordingRules>} A promise that resolves to an object containing\n * the extracted recording rules, keyed by data source UID.\n *\n * @throws Will log a warning if fetching or extracting rules fails for any data source.\n */\nexport async function fetchAndExtractLokiRecordingRules() {\n  const lokiDataSources = await getDataSourceFetcher().getHealthyDataSources('loki');\n  const extractedRecordingRules: ExtractedRecordingRules = {};\n  await Promise.all(\n    lokiDataSources.map(async (dataSource) => {\n      try {\n        const ruleGroups: RecordingRuleGroup[] = await fetchRecordingRuleGroups(dataSource);\n        const extractedRules = extractRecordingRulesFromRuleGroups(ruleGroups, dataSource);\n        extractedRecordingRules[dataSource.uid] = extractedRules;\n      } catch (err) {\n        logger.warn(err);\n      }\n    })\n  );\n\n  return extractedRecordingRules;\n}\n\nexport const createLokiRecordingRulesConnector = () => {\n  let lokiRecordingRules: ExtractedRecordingRules = {};\n\n  // In this connector, conditions have been met for related logs\n  // when we find at least one data source with recording rules\n  // containing the selected metric\n  let conditionsMetForRelatedLogs = false;\n\n  return createMetricsLogsConnector({\n    name: 'lokiRecordingRules',\n    checkConditionsMetForRelatedLogs: () => conditionsMetForRelatedLogs,\n    async getDataSources(selectedMetric: string): Promise<FoundLokiDataSource[]> {\n      lokiRecordingRules = await fetchAndExtractLokiRecordingRules();\n      const lokiDataSources = getDataSourcesWithRecordingRulesContainingMetric(selectedMetric, lokiRecordingRules);\n      conditionsMetForRelatedLogs = Boolean(lokiDataSources.length);\n\n      return lokiDataSources;\n    },\n    getLokiQueryExpr(selectedMetric: string, datasourceUid: string): string {\n      return getLokiQueryForRelatedMetric(selectedMetric, datasourceUid, lokiRecordingRules);\n    },\n  });\n};\n\n/**\n * Returns whether the given query is a logs query (not a metrics query)\n * A query that's at least 3 characters long and doesn't contain a MetricExpr node is considered a logs query\n */\nfunction isLogsQuery(query: string): boolean {\n  if (query.trim().length <= 2) {\n    return false;\n  }\n\n  let hasMetricExpr = false;\n  const tree = parser.parse(query);\n\n  tree.iterate({\n    enter: ({ type }): false | void => {\n      if (type.id === MetricExpr) {\n        hasMetricExpr = true;\n        return false;\n      }\n    },\n  });\n\n  return !hasMetricExpr;\n}\n\n/**\n * Gets a node of the specified type from a LogQL query string\n * Returns undefined if no node of that type is found\n */\nfunction getNodeFromQuery(query: string, nodeType: number): SyntaxNode | undefined {\n  let foundNode: SyntaxNode | undefined;\n  const tree = parser.parse(query);\n\n  tree.iterate({\n    enter: (node): false | void => {\n      if (node.type.id === nodeType) {\n        foundNode = node.node;\n        return false;\n      }\n    },\n  });\n\n  return foundNode;\n}\n\n/**\n * Extracts the underlying log query from a metrics query\n * For metrics queries, it returns the selector and pipeline parts\n * For logs queries, it returns the original query unchanged\n * Returns an empty string if no valid query can be extracted\n *\n * @example\n * // Returns '{foo=\"bar\"} |= \"error\"'\n * getLogQueryFromMetricsQuery('rate({foo=\"bar\"} |= \"error\"[5m])')\n *\n * // Returns '{foo=\"bar\"}'\n * getLogQueryFromMetricsQuery('sum(rate({foo=\"bar\"}[5m]))')\n *\n * // Returns original query unchanged\n * getLogQueryFromMetricsQuery('{foo=\"bar\"} |= \"error\"')\n */\nexport function getLogQueryFromMetricsQuery(query: string): string {\n  // If it's already a logs query, return as-is\n  if (isLogsQuery(query)) {\n    return query;\n  }\n\n  // Get the selector node which contains the log query matchers\n  const selectorNode = getNodeFromQuery(query, Selector);\n  if (!selectorNode) {\n    return '';\n  }\n\n  const selector = query.substring(selectorNode.from, selectorNode.to);\n\n  // Get the pipeline expression node if it exists (contains filters, parsers etc.)\n  const pipelineExprNode = getNodeFromQuery(query, PipelineExpr);\n  const pipelineExpr = pipelineExprNode ? query.substring(pipelineExprNode.from, pipelineExprNode.to) : '';\n\n  // Combine selector with pipeline expression if it exists\n  return `${selector} ${pipelineExpr}`.trim();\n}\n","import { LoadingState } from '@grafana/data';\nimport { SceneQueryRunner, type QueryRunnerState } from '@grafana/scenes';\n\nimport { type MetricsLogsConnector } from '../Integrations/logs/base';\nimport { createLabelsCrossReferenceConnector } from '../Integrations/logs/labelsCrossReference';\nimport { createLokiRecordingRulesConnector } from '../Integrations/logs/lokiRecordingRules';\nimport { type MetricScene } from '../MetricScene';\nimport pluginJson from '../plugin.json';\nimport { getDataSourceFetcher, type DataSource } from '../utils/utils.datasource';\n\n/**\n * Manager class that handles the orchestration of related logs functionality.\n * This centralizes logs-related logic that was previously spread across multiple components.\n */\nexport class RelatedLogsOrchestrator {\n  private readonly _logsConnectors: MetricsLogsConnector[];\n  private readonly _metricScene: MetricScene;\n  private readonly _dataSourceFetcher = getDataSourceFetcher();\n  private readonly _changeHandlers = {\n    lokiDataSources: [] as Array<(dataSources: DataSource[]) => void>,\n    relatedLogsCount: [] as Array<(count: number) => void>,\n  };\n  /**\n   * Internal state that powers public properties defined by getters and setters.\n   */\n  private readonly _internalState = {\n    relatedLogsCount: 0,\n    lokiDataSources: [] as DataSource[],\n  };\n\n  constructor(metricScene: MetricScene) {\n    this._metricScene = metricScene;\n    this._logsConnectors = [createLokiRecordingRulesConnector(), createLabelsCrossReferenceConnector(metricScene)];\n  }\n\n  get lokiDataSources() {\n    return this._internalState.lokiDataSources;\n  }\n\n  set lokiDataSources(dataSources: DataSource[]) {\n    const currentDataSourcesSignature = this._internalState.lokiDataSources.map((ds) => ds.uid).join(',');\n    const newDataSourcesSignature = dataSources.map((ds) => ds.uid).join(',');\n\n    if (currentDataSourcesSignature && currentDataSourcesSignature === newDataSourcesSignature) {\n      return;\n    }\n\n    this._internalState.lokiDataSources = dataSources;\n    this._changeHandlers.lokiDataSources.forEach((handler) => handler(this._internalState.lokiDataSources));\n  }\n\n  set relatedLogsCount(count: number) {\n    this._internalState.relatedLogsCount = count;\n    this._changeHandlers.relatedLogsCount.forEach((handler) => handler(this._internalState.relatedLogsCount));\n  }\n\n  /**\n   * Add a listener that will be called when the lokiDataSources change.\n   */\n  addLokiDataSourcesChangeHandler(handler: (dataSources: DataSource[]) => void) {\n    this._changeHandlers.lokiDataSources.push(handler);\n  }\n\n  /**\n   * Add a listener that will be called when the relatedLogsCount changes.\n   */\n  addRelatedLogsCountChangeHandler(handler: (count: number) => void) {\n    this._changeHandlers.relatedLogsCount.push(handler);\n  }\n\n  /**\n   * Called when filters change to re-check for logs in datasources.\n   */\n  public handleFiltersChange(): void {\n    if (!this.lokiDataSources) {\n      return;\n    }\n\n    // When filters change, we need to reset our state to trigger updates in listeners\n    // Setting to empty array (vs undefined) signals we're actively checking\n    this.lokiDataSources = [];\n    this.relatedLogsCount = 0;\n\n    // Check all available datasources for logs after filter changes\n    this.findAndCheckAllDatasources();\n  }\n\n  /**\n   * Find all available datasources and check them for logs.\n   * This is used when filters change to ensure we're checking all possible datasources.\n   */\n  public async findAndCheckAllDatasources(): Promise<void> {\n    // Get all available Loki datasources\n    const allLokiDatasources = await this._dataSourceFetcher.getHealthyDataSources('loki');\n\n    // Check all datasources for logs\n    if (allLokiDatasources.length > 0) {\n      this.checkLogsInDataSources(allLokiDatasources);\n    } else {\n      // No datasources available\n      this.lokiDataSources = [];\n      this.relatedLogsCount = 0;\n    }\n  }\n\n  /**\n   * Get the Loki queries for a given datasource.\n   */\n  public getLokiQueries(\n    datasourceUid: string,\n    maxLines = 100\n  ): Array<{ refId: string; expr: string; maxLines: number }> {\n    const { metric } = this._metricScene.state;\n    const queriesByConnector = this._logsConnectors.reduce<Record<string, string>>((acc, connector, idx) => {\n      const lokiExpr = connector.getLokiQueryExpr(metric, datasourceUid);\n      if (lokiExpr) {\n        acc[connector.name ?? `connector-${idx}`] = lokiExpr;\n      }\n      return acc;\n    }, {});\n\n    const queries = Object.keys(queriesByConnector).map((connectorName) => ({\n      refId: `RelatedLogs-${connectorName}`,\n      expr: queriesByConnector[connectorName],\n      maxLines,\n      supportingQueryType: pluginJson.id,\n    }));\n\n    return queries;\n  }\n\n  /**\n   * Check each datasource for logs, then update the datasources and relatedLogsCount accordingly.\n   */\n  private checkLogsInDataSources(datasources: DataSource[]): void {\n    // Check each datasource for logs\n    const datasourcesWithLogs: DataSource[] = [];\n    let totalLogsCount = 0;\n    let totalChecked = 0;\n\n    // If no datasources to check, update immediately\n    if (datasources.length === 0) {\n      this.lokiDataSources = [];\n      this.relatedLogsCount = 0;\n      return;\n    }\n\n    // Check each datasource for logs\n    datasources.forEach((datasource) => {\n      const queryRunner = new SceneQueryRunner({\n        datasource: { uid: datasource.uid },\n        queries: [],\n        key: `related_logs_check_${datasource.uid}`,\n      });\n\n      // Build and set queries\n      queryRunner.setState({\n        queries: this.getLokiQueries(datasource.uid),\n      });\n\n      // Subscribe to results\n      queryRunner.subscribeToState((state) => {\n        if (state.data?.state === LoadingState.Done) {\n          totalChecked++;\n\n          // Check if we found logs in this datasource\n          if (state.data?.series) {\n            const rowCount = this.countLogsLines(state);\n            if (rowCount > 0) {\n              // This datasource has logs\n              datasourcesWithLogs.push(datasource);\n              totalLogsCount += rowCount;\n            }\n          }\n\n          // When all datasources have been checked\n          if (totalChecked === datasources.length) {\n            // Update state with our findings\n            this.lokiDataSources = datasourcesWithLogs;\n            this.relatedLogsCount = totalLogsCount;\n          }\n        }\n      });\n\n      // Activate query\n      queryRunner.activate();\n    });\n  }\n\n  /**\n   * Returns true if any of the connectors have conditions met for related logs to be shown.\n   */\n  public checkConditionsMetForRelatedLogs(): boolean {\n    return this._logsConnectors.some((connector) => connector.checkConditionsMetForRelatedLogs());\n  }\n\n  /**\n   * Given the state of a query runner running a Loki query, count the number of log lines.\n   */\n  public countLogsLines(state: QueryRunnerState): number {\n    return state.data?.series.reduce((sum: number, frame) => sum + frame.length, 0) ?? 0;\n  }\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Alert, Stack, Text, TextLink, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nexport function NoRelatedLogs() {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <Stack direction=\"column\" gap={2}>\n      <Alert title=\"No related logs found\" severity=\"info\">\n        We couldn&apos;t find any logs related to the current metric with your selected filters.\n      </Alert>\n      <Text>\n        To find related logs, try the following:\n        <ul className={styles.list}>\n          <li>Adjust your label filters to include labels that exist in both the current metric and your logs</li>\n          <li>\n            Select a metric created by a{' '}\n            <TextLink external href=\"https://grafana.com/docs/loki/latest/alert/#recording-rules\">\n              Loki Recording Rule\n            </TextLink>\n          </li>\n          <li>Broaden the time range to include more data</li>\n        </ul>\n      </Text>\n      <Text variant=\"bodySmall\" color=\"secondary\">\n        Note: Related logs is an experimental feature.\n      </Text>\n    </Stack>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    list: css({\n      paddingLeft: theme.spacing(2),\n      marginTop: theme.spacing(1),\n    }),\n  };\n}\n","import { config, usePluginLinks } from '@grafana/runtime';\nimport { type SceneDataQuery, type SceneTimeRangeState } from '@grafana/scenes';\nimport { LinkButton } from '@grafana/ui';\nimport React, { useMemo } from 'react';\n\nimport { reportExploreMetrics } from '../interactions';\n\nconst extensionPointId = 'grafana-metricsdrilldown-app/open-in-logs-drilldown/v1';\n\nexport interface LogsDrilldownLinkContext {\n  targets: SceneDataQuery[];\n  timeRange?: SceneTimeRangeState;\n}\n\nexport function OpenInLogsDrilldownButton({ context }: Readonly<{ context: LogsDrilldownLinkContext }>) {\n  const memoizedContext = useMemo(() => context, [context]);\n  const { links, isLoading } = usePluginLinks({\n    extensionPointId,\n    limitPerPlugin: 1,\n    context: memoizedContext,\n  });\n  const logsDrilldownLink = useMemo(() => {\n    return links.find(({ pluginId }) => pluginId === 'grafana-lokiexplore-app');\n  }, [links]);\n\n  if (isLoading) {\n    return (\n      <LinkButton variant=\"secondary\" size=\"sm\" disabled>\n        Loading...\n      </LinkButton>\n    );\n  }\n\n  const logsDrilldownLinkExists = typeof logsDrilldownLink !== 'undefined';\n\n  return (\n    <LinkButton\n      href={\n        // We prefix with the appSubUrl for environments that don't host grafana at the root.\n        logsDrilldownLinkExists\n          ? `${config.appSubUrl}${logsDrilldownLink.path}`\n          : `${config.appSubUrl}/a/grafana-lokiexplore-app` // We fall back to the app's landing page if a link can't get generated using the supplied `context`\n      }\n      target=\"_blank\"\n      tooltip={\n        logsDrilldownLinkExists\n          ? 'Use the Logs Drilldown app to explore these logs'\n          : 'Navigate to the Logs Drilldown app'\n      }\n      variant=\"secondary\"\n      size=\"sm\"\n      onClick={() => reportExploreMetrics('related_logs_action_clicked', { action: 'open_logs_drilldown' })}\n    >\n      {logsDrilldownLinkExists ? 'Open in Logs Drilldown' : 'Open Logs Drilldown'}\n    </LinkButton>\n  );\n}\n","import { LoadingState } from '@grafana/data';\nimport {\n  CustomVariable,\n  PanelBuilders,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneQueryRunner,\n  SceneReactObject,\n  SceneVariableSet,\n  VariableDependencyConfig,\n  VariableValueSelectors,\n  type QueryRunnerState,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneVariable,\n} from '@grafana/scenes';\nimport { Spinner, Stack } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from '../interactions';\nimport { VAR_FILTERS, VAR_LOGS_DATASOURCE, VAR_LOGS_DATASOURCE_EXPR } from '../shared';\nimport { NoRelatedLogs } from './NoRelatedLogsFound';\nimport { OpenInLogsDrilldownButton, type LogsDrilldownLinkContext } from './OpenInLogsDrilldownButton';\nimport { type RelatedLogsOrchestrator } from './RelatedLogsOrchestrator';\nimport { isCustomVariable } from '../utils/utils.variables';\n\ninterface RelatedLogsSceneProps {\n  orchestrator: RelatedLogsOrchestrator;\n}\n\ninterface RelatedLogsSceneState extends SceneObjectState, RelatedLogsSceneProps {\n  loading: boolean;\n  controls: SceneObject[];\n  body: SceneCSSGridLayout;\n  logsDrilldownLinkContext: LogsDrilldownLinkContext;\n}\n\nconst LOGS_PANEL_CONTAINER_KEY = 'related_logs/logs_panel_container';\nconst RELATED_LOGS_QUERY_KEY = 'related_logs/logs_query';\n\nexport class RelatedLogsScene extends SceneObjectBase<RelatedLogsSceneState> {\n  private _queryRunner?: SceneQueryRunner;\n\n  constructor(props: RelatedLogsSceneProps) {\n    super({\n      loading: false,\n      controls: [],\n      body: new SceneCSSGridLayout({\n        templateColumns: '1fr',\n        autoRows: 'minmax(300px, 1fr)',\n        children: [\n          new SceneCSSGridItem({\n            key: LOGS_PANEL_CONTAINER_KEY,\n            body: undefined,\n          }),\n        ],\n      }),\n      orchestrator: props.orchestrator,\n      logsDrilldownLinkContext: {\n        targets: [],\n      },\n    });\n\n    this.addActivationHandler(() => {\n      this._onActivate();\n    });\n  }\n\n  private async _onActivate() {\n    // Register handler for future changes to lokiDataSources\n    this.state.orchestrator.addLokiDataSourcesChangeHandler(() => this.setupLogsPanel());\n\n    // If data sources have already been loaded, we don't need to fetch them again\n    if (!this.state.orchestrator.lokiDataSources.length) {\n      this.setState({ loading: true });\n      await this.state.orchestrator.findAndCheckAllDatasources();\n      this.setState({ loading: false });\n    } else {\n      this.setupLogsPanel();\n    }\n  }\n\n  private showNoLogsFound() {\n    const logsPanelContainer = sceneGraph.findByKeyAndType(this, LOGS_PANEL_CONTAINER_KEY, SceneCSSGridItem);\n    logsPanelContainer.setState({\n      body: new SceneReactObject({ component: NoRelatedLogs }),\n    });\n    this.setState({\n      controls: undefined,\n    });\n    this.state.orchestrator.relatedLogsCount = 0;\n  }\n\n  private _buildQueryRunner(): void {\n    this._queryRunner = new SceneQueryRunner({\n      datasource: { uid: VAR_LOGS_DATASOURCE_EXPR },\n      queries: [],\n      key: RELATED_LOGS_QUERY_KEY,\n    });\n    this._constructLogsDrilldownLinkContext(this._queryRunner.state);\n\n    // Set up subscription to query results\n    this._subs.add(\n      this._queryRunner.subscribeToState((state) => {\n        if (state.data?.state !== LoadingState.Done) {\n          // Only process completed query results\n          return;\n        }\n\n        const logLinesCount = this.state.orchestrator.countLogsLines(state);\n\n        if (logLinesCount === 0) {\n          // Show NoRelatedLogs if no logs found\n          this.showNoLogsFound();\n        }\n\n        this._constructLogsDrilldownLinkContext(state);\n      })\n    );\n  }\n\n  private setupLogsPanel(): void {\n    // Initialize query runner\n    this._buildQueryRunner();\n\n    // If no datasources can provide related logs given the current conditions, show the NoRelatedLogsScene\n    if (!this.state.orchestrator.lokiDataSources.length) {\n      this.showNoLogsFound();\n      return;\n    }\n\n    // Set up UI for logs panel\n    const logsPanelContainer = sceneGraph.findByKeyAndType(this, LOGS_PANEL_CONTAINER_KEY, SceneCSSGridItem);\n    logsPanelContainer.setState({\n      body: PanelBuilders.logs().setTitle('Logs').setData(this._queryRunner).build(),\n    });\n\n    // Set up variables for datasource selection\n    const logsDataSourceVariable = new CustomVariable({\n      name: VAR_LOGS_DATASOURCE,\n      label: 'Logs data source',\n      query: this.state.orchestrator.lokiDataSources.map((ds) => `${ds.name} : ${ds.uid}`).join(','),\n    });\n    this.setState({\n      $variables: new SceneVariableSet({ variables: [logsDataSourceVariable] }),\n      controls: [new VariableValueSelectors({ layout: 'vertical' })],\n    });\n    this._subs.add(\n      logsDataSourceVariable.subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          reportExploreMetrics('related_logs_action_clicked', { action: 'logs_data_source_changed' });\n        }\n      })\n    );\n\n    // Update Loki query\n    this.updateLokiQuery();\n  }\n\n  /**\n   * Construct the Logs Drilldown link context based on the query runner state\n   * @param state - The query runner state.\n   */\n  private _constructLogsDrilldownLinkContext(state: QueryRunnerState) {\n    const dsUid = (sceneGraph.lookupVariable(VAR_LOGS_DATASOURCE, this)?.getValue() ?? '') as string;\n    const queries = state.queries;\n    const targets: LogsDrilldownLinkContext['targets'] = [];\n\n    if (dsUid && queries.length) {\n      queries.forEach((query) => {\n        targets.push({\n          ...query,\n          datasource: {\n            uid: dsUid,\n            type: 'loki',\n          },\n        });\n      });\n    }\n\n    this.setState({\n      logsDrilldownLinkContext: { targets, timeRange: sceneGraph.getTimeRange(this).state },\n    });\n  }\n\n  /**\n   * Updates the Loki query based on the configured connectors, selected datasource, and current filters.\n   * This function is called when the selected datasource or filters change.\n   */\n  private updateLokiQuery() {\n    if (!this._queryRunner) {\n      return;\n    }\n\n    const selectedDatasourceVar = sceneGraph.lookupVariable(VAR_LOGS_DATASOURCE, this);\n\n    let selectedDatasourceUid: string | undefined = undefined;\n\n    if (isCustomVariable(selectedDatasourceVar)) {\n      selectedDatasourceUid = selectedDatasourceVar.getValue() as string;\n    }\n\n    if (!selectedDatasourceUid) {\n      return;\n    }\n\n    const queries = this.state.orchestrator.getLokiQueries(selectedDatasourceUid);\n\n    // If no queries were generated, show the NoRelatedLogsScene\n    if (queries.length === 0) {\n      this.showNoLogsFound();\n      return;\n    }\n\n    // Update queries - this will trigger the query runner to fetch new data\n    // The query results will be processed in the subscription handler\n    this._queryRunner.setState({ queries });\n  }\n\n  // Handle variable changes\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_LOGS_DATASOURCE, VAR_FILTERS],\n    onReferencedVariableValueChanged: (variable: SceneVariable) => {\n      if (variable.state.name === VAR_FILTERS) {\n        this.state.orchestrator.handleFiltersChange();\n      } else if (variable.state.name === VAR_LOGS_DATASOURCE) {\n        this.updateLokiQuery();\n      }\n    },\n  });\n\n  static readonly Component = ({ model }: SceneComponentProps<RelatedLogsScene>) => {\n    const { controls, body, logsDrilldownLinkContext, loading } = model.useState();\n\n    if (loading) {\n      return <Spinner />;\n    }\n\n    return (\n      <Stack gap={1} direction={'column'} grow={1}>\n        <Stack gap={1} direction={'row'} justifyContent={'space-between'} alignItems={'start'}>\n          <Stack gap={1}>\n            {controls?.map((control) => (\n              <control.Component key={control.state.key} model={control} />\n            ))}\n          </Stack>\n          <OpenInLogsDrilldownButton context={logsDrilldownLinkContext} />\n        </Stack>\n        <body.Component model={body} />\n      </Stack>\n    );\n  };\n}\n","import { css } from '@emotion/css';\nimport { config } from '@grafana/runtime';\nimport {\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  SceneVariableSet,\n  VariableDependencyConfig,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { GroupByVariable } from 'Breakdown/GroupByVariable';\nimport { actionViews, actionViewsDefinitions, type ActionViewType } from 'MetricActionBar';\n\nimport { MetricGraphScene } from './MetricGraphScene';\nimport { RelatedLogsOrchestrator } from './RelatedLogs/RelatedLogsOrchestrator';\nimport { RelatedLogsScene } from './RelatedLogs/RelatedLogsScene';\nimport { getVariablesWithMetricConstant, RefreshMetricsEvent, VAR_FILTERS, type MakeOptional } from './shared';\n\ninterface MetricSceneState extends SceneObjectState {\n  body: MetricGraphScene;\n  metric: string;\n  nativeHistogram?: boolean;\n  actionView?: ActionViewType;\n  relatedLogsCount?: number;\n}\n\nexport class MetricScene extends SceneObjectBase<MetricSceneState> {\n  public readonly relatedLogsOrchestrator = new RelatedLogsOrchestrator(this);\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['actionView'] });\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_FILTERS],\n    onReferencedVariableValueChanged: () => {\n      // When filters change, we need to re-check for related logs\n\n      this.relatedLogsOrchestrator.handleFiltersChange();\n    },\n  });\n\n  public constructor(state: MakeOptional<MetricSceneState, 'body'>) {\n    super({\n      $variables: state.$variables ?? getVariableSet(state.metric),\n      body: state.body ?? new MetricGraphScene({ metric: state.metric }),\n      ...state,\n    });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  private _onActivate() {\n    if (this.state.actionView === undefined) {\n      this.setActionView(actionViews.breakdown);\n    }\n\n    this.relatedLogsOrchestrator.findAndCheckAllDatasources();\n    this.relatedLogsOrchestrator.addRelatedLogsCountChangeHandler((count) => {\n      this.setState({ relatedLogsCount: count });\n    });\n\n    this.subscribeToEvents();\n  }\n\n  private subscribeToEvents() {\n    if (config.featureToggles.enableScopesInMetricsExplore) {\n      // Push the scopes change event to the tabs\n      // The event is not propagated because the tabs are not part of the scene graph\n      this._subs.add(\n        this.subscribeToEvent(RefreshMetricsEvent, (event) => {\n          this.state.body.state.selectedTab?.publishEvent(event);\n        })\n      );\n    }\n  }\n\n  getUrlState() {\n    return { actionView: this.state.actionView };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    if (typeof values.actionView === 'string') {\n      if (this.state.actionView !== values.actionView) {\n        const actionViewDef = actionViewsDefinitions.find((v) => v.value === values.actionView);\n        if (actionViewDef) {\n          this.setActionView(actionViewDef.value);\n        }\n      }\n    } else if (values.actionView === null) {\n      this.setActionView(null);\n    }\n  }\n\n  public setActionView(actionViewType: ActionViewType | null) {\n    const { body } = this.state;\n    const actionViewDef = actionViewType ? actionViewsDefinitions.find((v) => v.value === actionViewType) : null;\n\n    if (actionViewDef && actionViewDef.value !== this.state.actionView) {\n      body.setState({ selectedTab: actionViewDef.getScene(this) });\n      this.setState({ actionView: actionViewDef.value });\n    } else {\n      body.setState({ selectedTab: undefined });\n      this.setState({ actionView: undefined });\n    }\n  }\n\n  static readonly Component = ({ model }: SceneComponentProps<MetricScene>) => {\n    const { body } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.container} data-testid=\"metric-scene\">\n        <body.Component model={body} />\n      </div>\n    );\n  };\n\n  public createRelatedLogsScene(): SceneObject<SceneObjectState> {\n    return new RelatedLogsScene({\n      orchestrator: this.relatedLogsOrchestrator,\n    });\n  }\n}\n\nfunction getVariableSet(metric: string) {\n  return new SceneVariableSet({\n    variables: [...getVariablesWithMetricConstant(metric), new GroupByVariable()],\n  });\n}\n\nconst getStyles = () => ({\n  container: css({\n    position: 'relative',\n    height: '100%',\n    width: '100%',\n    // Ensure proper flex behavior for sticky positioning\n    display: 'flex',\n    flexDirection: 'column',\n  }),\n});\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Dropdown, Switch, ToolbarButton, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from './interactions';\nimport { MetricScene } from './MetricScene';\nimport { getTrailFor } from './utils';\n\ninterface DataTrailSettingsState extends SceneObjectState {\n  stickyMainGraph?: boolean;\n  isOpen?: boolean;\n}\n\nexport class DataTrailSettings extends SceneObjectBase<DataTrailSettingsState> {\n  constructor(state: Partial<DataTrailSettingsState>) {\n    super({\n      stickyMainGraph: state.stickyMainGraph ?? false,\n      isOpen: state.isOpen ?? false,\n    });\n  }\n\n  public onToggleStickyMainGraph = () => {\n    const stickyMainGraph = !this.state.stickyMainGraph;\n    reportExploreMetrics('settings_changed', { stickyMainGraph });\n    this.setState({ stickyMainGraph });\n  };\n\n  public onToggleOpen = (isOpen: boolean) => {\n    this.setState({ isOpen });\n  };\n\n  static readonly Component = ({ model }: SceneComponentProps<DataTrailSettings>) => {\n    const { stickyMainGraph, isOpen } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const trail = getTrailFor(model);\n    const { topScene } = trail.useState();\n\n    const isButtonVisible = topScene instanceof MetricScene;\n\n    if (!isButtonVisible) {\n      return null;\n    }\n\n    const renderPopover = () => {\n      return (\n        <div className={styles.popover} onClick={(evt) => evt.stopPropagation()}>\n          <div className={styles.heading}>Settings</div>\n          {topScene instanceof MetricScene && (\n            <div className={styles.options}>\n              <div>Always keep selected metric graph in-view</div>\n              <Switch value={stickyMainGraph} onChange={model.onToggleStickyMainGraph} />\n            </div>\n          )}\n        </div>\n      );\n    };\n\n    return (\n      <Dropdown overlay={renderPopover} placement=\"bottom\" onVisibleChange={model.onToggleOpen}>\n        <ToolbarButton icon=\"cog\" variant=\"canvas\" isOpen={isOpen} data-testid=\"settings-button\" />\n      </Dropdown>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    popover: css({\n      display: 'flex',\n      padding: theme.spacing(2),\n      flexDirection: 'column',\n      background: theme.colors.background.primary,\n      boxShadow: theme.shadows.z3,\n      borderRadius: theme.shape.radius.default,\n      border: `1px solid ${theme.colors.border.weak}`,\n      zIndex: 1,\n      marginRight: theme.spacing(2),\n    }),\n    heading: css({\n      fontWeight: theme.typography.fontWeightMedium,\n      paddingBottom: theme.spacing(2),\n    }),\n    options: css({\n      display: 'grid',\n      gridTemplateColumns: '1fr 50px',\n      rowGap: theme.spacing(1),\n      columnGap: theme.spacing(2),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { VariableHide, type AdHocVariableFilter, type GrafanaTheme2 } from '@grafana/data';\nimport { utf8Support, type PromQuery } from '@grafana/prometheus';\nimport { config, useChromeHeaderHeight } from '@grafana/runtime';\nimport {\n  AdHocFiltersVariable,\n  SceneControlsSpacer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  SceneReactObject,\n  SceneRefreshPicker,\n  SceneTimePicker,\n  SceneTimeRange,\n  SceneVariableSet,\n  ScopesVariable,\n  UrlSyncContextProvider,\n  VariableValueSelectors,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n  type SceneObjectWithUrlSync,\n  type SceneQueryRunner,\n  type SceneVariable,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { useEffect } from 'react';\n\nimport { ConfigurePanelAction } from 'GmdVizPanel/components/ConfigurePanelAction';\nimport { ConfigurePanelForm } from 'GmdVizPanel/components/ConfigurePanelForm/ConfigurePanelForm';\nimport { EventApplyPanelConfig } from 'GmdVizPanel/components/ConfigurePanelForm/EventApplyPanelConfig';\nimport { EventCancelConfigurePanel } from 'GmdVizPanel/components/ConfigurePanelForm/EventCancelConfigurePanel';\nimport { EventConfigurePanel } from 'GmdVizPanel/components/EventConfigurePanel';\nimport { GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { getMetricType } from 'GmdVizPanel/matchers/getMetricType';\nimport { MetricsDrilldownDataSourceVariable } from 'MetricsDrilldownDataSourceVariable';\nimport { PluginInfo } from 'PluginInfo/PluginInfo';\nimport { displaySuccess } from 'WingmanDataTrail/helpers/displayStatus';\nimport { MetricsReducer } from 'WingmanDataTrail/MetricsReducer';\nimport { MetricsVariable } from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\nimport { SceneDrawer } from 'WingmanDataTrail/SceneDrawer';\n\nimport { DataTrailSettings } from './DataTrailSettings';\nimport { MetricDatasourceHelper } from './helpers/MetricDatasourceHelper';\nimport { reportChangeInLabelFilters, reportExploreMetrics } from './interactions';\nimport { MetricScene } from './MetricScene';\nimport { MetricSelectedEvent, trailDS, VAR_FILTERS } from './shared';\nimport { getTrailStore } from './TrailStore/TrailStore';\nimport { limitAdhocProviders } from './utils';\nimport { isSceneQueryRunner } from './utils/utils.queries';\nimport { getAppBackgroundColor } from './utils/utils.styles';\nimport { isAdHocFiltersVariable } from './utils/utils.variables';\n\nexport interface DataTrailState extends SceneObjectState {\n  topScene?: SceneObject;\n  embedded?: boolean;\n  controls: SceneObject[];\n  settings: DataTrailSettings;\n  pluginInfo: SceneReactObject;\n  createdAt: number;\n\n  // wingman\n  dashboardMetrics?: Record<string, number>;\n  alertingMetrics?: Record<string, number>;\n\n  // just for the starting data source\n  initialDS?: string;\n  initialFilters?: AdHocVariableFilter[];\n\n  // Synced with url\n  metric?: string;\n  metricSearch?: string;\n  nativeHistogramMetric: string;\n\n  trailActivated: boolean; // this indicates that the trail has been updated by metric or filter selected\n  urlNamespace?: string; // optional namespace for url params, to avoid conflicts with other plugins in embedded mode\n\n  drawer: SceneDrawer;\n}\n\nexport class DataTrail extends SceneObjectBase<DataTrailState> implements SceneObjectWithUrlSync {\n  private _addingFilterWithoutReportingInteraction = false;\n  private datasourceHelper = new MetricDatasourceHelper(this);\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: ['metric', 'metricSearch', 'nativeHistogramMetric'],\n  });\n\n  getUrlState(): SceneObjectUrlValues {\n    const { metric, metricSearch, nativeHistogramMetric } = this.state;\n    return {\n      metric,\n      metricSearch,\n      // store the native histogram knowledge in url for the metric scene\n      nativeHistogramMetric,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<DataTrailState> = {};\n\n    if (typeof values.metric === 'string') {\n      if (this.state.metric !== values.metric) {\n        // if we have a metric and we have stored in the url that it is a native histogram\n        // we can pass that info into the metric scene to generate the appropriate queries\n        let nativeHistogramMetric = false;\n        if (values.nativeHistogramMetric === '1') {\n          nativeHistogramMetric = true;\n        }\n\n        Object.assign(stateUpdate, this.getSceneUpdatesForNewMetricValue(values.metric, nativeHistogramMetric));\n      }\n    } else if (values.metric == null && !this.state.embedded) {\n      stateUpdate.metric = undefined;\n      stateUpdate.topScene = new MetricsReducer();\n    }\n\n    if (typeof values.metricSearch === 'string') {\n      stateUpdate.metricSearch = values.metricSearch;\n    } else if (values.metric == null) {\n      stateUpdate.metricSearch = undefined;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  public constructor(state: Partial<DataTrailState>) {\n    super({\n      $timeRange: state.$timeRange ?? new SceneTimeRange({}),\n      $variables: state.$variables ?? getVariableSet(state.initialDS, state.metric, state.initialFilters),\n      controls: state.controls ?? [\n        new VariableValueSelectors({ layout: 'vertical' }),\n        new SceneControlsSpacer(),\n        new SceneTimePicker({}),\n        new SceneRefreshPicker({}),\n      ],\n      settings: state.settings ?? new DataTrailSettings({}),\n      pluginInfo: new SceneReactObject({ component: PluginInfo }),\n      createdAt: state.createdAt ?? new Date().getTime(),\n      dashboardMetrics: {},\n      alertingMetrics: {},\n      nativeHistogramMetric: state.nativeHistogramMetric ?? '',\n      trailActivated: state.trailActivated ?? false,\n      drawer: new SceneDrawer({}),\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.datasourceHelper.init();\n\n    this.subscribeToConfigEvents();\n\n    this.setState({ trailActivated: true });\n\n    if (!this.state.topScene) {\n      this.setState({ topScene: getTopSceneFor(this.state.metric) });\n    }\n\n    // Some scene elements publish this\n    this.subscribeToEvent(MetricSelectedEvent, this._handleMetricSelectedEvent.bind(this));\n\n    const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n\n    if (isAdHocFiltersVariable(filtersVariable)) {\n      this._subs.add(\n        filtersVariable?.subscribeToState((newState, prevState) => {\n          if (!this._addingFilterWithoutReportingInteraction) {\n            reportChangeInLabelFilters(newState.filters, prevState.filters);\n          }\n        })\n      );\n\n      // we ensure that, in the MetricsReducer, the Ad Hoc filters will display all the label names and values and\n      // we ensure that, in the MetricScene, the queries in the Scene graph will be considered and used as a filter\n      // to fetch label names and values\n      filtersVariable?.setState({\n        useQueriesAsFilterForOptions: Boolean(this.state.metric),\n      });\n\n      this.subscribeToState((newState, prevState) => {\n        if (newState.metric !== prevState.metric) {\n          filtersVariable?.setState({\n            useQueriesAsFilterForOptions: Boolean(newState.metric),\n          });\n\n          // ensure that when using browser nav, we close the drawer\n          this.state.drawer.close();\n        }\n      });\n    }\n\n    // Save the current trail as a recent (if the browser closes or reloads) if user selects a metric OR applies filters to metric select view\n    const saveRecentTrail = () => {\n      const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n      const hasFilters = isAdHocFiltersVariable(filtersVariable) && filtersVariable.state.filters.length > 0;\n      if (this.state.metric || hasFilters) {\n        getTrailStore().setRecentTrail(this);\n      }\n    };\n    window.addEventListener('unload', saveRecentTrail);\n\n    return () => {\n      if (!this.state.embedded) {\n        saveRecentTrail();\n      }\n      window.removeEventListener('unload', saveRecentTrail);\n    };\n  }\n\n  private async subscribeToConfigEvents() {\n    this._subs.add(\n      this.subscribeToEvent(EventConfigurePanel, async (event) => {\n        const { metric } = event.payload;\n\n        reportExploreMetrics('configure_panel_opened', { metricType: getMetricType(metric) });\n\n        const metadata = await this.getMetadataForMetric(metric);\n\n        this.state.drawer.open({\n          title: 'Configure the Prometheus function',\n          subTitle: `${metric} ${metadata ? ` (${metadata.type})` : ''}`, // eslint-disable-line sonarjs/no-nested-template-literals\n          body: new ConfigurePanelForm({ metric }),\n        });\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventCancelConfigurePanel, () => {\n        this.state.drawer.close();\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventApplyPanelConfig, (event) => {\n        const { metric, config, restoreDefault } = event.payload;\n\n        if (restoreDefault) {\n          reportExploreMetrics('default_panel_config_restored', { metricType: getMetricType(metric) });\n        } else {\n          reportExploreMetrics('panel_config_applied', { metricType: getMetricType(metric), configId: config.id });\n        }\n\n        this.state.drawer.close();\n\n        const panelsToUpdate = sceneGraph.findAllObjects(\n          this.state.topScene || this,\n          (o) =>\n            o instanceof GmdVizPanel &&\n            o.state.metric === metric &&\n            Boolean(sceneGraph.findDescendents(o, ConfigurePanelAction).length === 1)\n        ) as GmdVizPanel[];\n\n        for (const panel of panelsToUpdate) {\n          panel.update(config.panelOptions, config.queryOptions);\n        }\n\n        displaySuccess([`Configuration successfully ${restoreDefault ? 'restored' : 'applied'} for metric ${metric}!`]);\n      })\n    );\n  }\n\n  /**\n   * Assuming that the change in filter was already reported with a cause other than `'adhoc_filter'`,\n   * this will modify the adhoc filter variable and prevent the automatic reporting which would\n   * normally occur through the call to `reportChangeInLabelFilters`.\n   */\n  public addFilterWithoutReportingInteraction(filter: AdHocVariableFilter) {\n    const variable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n    if (!isAdHocFiltersVariable(variable)) {\n      return;\n    }\n\n    this._addingFilterWithoutReportingInteraction = true;\n    variable.setState({ filters: [...variable.state.filters, filter] });\n    this._addingFilterWithoutReportingInteraction = false;\n  }\n\n  public getMetadataForMetric(metric: string) {\n    return this.datasourceHelper.getMetadataForMetric(metric);\n  }\n\n  public async isNativeHistogram(metric: string) {\n    return this.datasourceHelper.isNativeHistogram(metric);\n  }\n\n  private async _handleMetricSelectedEvent(evt: MetricSelectedEvent) {\n    const metric = evt.payload ?? '';\n\n    // Add metric to adhoc filters baseFilter\n    const filterVar = sceneGraph.lookupVariable(VAR_FILTERS, this);\n    if (isAdHocFiltersVariable(filterVar)) {\n      filterVar.setState({\n        baseFilters: getBaseFiltersForMetric(evt.payload),\n      });\n    }\n\n    const nativeHistogramMetric = await this.isNativeHistogram(metric);\n\n    this._urlSync.performBrowserHistoryAction(() => {\n      this.setState(this.getSceneUpdatesForNewMetricValue(metric, nativeHistogramMetric));\n    });\n  }\n\n  private getSceneUpdatesForNewMetricValue(metric: string | undefined, nativeHistogramMetric?: boolean) {\n    const stateUpdate: Partial<DataTrailState> = {};\n    stateUpdate.metric = metric;\n    // refactoring opportunity? Or do we pass metric knowledge all the way down?\n    // must pass this native histogram prometheus knowledge deep into\n    // the topscene set on the trail > MetricScene > getAutoQueriesForMetric() > createHistogramMetricQueryDefs();\n    stateUpdate.nativeHistogramMetric = nativeHistogramMetric ? '1' : '';\n    stateUpdate.topScene = getTopSceneFor(metric, nativeHistogramMetric);\n\n    return stateUpdate;\n  }\n\n  public getQueries(): PromQuery[] {\n    // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n    const sqrs = sceneGraph.findAllObjects(this, (b) => isSceneQueryRunner(b)) as SceneQueryRunner[];\n\n    return sqrs.reduce<PromQuery[]>((acc, sqr) => {\n      acc.push(\n        ...sqr.state.queries.map((q) => ({\n          ...q,\n          expr: sceneGraph.interpolate(sqr, q.expr),\n        }))\n      );\n\n      return acc;\n    }, []);\n  }\n\n  static readonly Component = ({ model }: SceneComponentProps<DataTrail>) => {\n    const { controls, topScene, settings, pluginInfo, embedded, drawer } = model.useState();\n\n    const chromeHeaderHeight = useChromeHeaderHeight() ?? 0;\n    const headerHeight = embedded ? 0 : chromeHeaderHeight;\n    const styles = useStyles2(getStyles, headerHeight, model);\n\n    useEffect(() => {\n      const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, model);\n      const datasourceHelper = model.datasourceHelper;\n      limitAdhocProviders(model, filtersVariable, datasourceHelper);\n    }, [model]);\n\n    // Set CSS custom property for app-controls height in embedded mode\n    useEffect(() => {\n      // Update on mount and when controls change\n      updateAppControlsHeight();\n\n      // Use ResizeObserver to watch for height changes\n      const appControls = document.querySelector('[data-testid=\"app-controls\"]');\n\n      if (!appControls) {\n        return;\n      }\n\n      const resizeObserver = new ResizeObserver(updateAppControlsHeight);\n      resizeObserver.observe(appControls);\n\n      return () => {\n        // Clean up\n        resizeObserver.disconnect();\n        document.documentElement.style.removeProperty('--app-controls-height');\n      };\n    }, [embedded, controls]);\n\n    return (\n      <>\n        <div className={styles.container}>\n          {controls && (\n            <div className={styles.controls} data-testid=\"app-controls\">\n              {controls.map((control) => (\n                <control.Component key={control.state.key} model={control} />\n              ))}\n              <div className={styles.settingsInfo}>\n                <settings.Component model={settings} />\n                <pluginInfo.Component model={pluginInfo} />\n              </div>\n            </div>\n          )}\n          {topScene && (\n            <UrlSyncContextProvider\n              scene={topScene}\n              createBrowserHistorySteps={true}\n              updateUrlOnInit={true}\n              namespace={model.state.urlNamespace}\n            >\n              <div className={styles.body}>{topScene && <topScene.Component model={topScene} />}</div>\n            </UrlSyncContextProvider>\n          )}\n        </div>\n        <drawer.Component model={drawer} />\n      </>\n    );\n  };\n}\n\nfunction getTopSceneFor(metric?: string, nativeHistogram = false) {\n  if (metric) {\n    return new MetricScene({ metric, nativeHistogram });\n  } else {\n    return new MetricsReducer();\n  }\n}\n\nfunction getVariableSet(initialDS?: string, metric?: string, initialFilters?: AdHocVariableFilter[]) {\n  let variables: SceneVariable[] = [\n    new MetricsDrilldownDataSourceVariable({ initialDS }),\n    new MetricsVariable(),\n    new AdHocFiltersVariable({\n      key: VAR_FILTERS,\n      name: VAR_FILTERS,\n      label: 'Filters',\n      addFilterButtonText: 'Add label',\n      datasource: trailDS,\n      hide: VariableHide.dontHide,\n      layout: 'combobox',\n      filters: initialFilters ?? [],\n      baseFilters: getBaseFiltersForMetric(metric),\n      applyMode: 'manual',\n      allowCustomValue: true,\n      useQueriesAsFilterForOptions: false,\n      expressionBuilder: (filters: AdHocVariableFilter[]) => {\n        // remove any filters that include __name__ key in the expression\n        // to prevent the metric name from being set twice in the query and causing an error.\n        // also escapes equal signs to prevent invalid queries\n        // TODO: proper escaping as Scene does in https://github.com/grafana/scenes/blob/main/packages/scenes/src/variables/utils.ts#L45-L67\n        return (\n          filters\n            .filter((filter) => filter.key !== '__name__')\n            // eslint-disable-next-line sonarjs/no-nested-template-literals\n            .map((filter) => `${utf8Support(filter.key)}${filter.operator}\"${filter.value.replaceAll('=', `\\=`)}\"`)\n            .join(',')\n        );\n      },\n    }),\n  ];\n\n  if (isScopesSupported()) {\n    variables.unshift(new ScopesVariable({ enable: true }));\n  }\n\n  return new SceneVariableSet({\n    variables,\n  });\n}\n\nfunction getStyles(theme: GrafanaTheme2, headerHeight: number, trail: DataTrail) {\n  const background = getAppBackgroundColor(theme, trail);\n\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      gap: theme.spacing(1),\n      flexDirection: 'column',\n      padding: theme.spacing(1, 2),\n      position: 'relative',\n      background,\n    }),\n    body: css({\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n      minHeight: 0, // Allow body to shrink below its content size\n    }),\n    controls: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n      padding: theme.spacing(1, 0),\n      alignItems: 'flex-end',\n      flexWrap: 'wrap',\n      position: 'sticky',\n      background,\n      zIndex: theme.zIndex.navbarFixed,\n      top: headerHeight,\n      borderBottom: `1px solid ${theme.colors.border.weak}`,\n    }),\n    settingsInfo: css({\n      display: 'flex',\n      gap: theme.spacing(0.5),\n    }),\n  };\n}\n\nfunction getBaseFiltersForMetric(metric?: string): AdHocVariableFilter[] {\n  if (metric) {\n    return [{ key: '__name__', operator: '=', value: metric }];\n  }\n  return [];\n}\n\nfunction updateAppControlsHeight() {\n  const appControls = document.querySelector('[data-testid=\"app-controls\"]');\n\n  if (!appControls) {\n    return;\n  }\n\n  const { height } = appControls.getBoundingClientRect();\n  document.documentElement.style.setProperty('--app-controls-height', `${height}px`);\n}\n\nfunction isScopesSupported(): boolean {\n  return Boolean(\n    config.featureToggles.scopeFilters &&\n      config.featureToggles.enableScopesInMetricsExplore &&\n      // Scopes support in Grafana appears to begin with Grafana 12.0.0. We can remove\n      // the version check once the `dependencies.grafanaDependency` is updated to 12.0.0 or higher.\n      !config.buildInfo.version.startsWith('11.')\n  );\n}\n","import {\n  type AdHocFiltersVariable,\n  type CustomVariable,\n  type QueryVariable,\n  type SceneVariable,\n} from '@grafana/scenes';\n\ntype MaybeVariable = SceneVariable | null | undefined;\n\nexport function isAdHocFiltersVariable(variable: MaybeVariable): variable is AdHocFiltersVariable {\n  return variable !== null && variable?.state.type === 'adhoc';\n}\n\nexport function isCustomVariable(variable: MaybeVariable): variable is CustomVariable {\n  return variable !== null && variable?.state.type === 'custom';\n}\n\nexport function isQueryVariable(variable: MaybeVariable): variable is QueryVariable {\n  return variable !== null && variable?.state.type === 'query';\n}\n","export const PREF_KEYS = {\n  DATASOURCE: 'datasource',\n  RECENT_METRICS: 'recent-metrics',\n  BOOKMARKS: 'bookmarks',\n  METRIC_PREFS: 'metric-prefs',\n  BREAKDOWN_SORTBY: 'breakdown.sortby',\n};\n","import { type DataFrame } from '@grafana/data';\n\nexport function getLabelValueFromDataFrame(frame: DataFrame) {\n  const labels = frame.fields[1]?.labels;\n\n  if (!labels) {\n    return null;\n  }\n\n  const keys = Object.keys(labels);\n  if (keys.length === 0) {\n    return null;\n  }\n\n  return labels[keys[0]];\n}\n","import { OutlierDetector, type OutlierOutput } from '@bsull/augurs/outlier';\nimport {\n  doStandardCalcs,\n  fieldReducers,\n  FieldType,\n  outerJoinDataFrames,\n  ReducerID,\n  type DataFrame,\n} from '@grafana/data';\nimport { memoize } from 'lodash';\n\nimport { displayWarning } from 'WingmanDataTrail/helpers/displayStatus';\nimport { localeCompare } from 'WingmanDataTrail/helpers/localCompare';\n\nimport { reportExploreMetrics } from '../interactions';\nimport { getLabelValueFromDataFrame } from './levels';\n\nexport type SortSeriesByOption = 'alphabetical' | 'alphabetical-reversed' | 'outliers' | ReducerID.stdDev;\ntype SortSeriesDirection = 'asc' | 'desc';\n\n// Alphabetical sort\nconst sortAlphabetical = (series: DataFrame[], direction: SortSeriesDirection = 'asc') => {\n  const compareFn: (a: string, b: string) => number =\n    direction === 'asc' ? (a, b) => localeCompare(a, b) : (a, b) => localeCompare(b, a);\n\n  return series.sort((a, b) => {\n    const labelA = getLabelValueFromDataFrame(a);\n    if (!labelA) {\n      return 0;\n    }\n\n    const labelB = getLabelValueFromDataFrame(b);\n    if (!labelB) {\n      return 0;\n    }\n\n    return compareFn(labelA, labelB);\n  });\n};\n\n// Field reducer sort\nconst sortByFieldReducer = (series: DataFrame[], sortBy: string, direction: SortSeriesDirection = 'asc') => {\n  const fieldReducer = fieldReducers.get(sortBy);\n\n  const seriesCalcs = series.map((dataFrame) => {\n    const field = dataFrame.fields[1];\n    if (!field) {\n      return {\n        value: 0,\n        dataFrame,\n      };\n    }\n\n    const value = fieldReducer.reduce?.(field, true, true) ?? doStandardCalcs(field, true, true);\n    return {\n      value: value[sortBy] ?? 0,\n      dataFrame,\n    };\n  });\n\n  seriesCalcs.sort(direction === 'asc' ? (a, b) => a.value - b.value : (a, b) => b.value - a.value);\n\n  return seriesCalcs.map(({ dataFrame }) => dataFrame);\n};\n\n// Outlier sort\nconst sortByOutliers = (series: DataFrame[], direction: 'asc' | 'desc' = 'asc') => {\n  if (!wasmSupported()) {\n    throw new Error('WASM not supported');\n  }\n\n  const outliers = getOutliers(series);\n\n  const seriesCalcs = series.map((dataFrame, index) => ({\n    value: calculateOutlierValue(outliers, index),\n    dataFrame: dataFrame,\n  }));\n\n  seriesCalcs.sort(direction === 'asc' ? (a, b) => a.value - b.value : (a, b) => b.value - a.value);\n\n  return seriesCalcs.map(({ dataFrame }) => dataFrame);\n};\n\nconst getOutliers = (series: DataFrame[]): OutlierOutput => {\n  // Combine all frames into one by joining on time.\n  const joined = outerJoinDataFrames({ frames: series });\n  if (!joined) {\n    throw new Error('Error while joining frames into a single one');\n  }\n\n  // Get number fields: these are our series.\n  const joinedSeries = joined.fields.filter((f) => f.type === FieldType.number);\n  const points = joinedSeries.map((series) => new Float64Array(series.values));\n\n  return OutlierDetector.dbscan({ sensitivity: 0.9 }).detect(points);\n};\n\nconst calculateOutlierValue = (outliers: OutlierOutput, index: number): number => {\n  if (outliers.seriesResults[index].isOutlier) {\n    return -outliers.seriesResults[index].outlierIntervals.length;\n  }\n  return 0;\n};\n\nexport const sortSeries = memoize(\n  (origSeries: DataFrame[], sortBy: SortSeriesByOption, direction: SortSeriesDirection = 'asc') => {\n    if (!origSeries.length) {\n      return [];\n    }\n\n    const series = [...origSeries];\n\n    // Alphabetical sorting\n    if (sortBy === 'alphabetical') {\n      return sortAlphabetical(series, 'asc');\n    }\n\n    if (sortBy === 'alphabetical-reversed') {\n      return sortAlphabetical(series, 'desc');\n    }\n\n    // Outlier detection sorting\n    if (sortBy === 'outliers') {\n      try {\n        return sortByOutliers(series, direction);\n      } catch (e) {\n        const msg = `Error while sorting by outlying series: \"${(e as Error).toString()}\"!`;\n        displayWarning([msg, 'Falling back to standard deviation to identify the most variable series.']);\n\n        return sortByFieldReducer(series, ReducerID.stdDev, direction);\n      }\n    }\n\n    // Field reducer sorting (default case)\n    return sortByFieldReducer(series, sortBy, direction);\n  },\n  (series: DataFrame[], sortBy: string, direction: SortSeriesDirection = 'asc') => {\n    const firstTimestamp = seriesIsNotEmpty(series) ? series[0].fields[0].values[0] : 0;\n    const lastTimestamp = seriesIsNotEmpty(series)\n      ? series[series.length - 1].fields[0].values[series[series.length - 1].fields[0].values.length - 1]\n      : 0;\n\n    const firstValue = series.length > 0 ? getLabelValueFromDataFrame(series[0]) : '';\n    const lastValue = series.length > 0 ? getLabelValueFromDataFrame(series[series.length - 1]) : '';\n\n    const key = `${firstValue}_${lastValue}_${firstTimestamp}_${lastTimestamp}_${series.length}_${sortBy}_${direction}`;\n\n    return key;\n  }\n);\n\nfunction seriesIsNotEmpty(series: DataFrame[]) {\n  return series.length > 0 && series[0].fields.length > 0 && series[0].fields[0].values.length > 0;\n}\n\nexport const wasmSupported = () => {\n  const support = typeof WebAssembly === 'object';\n\n  if (!support) {\n    reportExploreMetrics('wasm_not_supported', {});\n  }\n\n  return support;\n};\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\ntype SectionTitleProps = {\n  title: string;\n  description: string;\n};\n\nexport function SectionTitle({ title, description }: Readonly<SectionTitleProps>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <h6 className={styles.title}>\n      <span>{title}</span>\n      <Tooltip content={description} placement=\"top\">\n        <Icon name=\"info-circle\" size=\"sm\" className={styles.infoIcon} />\n      </Tooltip>\n    </h6>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    title: css({\n      fontSize: '15px',\n      fontWeight: theme.typography.fontWeightLight,\n      borderBottom: `1px solid ${theme.colors.border.weak}`,\n      paddingBottom: theme.spacing(0.5),\n    }),\n    infoIcon: css({\n      marginLeft: theme.spacing(1),\n      cursor: 'pointer',\n      color: theme.colors.text.secondary,\n      position: 'relative',\n      top: '-4px',\n    }),\n  };\n}\n","import { useEffect, useState } from 'react';\n\nimport { logger } from '../tracking/logger/logger';\n\nfunction ensureErrorObject(error: any, defaultMessage: string): Error {\n  if (error instanceof Error) {\n    return error;\n  }\n  if (typeof error === 'string') {\n    return new Error(error);\n  }\n  if (typeof error.message === 'string') {\n    return new Error(error.message);\n  }\n  return new Error(defaultMessage);\n}\n\n/**\n * Determines if an error should be treated as an application-breaking error.\n * Filters out known non-critical errors like browser extension errors and ResizeObserver warnings.\n */\nfunction shouldTreatAsApplicationError(errorEvent: ErrorEvent): boolean {\n  // Check if error is from a browser extension\n  if (errorEvent.filename) {\n    const protocol = new URL(errorEvent.filename).protocol;\n\n    if (protocol.endsWith('extension:')) {\n      logger.error(new Error(`Browser extension error: ${errorEvent.message}`), {\n        filename: errorEvent.filename,\n        lineno: errorEvent.lineno?.toString(),\n        colno: errorEvent.colno?.toString(),\n      });\n      return false;\n    }\n  }\n\n  // Check for null error with message (like ResizeObserver warnings)\n  if (errorEvent.error === null && errorEvent.message) {\n    logger.error(new Error(`Non-critical error: ${errorEvent.message}`), {\n      filename: errorEvent.filename,\n      lineno: errorEvent.lineno?.toString(),\n      colno: errorEvent.colno?.toString(),\n    });\n    return false;\n  }\n\n  return true;\n}\n\nexport function useCatchExceptions(): [Error | undefined, React.Dispatch<React.SetStateAction<Error | undefined>>] {\n  const [error, setError] = useState<Error>();\n\n  // even though we wrap the app in an ErrorBoundary, some errors are not caught,\n  // so we have to set global handlers to catch these (e.g. error thrown from some click handlers)\n  useEffect(() => {\n    const onError = (errorEvent: ErrorEvent) => {\n      if (!shouldTreatAsApplicationError(errorEvent)) {\n        return;\n      }\n\n      setError(ensureErrorObject(errorEvent.error, 'Uncaught exception!'));\n    };\n\n    const onUnHandledRejection = (event: PromiseRejectionEvent) => {\n      // TODO: remove me when we remove MetricSelectScene\n      // indeed, it seems there's always  a cancelled request when landing on the view :man_shrug:\n      // Ideally, the code in DataTrail should handle the cancellation but we do it here because it's easier\n      if (event.reason.type === 'cancelled') {\n        setError(undefined);\n        return;\n      }\n\n      setError(ensureErrorObject(event.reason, 'Unhandled rejection!'));\n    };\n\n    window.addEventListener('error', onError);\n    window.addEventListener('unhandledrejection', onUnHandledRejection);\n    return () => {\n      window.removeEventListener('unhandledrejection', onUnHandledRejection);\n      window.removeEventListener('error', onError);\n    };\n  }, []);\n\n  return [error, setError];\n}\n","import { BusEventBase, BusEventWithPayload } from '@grafana/data';\nimport { ConstantVariable } from '@grafana/scenes';\nimport { VariableHide } from '@grafana/schema';\n\nexport const HOME_ROUTE = '/explore/metrics';\n\nexport const VAR_FILTERS = 'filters';\nexport const VAR_FILTERS_EXPR = '${filters}';\nconst VAR_METRIC = 'metric';\nexport const VAR_METRIC_EXPR = '${metric}';\nexport const VAR_GROUP_BY = 'groupby';\nexport const VAR_DATASOURCE = 'ds';\nexport const VAR_DATASOURCE_EXPR = '${ds}';\nexport const VAR_LOGS_DATASOURCE = 'logsDs';\nexport const VAR_LOGS_DATASOURCE_EXPR = '${logsDs}';\nexport const VAR_OTHER_METRIC_FILTERS = 'other_metric_filters';\n\nexport const LOGS_METRIC = '$__logs__';\n\nexport const trailDS = { uid: VAR_DATASOURCE_EXPR };\n\nexport type MakeOptional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\n\nexport function getVariablesWithMetricConstant(metric: string) {\n  return [\n    new ConstantVariable({\n      name: VAR_METRIC,\n      value: metric,\n      hide: VariableHide.hideVariable,\n    }),\n  ];\n}\n\nexport class MetricSelectedEvent extends BusEventWithPayload<string | undefined> {\n  public static readonly type = 'metric-selected-event';\n}\n\nexport class RefreshMetricsEvent extends BusEventBase {\n  public static readonly type = 'refresh-metrics-event';\n}\n","import { urlUtil } from '@grafana/data';\nimport { sceneUtils, type SceneObject, type SceneObjectRef, type SceneObjectUrlValues } from '@grafana/scenes';\nimport { debounce, isEqual } from 'lodash';\n\nimport { createBookmarkSavedNotification } from './utils';\nimport { DataTrail } from '../DataTrail';\nimport { PREF_KEYS } from '../UserPreferences/pref-keys';\nimport { userStorage } from '../UserPreferences/userStorage';\nimport { newMetricsTrail } from '../utils';\n\nexport const RECENT_TRAILS_KEY = 'grafana.trails.recent';\nconst MAX_RECENT_TRAILS = 20;\n\n// Added when removing history to replace serialized trail history with only URL values\ninterface UrlSerializedTrail {\n  urlValues: SceneObjectUrlValues;\n}\n\n// used in the migration for old history format\ninterface SerializedTrail {\n  history: SerializedTrailHistory[];\n  currentStep?: number; // Assume last step in history if not specified\n  createdAt?: number;\n}\n\n// used in the migration for old history format\ninterface SerializedTrailHistory {\n  urlValues: SceneObjectUrlValues;\n  description: string;\n}\n\nexport interface DataTrailBookmark {\n  urlValues: SceneObjectUrlValues;\n  createdAt: number;\n}\n\nexport class TrailStore {\n  private _recent: Array<SceneObjectRef<DataTrail>> = [];\n  private _bookmarks: DataTrailBookmark[] = [];\n  private _save: () => void;\n  private _lastModified: number;\n\n  constructor() {\n    this.load();\n    this._lastModified = Date.now();\n    const doSave = () => {\n      const serializedRecent = this._recent\n        .slice(0, MAX_RECENT_TRAILS)\n        .map((trail) => this._serializeTrail(trail.resolve()));\n      userStorage.setItem(RECENT_TRAILS_KEY, serializedRecent);\n      userStorage.setItem(PREF_KEYS.BOOKMARKS, this._bookmarks);\n      this._lastModified = Date.now();\n    };\n\n    this._save = debounce(doSave, 1000);\n\n    window.addEventListener('beforeunload', () => {\n      // Before closing or reloading the page, we want to remove the debounce from `_save` so that\n      // any calls to is on event `unload` are actualized. Debouncing would cause a delay until after the page has been unloaded.\n      this._save = doSave;\n    });\n  }\n\n  private _loadRecentTrailsFromStorage() {\n    const list: Array<SceneObjectRef<DataTrail>> = [];\n    const serializedTrails: SerializedTrail[] = userStorage.getItem(RECENT_TRAILS_KEY) || [];\n    for (const t of serializedTrails) {\n      const trail = this._deserializeTrail(t);\n      list.push(trail.getRef());\n    }\n    return list;\n  }\n\n  private _loadBookmarksFromStorage() {\n    const list: Array<DataTrailBookmark | SerializedTrail> = userStorage.getItem(PREF_KEYS.BOOKMARKS) || [];\n\n    return list.map((item) => {\n      if (isSerializedTrail(item)) {\n        // Take the legacy SerializedTrail implementation of bookmark storage, and extract a DataTrailBookmark\n        const step = item.currentStep != null ? item.currentStep : item.history.length - 1;\n        const bookmark: DataTrailBookmark = {\n          urlValues: item.history[step].urlValues,\n          createdAt: item.createdAt || Date.now(),\n        };\n        return bookmark;\n      }\n      return item;\n    });\n  }\n\n  private _deserializeTrail(t: SerializedTrail | UrlSerializedTrail): DataTrail {\n    // reconstruct the trail based on the serialized history\n    const trail = new DataTrail({});\n\n    const isSerializedTrail = 'history' in t;\n    const urlSerializedTrail = 'urlValues' in t;\n    if (isSerializedTrail) {\n      t.history.forEach((step) => {\n        // will go through all steps until the last one and load the most recent one\n        this._loadFromUrl(trail, step.urlValues);\n      });\n    } else if (urlSerializedTrail) {\n      this._loadFromUrl(trail, t.urlValues);\n    }\n    trail.setState(sceneUtils.cloneSceneObjectState(trail.state, {}));\n\n    return trail;\n  }\n\n  private _serializeTrail(trail: DataTrail): UrlSerializedTrail {\n    const urlValues = sceneUtils.getUrlState(trail);\n    return { urlValues };\n  }\n\n  public getTrailForBookmarkIndex(index: number) {\n    const bookmark = this._bookmarks[index];\n    if (!bookmark) {\n      // Create a blank trail\n      return newMetricsTrail();\n    }\n    return this.getTrailForBookmark(bookmark);\n  }\n\n  public getTrailForBookmark(bookmark: DataTrailBookmark) {\n    const key = getBookmarkKey(bookmark);\n    // Match for recent trails that have the exact same state as the current step\n    for (const recent of this._recent) {\n      const trail = recent.resolve();\n      if (getBookmarkKey(trail) === key) {\n        return trail;\n      }\n    }\n    // Just create a new trail with that state\n    const trail = new DataTrail({});\n    this._loadFromUrl(trail, bookmark.urlValues);\n    return trail;\n  }\n\n  private _loadFromUrl(node: SceneObject, urlValues: SceneObjectUrlValues) {\n    const urlState = urlUtil.renderUrl('', urlValues);\n    sceneUtils.syncStateFromSearchParams(node, new URLSearchParams(urlState));\n  }\n\n  // Recent Trails\n  get recent() {\n    return this._recent;\n  }\n\n  // Last updated metric\n  get lastModified() {\n    return this._lastModified;\n  }\n\n  load() {\n    this._recent = this._loadRecentTrailsFromStorage();\n    this._bookmarks = this._loadBookmarksFromStorage();\n    this._refreshBookmarkIndexMap();\n    this._lastModified = Date.now();\n  }\n\n  setRecentTrail(recentTrail: DataTrail) {\n    const notActivated = !recentTrail.state.trailActivated;\n\n    if (notActivated) {\n      // We do not set an uninitialized trail, or a RECENT single node \"start\" trail\n      return;\n    }\n\n    // Remove the `recentTrail` from the list if it already exists there\n    this._recent = this._recent.filter((t) => t !== recentTrail.getRef());\n\n    // Check if any existing \"recent\" entries have equivalent urlState to the new recentTrail\n    const recentUrlState = getUrlStateForComparison(recentTrail);\n\n    this._recent = this._recent.filter((t) => {\n      // Use the current step urlValues to filter out equivalent states\n      const urlState = getUrlStateForComparison(t.resolve());\n      // Only keep trails with sufficiently unique urlValues on their current step\n      return !isEqual(recentUrlState, urlState);\n    });\n\n    this._recent.unshift(recentTrail.getRef());\n    this._save();\n  }\n\n  // Bookmarked Trails\n  get bookmarks() {\n    return this._bookmarks;\n  }\n\n  addBookmark(trail: DataTrail) {\n    const urlState = sceneUtils.getUrlState(trail);\n\n    const bookmarkState: DataTrailBookmark = {\n      urlValues: urlState,\n      createdAt: Date.now(),\n    };\n\n    this._bookmarks.unshift(bookmarkState);\n    this._refreshBookmarkIndexMap();\n    this._save();\n    createBookmarkSavedNotification();\n  }\n\n  removeBookmark(index: number) {\n    if (index < this._bookmarks.length) {\n      this._bookmarks.splice(index, 1);\n      this._refreshBookmarkIndexMap();\n      this._save();\n    }\n  }\n\n  getBookmarkIndex(trail: DataTrail) {\n    const bookmarkKey = getBookmarkKey(trail);\n    const bookmarkIndex = this._bookmarkIndexMap.get(bookmarkKey);\n    return bookmarkIndex;\n  }\n\n  private _bookmarkIndexMap = new Map<string, number>();\n\n  private _refreshBookmarkIndexMap() {\n    this._bookmarkIndexMap.clear();\n    this._bookmarks.forEach((bookmarked, index) => {\n      const key = getBookmarkKey(bookmarked);\n      // If there are duplicate bookmarks, the latest index will be kept\n      this._bookmarkIndexMap.set(key, index);\n    });\n  }\n}\n\nfunction getUrlStateForComparison(trail: DataTrail) {\n  const urlState = sceneUtils.getUrlState(trail);\n  // Make a few corrections\n  correctUrlStateForComparison(urlState);\n\n  return urlState;\n}\n\nfunction correctUrlStateForComparison(urlState: SceneObjectUrlValues) {\n  // Omit some URL parameters that are not useful for state comparison,\n  // as they can change in the URL without creating new steps\n  delete urlState.actionView;\n  delete urlState.layout;\n  delete urlState.metricSearch;\n  delete urlState.refresh;\n\n  // Populate defaults\n  if (urlState['var-groupby'] === '' || urlState['var-groupby'] === undefined) {\n    urlState['var-groupby'] = '$__all';\n  }\n\n  if (typeof urlState['var-filters'] !== 'string') {\n    urlState['var-filters'] = urlState['var-filters']?.filter((filter) => filter !== '');\n  }\n\n  return urlState;\n}\n\nexport function getBookmarkKey(trail: DataTrail | DataTrailBookmark) {\n  if (trail instanceof DataTrail) {\n    return JSON.stringify(getUrlStateForComparison(trail));\n  }\n  return JSON.stringify(correctUrlStateForComparison({ ...trail.urlValues }));\n}\n\nlet store: TrailStore | undefined;\nexport function getTrailStore(): TrailStore {\n  if (!store) {\n    store = new TrailStore();\n  }\n\n  return store;\n}\n\nfunction isSerializedTrail(serialized: unknown): serialized is SerializedTrail {\n  return serialized != null && typeof serialized === 'object' && 'history' in serialized;\n}\n","import { AppEvents } from '@grafana/data';\nimport { getAppEvents } from '@grafana/runtime';\nimport { LinkButton, Stack } from '@grafana/ui';\nimport React from 'react';\n\nimport { ROUTES } from '../constants';\nimport { HOME_ROUTE } from '../shared';\nimport { currentPathIncludes } from '../utils';\n\nexport function createBookmarkSavedNotification() {\n  const appEvents = getAppEvents();\n  const isSidebarView = currentPathIncludes(ROUTES.Drilldown);\n\n  const infoText = !isSidebarView ? <i>Drilldown &gt; Metrics</i> : <i>the Metrics Reducer sidebar</i>;\n\n  appEvents.publish({\n    type: AppEvents.alertSuccess.name,\n    payload: [\n      'Bookmark created',\n      <Stack gap={2} direction=\"row\" key=\"bookmark-notification\">\n        <div>You can view bookmarks under {infoText}</div>\n        {!isSidebarView && (\n          <LinkButton fill=\"solid\" variant=\"secondary\" href={HOME_ROUTE}>\n            View bookmarks\n          </LinkButton>\n        )}\n      </Stack>,\n    ],\n  });\n}\n","import { reportExploreMetrics } from 'interactions';\n\nimport pluginJson from '../plugin.json';\nimport { PREF_KEYS } from './pref-keys';\n\nclass UserStorage {\n  private service: string;\n\n  constructor(service: string) {\n    this.service = service;\n  }\n\n  // TODO: temporary, let's wait for the new version to be in prod to remove it\n  public migrate() {\n    let hasMigrations = false;\n\n    const migrations = [\n      { legacyKey: 'metricsDrilldownDataSource', newKey: PREF_KEYS.DATASOURCE },\n      { legacyKey: 'metrics-drilldown-recent-metrics/v1', newKey: PREF_KEYS.RECENT_METRICS },\n      { legacyKey: 'grafana.trails.bookmarks', newKey: PREF_KEYS.BOOKMARKS },\n      { legacyKey: 'grafana.trails.breakdown.sort.labels.by', newKey: PREF_KEYS.BREAKDOWN_SORTBY },\n    ];\n\n    for (const { legacyKey, newKey } of migrations) {\n      let existingItem = localStorage.getItem(legacyKey);\n      if (existingItem === null) {\n        continue;\n      }\n\n      try {\n        existingItem = JSON.parse(existingItem);\n      } catch {}\n\n      this.setItem(newKey, existingItem);\n      localStorage.removeItem(legacyKey);\n\n      hasMigrations = true;\n    }\n\n    if (hasMigrations) {\n      reportExploreMetrics('user_preferences_migrated', {});\n    }\n  }\n\n  private buildStorageKey(key: string) {\n    return `${this.service}.${key}`;\n  }\n\n  getItem(key: string): any {\n    const storageKey = this.buildStorageKey(key);\n    const item = localStorage.getItem(storageKey);\n    return item === null ? null : JSON.parse(item);\n  }\n\n  setItem(key: string, value: any): void {\n    const storageKey = this.buildStorageKey(key);\n    localStorage.setItem(storageKey, JSON.stringify(value));\n  }\n\n  removeItem(key: string): void {\n    const storageKey = this.buildStorageKey(key);\n    localStorage.removeItem(storageKey);\n  }\n\n  clear() {\n    localStorage.clear();\n  }\n}\n\nexport const userStorage = new UserStorage(pluginJson.id);\n","import { locationService } from '@grafana/runtime';\nimport { createContext, useEffect, useState } from 'react';\n\nimport { type DataTrail } from 'DataTrail';\nimport { getUrlForTrail, newMetricsTrail } from 'utils';\n\nimport { navigationEvents } from '../WingmanDataTrail/SideBar/sections/BookmarksList';\n\ninterface MetricsAppContext {\n  trail: DataTrail;\n  goToUrlForTrail: (trail: DataTrail) => void;\n}\n\nexport const MetricsContext = createContext<MetricsAppContext>({\n  trail: newMetricsTrail(),\n  goToUrlForTrail: () => {},\n});\n\nexport function useTrail() {\n  const [trail, setTrail] = useState<DataTrail>(newMetricsTrail());\n\n  const goToUrlForTrail = (trail: DataTrail) => {\n    locationService.push(getUrlForTrail(trail));\n    setTrail(trail);\n  };\n\n  // Subscribe to navigation events from BookmarksList\n  useEffect(() => {\n    const handleNavigation = (trail: DataTrail) => {\n      goToUrlForTrail(trail);\n    };\n\n    // Subscribe to navigation events\n    const unsubscribe = navigationEvents.subscribe(handleNavigation);\n\n    // Clean up subscription\n    return () => unsubscribe();\n  }, []);\n\n  return { trail, goToUrlForTrail };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Collapse, TextLink, useStyles2 } from '@grafana/ui';\nimport React, { useCallback, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\n\nimport { InlineBanner } from './InlineBanner';\n\ntype ErrorViewProps = { error: Error };\n\nexport function ErrorView({ error }: Readonly<ErrorViewProps>) {\n  const styles = useStyles2(getStyles);\n\n  const navigate = useNavigate();\n  const { pathname, search } = useLocation();\n\n  const onClickReload = useCallback(() => {\n    const searchParams = new URLSearchParams(search);\n    const newSearchParams = new URLSearchParams();\n\n    // these are safe keys to keep\n    ['from', 'to', 'timezone']\n      .filter((key) => searchParams.has(key))\n      .forEach((key) => newSearchParams.set(key, searchParams.get(key)!));\n\n    navigate({ pathname, search: newSearchParams.toString() });\n    window.location.reload();\n  }, [navigate, pathname, search]);\n\n  const [isCollapseOpen, setIsCollapseOpen] = useState(false);\n\n  return (\n    <div className={styles.container}>\n      <InlineBanner\n        severity=\"error\"\n        title=\"Fatal error!\"\n        error={error}\n        errorContext={{ handheldBy: 'React error boundary' }}\n        message={\n          <>\n            <p className={styles.message}>\n              Please{' '}\n              <TextLink href=\"#\" onClick={onClickReload}>\n                try reloading the page\n              </TextLink>{' '}\n              or, if the problem persists, contact your organization admin. Sorry for the inconvenience.\n            </p>\n            <p>\n              <Collapse\n                className={styles.callStack}\n                collapsible\n                label=\"View stack trace\"\n                isOpen={isCollapseOpen}\n                onToggle={() => setIsCollapseOpen(!isCollapseOpen)}\n              >\n                <pre>\n                  <code>{error.stack}</code>\n                </pre>\n              </Collapse>\n            </p>\n          </>\n        }\n      />\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      margin: theme.spacing(2),\n    }),\n    message: css({\n      margin: theme.spacing(2, 0, 1, 0),\n    }),\n    callStack: css({\n      backgroundColor: 'transparent',\n      border: '0 none',\n\n      '& button': css({\n        paddingLeft: theme.spacing(1.5),\n      }),\n\n      '& button:focus': css({\n        outline: 'none',\n        boxShadow: 'none',\n      }),\n\n      '& button > svg': css({\n        marginLeft: theme.spacing(-2),\n        marginRight: theme.spacing(0.5),\n      }),\n\n      '& [class$=\"collapse__loader\"]': css({\n        display: 'none',\n      }),\n    }),\n  };\n}\n","import { type AdHocVariableFilter } from '@grafana/data';\nimport { config, reportInteraction } from '@grafana/runtime';\n\nimport { type ExposedComponentName } from 'exposedComponents/components';\nimport { type PanelConfigPreset } from 'GmdVizPanel/config/presets/types';\nimport { type MetricType } from 'GmdVizPanel/matchers/getMetricType';\nimport { type PanelType } from 'GmdVizPanel/types/available-panel-types';\nimport { type ActionViewType } from 'MetricActionBar';\nimport { type SortSeriesByOption } from 'services/sorting';\nimport { type SnakeCase } from 'utils/utils.types';\nimport { type LayoutType } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { type SortingOption as MetricsReducerSortByOption } from 'WingmanDataTrail/ListControls/MetricsSorter/MetricsSorter';\n\nimport { PLUGIN_ID } from './constants';\nimport { GIT_COMMIT } from './version';\n\nexport type ViewName = 'metrics-reducer' | 'metric-details';\n\ntype Interactions = {\n  // User selected a label to view its breakdown.\n  groupby_label_changed: {\n    label: string;\n  };\n  breakdown_panel_selected: {\n    label: string;\n  };\n  // User changed a label filter\n  label_filter_changed: {\n    label: string;\n    action: 'added' | 'removed' | 'changed';\n    cause: 'breakdown' | 'adhoc_filter';\n  };\n  // User changed the breakdown layout\n  breakdown_layout_changed: { layout: LayoutType };\n  // A metric exploration has started due to one of the following causes\n  exploration_started: {\n    cause: 'bookmark_clicked';\n  };\n  // A user has changed a bookmark\n  bookmark_changed: {\n    action: // Toggled on or off from the bookmark icon\n    | 'toggled_on'\n      | 'toggled_off'\n      // Deleted from the sidebar bookmarks list\n      | 'deleted';\n  };\n  // User changes metric explore settings\n  settings_changed: { stickyMainGraph?: boolean };\n  // User clicks on tab to change the action view\n  metric_action_view_changed: {\n    view: ActionViewType;\n\n    // The number of related logs\n    related_logs_count?: number;\n  };\n  // User clicks on one of the action buttons associated with a selected metric\n  selected_metric_action_clicked: {\n    action: // Opens the metric queries in Explore\n    | 'open_in_explore'\n      // Clicks on the share URL button\n      | 'share_url'\n      // Deselects the current selected metrics by clicking the \"Select new metric\" button\n      | 'unselect'\n      // When in embedded mode, clicked to open the exploration from the embedded view\n      | 'open_from_embedded';\n  };\n  // User clicks on one of the action buttons associated with related logs\n  related_logs_action_clicked: {\n    action: // Opens Logs Drilldown\n    | 'open_logs_drilldown'\n      // Logs data source changed\n      | 'logs_data_source_changed';\n  };\n  // User selects a metric\n  metric_selected: {\n    from: // By clicking \"Select\" on a metric panel when on the no-metric-selected metrics list view\n    | 'metric_list'\n      // By clicking \"Select\" on a metric panel when on the related metrics tab\n      | 'related_metrics';\n    // The number of search terms activated when the selection was made\n    searchTermCount: number | null;\n  };\n  // User opens/closes the prefix filter dropdown\n  prefix_filter_clicked: {\n    from: // By clicking \"Select\" on a metric panel when on the no-metric-selected metrics list view\n    | 'metric_list'\n      // By clicking \"Select\" on a metric panel when on the related metrics tab\n      | 'related_metrics';\n    action: // Opens the dropdown\n    | 'open'\n      // Closes the dropdown\n      | 'close';\n  };\n  // User types in the quick search bar\n  quick_search_used: {};\n  sorting_changed:\n    | {\n        // By clicking on the sort by variable in the metrics reducer\n        from: 'metrics-reducer';\n        // The sort by option selected\n        sortBy: MetricsReducerSortByOption;\n      }\n    | {\n        // By clicking on the sort by component in the label breakdown\n        from: 'label-breakdown';\n        // The sort by option selected\n        sortBy: SortSeriesByOption;\n      };\n  wasm_not_supported: {};\n  native_histogram_examples_closed: {};\n  native_histogram_example_clicked: {\n    metric: string;\n  };\n  // User toggles the Wingman sidebar\n  metrics_sidebar_toggled: {\n    action: // Opens the sidebar section\n    | 'opened'\n      // Closes the sidebar section\n      | 'closed';\n    section?: string;\n  };\n  // User clicks into the prefix filter section of the sidebar\n  sidebar_prefix_filter_section_clicked: {};\n  // User applies any prefix filter from the sidebar\n  sidebar_prefix_filter_applied: {\n    // Number of prefix filters applied (optional)\n    filter_count?: number;\n  };\n  // User clicks into the suffix filter section of the sidebar\n  sidebar_suffix_filter_section_clicked: {};\n  // User applies any suffix filter from the sidebar\n  sidebar_suffix_filter_applied: {\n    // Number of suffix filters applied (optional)\n    filter_count?: number;\n  };\n  // User selects a rules filter from the Wingman sidebar\n  sidebar_rules_filter_selected: {\n    filter_type: 'non_rules_metrics' | 'recording_rules';\n  };\n  // User applies a label filter from the sidebar\n  sidebar_group_by_label_filter_applied: {\n    label: string;\n  };\n  app_initialized: {\n    view: ViewName;\n    uel_epid: string;\n  };\n  // User took an action to view an exposed component\n  exposed_component_viewed: {\n    component: SnakeCase<ExposedComponentName>;\n  };\n  // User changes the panel type for a histogram metric (e.g., from heatmap to percentiles)\n  histogram_panel_type_changed: { panelType: PanelType };\n  // App migrated some legacy user prefs (see src/UserPreferences/userStorage.ts)\n  user_preferences_migrated: {};\n  // User opens the \"Configure panel\"\n  configure_panel_opened: { metricType: MetricType };\n  // User applies a panel config\n  panel_config_applied: { metricType: MetricType; configId: string };\n  // User restores the default panel config\n  default_panel_config_restored: { metricType: MetricType };\n  // An invalid metric config has been found\n  invalid_metric_config: { metricConfig: PanelConfigPreset };\n};\n\ntype OtherEvents = {\n  extreme_value_filter_behavior_triggered: {\n    expression: string;\n  };\n};\n\ntype AllEvents = Interactions & OtherEvents;\n\nconst INTERACTION_NAME_PREFIX = 'grafana_explore_metrics_';\n\nexport function reportExploreMetrics<E extends keyof AllEvents, P extends AllEvents[E]>(event: E, payload: P) {\n  reportInteraction(`${INTERACTION_NAME_PREFIX}${event}`, {\n    ...payload,\n    meta: {\n      // same naming as Faro (see src/tracking/faro/faro.ts)\n      appRelease: config.apps[PLUGIN_ID].version,\n      appVersion: GIT_COMMIT,\n    },\n  });\n}\n\n/**\n * Reports a single label filter change event\n */\nfunction reportLabelFilterChange(label: string, action: 'added' | 'removed' | 'changed') {\n  reportExploreMetrics('label_filter_changed', {\n    label,\n    action,\n    cause: 'adhoc_filter',\n  });\n}\n\n/**\n * Detects and reports changes to an existing filter\n */\nfunction detectChangedFilters(newFilters: AdHocVariableFilter[], oldFilters: AdHocVariableFilter[]) {\n  for (const oldFilter of oldFilters) {\n    for (const newFilter of newFilters) {\n      if (oldFilter.key === newFilter.key && oldFilter.value !== newFilter.value) {\n        reportLabelFilterChange(oldFilter.key, 'changed');\n      }\n    }\n  }\n}\n\n/**\n * Detects and reports removed filters\n */\nfunction detectRemovedFilters(newFilters: AdHocVariableFilter[], oldFilters: AdHocVariableFilter[]) {\n  for (const oldFilter of oldFilters) {\n    const stillExists = newFilters.some((newFilter) => newFilter.key === oldFilter.key);\n    if (!stillExists) {\n      reportLabelFilterChange(oldFilter.key, 'removed');\n    }\n  }\n}\n\n/**\n * Detects and reports added filters\n */\nfunction detectAddedFilters(newFilters: AdHocVariableFilter[], oldFilters: AdHocVariableFilter[]) {\n  for (const newFilter of newFilters) {\n    const isNew = !oldFilters.some((oldFilter) => oldFilter.key === newFilter.key);\n    if (isNew) {\n      reportLabelFilterChange(newFilter.key, 'added');\n    }\n  }\n}\n\n/** Detect the single change in filters and report the event, assuming it came from manipulating the adhoc filter */\nexport function reportChangeInLabelFilters(newFilters: AdHocVariableFilter[], oldFilters: AdHocVariableFilter[]) {\n  if (newFilters.length === oldFilters.length) {\n    // Same number of filters - check for changed values\n    detectChangedFilters(newFilters, oldFilters);\n  } else if (newFilters.length < oldFilters.length) {\n    // Filters were removed\n    detectRemovedFilters(newFilters, oldFilters);\n  } else {\n    // Filters were added\n    detectAddedFilters(newFilters, oldFilters);\n  }\n}\n","import { AppEvents } from '@grafana/data';\nimport { getAppEvents } from '@grafana/runtime';\n\nimport { logger } from 'tracking/logger/logger';\n\nexport function displayError(error: Error, msgs: string[]) {\n  const context = msgs.reduce((acc, msg, i) => ({ ...acc, [`info${i + 1}`]: msg }), { handheldBy: 'displayError' });\n\n  logger.error(error, context);\n\n  getAppEvents().publish({\n    type: AppEvents.alertError.name,\n    payload: msgs,\n  });\n}\n\nexport function displayWarning(msgs: string[]) {\n  logger.warn(msgs);\n\n  getAppEvents().publish({\n    type: AppEvents.alertWarning.name,\n    payload: msgs,\n  });\n}\n\nexport function displaySuccess(msgs: string[]) {\n  getAppEvents().publish({\n    type: AppEvents.alertSuccess.name,\n    payload: msgs,\n  });\n}\n","import { type Scope } from '@grafana/data';\nimport { SceneObjectBase, type SceneObjectState } from '@grafana/scenes';\n\nfunction getSelectedScopes(): Scope[] {\n  return [];\n}\n\nexport function getClosestScopesFacade(): ScopesFacade {\n  return new ScopesFacade();\n}\n\ninterface SelectedScope {\n  scope: Scope;\n  path: string[];\n}\n\ninterface ScopesFacadeState extends SceneObjectState {\n  // A callback that will be executed when new scopes are set\n  handler?: (facade: ScopesFacade) => void;\n  // The render count is a workaround to force the URL sync manager to update the URL with the latest scopes\n  // Basically it starts at 0, and it is increased with every scopes value update\n  renderCount?: number;\n}\n\nexport class ScopesFacade extends SceneObjectBase<ScopesFacadeState> {\n  private selectedScopes: SelectedScope[] = [];\n  private onScopesChangeCallbacks: Array<(scopes: SelectedScope[]) => void> = [];\n\n  constructor() {\n    super({});\n  }\n\n  public getSelectedScopes(): SelectedScope[] {\n    return this.selectedScopes;\n  }\n\n  public getSelectedScopesNames(): string[] {\n    return this.selectedScopes.map(({ scope }) => scope.metadata.name);\n  }\n\n  public setSelectedScopes(scopes: SelectedScope[]) {\n    this.selectedScopes = scopes;\n    this.notifySubscribers();\n  }\n\n  public onScopesChange(callback: (scopes: SelectedScope[]) => void) {\n    this.onScopesChangeCallbacks.push(callback);\n    return () => {\n      this.onScopesChangeCallbacks = this.onScopesChangeCallbacks.filter((cb) => cb !== callback);\n    };\n  }\n\n  private notifySubscribers() {\n    for (const callback of this.onScopesChangeCallbacks) {\n      callback(this.selectedScopes);\n    }\n  }\n\n  public get value() {\n    return getSelectedScopes();\n  }\n}\n","import { urlUtil, type AdHocVariableFilter, type GetTagResponse, type MetricFindValue } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport {\n  sceneGraph,\n  SceneTimeRange,\n  sceneUtils,\n  type AdHocFiltersVariable,\n  type SceneObject,\n  type SceneVariable,\n  type SceneVariableState,\n} from '@grafana/scenes';\n\nimport { logger } from 'tracking/logger/logger';\n\nimport { ROUTES } from './constants';\nimport { DataTrail, type DataTrailState } from './DataTrail';\nimport { type DataTrailSettings } from './DataTrailSettings';\nimport { type MetricDatasourceHelper } from './helpers/MetricDatasourceHelper';\nimport { LOGS_METRIC } from './shared';\nimport { getClosestScopesFacade } from './utils/utils.scopes';\nimport { isAdHocFiltersVariable } from './utils/utils.variables';\n\nexport function getTrailFor(model: SceneObject): DataTrail {\n  return sceneGraph.getAncestor(model, DataTrail);\n}\n\nexport function getTrailSettings(model: SceneObject): DataTrailSettings {\n  return sceneGraph.getAncestor(model, DataTrail).state.settings;\n}\n\nexport function newMetricsTrail(state?: Partial<DataTrailState>): DataTrail {\n  return new DataTrail({\n    initialDS: state?.initialDS,\n    $timeRange: state?.$timeRange ?? new SceneTimeRange({ from: 'now-1h', to: 'now' }),\n    embedded: state?.embedded ?? false,\n    ...state,\n  });\n}\n\nexport function getUrlForTrail(trail: DataTrail) {\n  const params = sceneUtils.getUrlState(trail);\n  return urlUtil.renderUrl(ROUTES.Drilldown, params);\n}\n\nfunction getCurrentPath(): Location['pathname'] {\n  return window.location.pathname;\n}\n\nexport function currentPathIncludes(path: string) {\n  return getCurrentPath().includes(path);\n}\n\nexport function getMetricName(metric?: string) {\n  if (!metric) {\n    return 'All metrics';\n  }\n\n  if (metric === LOGS_METRIC) {\n    return 'Logs';\n  }\n\n  return metric;\n}\n\nexport function getColorByIndex(index: number) {\n  const visTheme = config.theme2.visualization;\n  return visTheme.getColorByName(visTheme.palette[index % 8]);\n}\n\n// frontend hardening limit\nconst MAX_ADHOC_VARIABLE_OPTIONS = 10000;\n\n/**\n * Add custom providers for the adhoc filters variable that limit the responses for labels keys and label values.\n * Currently hard coded to 10000.\n *\n * The current provider functions for adhoc filter variables are the functions getTagKeys and getTagValues in the data source.\n * This function still uses these functions from inside the data source helper.\n *\n * @param dataTrail\n * @param limitedFilterVariable this is the filters variable\n * @param datasourceHelper\n */\nexport function limitAdhocProviders(\n  dataTrail: DataTrail,\n  limitedFilterVariable: SceneVariable<SceneVariableState> | null,\n  datasourceHelper: MetricDatasourceHelper\n) {\n  if (!isAdHocFiltersVariable(limitedFilterVariable)) {\n    return;\n  }\n\n  limitedFilterVariable.setState({\n    getTagKeysProvider: async (): Promise<{\n      replace?: boolean;\n      values: GetTagResponse | MetricFindValue[];\n    }> => {\n      // For the Prometheus label names endpoint, '/api/v1/labels'\n      // get the previously selected filters from the variable\n      // to use in the query to filter the response\n      // using filters, e.g. {previously_selected_label:\"value\"},\n      // as the series match[] parameter in Prometheus labels endpoint\n      const filters = limitedFilterVariable.state.filters;\n      // call getTagKeys and truncate the response\n      // we're passing the queries so we get the labels that adhere to the queries\n      // we're also passing the scopes so we get the labels that adhere to the scopes filters\n\n      const opts = {\n        filters,\n        scopes: getClosestScopesFacade()?.value,\n        queries: limitedFilterVariable.state.useQueriesAsFilterForOptions ? dataTrail.getQueries() : [],\n      };\n\n      // if there are too many queries it takes to much time to process the requests.\n      // In this case we favour responsiveness over reducing the number of options.\n      if (opts.queries.length > 20) {\n        opts.queries = [];\n      }\n\n      let values = (await datasourceHelper.getTagKeys(opts)).slice(0, MAX_ADHOC_VARIABLE_OPTIONS);\n\n      // use replace: true to override the default lookup in adhoc filter variable\n      return { replace: true, values };\n    },\n    getTagValuesProvider: async (\n      _: AdHocFiltersVariable,\n      filter: AdHocVariableFilter\n    ): Promise<{\n      replace?: boolean;\n      values: GetTagResponse | MetricFindValue[];\n    }> => {\n      // For the Prometheus label values endpoint, /api/v1/label/${interpolatedName}/values\n      // get the previously selected filters from the variable\n      // to use in the query to filter the response\n      // using filters, e.g. {previously_selected_label:\"value\"},\n      // as the series match[] parameter in Prometheus label values endpoint\n      const filtersValues = limitedFilterVariable.state.filters;\n      // remove current selected filter if updating a chosen filter\n      const filters = filtersValues.filter((f) => f.key !== filter.key);\n      // call getTagValues and truncate the response\n      // we're passing the queries so we get the label values that adhere to the queries\n      // we're also passing the scopes so we get the label values that adhere to the scopes filters\n\n      const opts = {\n        key: filter.key,\n        filters,\n        scopes: getClosestScopesFacade()?.value,\n        queries: limitedFilterVariable.state.useQueriesAsFilterForOptions ? dataTrail.getQueries() : [],\n      };\n\n      // if there are too many queries it takes to much time to process the requests.\n      // In this case we favour responsiveness over reducing the number of options.\n      if (opts.queries.length > 20) {\n        opts.queries = [];\n      }\n\n      const values = (await datasourceHelper.getTagValues(opts)).slice(0, MAX_ADHOC_VARIABLE_OPTIONS);\n      // use replace: true to override the default lookup in adhoc filter variable\n      return { replace: true, values };\n    },\n  });\n}\n\ninterface SceneType<T> extends Function {\n  new (...args: never[]): T;\n}\n\nexport function findObjectOfType<T extends SceneObject>(\n  scene: SceneObject,\n  check: (obj: SceneObject) => boolean,\n  returnType: SceneType<T>\n) {\n  const obj = sceneGraph.findObject(scene, check);\n  if (obj instanceof returnType) {\n    return obj;\n  } else if (obj !== null) {\n    logger.warn(`invalid return type: ${returnType.toString()}`);\n  }\n\n  return null;\n}\n","export const localeCompare = new Intl.Collator('en', { sensitivity: 'base' }).compare;\n","import { css } from '@emotion/css';\nimport { dateTimeFormat, type GrafanaTheme2 } from '@grafana/data';\nimport { sceneGraph } from '@grafana/scenes';\nimport { Card, IconButton, useStyles2 } from '@grafana/ui';\nimport React, { useMemo } from 'react';\n\nimport { type DataTrail } from './DataTrail';\nimport { VAR_FILTERS } from './shared';\nimport { getTrailStore, type DataTrailBookmark } from './TrailStore/TrailStore';\nimport { getMetricName } from './utils';\nimport { isAdHocFiltersVariable } from './utils/utils.variables';\n\ntype Props = {\n  trail?: DataTrail;\n  bookmark?: DataTrailBookmark;\n  onSelect: () => void;\n  onDelete?: () => void;\n  wide?: boolean;\n  compactHeight?: boolean;\n};\n\n// Helper function to truncate the value for a single key:value pair\nconst truncateValue = (key: string, value: string, maxLength: number) => {\n  const combinedLength = key.length + 2 + value.length; // 2 for \": \"\n  if (combinedLength > maxLength) {\n    return value.substring(0, maxLength - key.length - 5) + '...'; // 5 for \": \" and \"...\"\n  }\n  return value;\n};\n\nexport function DataTrailCard(props: Readonly<Props>) {\n  const { onSelect, onDelete, bookmark } = props;\n  const styles = useStyles2(getStyles);\n\n  const values = useMemo(() => {\n    let trail = props.trail || (bookmark && getTrailStore().getTrailForBookmark(bookmark));\n\n    if (!trail) {\n      return null;\n    }\n\n    const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, trail)!;\n    if (!isAdHocFiltersVariable(filtersVariable)) {\n      return null;\n    }\n\n    const createdAt = bookmark?.createdAt || trail.state.createdAt;\n\n    return {\n      filters: filtersVariable.state.filters,\n      metric: trail.state.metric,\n      createdAt,\n    };\n  }, [props.trail, bookmark]);\n\n  if (!values) {\n    return null;\n  }\n\n  const { filters, metric, createdAt } = values;\n\n  const heading = truncateValue('', getMetricName(metric), 27);\n  const cardHeightClassName = `${props.compactHeight && filters.length > 0 ? styles.cardTall : ''}`;\n  const cardClassName = `${styles.card} ${props.wide ? styles.cardWide : ''} ${cardHeightClassName}`;\n  return (\n    <article data-testid={`data-trail-card ${heading}`}>\n      <Card onClick={onSelect} className={cardClassName}>\n        <Card.Heading>\n          <div className={styles.metricValue}>{heading}</div>\n        </Card.Heading>\n        <Card.Meta className={styles.meta}>\n          {filters.map((f) => (\n            <span key={f.key}>\n              <div className={styles.secondaryFont}>{f.key}: </div>\n              <div className={styles.primaryFont}>{truncateValue(f.key, f.value, 44)}</div>\n            </span>\n          ))}\n        </Card.Meta>\n        <div className={styles.deleteButton}>\n          {onDelete && (\n            <Card.SecondaryActions>\n              <IconButton\n                key=\"delete\"\n                name=\"trash-alt\"\n                className={styles.secondary}\n                tooltip=\"Remove bookmark\"\n                onClick={onDelete}\n                data-testid=\"deleteButton\"\n              />\n            </Card.SecondaryActions>\n          )}\n        </div>\n      </Card>\n      <div className={styles.date}>\n        <div className={styles.secondaryFont}>Date created: </div>\n        <div className={styles.primaryFont}>{createdAt > 0 && dateTimeFormat(createdAt, { format: 'YYYY-MM-DD' })}</div>\n      </div>\n    </article>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    metricValue: css({\n      display: 'inline',\n      color: theme.colors.text.primary,\n      fontWeight: 500,\n      wordBreak: 'break-all',\n    }),\n    card: css({\n      position: 'relative',\n      width: '318px',\n      padding: `12px ${theme.spacing(2)} ${theme.spacing(1)} ${theme.spacing(2)}`,\n      alignItems: 'start',\n      marginBottom: 0,\n      borderTop: `1px solid ${theme.colors.border.weak}`,\n      borderRight: `1px solid ${theme.colors.border.weak}`,\n      borderLeft: `1px solid ${theme.colors.border.weak}`,\n      borderBottom: 'none', // Remove the bottom border\n      borderRadius: '2px 2px 0 0', // Top-left and top-right corners are 2px, bottom-left and bottom-right are 0; cannot use theme.shape.radius.default because need bottom corners to be 0\n    }),\n    cardWide: css({\n      width: '100%',\n    }),\n    cardTall: css({\n      height: '110px',\n    }),\n    secondary: css({\n      color: theme.colors.text.secondary,\n      fontSize: '12px',\n    }),\n    date: css({\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderRadius: '0 0 2px 2px',\n      padding: `${theme.spacing(1)} ${theme.spacing(2)}`,\n      backgroundColor: theme.colors.background.primary,\n    }),\n    meta: css({\n      flexWrap: 'wrap',\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      maxHeight: '36px', // 2 lines * 18px line-height\n      margin: 0,\n      gridArea: 'Meta',\n      color: theme.colors.text.secondary,\n      whiteSpace: 'nowrap',\n    }),\n    primaryFont: css({\n      display: 'inline',\n      color: theme.colors.text.primary,\n      fontSize: '12px',\n      fontWeight: '500',\n      letterSpacing: '0.018px',\n    }),\n    secondaryFont: css({\n      display: 'inline',\n      color: theme.colors.text.secondary,\n      fontSize: '12px',\n      fontWeight: '400',\n      lineHeight: '18px' /* 150% */,\n      letterSpacing: '0.018px',\n    }),\n    deleteButton: css({\n      position: 'absolute',\n      bottom: theme.spacing(1),\n      right: theme.spacing(1),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { useState } from 'react';\n\nimport { SectionTitle } from './SectionTitle';\nimport { type SideBarSectionState } from './types';\nimport { DataTrailCard } from '../../../DataTrailCard';\nimport { reportExploreMetrics } from '../../../interactions';\nimport { getBookmarkKey, getTrailStore } from '../../../TrailStore/TrailStore';\n\n// Create a simple event-based system to avoid circular dependencies\nexport const navigationEvents = {\n  listeners: new Set<(trail: any) => void>(),\n  emit: function (trail: any) {\n    this.listeners.forEach((listener) => listener(trail));\n  },\n  subscribe: function (listener: (trail: any) => void) {\n    this.listeners.add(listener);\n    return () => {\n      this.listeners.delete(listener);\n      return undefined; // Explicitly return void\n    };\n  },\n};\n\n// Simple function to navigate to a trail without using MetricsContext\nfunction goToUrlForTrail(trail: any) {\n  navigationEvents.emit(trail);\n}\n\ninterface BookmarksListState extends SideBarSectionState {}\n\nexport class BookmarksList extends SceneObjectBase<BookmarksListState> {\n  constructor({\n    key,\n    title,\n    description,\n    icon,\n    disabled,\n  }: {\n    key: BookmarksListState['key'];\n    title: BookmarksListState['title'];\n    description: BookmarksListState['description'];\n    icon: BookmarksListState['icon'];\n    disabled?: BookmarksListState['disabled'];\n  }) {\n    super({\n      key,\n      title,\n      description,\n      icon,\n      disabled: disabled ?? false,\n      active: false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {}\n\n  public static readonly Component = ({ model }: SceneComponentProps<BookmarksList>) => {\n    const styles = useStyles2(getStyles);\n    const { title, description } = model.useState();\n    const { bookmarks } = getTrailStore();\n    const [, setLastDelete] = useState(Date.now());\n\n    const onSelect = (index: number) => {\n      reportExploreMetrics('exploration_started', { cause: 'bookmark_clicked' });\n      const trail = getTrailStore().getTrailForBookmarkIndex(index);\n      getTrailStore().setRecentTrail(trail);\n      goToUrlForTrail(trail);\n    };\n\n    const onDelete = (index: number) => {\n      reportExploreMetrics('bookmark_changed', { action: 'deleted' });\n      getTrailStore().removeBookmark(index);\n      setLastDelete(Date.now()); // trigger re-render\n    };\n\n    return (\n      <div className={styles.container}>\n        <SectionTitle title={title} description={description} data-testid=\"bookmarks-list-sidebar\" />\n        {bookmarks.length > 0 ? (\n          <div className={styles.bookmarksList}>\n            {bookmarks.map((bookmark, index) => (\n              <DataTrailCard\n                key={getBookmarkKey(bookmark)}\n                bookmark={bookmark}\n                onSelect={() => onSelect(index)}\n                onDelete={() => onDelete(index)}\n                wide={true}\n                compactHeight={true}\n              />\n            ))}\n          </div>\n        ) : (\n          <div className={styles.emptyState}>No bookmarks yet</div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n      height: '100%',\n    }),\n    bookmarksList: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1.5),\n      overflowY: 'auto',\n      paddingRight: theme.spacing(1),\n    }),\n    emptyState: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      height: '100px',\n      color: theme.colors.text.secondary,\n      fontStyle: 'italic',\n    }),\n  };\n}\n","import { Alert, type AlertVariant } from '@grafana/ui';\nimport React from 'react';\n\nimport { logger, type ErrorContext } from '../tracking/logger/logger';\n\ntype InlineBannerProps = {\n  severity: AlertVariant;\n  title: string;\n  message?: string | React.ReactNode;\n  error?: Error;\n  errorContext?: ErrorContext;\n  children?: React.ReactNode;\n};\n\nexport function InlineBanner({ severity, title, message, error, errorContext, children }: Readonly<InlineBannerProps>) {\n  let errorObject;\n\n  if (error) {\n    errorObject = typeof error === 'string' ? new Error(error) : error;\n\n    logger.error(errorObject, {\n      ...(errorObject.cause || {}),\n      ...errorContext,\n      bannerTitle: title,\n    });\n  }\n\n  return (\n    <Alert title={title} severity={severity}>\n      {errorObject && (\n        <>\n          {errorObject.message || errorObject.toString()}\n          <br />\n        </>\n      )}\n      {message}\n      {children}\n    </Alert>\n  );\n}\n","import { type DataSourceInstanceSettings, type DataSourceJsonData } from '@grafana/data';\nimport { type PrometheusDatasource } from '@grafana/prometheus';\nimport { getBackendSrv, getDataSourceSrv } from '@grafana/runtime';\n\nimport { logger } from '../tracking/logger/logger';\nexport type DataSource = DataSourceInstanceSettings<DataSourceJsonData>;\n\n// This regex matches Grafana developed Prometheus data sources that are compatible with the vanilla Prometheus data source\nconst PROMETHEUS_DATA_SOURCE_REGEX = /^grafana-[0-9a-z]+prometheus-datasource$/;\n\n/**\n * Helper function to determine if a datasource is a Prometheus datasource\n */\nexport function isPrometheusDataSource(input: unknown): input is PrometheusDatasource {\n  return (\n    typeof input === 'object' &&\n    input !== null &&\n    'type' in input &&\n    typeof input.type === 'string' &&\n    (input.type === 'prometheus' || PROMETHEUS_DATA_SOURCE_REGEX.test(input.type)) &&\n    'uid' in input &&\n    typeof input.uid === 'string'\n  );\n}\n\ntype DataSourceType = 'prometheus' | 'loki';\n\n/**\n * Fetches and caches healthy data sources\n */\nexport class DataSourceFetcher {\n  private readonly pendingRequests = new Map<DataSourceType, Promise<DataSource[]>>();\n  private readonly cache = new Map<DataSourceType, DataSource[]>();\n\n  /**\n   * Retrieves healthy data sources of the specified type\n   * Results are cached indefinitely until the `DataSourceFetcher` is destroyed\n   *\n   * @param type - The type of data source to retrieve ('prometheus' or loki)\n   * @returns Array of healthy data sources\n   */\n  public async getHealthyDataSources(type: DataSourceType): Promise<DataSource[]> {\n    // Check if we have cached results\n    const cachedDataSources = this.cache.get(type);\n    if (cachedDataSources?.length) {\n      return cachedDataSources;\n    }\n\n    // If there's already a pending request for this type, wait for it\n    let pendingRequest = this.pendingRequests.get(type);\n    if (!pendingRequest) {\n      pendingRequest = this.fetchHealthyDataSources(type).finally(() => {\n        // Clean up the pending request after it completes\n        this.pendingRequests.delete(type);\n      });\n      this.pendingRequests.set(type, pendingRequest);\n    }\n\n    // Wait for the request to complete and update cache\n    const dataSources = await pendingRequest;\n    this.cache.set(type, dataSources);\n\n    return dataSources;\n  }\n\n  /**\n   * Fetches healthy data sources of the specified type\n   */\n  private async fetchHealthyDataSources(type: DataSourceType): Promise<DataSource[]> {\n    const allDataSourcesOfType = getDataSourceSrv().getList({\n      logs: true,\n      type,\n      filter: (ds) => ds.uid !== 'grafana',\n    });\n\n    const healthyDataSources: DataSource[] = [];\n    const unhealthyDataSources: DataSource[] = [];\n\n    await Promise.all(\n      allDataSourcesOfType.map(async (ds) => {\n        try {\n          const health = await getBackendSrv().get(`/api/datasources/uid/${ds.uid}/health`, undefined, undefined, {\n            showSuccessAlert: false,\n            showErrorAlert: false,\n          });\n\n          if (health?.status === 'OK') {\n            healthyDataSources.push(ds);\n          } else {\n            unhealthyDataSources.push(ds);\n          }\n        } catch {\n          unhealthyDataSources.push(ds);\n        }\n      })\n    );\n\n    if (unhealthyDataSources.length > 0) {\n      logger.warn(\n        `Found ${unhealthyDataSources.length} unhealthy ${type} data sources: ${unhealthyDataSources\n          .map((ds) => ds.name)\n          .join(', ')}`\n      );\n    }\n\n    return healthyDataSources;\n  }\n}\n\nlet dataSourceFetcherSingleton: DataSourceFetcher | undefined;\n\nexport function getDataSourceFetcher(): DataSourceFetcher {\n  if (!dataSourceFetcherSingleton) {\n    dataSourceFetcherSingleton = new DataSourceFetcher();\n  }\n\n  return dataSourceFetcherSingleton;\n}\n","import React, { lazy, useContext } from 'react';\nimport { Navigate, Route, Routes, useLocation } from 'react-router-dom';\n\nimport { ROUTES } from '../constants';\nimport { MetricsContext } from './useTrail';\n\nexport const Wingman = lazy(() => import('../pages/TrailWingman'));\n\n// For /trail links, redirect to /drilldown with the same search params\nconst TrailRedirect = () => {\n  const location = useLocation();\n  return <Navigate to={`${ROUTES.Drilldown}${location.search}`} replace />;\n};\n\nexport const AppRoutes = () => {\n  const { trail } = useContext(MetricsContext);\n\n  return (\n    <Routes>\n      <Route path={ROUTES.Drilldown} element={<Wingman trail={trail} />} />\n      <Route path={ROUTES.Trail} element={<TrailRedirect />} />\n      {/* catch-all route */}\n      <Route path=\"*\" element={<Navigate to={ROUTES.Drilldown} replace />} />\n    </Routes>\n  );\n};\n"],"names":["EventConfigurePanel","BusEventWithPayload","type","ConfigurePanelAction","SceneObjectBase","constructor","metric","disabled","userPrefs","userStorage","getItem","PREF_KEYS","METRIC_PREFS","super","undefined","isAlreadyConfigured","Boolean","config","onClick","this","publishEvent","state","Component","model","styles","useStyles2","getStyles","useState","label","Button","className","cx","selectButton","active","aria-label","variant","size","fill","icon","tooltip","tooltipPlacement","data-testid","theme","css","colors","text","maxContrast","CONFIG_PRESETS","TIMESERIES_AVG","TIMESERIES_SUM","TIMESERIES_STDDEV","TIMESERIES_PERCENTILES","TIMESERIES_MIN_MAX","TIMESERIES_AGE_TIME_MINUS_AVG","TIMESERIES_AGE_TIME_MINUS_MIN_MAX","HISTOGRAM_HEATMAP","HISTOGRAM_PERCENTILES","STATUS_UPDOWN_HISTORY","STATUS_UPDOWN_STAT","PROMQL_FUNCTIONS","Map","map","name","fn","args","expr","parameter","availableConfigPresetIds","Set","Object","values","availablePanelTypes","getPreferredConfigForMetric","metricConfig","every","key","id","has","panelOptions","Array","isArray","queryOptions","queries","q","includes","params","percentiles","length","p","isValid","reportExploreMetrics","setItem","displayWarning","PANEL_HEIGHT","DEFAULT_TIMESERIES_AGE_PRESETS","description","DEFAULT_HISTOGRAMS_PRESETS","DEFAULT_STATUS_UP_DOWN_PRESETS","DEFAULT_TIMESERIES_PRESETS","DEFAULT_TIMESERIES_RATE_PRESETS","COUNTER_METRIC_SUFFIXES","isCounterMetric","suffix","split","at","isHistogramMetric","endsWith","isAgeMetric","isStatusUpDownMetric","EventPanelTypeChanged","SelectAction","MetricSelectedEvent","QUERY_RESOLUTION","expressionToString","expression","toString","replaceAll","buildQueryExpression","options","labelMatchers","addIgnoreUsageFilter","defaultSelectors","m","utf8Support","operator","value","push","MatchingOperator","equal","isValidLegacyName","VAR_FILTERS_EXPR","Expression","defaultOperator","DEFAULT_UNIT","UNIT_BYTES","UNIT_SECONDS","UNIT_PERCENT","UNIT_COUNT","UNIT_MAP","UNIT_LIST","keys","RATE_UNIT_MAP","getUnitFromMetric","metricParts","toLowerCase","slice","i","Math","max","part","getUnit","metricName","metricPart","getPerSecondRateUnit","buildHeatmapPanel","panelConfig","histogramType","queryConfig","queryParams","isNativeHistogram","promql","rate","query","sum","by","maxDataPoints","resolution","HIGH","refId","format","fromExploreMetrics","getHeatmapQueryRunnerParams","unit","queryRunner","SceneQueryRunner","datasource","trailDS","PanelBuilders","heatmap","setTitle","title","setDescription","setHeaderActions","headerActions","setMenu","menu","clone","setShowMenuAlways","setData","setUnit","setOption","mode","HeatmapColorMode","Scheme","exponent","scheme","steps","reverse","legend","build","DEFAULT_PERCENTILES","getPercentilesQueryRunnerParams","isCounterMetricFn","isRateQuery","queryDefs","newExpr","entry","get","fnName","percentile","legendFormat","buildNonHistogramQueries","buildHistogramQueries","buildPercentilesPanel","$data","startColorIndex","fixedColorIndex","timeseries","TooltipDisplayMode","Multi","sort","SortOrder","Descending","setCustomFieldConfig","setOverrides","b","forEach","matchFieldsByQuery","overrideColor","fixedColor","getColorByIndex","buildQueriesWithPresetFunctions","defaultPromqlFn","UP_DOWN_VALUE_MAPPINGS","MappingType","ValueToText","color","buildStatPanel","interval","getStatQueryRunnerParams","stat","setColor","setMappings","buildStatushistoryPanel","min","getStatushistoryQueryRunnerParams","statushistory","VisibilityMode","Never","addUnspecifiedLabel","source","pipe","data","d","fields","labels","nonRateQueryFunctions","buildPrometheusQuery","filters","groupings","ignoreUsage","nonRateQueryFunction","filterExtremeValues","isUtf8Metric","filter","metricPartString","replace","and","left","right","getPromqlFunction","extremeValueFilterBehavior","panel","sceneGraph","findDescendents","queryRunnerSub","subscribeToState","LoadingState","Done","series","frame","valuesField","find","field","entities","NaN","isDataFrameAllNaN","isAllDataNaN","interpolate","extremeValueRemoval","success","issue","queryParsing","queryExpression","VAR_METRIC_EXPR","tree","parser","parse","iterate","enter","node","functionName","child","firstChild","nextSibling","from","to","isNonRateQueryFunction","parent","labelData","processLabelMatcher","op","grouping","extractGroupings","queryParts","error","Error","message","String","parseQueryForRebuild","filteredQuery","unsubscribe","newQueryRunner","setState","titleItems","VizPanelExtremeValuesMessage","level","runQueries","removeExtremeValues","logger","warn","div","extremeValuedisclaimer","Tooltip","content","span","warningMessage","Icon","aria-hidden","display","alignItems","gap","spacing","warning","main","info","fontSize","typography","bodySmall","getTimeseriesQueryRunnerParams","groupBy","buildGroupByQueries","avg","buildTimeseriesPanel","SceneDataTransformer","transformations","showLegend","placement","buildGroupByPanel","vizPanelBuilder","setBehaviors","GmdVizPanel","onActivate","discardPanelTypeUpdates","getTrailFor","updateBody","subscribeToStateChanges","subscribeToEvents","getDefaultPanelTypeForMetric","newState","prevState","isEqual","subscribeToEvent","event","payload","panelType","body","TypeError","update","discardUserPrefs","prefConfig","height","M","MEDIUM","addActivationHandler","container","LayoutType","LayoutSwitcher","getUrlState","urlSearchParamName","layout","updateFromUrl","stateUpdate","newLayout","o","DEFAULT_LAYOUT","DEFAULT_OPTIONS","_urlSync","SceneObjectUrlSyncConfig","onChange","RadioButtonGroup","fullWidth","SceneByVariableRepeater","performRepeat","_variableDependency","hasDependencyInLoadingState","loadingLayout","getLayoutLoading","errorLayout","emptyLayout","currentBatchSize","variable","lookupVariable","variableName","MultiValueVariable","getLayoutError","getMultiVariableValues","getLayoutEmpty","initialPageSize","newChildren","option","index","getLayoutChild","children","increaseBatchSize","newBatchSize","pageSizeIncrement","useSizes","total","remaining","increment","current","VariableDependencyConfig","variableNames","onVariableUpdateCompleted","hasAllValue","v","ShowMoreButton","batchSizes","EventSortByChanged","usageRequestOptions","showSuccessAlert","showErrorAlert","fetchAlertingMetrics","counts","result","usageType","count","transformCountsToAlertingUsage","alertingRules","metricCounts","relevantRules","rule","prometheusQueries","datasourceUid","metrics","extractMetricNames","parseAlertingRules","getBackendSrv","err","dashboardRequestMap","getDashboardLimited","limitFunction","dashboardUid","url","dashboardRequestsFailedCount","promise","then","dashboard","catch","Promise","resolve","finally","delete","set","concurrency","fetchDashboardMetrics","dashboards","limit","all","uid","parseDashboardSearchResponse","updateMetricUsage","dashboardName","dashboardUrl","dashboardData","dashboardSearchResponse","relevantDashboards","panels","relevantPanels","isPrometheusDataSource","targets","target","MetricUsageFetcher","getUsageMetrics","_usageState","metricsPromise","fetcher","getUsageForMetric","getUsageDetailsForMetric","getRecentMetrics","recentMetrics","RECENT_METRICS","thirtyDaysAgo","Date","now","RECENT_METRICS_EXPIRY_DAYS","validMetrics","timestamp","sortByOptions","VAR_WINGMAN_SORT_BY","MetricsSorter","activationHandler","sortByVar","getVariables","getByName","supportedSortByOptions","getValue","changeValueTo","_subs","add","sortBy","usageFetcher","metricsToCounts","$variables","SceneVariableSet","variables","CustomVariable","join","inputControls","VariableValueSelectors","initialized","sortMetricsWithRecentFirst","allRecentMetrics","allRecentMetricsSet","recent","nonRecent","reduce","sortedNonRecent","a","localeCompare","sortMetricsAlphabetically","MetricsDrilldownDataSourceVariable","DataSourceVariable","skipUrlSync","DATASOURCE","getCurrentDataSource","prometheusDataSources","datasources","ds","uidFromUrl","URL","window","location","href","searchParams","VAR_DATASOURCE","uidFromLocalStorage","currentDataSource","isDefault","initialDS","pluginId","bind","areArraysEqual","array1","array2","VAR_METRICS_VARIABLE","MetricsVariable","QueryVariable","VAR_FILTERS","includeAll","refresh","VariableRefresh","onTimeRangeChanged","VariableSort","alphabeticalAsc","hide","VariableHide","hideVariable","languageProviderVersionIs","languageProvider","fetchLabelValues","queryLabelKeys","MetricDatasourceHelper","getRuntimeDatasource","getDataSourceSrv","VAR_DATASOURCE_EXPR","__sceneObject","trail","init","sub","subs","metricsVariable","findByKeyAndType","initializeClassicHistograms","datasourceVariable","reset","metricsMetadata","metadataFetchP","classicHistograms","metricsVariableOptions","metricData","metadata","getMetadataForMetric","ensureMetricsMetadata","getMetricsMetadata","queryMetadata","queryMetricsMetadata","getQueryMetricsMetadata","loadMetadata","retrieveMetricsMetadata","loadMetricsMetadata","getLoadMetricsMetadata","entries","getTagKeys","test","isWrappedInQuotes","unwrapQuotes","getTagValues","fetchLabels","timeRange","matcher","fetchLabelsWithMatch","labelName","queryLabelValues","fetchSeriesValuesWithMatch","getPrometheusDataSourceForScene","sceneObject","dsVariable","findByKey","displayError","NULL_GROUP_BY_VALUE","LabelsDataSource","RuntimeDataSource","FieldType","other","metricFindQuery","scopedVars","valueOf","match","labelOptions","getLabelsMatchAPISupport","getFiltersFromVariable","response","processLabelOptions","getTimeRange","hasLabelsMatchAPISupport","filtersVariable","isAdHocFiltersVariable","startsWith","testDatasource","status","VAR_LABEL_VALUES","LabelValuesVariable","isMulti","allowCustomValue","VAR_WINGMAN_GROUP_BY","LabelsVariable","refreshOptions","AdHocFiltersVariable","filterExpression","updateQuery","placeholder","Label","background","primary","shape","radius","default","border","weak","GroupsIcon","svg","stroke","width","viewBox","circle","cy","r","strokeWidth","path","EventMetricsVariableActivated","EventMetricsVariableDeactivated","EventMetricsVariableLoaded","withLifecycleEvents","loading","MetricsWithLabelValueDataSource","metricsList","removeRules","isPrometheusRule","VAR_METRIC_WITH_LABEL_VALUE","MetricsWithLabelValueVariable","labelValue","adHocFiltersVariable","buildQuery","MetricsGroupByRow","subscribeToLayoutChange","layoutSwitcher","onChangeState","templateColumns","ROWS","GRID_TEMPLATE_ROWS","GRID_TEMPLATE_COLUMNS","labelCardinality","SceneCSSGridLayout","isLazy","autoRows","VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW","$behaviors","behaviors","sync","DashboardCursorSync","Crosshair","SceneReactObject","reactNode","Spinner","inline","InlineBanner","severity","colorIndex","SceneCSSGridItem","WithUsageDataPreviewPanel","vizPanelInGridItem","canvas","margin","boxShadow","containerHeader","marginBottom","paddingBottom","borderBottom","medium","headerButtons","position","top","marginLeft","marginRight","zIndex","collapsableSectionBody","flexDirection","padding","groupName","lineHeight","secondary","footer","justifyContent","marginTop","isCollapsed","setIsCollapsed","shouldDisplayShowMoreButton","CollapsableSection","isOpen","onToggle","MetricsGroupByList","rowGap","VAR_FILTERED_METRICS_VARIABLE","FilteredMetricsVariable","CountsProvider","useCounts","MetricVariableCountsProvider","nonFilteredVariable","filteredVariable","setInitCounts","initCounts","EventQuickSearchChanged","QuickSearch","newValue","toggleCountsDisplay","displayCounts","updateValue","notifyValueChange","useHumanFriendlyCountsMessage","targetName","countsProvider","tagName","tooltipContent","onReferencedVariableValueChanged","debounce","searchText","e","currentTarget","clear","onKeyDown","preventDefault","Input","prefix","Tag","IconButton","ListControls","EmbeddedScene","SceneFlexLayout","direction","maxHeight","SceneFlexItem","headerWrapper","MetricsVariableFilterEngine","setInitOptions","initOptions","cloneDeep","getFilteredOptions","filteredOptions","categories","applyCategoryFilters","prefixes","applyPrefixFilters","suffixes","applySuffixFilters","names","applyNameFilters","applyFilters","settings","forceUpdate","notify","updatedFilters","notifyUpdate","category","categoryRegex","buildRegex","concat","pattern","prefixesRegex","s","suffixesRegex","namePatterns","regexes","trim","RegExp","some","regex","flags","SceneVariableValueChangedEvent","metricToTargetLevenDistances","getLevenDistances","targetMetric","targetToDistances","distances","metricSplit","metricHalf","halfLeven","leven","wholeLeven","MetricsVariableSortEngine","lastMetrics","sortedMetrics","sortByUsage","metricList","aValue","bValue","metricsSorter","usageMetrics","scoreA","scoreB","sortMetricsByCount","EventFiltersChanged","ruleGroupLabels","EventSectionValueChanged","CheckboxWithCount","checked","checkboxWrapper","Checkbox","whiteSpace","overflow","textOverflow","CheckBoxList","groups","selectedGroups","onSelectionChange","checkboxListHeader","noResults","ul","checkboxList","group","li","checkboxItem","g","newGroups","overflowY","borderRadius","backgroundColor","shade","fontStyle","MetricsFilterSection","filteredMetricsVariable","updateLists","updateCounts","computeGroups","metricsReducer","originalOptions","filterEngine","getAncestor","MetricsReducer","enginesMap","filtersWithoutCurrentType","getFilters","optionsForCounting","newGroupsWithCount","showHideEmpty","showSearch","filter_count","filterType","filter_type","switchContainer","switchLabel","searchInput","flexBasis","flexShrink","hideEmpty","setHideEmpty","searchValue","setSearchValue","filteredGroups","useMemo","item","SectionTitle","Switch","computeMetricPrefixGroups","rawPrefixesMap","parts","prefixesMap","computeMetricSuffixGroups","rawSuffixesMap","suffixesMap","isRecordingRule","computeRulesGroups","rulesMap","LabelsList","selectedLabel","onClickLabel","onClickClearSelection","listHeader","selected","list","RadioButtonList","flex","cursor","LabelsBrowser","labelsVariable","selectLabel","useLabelsBrowser","labelsList","onInputChange","onInputKeyDown","onInputClear","search","Settings","CustomIcons","rect","x","y","rx","SideBarButton","ariaLabel","visible","iconOrText","buttonIcon","ButtonChild","availableIconsIndex","button","metricFiltersVariables","SideBar","cleanupOtherMetricsVar","initOtherMetricsVar","sectionValues","newSectionValues","setOtherMetricFilters","otherMetricFiltersVar","VAR_OTHER_METRIC_FILTERS","varToTextMap","newFilters","acc","keyLabel","hideLabel","currentVariableSet","readOnly","applyMode","getSectionValuesFromUrl","urlSearchParams","URLSearchParams","filterKey","filterValueFromUrl","setActiveSection","sectionKey","visibleSection","sections","action","section","BookmarksList","buttonsBar","boxSizing","borderTopLeftRadius","borderBottomLeftRadius","buttonContainer","transition","borderLeft","selectedBorder","opacity","visibility","closeButton","groupByValue","updateBasedOnGroupBy","hasGroupByValue","MetricsList","initVariablesFilteringAndSorting","filteredMetrics","unshift","updatedMetrics","errorObject","cause","addRecentMetric","sortEngine","quickSearch","filterSections","findAllObjects","sortByVariable","filterSection","listControls","sidebar","dataSources","dataSource","registerRuntimeDataSource","registerRuntimeDataSources","useChromeHeaderHeight","chromeHeaderHeight","APP_HEADER_HEIGHT","UsageData","usageCount","singularUsageType","pluralUsageType","dashboardItems","usageContainer","Dropdown","overlay","Menu","style","maxWidth","Item","menuItem","component","menuItemContent","usageItem","clickableUsageItem","borderTopWidth","textDecoration","link","VIZ_PANEL_HEIGHT","_onActivate","isCustomVariable","updateSortBy","updateLayout","usage","dashboardInfo","gridLayout","currentGridLayoutHeight","expectedPanelHeight","log","EventApplyPanelConfig","EventCancelConfigurePanel","AVAILABLE_PERCENTILES_OPTIONS","WithConfigPanelOptions","initPercentilesParams","show","presetId","isSelected","onSelect","onTogglePercentile","newQueryConfig","Number","checkedOptions","onClickPreset","bodyAndParams","paramsContainer","param","radioContainer","htmlFor","input","ConfigurePanelForm","syncTimeRange","buildBody","metricScene","DataTrail","timeZone","presets","getConfigPresetsForMetric","selectedPresetId","onSelectPreset","restoreDefault","userPrefForMetric","getPanelConfigFromPreset","preset","omit","$timeRange","SceneTimeRange","controls","SceneTimePicker","SceneRefreshPicker","isConfirmModalOpen","onClickRestoreDefault","onClickConfirmRestoreDefault","defaultPreset","closeConfirmModal","onClickCancel","onClickApplyConfig","presetPanel","presetWithQueryParams","controlsContainer","messageContainer","formButtonsContainer","getMetricType","control","ConfirmModal","confirmText","onConfirm","onDismiss","PluginLogo","memo","img","logo","src","pluginCommitSha","GIT_COMMIT","pluginCommitURL","buildInfo","grafanaBuildInfo","InfoMenuHeader","meta","version","updated","usePluginContext","menuHeader","h5","subTitle","InfoMenu","isDev","shortCommitSha","header","open","Divider","edition","env","commit","PluginInfo","SceneDrawer","close","Drawer","subtitle","closeOnMaskClick","onClose","GroupByVariable","VAR_GROUP_BY","defaultToAll","select","UI_TEXT","OPEN_EXPLORE_LABEL","COPY_URL_LABEL","BOOKMARK_LABEL","SELECT_NEW_METRIC_TOOLTIP","GmdVizPanelVariantSelector","vizPanel","currentPanelType","newPanelType","getQueryRunnerFor","dataProvider","isSceneQueryRunner","extensionPointId","pluginJson","AddToExplorationButton","getPanelConfigAndDataFrames","findObjectOfType","VizPanel","getData","fieldConfig","frames","getQueries","getContext","dsUid","findObject","getFilter","JSON","stringify","updateFieldConfigOverrides","properties","existingOverride","overrides","displayNameFromDS","displayName","fieldName","ctx","origin","logoPath","MimirLogo","drillDownLabel","context","links","usePluginLinks","limitPerPlugin","filterNameAndValueObj","ADD_TO_INVESTIGATION_MENU_TEXT","ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT","ADD_TO_INVESTIGATION_MENU_GROUP_TEXT","PanelMenu","addItem","setItems","items","addExplorationsLink","exploreUrl","viz","panelData","getExploreURL","iconClassName","shortcut","VizPanelMenu","addToExplorationsButton","addToExplorationButton","explorationsButton","getInvestigationLink","existingMenuItems","existingAddToExplorationLink","activate","addToExplorations","getPluginLinkExtensions","extensions","getObservablePluginLinks","firstValueFrom","getAppBackgroundColor","embedded","isLight","MAIN_PANEL_MIN_HEIGHT","XL","TOPVIEW_KEY","MetricGraphScene","topView","help","getMetricDescription","isHistogram","minHeight","ySizing","MetricActionBar","selectedTab","headerHeight","flexGrow","sticky","paddingTop","nonSticky","stickyMainGraph","getTrailSettings","METRIC_PREFIX_ALL_OPTION","PrefixFilterDropdown","metricPrefix","parseMetricPrefixes","prefixGroups","newOptions","selectOption","tooltipIcon","InlineField","InlineLabel","Combobox","RelatedListControls","RelatedMetricsScene","COPY_LABEL","ShareTrailButton","setTooltip","ToolbarButton","navigator","clipboard","appUrl","PLUGIN_BASE_URL","getUrlForTrail","writeText","setTimeout","EventTimeseriesDataReceived","EventForceSyncYAxis","EventResetSyncYAxis","syncYAxis","vizPanelsParent","NEGATIVE_INFINITY","POSITIVE_INFINITY","timeRangeSub","resetSub","forceSub","newMax","newMin","nonSyncedPanels","findTimeseriesPanels","t","defaults","findNewMaxMin","updateTimeseriesAxis","dataReceivedSub","clearFieldConfigCache","merge","SelectLabelAction","groupByVariable","isQueryVariable","publishTimeseriesData","addRefId","SERIES_COUNT_STATS_NAME","sliceSeries","start","end","stats","LABELS_VIZ_PANEL_HEIGHT","LabelVizPanel","buildVizPanel","getAllValuesConfig","seriesCountStats","seriesCount","getOverrides","FieldMatcherID","byFrameRefID","MetricLabelsList","sceneUtils","syncStateFromSearchParams","Controls","Field","AddToFiltersGraphAction","addFilterWithoutReportingInteraction","getLabelValueFromDataFrame","SortBySelector","BREAKDOWN_SORTBY","sortByTooltip","isClearable","SceneByFrameRepeater","Loading","filteredSeries","filterAndSort","initFilterAndSort","sortSeries","getCounts","LabelValuesCountsProvider","LABEL_VALUE_VIZ_PANEL_HEIGHT","LabelValueVizPanel","MetricLabelValuesList","subscribeToQuickSearchChange","byFrameRepeater","subscribeToSortByChange","sortBySelector","SINGLE","buildSinglePanel","existingByFrameRepeater","buildByFrameRepeater","errors","frameIndex","SceneDataNode","quickSearchField","GRID","singlePanelContainer","listContainer","listFooter","SingleMetricPanelComponent","ByFrameRepeaterComponent","LabelBreakdownScene","getVariable","oldState","featureToggles","enableScopesInMetricsExplore","RefreshMetricsEvent","searchField","actionViews","actionViewsDefinitions","getScene","createRelatedLogsScene","getLinkToExplore","MetricScene","openExploreLink","actions","breakpoints","up","md","customTabsBar","isBookmarked","toggleBookmark","getBookmarkIndex","getTrailStore","indexOnRender","bookmarkIndex","setBookmarkIndex","useEffect","SceneObjectStateChangedEvent","indexToRemove","removeBookmark","addBookmark","useBookmarkState","actionView","Box","paddingY","Stack","LinkButton","createAppUrl","TabsBar","tab","counter","relatedLogsCount","isActive","tabRender","Tab","onChangeTab","view","related_logs_count","relatedLogsOrchestrator","checkConditionsMetForRelatedLogs","setActionView","knownLabelNameDiscrepancies","job","instance","replaceKnownLabelNames","createLabelsCrossReferenceConnector","scene","conditionsMetForRelatedLogs","getDataSources","lokiDataSources","getDataSourceFetcher","getHealthyDataSources","results","hasLabels","labelKeys","availableLabels","f","lokiLabelName","hasMatchingLabels","getLokiQueryExpr","getLokiQueryForRelatedMetric","dataSourceUid","extractedRecordingRules","targetRule","hasMetricExpr","MetricExpr","isLogsQuery","selectorNode","getNodeFromQuery","Selector","selector","substring","pipelineExprNode","PipelineExpr","pipelineExpr","getLogQueryFromMetricsQuery","fetchAndExtractLokiRecordingRules","extractedRules","ruleGroups","rg","rules","existingRule","hasMultipleOccurrences","extractRecordingRulesFromRuleGroups","datasourceSettings","recordingRules","res","lastValueFrom","fetch","ok","createLokiRecordingRulesConnector","lokiRecordingRules","selectedMetric","foundLokiDataSources","recRules","rr","getDataSourcesWithRecordingRulesContainingMetric","nodeType","foundNode","RelatedLogsOrchestrator","_internalState","currentDataSourcesSignature","newDataSourcesSignature","_changeHandlers","handler","addLokiDataSourcesChangeHandler","addRelatedLogsCountChangeHandler","findAndCheckAllDatasources","allLokiDatasources","_dataSourceFetcher","checkLogsInDataSources","maxLines","_metricScene","queriesByConnector","_logsConnectors","connector","idx","lokiExpr","connectorName","supportingQueryType","datasourcesWithLogs","totalLogsCount","totalChecked","getLokiQueries","rowCount","countLogsLines","NoRelatedLogs","Alert","Text","TextLink","external","paddingLeft","OpenInLogsDrilldownButton","memoizedContext","isLoading","logsDrilldownLink","logsDrilldownLinkExists","appSubUrl","LOGS_PANEL_CONTAINER_KEY","RelatedLogsScene","orchestrator","setupLogsPanel","showNoLogsFound","_buildQueryRunner","_queryRunner","VAR_LOGS_DATASOURCE_EXPR","_constructLogsDrilldownLinkContext","logs","logsDataSourceVariable","VAR_LOGS_DATASOURCE","updateLokiQuery","logsDrilldownLinkContext","selectedDatasourceVar","selectedDatasourceUid","props","handleFiltersChange","grow","actionViewDef","actionViewType","getVariablesWithMetricConstant","DataTrailSettings","onToggleStickyMainGraph","onToggleOpen","popover","shadows","z3","heading","fontWeight","fontWeightMedium","gridTemplateColumns","columnGap","topScene","evt","stopPropagation","onVisibleChange","metricSearch","nativeHistogramMetric","assign","getSceneUpdatesForNewMetricValue","datasourceHelper","subscribeToConfigEvents","trailActivated","getTopSceneFor","_handleMetricSelectedEvent","_addingFilterWithoutReportingInteraction","reportChangeInLabelFilters","useQueriesAsFilterForOptions","drawer","saveRecentTrail","hasFilters","setRecentTrail","addEventListener","removeEventListener","metricType","configId","panelsToUpdate","displaySuccess","filterVar","baseFilters","getBaseFiltersForMetric","performBrowserHistoryAction","sqr","getVariableSet","initialFilters","SceneControlsSpacer","pluginInfo","createdAt","getTime","dashboardMetrics","alertingMetrics","nativeHistogram","addFilterButtonText","dontHide","expressionBuilder","scopeFilters","ScopesVariable","enable","flexWrap","navbarFixed","settingsInfo","updateAppControlsHeight","appControls","document","querySelector","getBoundingClientRect","documentElement","setProperty","limitAdhocProviders","resizeObserver","ResizeObserver","observe","disconnect","removeProperty","UrlSyncContextProvider","createBrowserHistorySteps","updateUrlOnInit","namespace","urlNamespace","BOOKMARKS","sortAlphabetical","compareFn","labelA","labelB","sortByFieldReducer","fieldReducer","fieldReducers","seriesCalcs","dataFrame","doStandardCalcs","getOutliers","joined","outerJoinDataFrames","points","number","Float64Array","OutlierDetector","dbscan","sensitivity","detect","calculateOutlierValue","outliers","seriesResults","isOutlier","outlierIntervals","memoize","origSeries","wasmSupported","sortByOutliers","msg","ReducerID","stdDev","firstTimestamp","seriesIsNotEmpty","lastTimestamp","support","WebAssembly","h6","infoIcon","fontWeightLight","ensureErrorObject","defaultMessage","useCatchExceptions","setError","onError","errorEvent","filename","protocol","lineno","colno","shouldTreatAsApplicationError","onUnHandledRejection","reason","HOME_ROUTE","VAR_METRIC","LOGS_METRIC","ConstantVariable","BusEventBase","RECENT_TRAILS_KEY","TrailStore","_loadRecentTrailsFromStorage","serializedTrails","_deserializeTrail","getRef","_loadBookmarksFromStorage","serialized","step","currentStep","history","urlValues","urlSerializedTrail","_loadFromUrl","cloneSceneObjectState","_serializeTrail","getTrailForBookmarkIndex","bookmark","_bookmarks","getTrailForBookmark","newMetricsTrail","getBookmarkKey","_recent","urlState","urlUtil","renderUrl","lastModified","_lastModified","load","_refreshBookmarkIndexMap","recentTrail","recentUrlState","getUrlStateForComparison","_save","bookmarks","bookmarkState","appEvents","getAppEvents","isSidebarView","currentPathIncludes","ROUTES","Drilldown","infoText","publish","AppEvents","alertSuccess","createBookmarkSavedNotification","splice","bookmarkKey","_bookmarkIndexMap","bookmarked","doSave","serializedRecent","correctUrlStateForComparison","store","migrate","hasMigrations","migrations","legacyKey","newKey","existingItem","localStorage","removeItem","buildStorageKey","service","storageKey","MetricsContext","createContext","goToUrlForTrail","useTrail","setTrail","locationService","navigationEvents","subscribe","ErrorView","navigate","useNavigate","pathname","useLocation","onClickReload","useCallback","newSearchParams","reload","isCollapseOpen","setIsCollapseOpen","errorContext","handheldBy","Collapse","callStack","collapsible","pre","code","stack","outline","INTERACTION_NAME_PREFIX","reportInteraction","appRelease","apps","PLUGIN_ID","appVersion","reportLabelFilterChange","oldFilters","oldFilter","newFilter","detectChangedFilters","detectRemovedFilters","detectAddedFilters","msgs","alertError","alertWarning","getClosestScopesFacade","ScopesFacade","getSelectedScopes","selectedScopes","getSelectedScopesNames","scope","setSelectedScopes","scopes","notifySubscribers","onScopesChange","callback","onScopesChangeCallbacks","cb","getMetricName","visTheme","theme2","visualization","getColorByName","palette","MAX_ADHOC_VARIABLE_OPTIONS","dataTrail","limitedFilterVariable","getTagKeysProvider","opts","getTagValuesProvider","_","check","returnType","obj","Intl","Collator","compare","truncateValue","maxLength","DataTrailCard","onDelete","cardHeightClassName","compactHeight","cardTall","cardClassName","card","wide","cardWide","article","Card","Heading","metricValue","Meta","secondaryFont","primaryFont","deleteButton","SecondaryActions","date","dateTimeFormat","wordBreak","borderTop","borderRight","gridArea","letterSpacing","bottom","listeners","emit","listener","bookmarksList","paddingRight","emptyState","setLastDelete","bannerTitle","br","PROMETHEUS_DATA_SOURCE_REGEX","DataSourceFetcher","cachedDataSources","cache","pendingRequest","pendingRequests","fetchHealthyDataSources","allDataSourcesOfType","getList","healthyDataSources","unhealthyDataSources","health","dataSourceFetcherSingleton","Wingman","lazy","TrailRedirect","Navigate","AppRoutes","useContext","Routes","Route","element","Trail"],"sourceRoot":""}